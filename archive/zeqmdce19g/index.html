<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="只为那句承诺-大话Promise"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>只为那句承诺-大话Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/zeqmdce19g/",
				"appid": "1613049289050283", 
				"title": "只为那句承诺-大话Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/zycj05a4m2d/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/zotepw8io9o/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&text=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&text=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&title=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&is_video=false&description=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&title=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&title=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&title=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fzeqmdce19g%2f&title=%e5%8f%aa%e4%b8%ba%e9%82%a3%e5%8f%a5%e6%89%bf%e8%af%ba-%e5%a4%a7%e8%af%9dPromise"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">只为那句承诺-大话Promise</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e大家周末好，要说最近几年什么语言大红大紫，当属JavaScript了。话说虽然是10天就创造出的语言，但是人家能文能武。web前端自然不必多说了，各种框架你方登罢我上场，前两年还是Angular一统天下，这两年React又是大红大紫，还有Vue最近异军突起，好不红火。要是仅仅是前端也就算了，但是由于Node.js人家在后台也能写，React Native的出现让人家移动端也能做。好吧，还有硬件上也出现Ruff方案，好像硬件上也能写了。真是让人感觉挺有意思的事情。\x3c\/p\x3e\n\x3cp\x3e图表君上边叨叨了这么多，难道是为JavaScript唱赞歌的吗？呵呵，其实并不是。只是最近因为在用上篇文章介绍的AWS Lambda。Lambda现在只支持Java，Node.js,Python。最终选择了Node.js进行开发，不可避免的要牵扯到异步操作的问题。那么今天就来聊聊JavaScript中的Promise。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e什么是Promise\x3c\/h2\x3e\n\x3cblockquote\x3e\n\x3cp\x3ePromise是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6将其写进了语言标准，统一了用法，原生提供了Promise对象。\x3c\/p\x3e\n\x3cp\x3e所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise是一个对象，从它可以获取异步操作的消息。Promise提供统一的API，各种异步操作都可以用同样的方法进行处理。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e上面是Promise的一个定义，引自阮一峰的ES6标准入门一书。\x3ca href=\x22http:\/\/es6.ruanyifeng.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eS6标准入门\x3c\/a\x3e。多说一句，目前的JavaScript项目无论是前台或者是后台，都应该采用ES6的标准语法来写，ES6让JavaScript的书写更加的清晰和规范。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e基本用法\x3c\/h2\x3e\n\x3cp\x3e如何来构造一个promise对象呢？ES6中提供了原生Promise可以使用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var promise = new Promise(function(resolve, reject) {\n  \/\/ ... here is some code\n\n  if (\/* 异步操作成功 *\/){\n    resolve(value);\n  } else {\n    reject(error);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... here is some code\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-comment\x22\x3e\/* 异步操作成功 *\/\x3c\/span\x3e){\n    resolve(value);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    reject(error);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的例子给出了new一个promise对象的方法，Promise的构造函数接受一个函数作为参数传入，这个函数的两个参数，reject和resolve是JavaScript本身提供的两个函数。\x3cbr\x3e一个promise对象有三个状态分别是，pending，resolved，rejected。resolve函数可以将pending状态转变为resolved状态。reject函数可以讲pending状态转变了rejected状态。对象的状态不受外界的影响，同样也是promise名字的由来。外部你拿着我的一个承诺，一会我会告诉你我的状态。\x3c\/p\x3e\n\x3cp\x3epromise对象通过then方法来添加回调函数。例如这样\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22promise.then(data=\x3e console.log(data), err=\x3e console.log(err));\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3epromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e=\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data), \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e=\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(err));\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当promise被resolved的时候，就会把data log出来。当promise被rejected的时候，err就会被log出来。\x3cbr\x3e看上去好像是挺简单的，的确Promise的应用使得异步的操作，以同步的形式表现出来。当发生错误的时候可以通过catch方法，来定义回调函数。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e怎么用\x3c\/h2\x3e\n\x3cp\x3e上边都是一些干巴巴的定义，那么到底该怎么用呢？Promise又怎么样的解决了问题呢，下边我们看一个例子。假设下边一个场景，我们一个服务，从一个外边service获取数据，然后写到一个db里，或者一个存储里，最后在把存储的状态龙出来，那么如果没有promise是怎么写的呢？可能会是这样。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22getData(function (value1) {\n  storeToDb(value1, function(value2) {\n    logStore(value2, function(value3) {\n      \/\/...\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3egetData(\x3cspan class=\x22hljs-name\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-name\x22\x3evalue1\x3c\/span\x3e) {\n  storeToDb(\x3cspan class=\x22hljs-name\x22\x3evalue1\x3c\/span\x3e, function(\x3cspan class=\x22hljs-name\x22\x3evalue2\x3c\/span\x3e) {\n    logStore(\x3cspan class=\x22hljs-name\x22\x3evalue2\x3c\/span\x3e, function(\x3cspan class=\x22hljs-name\x22\x3evalue3\x3c\/span\x3e) {\n      \/\/...\n    })\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n  })\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n})\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e传统的回调的写法，这样使得代码逻辑混乱在一起。再想想如果再加上错误处理的情况，更是酸爽。那么用promise来写会怎么样呢？看下边这样的代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getData(){\n    return new Promise((resolve,reject) =\x3e{\n        \/\/ ... send request to get data\n        \n        if(\/* get successfully*\/){\n            resolve(data)\n        }else{\n            reject(err)\n        }\n    })\n}\n\nfunction storeData(data){\n    return new Promise((resolve,reject)=\x3e{\n        \/\/ ... store the data\n        \n        if(\/*store successfully*\/){\n            resolve(data)\n        }else{\n            reject(err)\n        }\n    })\n}\n\n\ngetData()\n    .then(data =\x3e storeData(data))\n    .then(data =\x3e console.log(\x27the process is done\x27,data));\n    .catch(err =\x3e console.error(\x27there is the err\x27,err));\n\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... send request to get data\x3c\/span\x3e\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/* get successfully*\/\x3c\/span\x3e){\n            resolve(data)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            reject(err)\n        }\n    })\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3estoreData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve,reject\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ... store the data\x3c\/span\x3e\n        \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-comment\x22\x3e\/*store successfully*\/\x3c\/span\x3e){\n            resolve(data)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            reject(err)\n        }\n    })\n}\n\n\ngetData()\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e storeData(data))\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27the process is done\x27\x3c\/span\x3e,data));\n    .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27there is the err\x27\x3c\/span\x3e,err));\n\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样写是不是就是很清楚了，先getData，然后再storeData，最后将这次运行的情况log了出来，其中有任何的问题，在catch中都可以Catch出来。代码的逻辑以同步的方式得到了体现。我们来看看如果是其他语言会怎么写，下边是个ruby的语言的例子\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22def get_data \n    \/\/ ...send request\n    \n    if \/*get successfully *\/\n        return data\n    else\n        raise GetDataError\n    end\nend\n\n\ndef store_data\n    \/\/ ...save to db\n    \n    if \/*save successfully *\/\n        return data\n    else\n        raise StoreDataError\n    end\nend\n\n\n\/*Main Logic*\/\nbegin\n    request_data = get_data\n    db_data = store_data request_data\n    p \x26quot;here is the store data #{db_data}\x26quot;\nrescue e\n    p \x26quot;here is some errors #{e}\x26quot;\nend\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode\x3edef get_data \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...send request\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-built_in\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*get successfully *\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e data\n    \x3cspan class=\x22hljs-built_in\x22\x3eelse\x3c\/span\x3e\n        raise GetDataError\n    \x3cspan class=\x22hljs-built_in\x22\x3eend\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eend\x3c\/span\x3e\n\n\ndef store_data\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...save to db\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-built_in\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*save successfully *\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e data\n    \x3cspan class=\x22hljs-built_in\x22\x3eelse\x3c\/span\x3e\n        raise StoreDataError\n    \x3cspan class=\x22hljs-built_in\x22\x3eend\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eend\x3c\/span\x3e\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*Main Logic*\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ebegin\x3c\/span\x3e\n    request_data = get_data\n    db_data = store_data request_data\n    p \x3cspan class=\x22hljs-string\x22\x3e\x22here is the store data #{db_data}\x22\x3c\/span\x3e\nrescue e\n    p \x3cspan class=\x22hljs-string\x22\x3e\x22here is some errors #{e}\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eend\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们对比两个例子，可以看到在使用的Promise后让JavaScript的异步方式的编程模式更将清楚，也更加让人容易理解。\x3c\/p\x3e\n\x3cp\x3e由于JavaScript的执行环境是单线程的，所以大量采用了异步的方式来进行编程，这使得我们写起代码并不十分符合我们一般的习惯。但是Promise的出现让这种问题能得到一定程度的缓解。\x3c\/p\x3e\n\x3cp\x3e但是异步操作异步操作的好处，比如上边的那个例子，如果我们想要做的同时并发10个操作，那个在ruby或者其他语言中中就要启多个线程来进行。但是JavaScript就完全没有这个问题。只要简单的loop下就行了。\x3c\/p\x3e\n\x3cp\x3e但是如果我们想要在这10个操作完成后根据返回的状态做点其他操作该怎么做呢？这时候用Promise.all就是最好的了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let p = Promise.all([p1, p2, p3]);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs armasm\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-symbol\x22\x3elet\x3c\/span\x3e p = Promise.all([\x3cspan class=\x22hljs-built_in\x22\x3ep1\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3ep2\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3ep3\x3c\/span\x3e])\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ePromise.all接受数组作为参数传入，每个元素都是一个promise对象。只要所有子promise都resolved以后，p才会被resolved。只要有一个被rejected，这个p就会被rejected。但是有一点是这些子promise之间并不会有顺序的关系。再来看一个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var guid = 0;\nfunction run() {\n  guid\x2b\x2b;\n  var id = guid;\n  return new Promise(resolve =\x3e {\n    setTimeout(function () {\n      console.log(id);\n      resolve(id);\n    }, (Math.random() * 1.5 | 0) * 1000);\n  });\n}\n\nvar promises = Array.from({ length: 10 }, run);\nPromise.all(promises)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e guid = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  guid\x2b\x2b;\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e id = guid;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(id);\n      resolve(id);\n    }, (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random() * \x3cspan class=\x22hljs-number\x22\x3e1.5\x3c\/span\x3e | \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n  });\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promises = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.from({ \x3cspan class=\x22hljs-attr\x22\x3elength\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e }, run);\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all(promises)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eOUTPUT:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x222\n3\n5\n6\n7\n8\n10\n1\n4\n9\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从这次的output可以看到，promise之间并没有顺序执行，实际上是并发的。那么如何让这些promise是顺序执行呢？留个大家自己思考下，下篇文章，我们揭晓。或者可以联系图表君，私下告诉你答案哦。                                         \x3cbr\x3eps，当然也可以用一些第三方的库和方案，例如（async）来实现顺序操作，但是代码的乐趣不就是做些思维挑战吗:)\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e原创文章，欢迎转发，但请标明出处。欢迎关注图表君的公众号，一起成长。在微信中搜索 “多彩数据” 或者 “Data_Visualization”\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDMT9?w=258\x26amp;h=258\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDMT9?w=258\x26amp;h=258\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>只为那句承诺-大话Promise</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007327247">https://segmentfault.com/a/1190000007327247</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/zeqmdce19g/" target="_blank">https://alili.tech/archive/zeqmdce19g/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>