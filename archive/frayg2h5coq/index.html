<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React系列——react-redux之connect方法解析"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React系列——react-redux之connect方法解析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/frayg2h5coq/",
				"appid": "1613049289050283", 
				"title": "React系列——react-redux之connect方法解析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-08T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/sjq42hew0j/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/f6fgcyt1lb/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&text=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&text=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&title=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&is_video=false&description=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&title=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&title=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&title=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ffrayg2h5coq%2f&title=React%e7%b3%bb%e5%88%97%e2%80%94%e2%80%94react-redux%e4%b9%8bconnect%e6%96%b9%e6%b3%95%e8%a7%a3%e6%9e%90"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React系列——react-redux之connect方法解析</h1><div class="meta"><div class="postdate"><time datetime="2019-01-08" itemprop="datePublished">2019-01-08</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch4\x3econnect简介\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e前方高能预警，有耐心才能看完文章！！\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3ereact-redux仅有2个API，Provider和connect，Provider提供的是一个顶层容器的作用，实现store的上下文传递。\x3c\/p\x3e\n\x3cp\x3econnect方法比较复杂，虽然代码只有368行，但是为redux中常用的功能实现了和react连接的建立。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e一个基础的connect方法如下：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22connect(mapStateToProps, mapDispatchToProps, mergeProps, options = {}) \n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3econnect\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(mapStateToProps, mapDispatchToProps, mergeProps, options = {})\x3c\/span\x3e\x3c\/span\x3e \n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e为什么我们需要react-redux？\x3c\/h4\x3e\n\x3cp\x3e熟悉redux的人可能知道，redux是数据存储和管理的工具，但是想要在react中使用redux，并不能直接将store、action和react组件建立连接，所以就需要react-redux来结合react和redux。\x3c\/p\x3e\n\x3cp\x3ereact-redux文件体积非常小，你完全不需要担心给你的项目带来太多的垃圾代码。\x3c\/p\x3e\n\x3ch4\x3e从何处开始解析react-redux源码？\x3c\/h4\x3e\n\x3cp\x3e1、在JavaScript中，读懂别人的代码文件，你首先应该看的是函数的入口。\x3c\/p\x3e\n\x3cp\x3e2、找到函数入口，然后看有哪些参数。\x3c\/p\x3e\n\x3cp\x3e3、看看导入了哪些额外的插件，每个插件的作用大概预测一下。\x3c\/p\x3e\n\x3cp\x3e4、进入函数体进行解读。在react插件中解读函数有一个好处，就是react插件大部分都是采用了react组件的写法，你可以在react插件中看到很多react组件的影子。而不是像jQuery那样到处都是扩展性的方法，每个方法都有自己的设计模式，没有统一的规律可循。\x3c\/p\x3e\n\x3ch4\x3ereact-redux使用场景\x3c\/h4\x3e\n\x3cp\x3e下面这个官方例子展示了mapStateToProps和mapDispatchToProps的使用方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import * as todoActionCreators from \x27.\/todoActionCreators\x27\nimport * as counterActionCreators from \x27.\/counterActionCreators\x27\nimport { bindActionCreators } from \x27redux\x27\n\nfunction mapStateToProps(state) {\n  return { todos: state.todos }\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    todoActions: bindActionCreators(todoActionCreators, dispatch),\n    counterActions: bindActionCreators(counterActionCreators, dispatch)\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TodoApp)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e todoActionCreators \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/todoActionCreators\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e counterActionCreators \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/counterActionCreators\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { bindActionCreators } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emapStateToProps\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3etodos\x3c\/span\x3e: state.todos }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emapDispatchToProps\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3etodoActions\x3c\/span\x3e: bindActionCreators(todoActionCreators, dispatch),\n    \x3cspan class=\x22hljs-attr\x22\x3ecounterActions\x3c\/span\x3e: bindActionCreators(counterActionCreators, dispatch)\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(mapStateToProps, mapDispatchToProps)(TodoApp)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emergeProps的用法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import * as actionCreators from \x27.\/actionCreators\x27\n\nfunction mapStateToProps(state) {\n  return { todos: state.todos }\n}\n\nfunction mergeProps(stateProps, dispatchProps, ownProps) {\n  return Object.assign({}, ownProps, {\n    todos: stateProps.todos[ownProps.userId],\n    addTodo: (text) =\x3e dispatchProps.addTodo(ownProps.userId, text)\n  })\n}\n\nexport default connect(mapStateToProps, actionCreators, mergeProps)(TodoApp)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3eimport * as actionCreators \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x27.\/actionCreators\x27\n\nfunction mapStateToProps(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e) {\n  return { todos: \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e.todos }\n}\n\nfunction mergeProps(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps, dispatchProps, ownProps) {\n  return Object.assign({}, ownProps, {\n    todos: \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps.todos[ownProps.\x3cspan class=\x22hljs-keyword\x22\x3euser\x3c\/span\x3eId],\n    addTodo: (text) =\x26gt; dispatchProps.addTodo(ownProps.\x3cspan class=\x22hljs-keyword\x22\x3euser\x3c\/span\x3eId, text)\n  })\n}\n\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(mapStateToProps, actionCreators, mergeProps)(TodoApp)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3econnect源码解析\x3c\/h4\x3e\n\x3cp\x3e\x3cstrong\x3e源码有点长，你可以选择性的查看：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { Component, createElement } from \x27react\x27\nimport storeShape from \x27..\/utils\/storeShape\x27\nimport shallowEqual from \x27..\/utils\/shallowEqual\x27\nimport wrapActionCreators from \x27..\/utils\/wrapActionCreators\x27\nimport warning from \x27..\/utils\/warning\x27\nimport isPlainObject from \x27lodash\/isPlainObject\x27\nimport hoistStatics from \x27hoist-non-react-statics\x27\nimport invariant from \x27invariant\x27\n\nconst defaultMapStateToProps = state =\x3e ({}) \/\/ eslint-disable-line no-unused-vars\nconst defaultMapDispatchToProps = dispatch =\x3e ({ dispatch })\nconst defaultMergeProps = (stateProps, dispatchProps, parentProps) =\x3e ({\n  ...parentProps,\n  ...stateProps,\n  ...dispatchProps\n})\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || \x27Component\x27\n}\n\nlet errorObject = { value: null }\nfunction tryCatch(fn, ctx) {\n  try {\n    return fn.apply(ctx)\n  } catch (e) {\n    errorObject.value = e\n    return errorObject\n  }\n}\n\n\/\/ Helps track hot reloading.\nlet nextVersion = 0\n\nexport default function connect(mapStateToProps, mapDispatchToProps, mergeProps, options = {}) {\n  const shouldSubscribe = Boolean(mapStateToProps)\n  const mapState = mapStateToProps || defaultMapStateToProps\n\n  let mapDispatch\n  if (typeof mapDispatchToProps === \x27function\x27) {\n    mapDispatch = mapDispatchToProps\n  } else if (!mapDispatchToProps) {\n    mapDispatch = defaultMapDispatchToProps\n  } else {\n    mapDispatch = wrapActionCreators(mapDispatchToProps)\n  }\n\n  const finalMergeProps = mergeProps || defaultMergeProps\n  const { pure = true, withRef = false } = options\n  const checkMergedEquals = pure \x26amp;\x26amp; finalMergeProps !== defaultMergeProps\n\n  \/\/ Helps track hot reloading.\n  const version = nextVersion\x2b\x2b\n\n  return function wrapWithConnect(WrappedComponent) {\n    const connectDisplayName = `Connect(${getDisplayName(WrappedComponent)})`\n\n    function checkStateShape(props, methodName) {\n      if (!isPlainObject(props)) {\n        warning(\n          `${methodName}() in ${connectDisplayName} must return a plain object. ` \x2b\n          `Instead received ${props}.`\n        )\n      }\n    }\n\n    function computeMergedProps(stateProps, dispatchProps, parentProps) {\n      const mergedProps = finalMergeProps(stateProps, dispatchProps, parentProps)\n      if (process.env.NODE_ENV !== \x27production\x27) {\n        checkStateShape(mergedProps, \x27mergeProps\x27)\n      }\n      return mergedProps\n    }\n\n    class Connect extends Component {\n      shouldComponentUpdate() {\n        return !pure || this.haveOwnPropsChanged || this.hasStoreStateChanged\n      }\n\n      constructor(props, context) {\n        super(props, context)\n        this.version = version\n        this.store = props.store || context.store\n\n        invariant(this.store,\n          `Could not find \x26quot;store\x26quot; in either the context or ` \x2b\n          `props of \x26quot;${connectDisplayName}\x26quot;. ` \x2b\n          `Either wrap the root component in a \x3cProvider\x3e, ` \x2b\n          `or explicitly pass \x26quot;store\x26quot; as a prop to \x26quot;${connectDisplayName}\x26quot;.`\n        )\n\n        const storeState = this.store.getState()\n        this.state = { storeState }\n        this.clearCache()\n      }\n\n      computeStateProps(store, props) {\n        if (!this.finalMapStateToProps) {\n          return this.configureFinalMapState(store, props)\n        }\n\n        const state = store.getState()\n        const stateProps = this.doStatePropsDependOnOwnProps ?\n          this.finalMapStateToProps(state, props) :\n          this.finalMapStateToProps(state)\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(stateProps, \x27mapStateToProps\x27)\n        }\n        return stateProps\n      }\n\n      configureFinalMapState(store, props) {\n        const mappedState = mapState(store.getState(), props)\n        const isFactory = typeof mappedState === \x27function\x27\n\n        this.finalMapStateToProps = isFactory ? mappedState : mapState\n        this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1\n\n        if (isFactory) {\n          return this.computeStateProps(store, props)\n        }\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(mappedState, \x27mapStateToProps\x27)\n        }\n        return mappedState\n      }\n\n      computeDispatchProps(store, props) {\n        if (!this.finalMapDispatchToProps) {\n          return this.configureFinalMapDispatch(store, props)\n        }\n\n        const { dispatch } = store\n        const dispatchProps = this.doDispatchPropsDependOnOwnProps ?\n          this.finalMapDispatchToProps(dispatch, props) :\n          this.finalMapDispatchToProps(dispatch)\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(dispatchProps, \x27mapDispatchToProps\x27)\n        }\n        return dispatchProps\n      }\n\n      configureFinalMapDispatch(store, props) {\n        const mappedDispatch = mapDispatch(store.dispatch, props)\n        const isFactory = typeof mappedDispatch === \x27function\x27\n\n        this.finalMapDispatchToProps = isFactory ? mappedDispatch : mapDispatch\n        this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1\n\n        if (isFactory) {\n          return this.computeDispatchProps(store, props)\n        }\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(mappedDispatch, \x27mapDispatchToProps\x27)\n        }\n        return mappedDispatch\n      }\n\n      updateStatePropsIfNeeded() {\n        const nextStateProps = this.computeStateProps(this.store, this.props)\n        if (this.stateProps \x26amp;\x26amp; shallowEqual(nextStateProps, this.stateProps)) {\n          return false\n        }\n\n        this.stateProps = nextStateProps\n        return true\n      }\n\n      updateDispatchPropsIfNeeded() {\n        const nextDispatchProps = this.computeDispatchProps(this.store, this.props)\n        if (this.dispatchProps \x26amp;\x26amp; shallowEqual(nextDispatchProps, this.dispatchProps)) {\n          return false\n        }\n\n        this.dispatchProps = nextDispatchProps\n        return true\n      }\n\n      updateMergedPropsIfNeeded() {\n        const nextMergedProps = computeMergedProps(this.stateProps, this.dispatchProps, this.props)\n        if (this.mergedProps \x26amp;\x26amp; checkMergedEquals \x26amp;\x26amp; shallowEqual(nextMergedProps, this.mergedProps)) {\n          return false\n        }\n\n        this.mergedProps = nextMergedProps\n        return true\n      }\n\n      isSubscribed() {\n        return typeof this.unsubscribe === \x27function\x27\n      }\n\n      trySubscribe() {\n        if (shouldSubscribe \x26amp;\x26amp; !this.unsubscribe) {\n          this.unsubscribe = this.store.subscribe(this.handleChange.bind(this))\n          this.handleChange()\n        }\n      }\n\n      tryUnsubscribe() {\n        if (this.unsubscribe) {\n          this.unsubscribe()\n          this.unsubscribe = null\n        }\n      }\n\n      componentDidMount() {\n        this.trySubscribe()\n      }\n\n      componentWillReceiveProps(nextProps) {\n        if (!pure || !shallowEqual(nextProps, this.props)) {\n          this.haveOwnPropsChanged = true\n        }\n      }\n\n      componentWillUnmount() {\n        this.tryUnsubscribe()\n        this.clearCache()\n      }\n\n      clearCache() {\n        this.dispatchProps = null\n        this.stateProps = null\n        this.mergedProps = null\n        this.haveOwnPropsChanged = true\n        this.hasStoreStateChanged = true\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n        this.renderedElement = null\n        this.finalMapDispatchToProps = null\n        this.finalMapStateToProps = null\n      }\n\n      handleChange() {\n        if (!this.unsubscribe) {\n          return\n        }\n\n        const storeState = this.store.getState()\n        const prevStoreState = this.state.storeState\n        if (pure \x26amp;\x26amp; prevStoreState === storeState) {\n          return\n        }\n\n        if (pure \x26amp;\x26amp; !this.doStatePropsDependOnOwnProps) {\n          const haveStatePropsChanged = tryCatch(this.updateStatePropsIfNeeded, this)\n          if (!haveStatePropsChanged) {\n            return\n          }\n          if (haveStatePropsChanged === errorObject) {\n            this.statePropsPrecalculationError = errorObject.value\n          }\n          this.haveStatePropsBeenPrecalculated = true\n        }\n\n        this.hasStoreStateChanged = true\n        this.setState({ storeState })\n      }\n\n      getWrappedInstance() {\n        invariant(withRef,\n          `To access the wrapped instance, you need to specify ` \x2b\n          `{ withRef: true } as the fourth argument of the connect() call.`\n        )\n\n        return this.refs.wrappedInstance\n      }\n\n      render() {\n        const {\n          haveOwnPropsChanged,\n          hasStoreStateChanged,\n          haveStatePropsBeenPrecalculated,\n          statePropsPrecalculationError,\n          renderedElement\n        } = this\n\n        this.haveOwnPropsChanged = false\n        this.hasStoreStateChanged = false\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n\n        if (statePropsPrecalculationError) {\n          throw statePropsPrecalculationError\n        }\n\n        let shouldUpdateStateProps = true\n        let shouldUpdateDispatchProps = true\n        if (pure \x26amp;\x26amp; renderedElement) {\n          shouldUpdateStateProps = hasStoreStateChanged || (\n            haveOwnPropsChanged \x26amp;\x26amp; this.doStatePropsDependOnOwnProps\n          )\n          shouldUpdateDispatchProps =\n            haveOwnPropsChanged \x26amp;\x26amp; this.doDispatchPropsDependOnOwnProps\n        }\n\n        let haveStatePropsChanged = false\n        let haveDispatchPropsChanged = false\n        if (haveStatePropsBeenPrecalculated) {\n          haveStatePropsChanged = true\n        } else if (shouldUpdateStateProps) {\n          haveStatePropsChanged = this.updateStatePropsIfNeeded()\n        }\n        if (shouldUpdateDispatchProps) {\n          haveDispatchPropsChanged = this.updateDispatchPropsIfNeeded()\n        }\n\n        let haveMergedPropsChanged = true\n        if (\n          haveStatePropsChanged ||\n          haveDispatchPropsChanged ||\n          haveOwnPropsChanged\n        ) {\n          haveMergedPropsChanged = this.updateMergedPropsIfNeeded()\n        } else {\n          haveMergedPropsChanged = false\n        }\n\n        if (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n          return renderedElement\n        }\n\n        if (withRef) {\n          this.renderedElement = createElement(WrappedComponent, {\n            ...this.mergedProps,\n            ref: \x27wrappedInstance\x27\n          })\n        } else {\n          this.renderedElement = createElement(WrappedComponent,\n            this.mergedProps\n          )\n        }\n\n        return this.renderedElement\n      }\n    }\n\n    Connect.displayName = connectDisplayName\n    Connect.WrappedComponent = WrappedComponent\n    Connect.contextTypes = {\n      store: storeShape\n    }\n    Connect.propTypes = {\n      store: storeShape\n    }\n\n    if (process.env.NODE_ENV !== \x27production\x27) {\n      Connect.prototype.componentWillUpdate = function componentWillUpdate() {\n        if (this.version === version) {\n          return\n        }\n\n        \/\/ We are hot reloading!\n        this.version = version\n        this.trySubscribe()\n        this.clearCache()\n      }\n    }\n\n    return hoistStatics(Connect, WrappedComponent)\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre\x3e\x3ccode\x3eimport { Component, createElement } from \x27react\x27\nimport storeShape from \x27..\/utils\/storeShape\x27\nimport shallowEqual from \x27..\/utils\/shallowEqual\x27\nimport wrapActionCreators from \x27..\/utils\/wrapActionCreators\x27\nimport warning from \x27..\/utils\/warning\x27\nimport isPlainObject from \x27lodash\/isPlainObject\x27\nimport hoistStatics from \x27hoist-non-react-statics\x27\nimport invariant from \x27invariant\x27\n\nconst defaultMapStateToProps = state =\x26gt; ({}) \/\/ eslint-disable-line no-unused-vars\nconst defaultMapDispatchToProps = dispatch =\x26gt; ({ dispatch })\nconst defaultMergeProps = (stateProps, dispatchProps, parentProps) =\x26gt; ({\n  ...parentProps,\n  ...stateProps,\n  ...dispatchProps\n})\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || \x27Component\x27\n}\n\nlet errorObject = { value: null }\nfunction tryCatch(fn, ctx) {\n  try {\n    return fn.apply(ctx)\n  } catch (e) {\n    errorObject.value = e\n    return errorObject\n  }\n}\n\n\/\/ Helps track hot reloading.\nlet nextVersion = 0\n\nexport default function connect(mapStateToProps, mapDispatchToProps, mergeProps, options = {}) {\n  const shouldSubscribe = Boolean(mapStateToProps)\n  const mapState = mapStateToProps || defaultMapStateToProps\n\n  let mapDispatch\n  if (typeof mapDispatchToProps === \x27function\x27) {\n    mapDispatch = mapDispatchToProps\n  } else if (!mapDispatchToProps) {\n    mapDispatch = defaultMapDispatchToProps\n  } else {\n    mapDispatch = wrapActionCreators(mapDispatchToProps)\n  }\n\n  const finalMergeProps = mergeProps || defaultMergeProps\n  const { pure = true, withRef = false } = options\n  const checkMergedEquals = pure \x26amp;\x26amp; finalMergeProps !== defaultMergeProps\n\n  \/\/ Helps track hot reloading.\n  const version = nextVersion\x2b\x2b\n\n  return function wrapWithConnect(WrappedComponent) {\n    const connectDisplayName = `Connect(${getDisplayName(WrappedComponent)})`\n\n    function checkStateShape(props, methodName) {\n      if (!isPlainObject(props)) {\n        warning(\n          `${methodName}() in ${connectDisplayName} must return a plain object. ` \x2b\n          `Instead received ${props}.`\n        )\n      }\n    }\n\n    function computeMergedProps(stateProps, dispatchProps, parentProps) {\n      const mergedProps = finalMergeProps(stateProps, dispatchProps, parentProps)\n      if (process.env.NODE_ENV !== \x27production\x27) {\n        checkStateShape(mergedProps, \x27mergeProps\x27)\n      }\n      return mergedProps\n    }\n\n    class Connect extends Component {\n      shouldComponentUpdate() {\n        return !pure || this.haveOwnPropsChanged || this.hasStoreStateChanged\n      }\n\n      constructor(props, context) {\n        super(props, context)\n        this.version = version\n        this.store = props.store || context.store\n\n        invariant(this.store,\n          `Could not find \x22store\x22 in either the context or ` \x2b\n          `props of \x22${connectDisplayName}\x22. ` \x2b\n          `Either wrap the root component in a \x26lt;Provider\x26gt;, ` \x2b\n          `or explicitly pass \x22store\x22 as a prop to \x22${connectDisplayName}\x22.`\n        )\n\n        const storeState = this.store.getState()\n        this.state = { storeState }\n        this.clearCache()\n      }\n\n      computeStateProps(store, props) {\n        if (!this.finalMapStateToProps) {\n          return this.configureFinalMapState(store, props)\n        }\n\n        const state = store.getState()\n        const stateProps = this.doStatePropsDependOnOwnProps ?\n          this.finalMapStateToProps(state, props) :\n          this.finalMapStateToProps(state)\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(stateProps, \x27mapStateToProps\x27)\n        }\n        return stateProps\n      }\n\n      configureFinalMapState(store, props) {\n        const mappedState = mapState(store.getState(), props)\n        const isFactory = typeof mappedState === \x27function\x27\n\n        this.finalMapStateToProps = isFactory ? mappedState : mapState\n        this.doStatePropsDependOnOwnProps = this.finalMapStateToProps.length !== 1\n\n        if (isFactory) {\n          return this.computeStateProps(store, props)\n        }\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(mappedState, \x27mapStateToProps\x27)\n        }\n        return mappedState\n      }\n\n      computeDispatchProps(store, props) {\n        if (!this.finalMapDispatchToProps) {\n          return this.configureFinalMapDispatch(store, props)\n        }\n\n        const { dispatch } = store\n        const dispatchProps = this.doDispatchPropsDependOnOwnProps ?\n          this.finalMapDispatchToProps(dispatch, props) :\n          this.finalMapDispatchToProps(dispatch)\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(dispatchProps, \x27mapDispatchToProps\x27)\n        }\n        return dispatchProps\n      }\n\n      configureFinalMapDispatch(store, props) {\n        const mappedDispatch = mapDispatch(store.dispatch, props)\n        const isFactory = typeof mappedDispatch === \x27function\x27\n\n        this.finalMapDispatchToProps = isFactory ? mappedDispatch : mapDispatch\n        this.doDispatchPropsDependOnOwnProps = this.finalMapDispatchToProps.length !== 1\n\n        if (isFactory) {\n          return this.computeDispatchProps(store, props)\n        }\n\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          checkStateShape(mappedDispatch, \x27mapDispatchToProps\x27)\n        }\n        return mappedDispatch\n      }\n\n      updateStatePropsIfNeeded() {\n        const nextStateProps = this.computeStateProps(this.store, this.props)\n        if (this.stateProps \x26amp;\x26amp; shallowEqual(nextStateProps, this.stateProps)) {\n          return false\n        }\n\n        this.stateProps = nextStateProps\n        return true\n      }\n\n      updateDispatchPropsIfNeeded() {\n        const nextDispatchProps = this.computeDispatchProps(this.store, this.props)\n        if (this.dispatchProps \x26amp;\x26amp; shallowEqual(nextDispatchProps, this.dispatchProps)) {\n          return false\n        }\n\n        this.dispatchProps = nextDispatchProps\n        return true\n      }\n\n      updateMergedPropsIfNeeded() {\n        const nextMergedProps = computeMergedProps(this.stateProps, this.dispatchProps, this.props)\n        if (this.mergedProps \x26amp;\x26amp; checkMergedEquals \x26amp;\x26amp; shallowEqual(nextMergedProps, this.mergedProps)) {\n          return false\n        }\n\n        this.mergedProps = nextMergedProps\n        return true\n      }\n\n      isSubscribed() {\n        return typeof this.unsubscribe === \x27function\x27\n      }\n\n      trySubscribe() {\n        if (shouldSubscribe \x26amp;\x26amp; !this.unsubscribe) {\n          this.unsubscribe = this.store.subscribe(this.handleChange.bind(this))\n          this.handleChange()\n        }\n      }\n\n      tryUnsubscribe() {\n        if (this.unsubscribe) {\n          this.unsubscribe()\n          this.unsubscribe = null\n        }\n      }\n\n      componentDidMount() {\n        this.trySubscribe()\n      }\n\n      componentWillReceiveProps(nextProps) {\n        if (!pure || !shallowEqual(nextProps, this.props)) {\n          this.haveOwnPropsChanged = true\n        }\n      }\n\n      componentWillUnmount() {\n        this.tryUnsubscribe()\n        this.clearCache()\n      }\n\n      clearCache() {\n        this.dispatchProps = null\n        this.stateProps = null\n        this.mergedProps = null\n        this.haveOwnPropsChanged = true\n        this.hasStoreStateChanged = true\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n        this.renderedElement = null\n        this.finalMapDispatchToProps = null\n        this.finalMapStateToProps = null\n      }\n\n      handleChange() {\n        if (!this.unsubscribe) {\n          return\n        }\n\n        const storeState = this.store.getState()\n        const prevStoreState = this.state.storeState\n        if (pure \x26amp;\x26amp; prevStoreState === storeState) {\n          return\n        }\n\n        if (pure \x26amp;\x26amp; !this.doStatePropsDependOnOwnProps) {\n          const haveStatePropsChanged = tryCatch(this.updateStatePropsIfNeeded, this)\n          if (!haveStatePropsChanged) {\n            return\n          }\n          if (haveStatePropsChanged === errorObject) {\n            this.statePropsPrecalculationError = errorObject.value\n          }\n          this.haveStatePropsBeenPrecalculated = true\n        }\n\n        this.hasStoreStateChanged = true\n        this.setState({ storeState })\n      }\n\n      getWrappedInstance() {\n        invariant(withRef,\n          `To access the wrapped instance, you need to specify ` \x2b\n          `{ withRef: true } as the fourth argument of the connect() call.`\n        )\n\n        return this.refs.wrappedInstance\n      }\n\n      render() {\n        const {\n          haveOwnPropsChanged,\n          hasStoreStateChanged,\n          haveStatePropsBeenPrecalculated,\n          statePropsPrecalculationError,\n          renderedElement\n        } = this\n\n        this.haveOwnPropsChanged = false\n        this.hasStoreStateChanged = false\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n\n        if (statePropsPrecalculationError) {\n          throw statePropsPrecalculationError\n        }\n\n        let shouldUpdateStateProps = true\n        let shouldUpdateDispatchProps = true\n        if (pure \x26amp;\x26amp; renderedElement) {\n          shouldUpdateStateProps = hasStoreStateChanged || (\n            haveOwnPropsChanged \x26amp;\x26amp; this.doStatePropsDependOnOwnProps\n          )\n          shouldUpdateDispatchProps =\n            haveOwnPropsChanged \x26amp;\x26amp; this.doDispatchPropsDependOnOwnProps\n        }\n\n        let haveStatePropsChanged = false\n        let haveDispatchPropsChanged = false\n        if (haveStatePropsBeenPrecalculated) {\n          haveStatePropsChanged = true\n        } else if (shouldUpdateStateProps) {\n          haveStatePropsChanged = this.updateStatePropsIfNeeded()\n        }\n        if (shouldUpdateDispatchProps) {\n          haveDispatchPropsChanged = this.updateDispatchPropsIfNeeded()\n        }\n\n        let haveMergedPropsChanged = true\n        if (\n          haveStatePropsChanged ||\n          haveDispatchPropsChanged ||\n          haveOwnPropsChanged\n        ) {\n          haveMergedPropsChanged = this.updateMergedPropsIfNeeded()\n        } else {\n          haveMergedPropsChanged = false\n        }\n\n        if (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n          return renderedElement\n        }\n\n        if (withRef) {\n          this.renderedElement = createElement(WrappedComponent, {\n            ...this.mergedProps,\n            ref: \x27wrappedInstance\x27\n          })\n        } else {\n          this.renderedElement = createElement(WrappedComponent,\n            this.mergedProps\n          )\n        }\n\n        return this.renderedElement\n      }\n    }\n\n    Connect.displayName = connectDisplayName\n    Connect.WrappedComponent = WrappedComponent\n    Connect.contextTypes = {\n      store: storeShape\n    }\n    Connect.propTypes = {\n      store: storeShape\n    }\n\n    if (process.env.NODE_ENV !== \x27production\x27) {\n      Connect.prototype.componentWillUpdate = function componentWillUpdate() {\n        if (this.version === version) {\n          return\n        }\n\n        \/\/ We are hot reloading!\n        this.version = version\n        this.trySubscribe()\n        this.clearCache()\n      }\n    }\n\n    return hoistStatics(Connect, WrappedComponent)\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们按照上面介绍的解析步骤来一步步有序的分析源码。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1、查看函数入口，以及需要传入的参数。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e如果只是看这样一个函数体，我们无法得知每个参数到底是什么？有什么作用？但是，我们可以先结合使用的demo初步了解各个参数的作用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function connect(mapStateToProps, mapDispatchToProps, mergeProps, options = {}) {}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3econnect\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emapStateToProps, mapDispatchToProps, mergeProps, options = {}\x3c\/span\x3e) \x3c\/span\x3e{}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3emapStateToProps\x3c\/strong\x3e：传入所有state，返回指定的state数据。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mapStateToProps(state) {\n      return { todos: state.todos }\n    }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3efunction mapStateToProps(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e) {\n      return { todos: \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e.todos }\n    }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3emapDispatchToProps\x3c\/strong\x3e：传入dispatch，返回使用bindActionCreators()绑定的action方法。我们不再这里讨论bindActionCreators的用法，这个知识将会放到redux解析的文章中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mapDispatchToProps(dispatch) {\n  return bindActionCreators(Object.assign({}, todoActionCreators, counterActionCreators), dispatch)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emapDispatchToProps\x3c\/span\x3e(dispatch) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3ebindActionCreators(Object.assign({},\x3c\/span\x3e todoActionCreators, counterActionCreators), dispatch)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3emergeProps\x3c\/strong\x3e：mergeProps如果不指定，则默认返回 Object.assign({}, ownProps, stateProps, dispatchProps)，顾名思义，mergeProps是合并的意思，将state合并后传递给组件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function mergeProps(stateProps, dispatchProps, ownProps) {\n  return Object.assign({}, ownProps, {\n    todos: stateProps.todos[ownProps.userId],\n    addTodo: (text) =\x3e dispatchProps.addTodo(ownProps.userId, text)\n  })\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3efunction mergeProps(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps, dispatchProps, ownProps) {\n  return Object.assign({}, ownProps, {\n    todos: \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps.todos[ownProps.\x3cspan class=\x22hljs-keyword\x22\x3euser\x3c\/span\x3eId],\n    addTodo: (text) =\x26gt; dispatchProps.addTodo(ownProps.\x3cspan class=\x22hljs-keyword\x22\x3euser\x3c\/span\x3eId, text)\n  })\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eoptions\x3c\/strong\x3e：通过配置项可以更加详细的定义connect的行为，通常只需要执行默认值。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e2、查看导入了哪些插件\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { Component, createElement } from \x27react\x27\nimport storeShape from \x27..\/utils\/storeShape\x27\nimport shallowEqual from \x27..\/utils\/shallowEqual\x27\nimport wrapActionCreators from \x27..\/utils\/wrapActionCreators\x27\nimport warning from \x27..\/utils\/warning\x27\nimport isPlainObject from \x27lodash\/isPlainObject\x27\nimport hoistStatics from \x27hoist-non-react-statics\x27\nimport invariant from \x27invariant\x27\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Component, createElement } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27react\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e storeShape \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/storeShape\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e shallowEqual \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/shallowEqual\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e wrapActionCreators \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/wrapActionCreators\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e warning \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\/warning\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e isPlainObject \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\/isPlainObject\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e hoistStatics \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27hoist-non-react-statics\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e invariant \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27invariant\x27\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ereact\x3c\/strong\x3e：使用到了react组件，那么我们可以猜测connect和Provider类似，需要创建一个Connect组件。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3estoreShape\x3c\/strong\x3e：通过了redux常用API的类型验证。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import PropTypes from \x27prop-types\x27\nexport default PropTypes.shape({\n  subscribe: PropTypes.func.isRequired,\n  dispatch: PropTypes.func.isRequired,\n  getState: PropTypes.func.isRequired\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3eimport PropTypes from \x3cspan class=\x22hljs-string\x22\x3e\x27prop-types\x27\x3c\/span\x3e\nexport default PropTypes.shape({\n  subscribe: PropTypes\x3cspan class=\x22hljs-selector-class\x22\x3e.func\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.isRequired\x3c\/span\x3e,\n  dispatch: PropTypes\x3cspan class=\x22hljs-selector-class\x22\x3e.func\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.isRequired\x3c\/span\x3e,\n  getState: PropTypes\x3cspan class=\x22hljs-selector-class\x22\x3e.func\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.isRequired\x3c\/span\x3e\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eshallowEqual\x3c\/strong\x3e：这个文件的作用是传入2个对象，首先比较对象是否一致，如果一致，则返回true，如果不一致，则获取2个对象的key数组，判断2个对象key数组的长度是否相等，如果不相等，返回false，如果相等，最后用for循环遍历A对象的key，如果当前的遍历值不存在于B的key中或者A对象的当前key的value不等于B对象的当前key的value，则返回false，如果不属于上面的任何情况，则返回true。（如果认为我这段讲的迷迷糊糊，你也可以自己理解下面的代码。）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function shallowEqual(objA, objB) {\n  if (objA === objB) {\n    return true\n  }\n  const keysA = Object.keys(objA)\n  const keysB = Object.keys(objB)\n  if (keysA.length !== keysB.length) {\n    return false\n  }\n  \/\/ 测试A对象的key和B对象的key不一致\n  const hasOwn = Object.prototype.hasOwnProperty\n  for (let i = 0; i \x3c keysA.length; i\x2b\x2b) {\n    if (!hasOwn.call(objB, keysA[i]) || objA[keysA[i]] !== objB[keysA[i]]) {\n      return false\n    }\n  }\n  return true\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eshallowEqual\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobjA, objB\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (objA === objB) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e keysA = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(objA)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e keysB = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(objB)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (keysA.length !== keysB.length) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 测试A对象的key和B对象的key不一致\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hasOwn = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.hasOwnProperty\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; keysA.length; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!hasOwn.call(objB, keysA[i]) || objA[keysA[i]] !== objB[keysA[i]]) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ehasOwn的作用是判断对象里面是否包含某个属性。这段代码的实际用途是判断下一个props和当前的props是否一致。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22shallowEqual(nextStateProps, this.stateProps)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3eshallowEqual(nextStateProps, this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ewrapActionCreators\x3c\/strong\x3e：实现了bindActionCreators方法绑定action到组件的操作。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { bindActionCreators } from \x27redux\x27\n\nexport default function wrapActionCreators(actionCreators) {\n  return dispatch =\x3e bindActionCreators(actionCreators, dispatch)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { bindActionCreators } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewrapActionCreators\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eactionCreators\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e =\x26gt;\x3c\/span\x3e bindActionCreators(actionCreators, dispatch)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e函数使用方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22wrapActionCreators(mapDispatchToProps)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3ewrapActionCreators\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(mapDispatchToProps)\x3c\/span\x3e\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ewarning\x3c\/strong\x3e：在控制台打印warning信息\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function warning(message) {\n  if (typeof console !== \x27undefined\x27 \x26amp;\x26amp; typeof console.error === \x27function\x27) {\n    console.error(message)\n  }\n  try {\n    throw new Error(message)\n  } catch (e) {}\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewarning\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e !== \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(message)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(message)\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {}\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3elodash\/isPlainObject\x3c\/strong\x3e：检查传入的值是不是纯对象，如果是，返回true，否则返回false。方法详情查看 \x3ca href=\x22http:\/\/lodashjs.com\/docs\/#_isplainobjectvalue\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elodash之isPlainObject\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function isPlainObject(value) {\n  if (!isObjectLike(value) || baseGetTag(value) != objectTag) {\n    return false;\n  }\n  var proto = getPrototype(value);\n  if (proto === null) {\n    return true;\n  }\n  var Ctor = hasOwnProperty.call(proto, \x27constructor\x27) \x26amp;\x26amp; proto.constructor;\n  return typeof Ctor == \x27function\x27 \x26amp;\x26amp; Ctor instanceof Ctor \x26amp;\x26amp;\n    funcToString.call(Ctor) == objectCtorString;\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3efunction \x3cspan class=\x22hljs-title\x22\x3eisPlainObject\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isObjectLike(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e) || baseGetTag(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e) != objectTag) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e proto = getPrototype(\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (proto === \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Ctor = hasOwnProperty.call(proto, \x3cspan class=\x22hljs-string\x22\x3e\x27constructor\x27\x3c\/span\x3e) \x26amp;\x26amp; proto.constructor;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e Ctor == \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e \x26amp;\x26amp; Ctor instanceof Ctor \x26amp;\x26amp;\n    funcToString.call(Ctor) == objectCtorString;\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ehoist-non-react-statics\x3c\/strong\x3e：这段代码有点神奇，\x3cstrong\x3eREACT_STATICS\x3c\/strong\x3e是一堆react的常用方法，\x3cstrong\x3eKNOWN_STATICS\x3c\/strong\x3e是函数的一些属性。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var REACT_STATICS = {\n    childContextTypes: true,\n    contextTypes: true,\n    defaultProps: true,\n    displayName: true,\n    getDefaultProps: true,\n    mixins: true,\n    propTypes: true,\n    type: true\n};\nvar KNOWN_STATICS = {\n    name: true,\n    length: true,\n    prototype: true,\n    caller: true,\n    arguments: true,\n    arity: true\n};\nvar isGetOwnPropertySymbolsAvailable = typeof Object.getOwnPropertySymbols === \x27function\x27;\n\nmodule.exports = function hoistNonReactStatics(targetComponent, sourceComponent, customStatics) {\n    if (typeof sourceComponent !== \x27string\x27) { \/\/ don\x27t hoist over string (html) components\n        var keys = Object.getOwnPropertyNames(sourceComponent);\n        if (isGetOwnPropertySymbolsAvailable) {\n            keys = keys.concat(Object.getOwnPropertySymbols(sourceComponent));\n        }\n\n        for (var i = 0; i \x3c keys.length; \x2b\x2bi) {\n            if (!REACT_STATICS[keys[i]] \x26amp;\x26amp; !KNOWN_STATICS[keys[i]] \x26amp;\x26amp; (!customStatics || !customStatics[keys[i]])) {\n                try {\n                    targetComponent[keys[i]] = sourceComponent[keys[i]];\n                } catch (error) {\n\n                }\n            }\n        }\n    }\n\n    return targetComponent;\n};\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eREACT_STATICS\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    childContextTypes:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    contextTypes:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    defaultProps:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    displayName:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    getDefaultProps:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    mixins:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    propTypes:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    type:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e};\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eKNOWN_STATICS\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    name:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    length:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    prototype:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    caller:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    arguments:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e    arity:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e};\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eisGetOwnPropertySymbolsAvailable\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eObject.getOwnPropertySymbols\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e===\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-string\x22\x3emodule.exports\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ehoistNonReactStatics(targetComponent,\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esourceComponent,\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ecustomStatics)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(typeof\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esourceComponent\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e!==\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/\/\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3edon\x27t\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ehoist\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eover\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3estring\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(html)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ecomponents\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ekeys\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eObject.getOwnPropertyNames(sourceComponent);\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(isGetOwnPropertySymbolsAvailable)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3ekeys\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ekeys.concat(Object.getOwnPropertySymbols(sourceComponent));\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-string\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(var\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ei\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ei\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x26lt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ekeys.length;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x2b\x2bi)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3eif\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(!REACT_STATICS[keys[i]]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x26amp;\x26amp;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e!KNOWN_STATICS[keys[i]]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x26amp;\x26amp;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(!customStatics\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e||\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e!customStatics[keys[i]]))\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n                \x3cspan class=\x22hljs-string\x22\x3etry\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-string\x22\x3etargetComponent[keys[i]]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3esourceComponent[keys[i]];\x3c\/span\x3e\n                \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ecatch\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e(error)\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\n                \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-string\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3etargetComponent;\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e};\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们首先从函数入口解读，入口传入了3个参数，\x3cstrong\x3etargetComponent\x3c\/strong\x3e, \x3cstrong\x3esourceComponent\x3c\/strong\x3e, \x3cstrong\x3ecustomStatics\x3c\/strong\x3e，首先判断sourceComponent的类型不是一个字符串，然后使用getOwnPropertyNames获取sourceComponent对象的key，返回值是key组成的数组keys。接着判断isGetOwnPropertySymbolsAvailable（肯定是true），如果为true，执行下面的语句：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22keys = keys.concat(Object.getOwnPropertySymbols(sourceComponent));\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs abnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3ekeys\x3c\/span\x3e = keys.concat(Object.getOwnPropertySymbols(sourceComponent))\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3egetOwnPropertySymbols和getOwnPropertyNames作用类似，但是\x3cstrong\x3egetOwnPropertyNames只是返回字符串类型的key\x3c\/strong\x3e，而\x3cstrong\x3egetOwnPropertySymbols可以返回Symbol类型的key\x3c\/strong\x3e。然后我们再把2种情况下的key拼接到一个数组里面返回新的keys。\x3c\/p\x3e\n\x3cp\x3e然后执行for语句，遍历keys，如果不包含REACT_STATICS中的react的静态方法，同时不包含KNOWN_STATICS中的属性，同时不存在customStatics（传入函数的第三个参数不存在）或者存在但没有sourceComponent的key，就执行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/将sourceComponent的方法写入targetComponent中\ntargetComponent[keys[i]] = sourceComponent[keys[i]];\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs inform7\x22\x3e\x3ccode\x3e\/\/将sourceComponent的方法写入targetComponent中\ntargetComponent\x3cspan class=\x22hljs-comment\x22\x3e[keys\x3cspan class=\x22hljs-comment\x22\x3e[i]\x3c\/span\x3e]\x3c\/span\x3e = sourceComponent\x3cspan class=\x22hljs-comment\x22\x3e[keys\x3cspan class=\x22hljs-comment\x22\x3e[i]\x3c\/span\x3e]\x3c\/span\x3e;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后返回targetComponent：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22return targetComponent\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e targetComponent\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法在connect中的实际作用是：将WrappedComponent内的react静态方法绑定到Connect组件上。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22hoistStatics(Connect, WrappedComponent)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3ehoistStatics\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(Connect, WrappedComponent)\x3c\/span\x3e\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3einvariant\x3c\/strong\x3e：我们看到invariant传入了好几个参数，第一个if语句表示如果不是生产环境，并且format没有定义，就抛出异常。第二个if表示如果condition未定义，同时format未定义，就抛出error，如果condition不存在但format存在，抛出另外的错误。（总结就是一个错误检查机制）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var NODE_ENV = process.env.NODE_ENV;\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (NODE_ENV !== \x27production\x27) {\n    if (format === undefined) {\n      throw new Error(\x27invariant requires an error message argument\x27);\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        \x27Minified exception occurred; use the non-minified dev environment \x27 \x2b\n        \x27for the full error message and additional helpful warnings.\x27\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(\/%s\/g, function() { return args[argIndex\x2b\x2b]; })\n      );\n      error.name = \x27Invariant Violation\x27;\n    }\n\n    error.framesToPop = 1; \/\/ we don\x27t care about invariant\x27s own frame\n    throw error;\n  }\n\n};\n\nmodule.exports = invariant;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e NODE_ENV = process.env.NODE_ENV;\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e invariant = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econdition, format, a, b, c, d, e, f\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (format === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27invariant requires an error message argument\x27\x3c\/span\x3e);\n    }\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!condition) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e error;\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (format === \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n      error = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\n        \x3cspan class=\x22hljs-string\x22\x3e\x27Minified exception occurred; use the non-minified dev environment \x27\x3c\/span\x3e \x2b\n        \x3cspan class=\x22hljs-string\x22\x3e\x27for the full error message and additional helpful warnings.\x27\x3c\/span\x3e\n      );\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = [a, b, c, d, e, f];\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e argIndex = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n      error = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\n        format.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/%s\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e args[argIndex\x2b\x2b]; })\n      );\n      error.name = \x3cspan class=\x22hljs-string\x22\x3e\x27Invariant Violation\x27\x3c\/span\x3e;\n    }\n\n    error.framesToPop = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ we don\x27t care about invariant\x27s own frame\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error;\n  }\n\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = invariant;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法实际用途：检查store是否存在\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22invariant(this.store,\n          `Could not find \x26quot;store\x26quot; in either the context or ` \x2b\n          `props of \x26quot;${connectDisplayName}\x26quot;. ` \x2b\n          `Either wrap the root component in a \x3cProvider\x3e, ` \x2b\n          `or explicitly pass \x26quot;store\x26quot; as a prop to \x26quot;${connectDisplayName}\x26quot;.`\n        )\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livecodeserver\x22\x3e\x3ccode\x3einvariant(this.store,\n          `Could \x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e find \x3cspan class=\x22hljs-string\x22\x3e\x22store\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e either \x3cspan class=\x22hljs-keyword\x22\x3ethe\x3c\/span\x3e context \x3cspan class=\x22hljs-keyword\x22\x3eor\x3c\/span\x3e ` \x2b\n          `props \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22${connectDisplayName}\x22\x3c\/span\x3e. ` \x2b\n          `Either \x3cspan class=\x22hljs-keyword\x22\x3ewrap\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethe\x3c\/span\x3e root component \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ea\x3c\/span\x3e \x26lt;Provider\x26gt;, ` \x2b\n          `\x3cspan class=\x22hljs-keyword\x22\x3eor\x3c\/span\x3e explicitly pass \x3cspan class=\x22hljs-string\x22\x3e\x22store\x22\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ea\x3c\/span\x3e prop \x3cspan class=\x22hljs-built_in\x22\x3eto\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22${connectDisplayName}\x22\x3c\/span\x3e.`\n        )\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e3、定义几个参数默认值常量\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e当你没有给组件绑定state和dispatch的时候，就执行默认的配置。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3edefaultMapStateToProps\x3c\/strong\x3e：传入state，返回空对象\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3edefaultMapDispatchToProps\x3c\/strong\x3e： 传入dispatch，返回dispatch对象\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3edefaultMergeProps\x3c\/strong\x3e：传入stateProps, dispatchProps, parentProps，返回当前传入的对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const defaultMapStateToProps = state =\x3e ({})\nconst defaultMapDispatchToProps = dispatch =\x3e ({ dispatch })\nconst defaultMergeProps = (stateProps, dispatchProps, parentProps) =\x3e ({\n  ...parentProps,\n  ...stateProps,\n  ...dispatchProps\n})\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3econst \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3eMapStateToProps = \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e =\x26gt; ({})\nconst \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3eMapDispatchToProps = dispatch =\x26gt; ({ dispatch })\nconst \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3eMergeProps = (\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps, dispatchProps, parentProps) =\x26gt; ({\n  ...parentProps,\n  ...\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3eProps,\n  ...dispatchProps\n})\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e4、getDisplayName方法\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e返回当前传入的组件名\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || \x27Component\x27\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetDisplayName\x3c\/span\x3e(WrappedComponent) {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3eWrappedComponent.displayName\x3c\/span\x3e || WrappedComponent.name || \x3cspan class=\x22hljs-symbol\x22\x3e\x27Component\x3c\/span\x3e\x27\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e5、tryCatch方法\x3c\/strong\x3e\x3cbr\x3e给fn函数指定上下文。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let errorObject = { value: null }\nfunction tryCatch(fn, ctx) {\n  try {\n    return fn.apply(ctx)\n  } catch (e) {\n    errorObject.value = e\n    return errorObject\n  }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e errorObject = { \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e }\n\x3cspan class=\x22hljs-function\x22\x3efunction \x3cspan class=\x22hljs-title\x22\x3etryCatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efn, ctx\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fn.apply(ctx)\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n    errorObject.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e errorObject\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用场景：在connect内调用tryCatch给updateStatePropsIfNeeded方法指定当前的上下文\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22tryCatch(this.updateStatePropsIfNeeded, this)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3etryCatch(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateStatePropsIfNeeded, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果你不明白上面的代码，可以看下面比较简单的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let b = {\n  a: 1,\n  e: function() {\n    console.log(this.a)\n  },\n  c: function() {\n    tryCatch(this.e, this)\n  }\n}\n\nb.c() \/\/ 1\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e b = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ee\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.a)\n  },\n  \x3cspan class=\x22hljs-attr\x22\x3ec\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    tryCatch(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n  }\n}\n\nb.c() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 1\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e6、connect函数解析思路\x3c\/strong\x3e\x3cbr\x3econnect函数是核心，我们需要大概了解函数做的事情，才能更好的读懂源码。\x3cbr\x3e既然是函数，那就有返回值，connect()返回值是Connect组件（请注意大小写的区别）。\x3c\/p\x3e\n\x3cp\x3e通俗点理解，使用connect可以把state和dispatch绑定到react组件，使得组件可以访问到redux的数据。\x3cbr\x3e常看到下面这种写法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default connect(mapStateToProps)(TodoApp)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haskell\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-title\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e connect(\x3cspan class=\x22hljs-title\x22\x3emapStateToProps\x3c\/span\x3e)(\x3cspan class=\x22hljs-type\x22\x3eTodoApp\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我把connect的核心实现简化提取出来，是下面这种形式：WrappedComponent参数对应的就是TodoApp。函数最终返回的是将state和dispatch绑定到Connect之后的新组件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22funtion connect(mapStateToProps) {\n    return function wrapWithConnect(WrappedComponent) {\n        class Connect extends Component {\n        \n        }\n        return hoistStatics(Connect, WrappedComponent)\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scala\x22\x3e\x3ccode\x3efuntion connect(mapStateToProps) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e function wrapWithConnect(\x3cspan class=\x22hljs-type\x22\x3eWrappedComponent\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eConnect\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n        \n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hoistStatics(\x3cspan class=\x22hljs-type\x22\x3eConnect\x3c\/span\x3e, \x3cspan class=\x22hljs-type\x22\x3eWrappedComponent\x3c\/span\x3e)\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e7、Connect组件执行\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e既然已经知道connect函数返回的是Connect组件，而Connect组件继承于react，我们就可以按照react的生命周期来阅读代码。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eConnect组件方法组成：\x3c\/strong\x3e方法虽然很多，但是我们只需要紧跟react生命周期函数去了解代码，而其他方法都是在生命周期函数中调用的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class Connect extends Component {\n      shouldComponentUpdate() {}\n      constructor(props, context) {}    \n      computeStateProps(store, props) {}    \n      configureFinalMapState(store, props) {}    \n      computeDispatchProps(store, props) {}    \n      configureFinalMapDispatch(store, props) {}    \n      updateStatePropsIfNeeded() {}\n      updateDispatchPropsIfNeeded() {}    \n      updateMergedPropsIfNeeded() {}    \n      isSubscribed() {}    \n      trySubscribe() {}    \n      tryUnsubscribe() {}    \n      componentDidMount() {}    \n      componentWillReceiveProps(nextProps) {}    \n      componentWillUnmount() {}    \n      clearCache() {}    \n      handleChange() {}    \n      getWrappedInstance() {}\n      render() {}\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e Connect extends Component \x3cspan class=\x22hljs-comment\x22\x3e{\n      shouldComponentUpdate() {}\x3c\/span\x3e\n      \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(props, context)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ecomputeStateProps\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(store, props)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3econfigureFinalMapState\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(store, props)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ecomputeDispatchProps\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(store, props)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3econfigureFinalMapDispatch\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(store, props)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3eupdateStatePropsIfNeeded\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e\n      \x3cspan class=\x22hljs-title\x22\x3eupdateDispatchPropsIfNeeded\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3eupdateMergedPropsIfNeeded\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3eisSubscribed\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3etrySubscribe\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3etryUnsubscribe\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ecomponentDidMount\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ecomponentWillReceiveProps\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(nextProps)\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ecomponentWillUnmount\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3eclearCache\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3ehandleChange\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e    \n      \x3cspan class=\x22hljs-title\x22\x3egetWrappedInstance\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e\n      \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e{}\x3c\/span\x3e\n}\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e简单了解react生命周期的函数执行顺序：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e初次渲染\x3c\/strong\x3e：render =\x26gt; componentDidMount\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e当state更新时\x3c\/strong\x3e：componentWillReceiveProps =\x26gt; shouldComponentUpdate =\x26gt; render\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3erender：\x3c\/strong\x3e进入Connect组件执行的时候，先进入render方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22render() {\n        const {haveOwnPropsChanged, hasStoreStateChanged, haveStatePropsBeenPrecalculated, statePropsPrecalculationError, renderedElement} = this\n\n        this.haveOwnPropsChanged = false\n        this.hasStoreStateChanged = false\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n\n        if (statePropsPrecalculationError) {\n          throw statePropsPrecalculationError\n        }\n\n        let shouldUpdateStateProps = true\n        let shouldUpdateDispatchProps = true\n        if (pure \x26amp;\x26amp; renderedElement) {\n          shouldUpdateStateProps = hasStoreStateChanged || (\n            haveOwnPropsChanged \x26amp;\x26amp; this.doStatePropsDependOnOwnProps\n          )\n          shouldUpdateDispatchProps =\n            haveOwnPropsChanged \x26amp;\x26amp; this.doDispatchPropsDependOnOwnProps\n        }\n\n        let haveStatePropsChanged = false\n        let haveDispatchPropsChanged = false\n        if (haveStatePropsBeenPrecalculated) {\n          haveStatePropsChanged = true\n        } else if (shouldUpdateStateProps) {\n          haveStatePropsChanged = this.updateStatePropsIfNeeded()\n        }\n        if (shouldUpdateDispatchProps) {\n          haveDispatchPropsChanged = this.updateDispatchPropsIfNeeded()\n        }\n\n        let haveMergedPropsChanged = true\n        if (haveStatePropsChanged || haveDispatchPropsChanged || haveOwnPropsChanged) {\n          haveMergedPropsChanged = this.updateMergedPropsIfNeeded()\n        } else {\n          haveMergedPropsChanged = false\n        }\n\n        if (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n          return renderedElement\n        }\n\n        if (withRef) {\n          this.renderedElement = createElement(WrappedComponent, {\n            ...this.mergedProps,\n            ref: \x27wrappedInstance\x27\n          })\n        } else {\n          this.renderedElement = createElement(WrappedComponent,\n            this.mergedProps\n          )\n        }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3erender() {\n        const {haveOwnPropsChanged, hasStoreStateChanged, haveStatePropsBeenPrecalculated, statePropsPrecalculationError, renderedElement} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveOwnPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasStoreStateChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveStatePropsBeenPrecalculated = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.statePropsPrecalculationError = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (statePropsPrecalculationError) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e statePropsPrecalculationError\n        }\n\n        let shouldUpdateStateProps = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        let shouldUpdateDispatchProps = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pure \x26amp;\x26amp; renderedElement) {\n          shouldUpdateStateProps = hasStoreStateChanged || (\n            haveOwnPropsChanged \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.doStatePropsDependOnOwnProps\n          )\n          shouldUpdateDispatchProps =\n            haveOwnPropsChanged \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.doDispatchPropsDependOnOwnProps\n        }\n\n        let haveStatePropsChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        let haveDispatchPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (haveStatePropsBeenPrecalculated) {\n          haveStatePropsChanged = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (shouldUpdateStateProps) {\n          haveStatePropsChanged = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateStatePropsIfNeeded()\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (shouldUpdateDispatchProps) {\n          haveDispatchPropsChanged = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateDispatchPropsIfNeeded()\n        }\n\n        let haveMergedPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (haveStatePropsChanged || haveDispatchPropsChanged || haveOwnPropsChanged) {\n          haveMergedPropsChanged = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.updateMergedPropsIfNeeded()\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          haveMergedPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e renderedElement\n        }\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (withRef) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.renderedElement = createElement(WrappedComponent, {\n            ...\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps,\n            ref: \x3cspan class=\x22hljs-string\x22\x3e\x27wrappedInstance\x27\x3c\/span\x3e\n          })\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.renderedElement = createElement(WrappedComponent,\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps\n          )\n        }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ea、首先定义了5个成员变量，在Connect组件内部的任意函数位置可以访问到this定义的成员变量。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const {haveOwnPropsChanged, hasStoreStateChanged, haveStatePropsBeenPrecalculated, statePropsPrecalculationError, renderedElement} = this\n\n\/\/上面的代码等于下面的写法，this指当前的组件对象。\n\n\/\/判断新传入的props和当前的是否相等，是bool值\nvar haveOwnPropsChanged = this.haveOwnPropsChanged; \n\/\/当state更新时，改变hasStoreStateChanged的状态，是bool值\nvar hasStoreStateChanged = this.hasStoreStateChanged;\n\/\/表示state和props已经提前计算改变，也是bool值\nvar haveStatePropsBeenPrecalculated = this.haveStatePropsBeenPrecalculated;\n\/\/如果state和props更新时出现错误，则抛出statePropsPrecalculationError异常\nvar statePropsPrecalculationError = this.statePropsPrecalculationError;\n\/\/将要渲染的react组件\nvar renderedElement = this.renderedElement;\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3econst {haveOwnPropsChanged, hasStoreStateChanged, haveStatePropsBeenPrecalculated, \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError, renderedElement} = this\n\n\/\/上面的代码等于下面的写法，this指当前的组件对象。\n\n\/\/判断新传入的props和当前的是否相等，是bool值\nvar haveOwnPropsChanged = this.haveOwnPropsChanged; \n\/\/当\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e更新时，改变hasStoreStateChanged的状态，是bool值\nvar hasStoreStateChanged = this.hasStoreStateChanged;\n\/\/表示\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e和props已经提前计算改变，也是bool值\nvar haveStatePropsBeenPrecalculated = this.haveStatePropsBeenPrecalculated;\n\/\/如果\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e和props更新时出现错误，则抛出\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError异常\nvar \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError = this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError;\n\/\/将要渲染的react组件\nvar renderedElement = this.renderedElement;\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eb、给成员变量设置默认值。\x3c\/strong\x3e默认值要么是false，要么是null。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22this.haveOwnPropsChanged = false\nthis.hasStoreStateChanged = false\nthis.haveStatePropsBeenPrecalculated = false\nthis.statePropsPrecalculationError = null\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveOwnPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasStoreStateChanged = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveStatePropsBeenPrecalculated = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.statePropsPrecalculationError = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ec、抛出异常\x3c\/strong\x3e：初次渲染时，statePropsPrecalculationError为null，不会抛出异常，当执行state和props更新出现异常时，会抛出错误。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (statePropsPrecalculationError) {\n      throw statePropsPrecalculationError\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3eif (\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError) {\n      throw \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们追踪到statePropsPrecalculationError的赋值是在handleChange()里面执行的，受到haveStatePropsChanged的结果影响。当haveStatePropsChanged出现错误时，就把报错内容赋值给statePropsPrecalculationError。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if (haveStatePropsChanged === errorObject) {\n      this.statePropsPrecalculationError = errorObject.value\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3eif (haveStatePropsChanged === errorObject) {\n      this.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3ePropsPrecalculationError = errorObject.value\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ed、定义shouldUpdateStateProps和shouldUpdateDispatchProps\x3c\/strong\x3e：默认为true前者表示默认允许更新state和props，后者表示默认允许更新dispatch。\x3cbr\x3epure：options的配置项，初始值为true。\x3cbr\x3eshouldUpdateStateProps：我们看到 || 符号，只要左右2边满足一个为true，则返回true，如果2个都是false，则返回false。\x3cbr\x3eshouldUpdateDispatchProps：同时满足haveOwnPropsChanged、doDispatchPropsDependOnOwnProps为true，则返回true，否则返回false。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    let shouldUpdateStateProps = true\n    let shouldUpdateDispatchProps = true\n    if (pure \x26amp;\x26amp; renderedElement) {\n        shouldUpdateStateProps = hasStoreStateChanged ||\n (haveOwnPropsChanged \x26amp;\x26amp; this.doStatePropsDependOnOwnProps)\n        shouldUpdateDispatchProps = haveOwnPropsChanged \x26amp;\x26amp; this.doDispatchPropsDependOnOwnProps\n     }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs nix\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eshouldUpdateStateProps\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eshouldUpdateDispatchProps\x3c\/span\x3e = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pure \x26amp;\x26amp; renderedElement) {\n        \x3cspan class=\x22hljs-attr\x22\x3eshouldUpdateStateProps\x3c\/span\x3e = hasStoreStateChanged ||\n (haveOwnPropsChanged \x26amp;\x26amp; this.doStatePropsDependOnOwnProps)\n        \x3cspan class=\x22hljs-attr\x22\x3eshouldUpdateDispatchProps\x3c\/span\x3e = haveOwnPropsChanged \x26amp;\x26amp; this.doDispatchPropsDependOnOwnProps\n     }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ee、上面几个步骤都是定义state和props的各种状态的变量，目的是为了判断render方法返回怎样的renderedElement。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/如果haveMergedPropsChanged为false，并且renderedElement不为null，则返回renderedElement\n\/\/这段代码在初次渲染是不会执行，只有在更新state和props的时候执行\nif (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n    return renderedElement\n}\n\n\/\/haveMergedPropsChanged由updateMergedPropsIfNeeded方法的返回值控制，如果mergedProps等于nextMergedProps，返回false，不相等则返回true，表示应该更新state和props\nupdateMergedPropsIfNeeded() {\n    const nextMergedProps = computeMergedProps(this.stateProps, this.dispatchProps, this.props)\n    if (this.mergedProps \x26amp;\x26amp; checkMergedEquals \x26amp;\x26amp; shallowEqual(nextMergedProps, this.mergedProps)) {\n      return false\n    }\n\n    this.mergedProps = nextMergedProps\n    return true\n  }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/如果haveMergedPropsChanged为false，并且renderedElement不为null，则返回renderedElement\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/这段代码在初次渲染是不会执行，只有在更新state和props的时候执行\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!haveMergedPropsChanged \x26amp;\x26amp; renderedElement) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e renderedElement\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/haveMergedPropsChanged由updateMergedPropsIfNeeded方法的返回值控制，如果mergedProps等于nextMergedProps，返回false，不相等则返回true，表示应该更新state和props\x3c\/span\x3e\nupdateMergedPropsIfNeeded() {\n    const nextMergedProps = computeMergedProps(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.stateProps, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatchProps, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps \x26amp;\x26amp; checkMergedEquals \x26amp;\x26amp; shallowEqual(nextMergedProps, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps = nextMergedProps\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e初次进入组件最先渲染的返回值是下面这段：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    if (withRef) {\n          this.renderedElement = createElement(WrappedComponent, {\n            ...this.mergedProps,\n            ref: \x27wrappedInstance\x27\n          })\n        } else {\n          this.renderedElement = createElement(WrappedComponent,\n            this.mergedProps\n          )\n        }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (withRef) {\n          this\x3cspan class=\x22hljs-selector-class\x22\x3e.renderedElement\x3c\/span\x3e = createElement(WrappedComponent, {\n            ..\x3cspan class=\x22hljs-selector-class\x22\x3e.this\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.mergedProps\x3c\/span\x3e,\n            ref: \x3cspan class=\x22hljs-string\x22\x3e\x27wrappedInstance\x27\x3c\/span\x3e\n          })\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          this\x3cspan class=\x22hljs-selector-class\x22\x3e.renderedElement\x3c\/span\x3e = createElement(WrappedComponent,\n            this\x3cspan class=\x22hljs-selector-class\x22\x3e.mergedProps\x3c\/span\x3e\n          )\n        }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3econnect渲染结果\x3c\/strong\x3e：在你绑定的组件外层包裹了Connect组件，看下面的图你应该能更加清晰的了解connect做的事情。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVQXkk?w=1744\x26amp;h=706\x22 src=\x22https:\/\/static.alili.tech\/img\/bVQXkk?w=1744\x26amp;h=706\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3ecomponentWillReceiveProps\x3c\/strong\x3e：组件接收到新的state。如果pure为false，并且nextProps和this.props不相等，则设置this.haveOwnPropsChanged为true。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22componentWillReceiveProps(nextProps) {\n        if (!pure || !shallowEqual(nextProps, this.props)) {\n          this.haveOwnPropsChanged = true\n        }\n      }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3ecomponentWillReceiveProps(nextProps) {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!pure || !shallowEqual(nextProps, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props)) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveOwnPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        }\n      }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3eshouldComponentUpdate()\x3c\/strong\x3e：判断组件是否允许更新。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22shouldComponentUpdate() {\n        return !pure || this.haveOwnPropsChanged || this.hasStoreStateChanged\n      }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3eshouldComponentUpdate() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !pure || \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveOwnPropsChanged || \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasStoreStateChanged\n      }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ecomponentDidMount()：\x3c\/strong\x3e组件初次渲染完成，执行订阅更新\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22componentDidMount() {\n        this.trySubscribe()\n      }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3ecomponentDidMount\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n        this.trySubscribe()\n      }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3ecomponentWillUnmount()：\x3c\/strong\x3e组件卸载时恢复状态。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    componentWillUnmount() {\n        this.tryUnsubscribe()\n        this.clearCache()\n      }\n\n      clearCache() {\n        this.dispatchProps = null\n        this.stateProps = null\n        this.mergedProps = null\n        this.haveOwnPropsChanged = true\n        this.hasStoreStateChanged = true\n        this.haveStatePropsBeenPrecalculated = false\n        this.statePropsPrecalculationError = null\n        this.renderedElement = null\n        this.finalMapDispatchToProps = null\n        this.finalMapStateToProps = null\n      }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e    componentWillUnmount() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.tryUnsubscribe()\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.clearCache()\n      }\n\n      clearCache() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.dispatchProps = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.stateProps = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.mergedProps = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveOwnPropsChanged = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.hasStoreStateChanged = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.haveStatePropsBeenPrecalculated = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.statePropsPrecalculationError = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.renderedElement = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.finalMapDispatchToProps = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.finalMapStateToProps = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n      }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e8、总结\x3c\/strong\x3e\x3cbr\x3e如果看到这里，你还没有理清思路，那么可以看完总结再回过头去理解源码。\x3c\/p\x3e\n\x3cp\x3econnect方法做的事情是将state和dispatch绑定到Connect组件的参数上，然后Connect组件将你当前的App组件封装起来，使得App组件可以通过props获取到父组件Connect传递的state和props。\x3c\/p\x3e\n\x3cp\x3e这也就是为什么你可以在自己写的组件上面直接通过this.props访问到state和action。有的人是通过store去读取state和dispatch action，也是一样的道理。\x3c\/p\x3e\n\x3cp\x3e从connect方法的实现，我们看到了非常多react组件的影子，生命周期，props传递，context上下文。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e对比Provider组件：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eProvider是顶层组件的作用，将store作为上下文提供给全局共享，而Connect组件是局部组件，将某个react组件包装起来，传递指定的state和props给该组件访问。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React系列——react-redux之connect方法解析</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010188279">https://segmentfault.com/a/1190000010188279</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/frayg2h5coq/" target="_blank">https://alili.tech/archive/frayg2h5coq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>