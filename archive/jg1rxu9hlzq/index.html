<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="关于直播视频格式和浏览器兼容性历史的来龙去脉"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>关于直播视频格式和浏览器兼容性历史的来龙去脉 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/jg1rxu9hlzq/",
				"appid": "1613049289050283", 
				"title": "关于直播视频格式和浏览器兼容性历史的来龙去脉 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-16T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/0diru7ecngd5/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/csldidf2qt/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&text=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&text=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&title=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&is_video=false&description=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&title=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&title=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&title=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjg1rxu9hlzq%2f&title=%e5%85%b3%e4%ba%8e%e7%9b%b4%e6%92%ad%e8%a7%86%e9%a2%91%e6%a0%bc%e5%bc%8f%e5%92%8c%e6%b5%8f%e8%a7%88%e5%99%a8%e5%85%bc%e5%ae%b9%e6%80%a7%e5%8e%86%e5%8f%b2%e7%9a%84%e6%9d%a5%e9%be%99%e5%8e%bb%e8%84%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">关于直播视频格式和浏览器兼容性历史的来龙去脉</h1><div class="meta"><div class="postdate"><time datetime="2019-01-16" itemprop="datePublished">2019-01-16</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e因为误打误撞来到了淘宝直播团队，从开始完全不了解直播技术，现在因为leader暂时的离开，准备接手h5播放器的迭代，就不得不开始了解相关的视频技术，先整理一下在直播技术中的视频格式和不同浏览器的兼容性。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e直播协议HLS和RTMP\x3c\/h3\x3e\n\x3cp\x3e直播技术一般有两种协议方式，分别是HLS和RTMP，两种协议分别的解释我就摘抄了一个博主的\x3ca href=\x22http:\/\/www.tuicool.com\/articles\/uANbEnr\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e解释\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e\x3cem\x3eHLS\x3c\/em\x3e\x3c\/strong\x3e ，是苹果公司实现的基于 HTTP 的流媒体传输协议，全称 HTTP Live Streaming，可支持流媒体的直播和点播，主要应用在 iOS 系统，为 iOS 设备（如 iPhone、iPad）提供音视频直播和点播方案。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e\x3cem\x3eRTMP\x3c\/em\x3e\x3c\/strong\x3e ，实时消息传输协议，Real Time Messaging Protocol，是 Adobe Systems 公司为 Flash 播放器和服务器之间音频、视频和数据传输开发的开放协议。协议基于 TCP，是一个协议族，包括 RTMP 基本协议及 RTMPT\/RTMPS\/RTMPE 等多种变种。RTMP 是一种设计用来进行实时数据通信的网络协议，主要用来在 Flash\/AIR 平台和支持RTMP协议的流媒体\/交互服务器之间进行音视频和数据通信。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e总结下来就是RTMP是Adobe公司推出的基于flash的实时视频消息传输协议，服务端和用户端通过flash建立长链接，并实时进行消息的推送、传输和接收然后播放，对应的视频播放格式是\x3cstrong\x3e\x3cem\x3eflv\x3c\/em\x3e\x3c\/strong\x3e。而HLS就是apple公司为了消灭flash（因为老乔一直以来对flash的抵制和ios对flash的不支持）自己定义的一套替代flash的视频解决方案。服务器和用户端通过不停的接收视频片段（每个片段都通过一次http请求）来播放，对应的视频播放格式是\x3cstrong\x3e\x3cem\x3em3u8\x3c\/em\x3e\x3c\/strong\x3e，其中m3u8只是一个表示视频片段地址的纯文本，用来加载一个个的.ts视频文件。\x3c\/p\x3e\n\x3ch4\x3eHLS和RTMP的利弊\x3c\/h4\x3e\n\x3cp\x3e两种协议各有利弊，具体的在本篇中不展开了，就我所知的RTMP协议延迟低，协议本身设计简洁，适合实时性较高的网络直播，HLS是http请求，所以可以用cdn缓存等方式加快传输，但是因为是视频片段，容易被跳过，所以如果有强制广告要求的话也可能被跳过。但是RTMP因为占用的网络端口是1935，如果以后浏览器的一些新安全机制就有可能block所有80端口以外的连接，也有安全性问题。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eflv和m3u8格式的浏览器兼容性\x3c\/h3\x3e\n\x3ch4\x3e移动端\x3c\/h4\x3e\n\x3cp\x3e因为苹果公司对flash的强烈抵制以及自己定的视频协议，所以在ios端原生支持m3u8格式的视频播放而不支持flv的播放，而且因为苹果在移动端的领头作用，所以其他移动端包括android浏览器也都原生支持m3u8格式的视频播放。\x3c\/p\x3e\n\x3ch4\x3ePC端\x3c\/h4\x3e\n\x3cp\x3epc端因为历史原因，在hls之前都是用flash播放视频，后来随着html5的普及，可以用原生的video标签来播放mp4、ogg、webm等视频格式的播放，但是对于直播格式m3u8（除了safari）和flv都不能支持播放。所以现在pc端普遍的做法还是通过flash来播放m3u8和flv格式的视频。\x3c\/p\x3e\n\x3ch4\x3eMSE\x3c\/h4\x3e\n\x3cp\x3e但是因为flash的淘汰正在加速，也比较有\x3ca href=\x22https:\/\/blog.peer5.com\/flash-is-dying-in-december-long-live-html5-video-player\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e决心\x3c\/a\x3e，比如我就发现现在chrome播放flash视频已经要手动点击允许了。加上\x3ca href=\x22https:\/\/www.w3.org\/TR\/media-source\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emedia source extention\x3c\/a\x3e在高端浏览器已经被支持，就可以直接在浏览器端就实现视频格式的转换。MSE是一个可以通过js控制浏览器视频源文件的api，有了这个api我们就可以通过js在浏览器端对视频进行转码及处理并提供给video标签了。B站已经开源了一个flv播放器\x3ca href=\x22https:\/\/github.com\/Bilibili\/flv.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eflv.js\x3c\/a\x3e，原理就是通过解析视频源，然后进行视频源解码转换成mp4格式，然后通过mse丢在video原生标签里播放，同理也有\x3ca href=\x22https:\/\/github.com\/video-dev\/hls.js?files=1\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehls.js\x3c\/a\x3e对m3u8格式的视频进行转码在pc端播放。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>关于直播视频格式和浏览器兼容性历史的来龙去脉</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009121042">https://segmentfault.com/a/1190000009121042</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/jg1rxu9hlzq/" target="_blank">https://alili.tech/archive/jg1rxu9hlzq/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>