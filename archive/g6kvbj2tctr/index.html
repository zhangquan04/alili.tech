<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="前端模板的原理与实现"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>前端模板的原理与实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/g6kvbj2tctr/",
				"appid": "1613049289050283", 
				"title": "前端模板的原理与实现 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-03T02:30:39"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9fgmq5mxrhq/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/fan2b2jtlen/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&text=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&text=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&title=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&is_video=false&description=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&title=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&title=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&title=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fg6kvbj2tctr%2f&title=%e5%89%8d%e7%ab%af%e6%a8%a1%e6%9d%bf%e7%9a%84%e5%8e%9f%e7%90%86%e4%b8%8e%e5%ae%9e%e7%8e%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">前端模板的原理与实现</h1><div class="meta"><div class="postdate"><time datetime="2019-02-03" itemprop="datePublished">2019-02-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e时下流行什么react, avalon, angular, vue什么，其核心都离不开前端模板。理解前端模板，是我们了解MV* 的关键。 \x3c\/p\x3e\n\x3cp\x3e前端框架最重要的目的是将页面渲染出来。“渲染”（render）这个词最初不是前端的东西的。前端之前叫做切图，将设计师做的PSD变成一个静态页面，然后加上动态交互。但是我们有许多数据是来自后端，如何将数据加入静态页面呢？于是又多了一套工序叫“套页面”。套页面的过程实际就是将静态页面变成切割成一块块，每一块都是一个php，jsp或vm文件，它们是\x3cstrong\x3e后端模板引擎\x3c\/strong\x3e的处理对象！\x3c\/p\x3e\n\x3cp\x3e其实模板是不局限于后端还是前端的， 模板的本质是用于从\x3cstrong\x3e数据（变量）\x3c\/strong\x3e到实际的\x3cstrong\x3e视觉表现（HTML代码）\x3c\/strong\x3e这项工作的一种实现手段。由于后端近水楼台先得月（取数据比较方便），因此先在后端发展出这种技术。这些后端模板文件是活动于服务器的，然后经过复杂的处理，最后由浏览器渲染出来。这时的渲染是将服务器拼接好的静态文本变成一个DOM树的过程。\x3c\/p\x3e\n\x3cp\x3e如果要实现前端实现MVC或MVP，那些工序必须发生改变。静态文件产出是不变，尤其是大公司，分工够细，有专门的切图组（大多数是妹子）将它们做出来。接着是套页面，这时就不能使用后端模板引擎，需要引入前端模板引擎。由于实现一个前端模板引擎太简单了，经过多年的发展，已经有众多好用的轮子：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/janl\/mustache.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/janl\/musta...\x3c\/a\x3e\x3cbr\x3e基于JavaScript的Logic-less（无逻辑或轻逻辑）模板。 \x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/twitter\/hogan.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/twitter\/ho...\x3c\/a\x3e\x3cbr\x3e上面的优化版，twitter出品\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/wycats\/handlebars.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/wycats\/han...\x3c\/a\x3e\x3cbr\x3e完全兼容mustcache的语法\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/paularmstrong\/swig\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/paularmstr...\x3c\/a\x3e\x3cbr\x3e拥有更强悍的模板继承与block 重写功能\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/mozilla\/nunjucks\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/mozilla\/nu...\x3c\/a\x3e\x3cbr\x3e跟django的模板系统相似，可以说swig的升级版，是gitbook的御用前端模板\x3c\/p\x3e\n\x3cp\x3e其它推荐的还有ejs， 易学易用，对有过ASP\/PHP\/JSP编程经验的人来说，非常亲切自然，缺点就是功能有点简单。\x3c\/p\x3e\n\x3cp\x3e其他doT,  xtempalate， Underscore Templates。 \x3c\/p\x3e\n\x3cp\x3e最不推荐是jade， 有点华而不实，过度设计，导致套页面工作量大，性能其差。\x3c\/p\x3e\n\x3cp\x3e虚拟DOM时代流行的jsx就是无逻辑模板。之所以流行无逻辑或轻逻辑模板，其主要原因是改动成本比较少，像jade这样自造语法糖太多，从美工手中拿来的html需要大动干戈，进行摧心折骨般的改造才能套数据。对于模板来说，最简单而言，就是将某个可变数据放到适当的地方（\x3cstrong\x3e填空\x3c\/strong\x3e），而其次，可以控制这个区域输出不输入（\x3cstrong\x3eif指令\x3c\/strong\x3e)，或让其个区域循环输入多次（\x3cstrong\x3efor指令\x3c\/strong\x3e)，更强制，实现模板互相套嵌（\x3cstrong\x3elayout与block\x3c\/strong\x3e）。为了实现if与for有两种方法，一种是单纯的区域，插入一个js 语句，里面有if语句与for语句，另一种是使用语法糖，比如说 ms-for, ms-repeat, ng-if, ng-repeat。语法糖的用法比直接使用JS语句简单，但是带来学习成本与拓展功能。每一个模板 if, for指令的语法都不一样的，并且你想在循环做一些处理，比如过滤一些数据，或突然在某处中断，这又得引用一些新的语句。随着模板要求前后共用，就有了传输成本，直接写JS语句在模板里面肯定比不过语法糖。因此基于这种种原因，mustache风格的模板就成为主流。\x3c\/p\x3e\n\x3cp\x3e现在三种模板风格：\x3c\/p\x3e\n\x3cp\x3ePHP\/ASP\/JSP风格：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3c% if ( list.length ) { %\x3e\n  \x3col\x3e\n    \x3c% for ( n=0; n\x3clist.length; \x2b\x2bn ) { %\x3e\n      \x3cli\x3e\n        \x3c%= list[n] %\x3e\n      \x3c\/li\x3e\n    \x3c% } %\x3e\n  \x3c\/ol\x3e\n\x3c% } %\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs erb\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ( list.length ) { \x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e%\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eol\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e ( n=\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; n\x26lt;list.length; \x2b\x2bn ) { \x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e%\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%=\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22ruby\x22\x3e list[n] \x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e%\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22ruby\x22\x3e } \x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e%\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eol\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3e%\x3c\/span\x3e\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22ruby\x22\x3e } \x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e%\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3emustcache风格，高级语法有限，通常难自定义拓展：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x22{{\x22#if list.length\x22}}\x22\n  \x3col\x3e\n    \x22{{\x22#each list item\x22}}\x22\n      \x3cli\x3e\n        \x22{{\x22 item \x22}}\x22\n      \x3c\/li\x3e\n    \x22{{\x22\/each\x22}}\x22\n  \x3c\/ol\x3e\n\x22{{\x22\/if\x22}}\x22\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs handlebars\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e\x22{{\x22#\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3eif\x3c\/span\x3e\x3c\/span\x3e list.length\x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eol\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e\x22{{\x22#\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3eeach\x3c\/span\x3e\x3c\/span\x3e list item\x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22 item \x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e\x22{{\x22\/\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3eeach\x3c\/span\x3e\x3c\/span\x3e\x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eol\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e\x22{{\x22\/\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-builtin-name\x22\x3eif\x3c\/span\x3e\x3c\/span\x3e\x22}}\x22\x3c\/span\x3e\x3c\/code\x3e\x3cspan class=\x22xml\x22\x3e\x3c\/span\x3e\x3c\/pre\x3e\n\x3cp\x3e属性绑定风格：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3col ms-if=\x26quot;list.length\x26quot;\x3e\n  \x3cli ms-for=\x26quot;item in list\x26quot;\x3e\n      \x22{{\x22item\x22}}\x22\n  \x3c\/li\x3e\n\x3c\/ol\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eol\x3c\/span\x3e ms-\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22list.length\x22\x3c\/span\x3e\x26gt;\n  \x26lt;\x3cspan class=\x22hljs-selector-tag\x22\x3eli\x3c\/span\x3e ms-\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22item in list\x22\x3c\/span\x3e\x26gt;\n      \x22{{\x22item\x22}}\x22\n  \x26lt;\/li\x26gt;\n\x26lt;\/ol\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e前两者只能出现于script, textarea等容器元素内部。因此\x3ccode\x3e\x26lt;\x3c\/code\x3e分隔符与标签的\x3ccode\x3e\x26lt;\x3c\/code\x3e容器造成冲突，并且也不利于IDE的格式化处理。属性绑定风格则是MVVM时期最流行的模板定义风格，某页面某个区域就是一个模板，不需要进行入append等操作。\x3c\/p\x3e\n\x3cp\x3e我们再来看如何实现前端模板。前端模板的本质就是一个可以转换函数（渲染函数）的字符串。渲染函数放进一个充满数据的对象后，还原为一个全新的字符串。因此重点是如何构建一个渲染函数。最简单的方式是正则，还记得第二章的format方法吗，这就是一个轻型的填充数据的方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function format(str, object) {\n    var array = Array.prototype.slice.call(arguments, 1);\n    return str.replace(\/\\\\?\\#{([^{}]\x2b)\\}\/gm, function(match, name) {\n        if (match.charAt(0) == \x27\\\\\x27)\n            return match.slice(1);\n        var index = Number(name)\n        if (index \x3e= 0)\n            return array[index];\n        if (object \x26amp;\x26amp; object[name] !== void 0)\n            return  object[name];\n        return  \x27\x27;\n    });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eformat\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr, object\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e array = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype.slice.call(\x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e str.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\\\?\\#{([^{}]\x2b)\\}\/gm\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ematch, name\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (match.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) == \x3cspan class=\x22hljs-string\x22\x3e\x27\\\\\x27\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e match.slice(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e index = \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e(name)\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (index \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e array[index];\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (object \x26amp;\x26amp; object[name] !== \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e  object[name];\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e  \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n    });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eformat方法是通过\x3ccode\x3e#{ }\x3c\/code\x3e来划分静态内容与动态内容的，一般来说它们称之为定界符（\x3cstrong\x3edelimiter\x3c\/strong\x3e）。\x3ccode\x3e#{\x3c\/code\x3e为前定界符，\x3ccode\x3e}\x3c\/code\x3e为后界符，这个#{}其实是ruby风格的定界符。通常的定界符是\x3ccode\x3e\x26lt;%\x3c\/code\x3e与\x3ccode\x3e%\x26gt;\x3c\/code\x3e，\x3ccode\x3e\x22{{\x22\x3c\/code\x3e与\x3ccode\x3e\x22}}\x22\x3c\/code\x3e  。通常在前定界符中还有一些修饰符号，比如=号，表示这个会输出到页面，-号，表示会去掉两旁的空白。\x3cbr\x3e将下例，要编译成一个渲染函数\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var tpl = \x27你好,我的名字啊\x3c%name%\x3e, 今年已经 \x3c%info.age%\x3e岁了\x27\n var data = {\n     name: \x26quot;司徒正美\x26quot;,\n     age: 20\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tpl = \x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字啊\x26lt;%name%\x26gt;, 今年已经 \x26lt;%info.age%\x26gt;岁了\x27\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n     \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22司徒正美\x22\x3c\/span\x3e,\n     \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e大抵是这样\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var body = \x27你好,我的名字叫\x27\x2b data.name\x2b \x27, 今年已经 \x27\x2bdata.info.age\x2b \x27岁了\x27\nvar render = new Function(\x27data\x27, \x27return \x27\x2b body)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e body = \x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字叫\x27\x3c\/span\x3e\x2b data.name\x2b \x3cspan class=\x22hljs-string\x22\x3e\x27, 今年已经 \x27\x3c\/span\x3e\x2bdata.info.age\x2b \x3cspan class=\x22hljs-string\x22\x3e\x27岁了\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e render = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27return \x27\x3c\/span\x3e\x2b body)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e或者聪明一点，使用数组来join:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var array = [\x27return \x27]\narray.push(\x27你好,我的名字叫\x27）\narray.push(data.name)\narray.push(\x27, 今年已经\x27)\narray.push(data.info.age)\narray.push( \x27岁了\x27)\nvar render = new Function(\x27data\x27, array.join(\x27\x2b\x27))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e array = [\x3cspan class=\x22hljs-string\x22\x3e\x27return \x27\x3c\/span\x3e]\narray.push(\x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字叫\x27\x3c\/span\x3e）\narray.push(data.name)\narray.push(\x3cspan class=\x22hljs-string\x22\x3e\x27, 今年已经\x27\x3c\/span\x3e)\narray.push(data.info.age)\narray.push( \x3cspan class=\x22hljs-string\x22\x3e\x27岁了\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e render = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e, array.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就得区分静态内容与为变量前加\x3ccode\x3edata.\x3c\/code\x3e前缀。这一步可以用正则来做，也可以用纯字符串。我们试一下纯字符串方式。假令前定界符为openTag，后定界符为closeTag，通过indexOf 与slice方法，就可以将它切成一块块。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function tokenize(str) {\n    var openTag = \x27\x3c%\x27\n    var closeTag = \x27%\x3e\x27\n    var ret = []\n    do {\n        var index = str.indexOf(openTag)\n        index = index === -1 ? str.length : index\n        var value = str.slice(0, index)\n        \/\/抽取\x22{{\x22前面的静态内容\n        ret.push({\n            expr: value,\n            type: \x27text\x27\n        })\n        \/\/改变str字符串自身\n        str = str.slice(index \x2b openTag.length)\n        if (str) {\n            index = str.indexOf(closeTag)\n            var value = str.slice(0, index)\n            \/\/抽取\x22{{\x22与\x22}}\x22的动态内容\n            ret.push({\n                expr: value.trim(),\/\/JS逻辑两旁的空白可以省去\n                type: \x27js\x27\n            })\n            \/\/改变str字符串自身\n            str = str.slice(index \x2b closeTag.length)\n        }\n    } while (str.length)\n    return ret\n}\nconsole.log(tokenize(tpl))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs axapta\x22\x3e\x3ccode\x3efunction tokenize(\x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e) {\n    var openTag = \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;%\x27\x3c\/span\x3e\n    var closeTag = \x3cspan class=\x22hljs-string\x22\x3e\x27%\x26gt;\x27\x3c\/span\x3e\n    var ret = []\n    do {\n        var \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.indexOf(openTag)\n        \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e === \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e ? \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.length : \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e\n        var value = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/抽取\x22{{\x22前面的静态内容\x3c\/span\x3e\n        ret.push({\n            expr: value,\n            type: \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e\n        })\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/改变str字符串自身\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e \x2b openTag.length)\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.indexOf(closeTag)\n            var value = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/抽取\x22{{\x22与\x22}}\x22的动态内容\x3c\/span\x3e\n            ret.push({\n                expr: value.trim(),\x3cspan class=\x22hljs-comment\x22\x3e\/\/JS逻辑两旁的空白可以省去\x3c\/span\x3e\n                type: \x3cspan class=\x22hljs-string\x22\x3e\x27js\x27\x3c\/span\x3e\n            })\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/改变str字符串自身\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e \x2b closeTag.length)\n        }\n    } \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3estr\x3c\/span\x3e.length)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e ret\n}\nconsole.log(tokenize(tpl))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDuyQ?w=335\x26amp;h=368\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDuyQ?w=335\x26amp;h=368\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然后通过render方法将它们拼接起来。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function render(str) {\n     var tokens = tokenize(str)\n     var ret = []\n     for (var i = 0, token; token = tokens[i\x2b\x2b]; ) {\n         if (token.type === \x27text\x27) {\n             ret.push(\x27\x26quot;\x27 \x2b token.expr \x2b \x27\x26quot;\x27)\n         } else {\n             ret.push(token.expr)\n         }\n     }\n     console.log(\x26quot;return \x26quot;\x2b ret.join(\x27\x2b\x27))\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3efunction render(str) {\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tokens = \x3cspan class=\x22hljs-keyword\x22\x3etokenize\x3c\/span\x3e(str)\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e = []\n     \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = 0, \x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e; \x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e = tokens[i\x2b\x2b]; ) {\n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e === \x27text\x27) {\n             \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e.push(\x27\x3cspan class=\x22hljs-string\x22\x3e\x22\x27 \x2b token.expr \x2b \x27\x22\x3c\/span\x3e\x27)\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n             \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e.push(\x3cspan class=\x22hljs-keyword\x22\x3etoken\x3c\/span\x3e.expr)\n         }\n     }\n     console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22return \x22\x3c\/span\x3e\x2b \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e.join(\x27\x2b\x27))\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e打印出来如下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22return \x26quot;你好,我的名字叫\x26quot;\x2bname\x2b\x26quot;, 今年已经 \x26quot;\x2binfo.age\x2b\x26quot;岁了\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs applescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22你好,我的名字叫\x22\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-built_in\x22\x3ename\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22, 今年已经 \x22\x3c\/span\x3e\x2binfo.age\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22岁了\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个方法还不完整。首先光是在两旁加上双引号是不可靠的，万一里面还有双引号怎么办。因此我们需要引入第二章介绍的quote方法，当类型为文本时，\x3ccode\x3eret.push(\x2bquote(token.expr)\x2b）\x3c\/code\x3e。其次需要对动态部分的变量加上\x3ccode\x3e.data\x3c\/code\x3e。怎么知道它是一个变量呢。我们回想一下变量的定义，就是以_,$或字母开头的字符组合。为了简洁起见，我们暂时不用里会中文的情况。不过，\x3ccode\x3einfo.age\x3c\/code\x3e这个字符串里面，其实有两个符合变量的子串，而我只需要在info前面加\x3ccode\x3edata.\x3c\/code\x3e。这时，我们需要设法在匹配变量前，将对象的子级属性替换掉，替换成不符合变量的字符，然后再替换为去。为此，我搞了一个dig与fill方法，将子级属性变成\x3ccode\x3e??12\x3c\/code\x3e这样的字符串:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 var quote = JSON.stringify\/\/自己到第二章找完整函数\n var rident = \/[$a-zA-Z_][$a-zA-Z0-9_]*\/g\n var rproperty = \/\\.\\s*[\\w\\.\\$]\x2b\/g\n var number = 1\n var rfill = \/\\?\\?\\d\x2b\/g\n var stringPool = {}\n function dig(a) {\n     var key = \x27??\x27 \x2b number\x2b\x2b\n     stringPool[key] = a\n     return key\n }\n function fill(a) {\n     return stringPool[a]\n }\n function render(str) {\n     stringPool = {}\n     var tokens = tokenize(str)\n     var ret = []\n     for (var i = 0, token; token = tokens[i\x2b\x2b]; ) {\n         if (token.type === \x27text\x27) {\n             ret.push(quote(token.expr))\n         } else {\n             \/\/ 先去掉对象的子级属性,减少干扰因素\n             var js = token.expr.replace(rproperty, dig)\n             js = js.replace(rident, function (a) {\n                 return \x27data.\x27 \x2b a\n             })\n             js = js.replace(rfill, fill)\n             ret.push(js)\n         }\n     }\n     console.log(\x26quot;return \x26quot; \x2b ret.join(\x27\x2b\x27))\n }\nrender(tpl)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e quote = \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify\x3cspan class=\x22hljs-comment\x22\x3e\/\/自己到第二章找完整函数\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rident = \x3cspan class=\x22hljs-regexp\x22\x3e\/[$a-zA-Z_][$a-zA-Z0-9_]*\/g\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rproperty = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.\\s*[\\w\\.\\$]\x2b\/g\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e number = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rfill = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\?\\?\\d\x2b\/g\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e stringPool = {}\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edig\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ea\x3c\/span\x3e) \x3c\/span\x3e{\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = \x3cspan class=\x22hljs-string\x22\x3e\x27??\x27\x3c\/span\x3e \x2b number\x2b\x2b\n     stringPool[key] = a\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e key\n }\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efill\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ea\x3c\/span\x3e) \x3c\/span\x3e{\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e stringPool[a]\n }\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n     stringPool = {}\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tokens = tokenize(str)\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = []\n     \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, token; token = tokens[i\x2b\x2b]; ) {\n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e) {\n             ret.push(quote(token.expr))\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n             \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先去掉对象的子级属性,减少干扰因素\x3c\/span\x3e\n             \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e js = token.expr.replace(rproperty, dig)\n             js = js.replace(rident, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ea\x3c\/span\x3e) \x3c\/span\x3e{\n                 \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27data.\x27\x3c\/span\x3e \x2b a\n             })\n             js = js.replace(rfill, fill)\n             ret.push(js)\n         }\n     }\n     \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22return \x22\x3c\/span\x3e \x2b ret.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e))\n }\nrender(tpl)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e输出为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22return \x26quot;你好,我的名字叫\x26quot;\x2bdata.name\x2b\x26quot;, 今年已经 \x26quot;\x2bdata.info.age\x2b\x26quot;岁了\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22你好,我的名字叫\x22\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.name\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22, 今年已经 \x22\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.info.age\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22岁了\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后，我们修改一下后面两行，得到我们梦魅以求的渲染函数，它的实现过程比format方法复杂多了，但却是所有扩展性极强的前端模板的一般实现过程。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  function render(str){\n  \/\/略。。。\n     return new Function(\x26quot;data\x26quot;, \x26quot;return \x26quot; \x2b ret.join(\x27\x2b\x27))\n  }\n  var fn = render(tpl)\n  console.log(fn\x2b\x26quot;\x26quot;)\n  console.log(fn(data))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/略。。。\x3c\/span\x3e\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22data\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22return \x22\x3c\/span\x3e \x2b ret.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x27\x3c\/span\x3e))\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = render(tpl)\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn(data))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDuzp?w=510\x26amp;h=87\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDuzp?w=510\x26amp;h=87\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们再看一下如何引入循环语句，比如将上面的模板与数据改成这样\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var tpl = \x27你好,我的名字叫\x3c%name%\x3e, 今年已经 \x3c%info.age%\x3e岁了,喜欢\x3c% for(var i = 0, el; el = list[i\x2b\x2b];){%\x3e\x3c% el %\x3e \x3c% } %\x3e\x27\n var data = {\n     name: \x26quot;司徒正美\x26quot;,\n     info: {\n         age: 20\n     },\n     list: [\x26quot;苹果\x26quot;,\x26quot;香蕉\x26quot;,\x26quot;雪梨\x26quot;]\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tpl = \x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字叫\x26lt;%name%\x26gt;, 今年已经 \x26lt;%info.age%\x26gt;岁了,喜欢\x26lt;% for(var i = 0, el; el = list[i\x2b\x2b];){%\x26gt;\x26lt;% el %\x26gt; \x26lt;% } %\x26gt;\x27\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n     \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22司徒正美\x22\x3c\/span\x3e,\n     \x3cspan class=\x22hljs-attr\x22\x3einfo\x3c\/span\x3e: {\n         \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e\n     },\n     \x3cspan class=\x22hljs-attr\x22\x3elist\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22苹果\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22香蕉\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22雪梨\x22\x3c\/span\x3e]\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时我们就添加一种新的类型，不输出到页面的动态内容。这在token方法中做一些修改\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22value = value.trim()\nif (\/^(if|for|})\/.test(value)) {\n    ret.push({\n        expr: value,\n        type: \x27logic\x27\n    })\n} else {\n    ret.push({\n        expr: value,\n        type: \x27js\x27\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3evalue = value.trim()\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-regexp\x22\x3e\/^(if|for|})\/\x3c\/span\x3e.test(value)) {\n    ret.push({\n        \x3cspan class=\x22hljs-attr\x22\x3eexpr\x3c\/span\x3e: value,\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e\n    })\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    ret.push({\n        \x3cspan class=\x22hljs-attr\x22\x3eexpr\x3c\/span\x3e: value,\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27js\x27\x3c\/span\x3e\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但render方法怎么修改好呢，显示这时继续用\x3ccode\x3e＋\x3c\/code\x3e已经不行了，否则下场是这样\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22return \x26quot;你好,我的名字叫\x26quot;\x2bdata.name\x2b\x26quot;, 今年已经 \x26quot;\x2bdata.info.age\x2b\x26quot;岁了,喜欢\x26quot;\x2bfor(var i = 0, el; el = list[i\x2b\x2b];){\x2b\x26quot;\x26quot;\x2bdata.el\x2b\x26quot; \x26quot;\x2b}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22你好,我的名字叫\x22\x3c\/span\x3e\x2bdata.name\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22, 今年已经 \x22\x3c\/span\x3e\x2bdata.info.age\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22岁了,喜欢\x22\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, el; el = list[i\x2b\x2b];){\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e\x2bdata.el\x2b\x3cspan class=\x22hljs-string\x22\x3e\x22 \x22\x3c\/span\x3e\x2b}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这时， 我们需要借用数组，将要输入的数据（text, js类型 ）放进去，logic类型不放进去。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function addPrefix(str) {\n   \/\/ 先去掉对象的子级属性,减少干扰因素\n   var js = str.replace(rproperty, dig)\n   js = js.replace(rident, function (a) {\n       return \x27data.\x27 \x2b a\n   })\n   return js.replace(rfill, fill)\n}\nfunction addView(s) {\n   return \x27__data__.push(\x27 \x2b s \x2b \x27)\x27\n}\nfunction render(str) {\n    stringPool = {}\n    var tokens = tokenize(str)\n    var ret = [\x27var __data__ = []\x27]\n    tokens.forEach(function(token){\n       if (token.type === \x27text\x27) {\n           ret.push(addView(quote(token.expr)))\n       } else if (token.type === \x27logic\x27) {\n           \/\/逻辑部分都经过addPrefix方法处理\n           ret.push(addPrefix(token.expr))\n       } else {\n           ret.push(addView(addPrefix(token.expr)))\n       }\n    })\n    ret.push(\x26quot;return __data__.join(\x27\x27)\x26quot;)\n    console.log( ret.join(\x27\\n\x27))\n  }\nvar fn = render(tpl)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddPrefix\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先去掉对象的子级属性,减少干扰因素\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e js = str.replace(rproperty, dig)\n   js = js.replace(rident, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ea\x3c\/span\x3e) \x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27data.\x27\x3c\/span\x3e \x2b a\n   })\n   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e js.replace(rfill, fill)\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddView\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3es\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27__data__.push(\x27\x3c\/span\x3e \x2b s \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27)\x27\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n    stringPool = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tokens = tokenize(str)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = [\x3cspan class=\x22hljs-string\x22\x3e\x27var __data__ = []\x27\x3c\/span\x3e]\n    tokens.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etoken\x3c\/span\x3e)\x3c\/span\x3e{\n       \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e) {\n           ret.push(addView(quote(token.expr)))\n       } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e) {\n           \x3cspan class=\x22hljs-comment\x22\x3e\/\/逻辑部分都经过addPrefix方法处理\x3c\/span\x3e\n           ret.push(addPrefix(token.expr))\n       } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n           ret.push(addView(addPrefix(token.expr)))\n       }\n    })\n    ret.push(\x3cspan class=\x22hljs-string\x22\x3e\x22return __data__.join(\x27\x27)\x22\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log( ret.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e))\n  }\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = render(tpl)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e得到的内部结构是这样的，显然addPrefix方法出问题，我们应该过滤掉if, for等关键字与保留字。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var __data__ = []\n__data__.push(\x26quot;你好,我的名字叫\x26quot;)\n__data__.push(data.name)\n__data__.push(\x26quot;, 今年已经 \x26quot;)\n__data__.push(data.info.age)\n__data__.push(\x26quot;岁了,喜欢\x26quot;)\ndata.for(data.var data.i = 0, data.el; data.el = data.list[data.i\x2b\x2b]){\n__data__.push(\x26quot;\x26quot;)\n__data__.push(data.el)\n__data__.push(\x26quot; \x26quot;)\n}\nreturn __data__.join(\x27\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e __data__ = []\n__data__.push(\x3cspan class=\x22hljs-string\x22\x3e\x22你好,我的名字叫\x22\x3c\/span\x3e)\n__data__.push(data.name)\n__data__.push(\x3cspan class=\x22hljs-string\x22\x3e\x22, 今年已经 \x22\x3c\/span\x3e)\n__data__.push(data.info.age)\n__data__.push(\x3cspan class=\x22hljs-string\x22\x3e\x22岁了,喜欢\x22\x3c\/span\x3e)\ndata.for(data.var data.i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, data.el; data.el = data.list[data.i\x2b\x2b]){\n__data__.push(\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)\n__data__.push(data.el)\n__data__.push(\x3cspan class=\x22hljs-string\x22\x3e\x22 \x22\x3c\/span\x3e)\n}\n\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e __data__.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e但即使我们处理掉关键字与保留字，对于中间生成i, el怎么区分呢？是区分不了。于是目前有两种方法，一是使用with， 这时我们就不需要加\x3ccode\x3edata.\x3c\/code\x3e前缀。第二种引入新的语法。比如，前面是\x3ccode\x3e@\x3c\/code\x3e就替换为\x3ccode\x3edata.\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e先看第一种：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function render(str) {\n     stringPool = {}\n     var tokens = tokenize(str)\n     var ret = [\x27var __data__ = [];\x27, \x27with(data){\x27]\n     for (var i = 0, token; token = tokens[i\x2b\x2b]; ) {\n         if (token.type === \x27text\x27) {\n             ret.push(addView(quote(token.expr)))\n         } else if (token.type === \x27logic\x27) {\n             ret.push(token.expr)\n         } else {\n             ret.push(addView(token.expr))\n         }\n     }\n     ret.push(\x27}\x27)\n     ret.push(\x27return __data__.join(\x26quot;\x26quot;)\x27)\n     return new Function(\x26quot;data\x26quot;, ret.join(\x27\\n\x27))\n }\n var fn = render(tpl)\n console.log(fn \x2b \x26quot;\x26quot;)\n console.log(fn(data))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n     stringPool = {}\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tokens = tokenize(str)\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = [\x3cspan class=\x22hljs-string\x22\x3e\x27var __data__ = [];\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27with(data){\x27\x3c\/span\x3e]\n     \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, token; token = tokens[i\x2b\x2b]; ) {\n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e) {\n             ret.push(addView(quote(token.expr)))\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e) {\n             ret.push(token.expr)\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n             ret.push(addView(token.expr))\n         }\n     }\n     ret.push(\x3cspan class=\x22hljs-string\x22\x3e\x27}\x27\x3c\/span\x3e)\n     ret.push(\x3cspan class=\x22hljs-string\x22\x3e\x27return __data__.join(\x22\x22)\x27\x3c\/span\x3e)\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22data\x22\x3c\/span\x3e, ret.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e))\n }\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = render(tpl)\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn(data))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDuH7?w=390\x26amp;h=265\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDuH7?w=390\x26amp;h=265\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e许多迷你模板都是用with减少替换工作。\x3c\/p\x3e\n\x3cp\x3e第二种方法，使用引导符\x3ccode\x3e@\x3c\/code\x3e, avalon2就是这么玩。这样addPrefix方法可以减少许多代码。相对应，模板也要改动一下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 var tpl = \x27你好,我的名字叫\x3c%@name%\x3e, 今年已经 \x3c%@info.age%\x3e岁了,喜欢\x3c% for(var i = 0, el; el = @list[i\x2b\x2b];){%\x3e\x3c% el %\x3e \x3c% } %\x3e\x27\n var rguide = \/(^|[^\\w\\u00c0-\\uFFFF_])(@|##)(?=[$\\w])\/g\n function addPrefix(str) {\n     return str.replace(rguide, \x27$1data.\x27)\n }\n function render(str) {\n     stringPool = {}\n     var tokens = tokenize(str)\n     var ret = [\x27var __data__ = [];\x27]\n     for (var i = 0, token; token = tokens[i\x2b\x2b]; ) {\n         if (token.type === \x27text\x27) {\n             ret.push(addView(quote(token.expr)))\n         } else if (token.type === \x27logic\x27) {\n             \/\/逻辑部分都经过addPrefix方法处理\n             ret.push(addPrefix(token.expr))\n         } else {\n             ret.push(addView(addPrefix(token.expr)))\n         }\n     }\n    \n     ret.push(\x27return __data__.join(\x26quot;\x26quot;)\x27)\n     return new Function(\x26quot;data\x26quot;, ret.join(\x27\\n\x27))\n }\n var fn = render(tpl)\n console.log(fn \x2b \x26quot;\x26quot;)\n console.log(fn(data))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tpl = \x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字叫\x26lt;%@name%\x26gt;, 今年已经 \x26lt;%@info.age%\x26gt;岁了,喜欢\x26lt;% for(var i = 0, el; el = @list[i\x2b\x2b];){%\x26gt;\x26lt;% el %\x26gt; \x26lt;% } %\x26gt;\x27\x3c\/span\x3e\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e rguide = \x3cspan class=\x22hljs-regexp\x22\x3e\/(^|[^\\w\\u00c0-\\uFFFF_])(@|##)(?=[$\\w])\/g\x3c\/span\x3e\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddPrefix\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e str.replace(rguide, \x3cspan class=\x22hljs-string\x22\x3e\x27$1data.\x27\x3c\/span\x3e)\n }\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erender\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n     stringPool = {}\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tokens = tokenize(str)\n     \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = [\x3cspan class=\x22hljs-string\x22\x3e\x27var __data__ = [];\x27\x3c\/span\x3e]\n     \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, token; token = tokens[i\x2b\x2b]; ) {\n         \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e) {\n             ret.push(addView(quote(token.expr)))\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (token.type === \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e) {\n             \x3cspan class=\x22hljs-comment\x22\x3e\/\/逻辑部分都经过addPrefix方法处理\x3c\/span\x3e\n             ret.push(addPrefix(token.expr))\n         } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n             ret.push(addView(addPrefix(token.expr)))\n         }\n     }\n    \n     ret.push(\x3cspan class=\x22hljs-string\x22\x3e\x27return __data__.join(\x22\x22)\x27\x3c\/span\x3e)\n     \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22data\x22\x3c\/span\x3e, ret.join(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e))\n }\n \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = render(tpl)\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)\n \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn(data))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDuzx?w=398\x26amp;h=237\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDuzx?w=398\x26amp;h=237\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e第二种比第一种的优势在于，性能更高，并且避开es5严格模式的限制。\x3c\/p\x3e\n\x3cp\x3e我们再认真思考一下，其实循环语句与条件语句，不单是for, if两个，还有while, do while, else什么。因此这需要优化。这也有两种方法，添加更多语法符合，比如上面所说的\x3ccode\x3e=\x3c\/code\x3e就是输出，没有则不输出。这是ASP\/JSP\/PHP等模板采用的手段：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/tokenize方法\nif (value.charAt(0) === \x27=\x27) {\n     ret.push({\n         expr: value, \n         type: \x27js\x27\n     })\n } else {\n     ret.push({\n         expr: value, \n         type: \x27logic\x27\n     })\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/tokenize方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e) {\n     ret.push({\n         \x3cspan class=\x22hljs-attr\x22\x3eexpr\x3c\/span\x3e: value, \n         \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27js\x27\x3c\/span\x3e\n     })\n } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n     ret.push({\n         \x3cspan class=\x22hljs-attr\x22\x3eexpr\x3c\/span\x3e: value, \n         \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e\n     })\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e另一种，使用语法糖，如\x3ccode\x3e#each (el, index) in @list \x3c\/code\x3e, \x27#eachEnd\x27, \x27#if \x27,\x27#ifEnd\x27。还是改动tokenize方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 if (value.charAt(0) === \x27#\x27) {\n    if (value === \x27#eachEnd\x27 || value === \x27#ifEnd\x27) {\n        ret.push({\n            expr: \x27}\x27,\n            type: \x27logic\x27\n        })\n    } else if (value.slice(0, 4) === \x27#if \x27) {\n        ret.push({\n            expr: \x27if(\x27 \x2b value.slice(4) \x2b \x27){\x27,\n            type: \x27logic\x27\n        })\n    } else if (value.slice(0, 6) === \x27#each \x27) {\n        var arr = value.slice(6).split(\x27 in \x27)\n        var arrayName = arr[1]\n        var args = arr[0].match(\/[$\\w_]\x2b\/g)\n        var itemName = args.pop()\n        var indexName = args.pop() || \x27$index\x27\n        value = [\x27for(var \x27, \x27 = 0;\x27, \x27\x3c\x27 \x2b arrayName \x2b \x27.length;\x27, \x27\x2b\x2b){\x27].join(indexName) \x2b\n                \x27\\nvar \x27 \x2b itemName \x2b \x27 = \x27 \x2b arrayName \x2b \x27[\x27 \x2b indexName \x2b \x27];\x27\n        ret.push({\n            expr: value,\n            type: \x27logic\x27\n        })\n    \n    }\n    \n} else{\n   \/\/...\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cs\x22\x3e\x3ccode\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e.charAt(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) === \x3cspan class=\x22hljs-string\x22\x3e\x27#\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e === \x3cspan class=\x22hljs-string\x22\x3e\x27#eachEnd\x27\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e === \x3cspan class=\x22hljs-string\x22\x3e\x27#ifEnd\x27\x3c\/span\x3e) {\n        ret.push({\n            expr: \x3cspan class=\x22hljs-string\x22\x3e\x27}\x27\x3c\/span\x3e,\n            type: \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e\n        })\n    } \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e=== \x3cspan class=\x22hljs-string\x22\x3e\x27#if \x27\x3c\/span\x3e) {\n        ret.push({\n            expr: \x3cspan class=\x22hljs-string\x22\x3e\x27if(\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27){\x27\x3c\/span\x3e,\n            type: \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e\n        })\n    } \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e=== \x3cspan class=\x22hljs-string\x22\x3e\x27#each \x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arr = \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e.slice(\x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e).split(\x3cspan class=\x22hljs-string\x22\x3e\x27 in \x27\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e arrayName = arr[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = arr[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].match(\/[$\\w_]\x2b\/g)\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e itemName = args.pop()\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e indexName = args.pop() || \x3cspan class=\x22hljs-string\x22\x3e\x27$index\x27\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e = [\x3cspan class=\x22hljs-string\x22\x3e\x27for(var \x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27 = 0;\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;\x27\x3c\/span\x3e \x2b arrayName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.length;\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x2b\x2b){\x27\x3c\/span\x3e].\x3cspan class=\x22hljs-keyword\x22\x3ejoin\x3c\/span\x3e(indexName) \x2b\n                \x3cspan class=\x22hljs-string\x22\x3e\x27\\nvar \x27\x3c\/span\x3e \x2b itemName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 = \x27\x3c\/span\x3e \x2b arrayName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27[\x27\x3c\/span\x3e \x2b indexName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27];\x27\x3c\/span\x3e\n        ret.push({\n            expr: \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e,\n            type: \x3cspan class=\x22hljs-string\x22\x3e\x27logic\x27\x3c\/span\x3e\n        })\n    \n    }\n    \n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对应的模板改成\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var tpl = \x27你好,我的名字叫\x3c%@name%\x3e, 今年已经 \x3c%@info.age%\x3e岁了,喜欢\x3c%#each el in @list %\x3e\x3c% el %\x3e \x3c% #eachEnd %\x3e\x27\nvar fn = render(tpl)\nconsole.log(fn \x2b \x26quot;\x26quot;)\nconsole.log(fn(data))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e tpl = \x3cspan class=\x22hljs-string\x22\x3e\x27你好,我的名字叫\x26lt;%@name%\x26gt;, 今年已经 \x26lt;%@info.age%\x26gt;岁了,喜欢\x26lt;%#each el in @list %\x26gt;\x26lt;% el %\x26gt; \x26lt;% #eachEnd %\x26gt;\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fn = render(tpl)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn \x2b \x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(fn(data))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDuAk?w=463\x26amp;h=248\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDuAk?w=463\x26amp;h=248\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可能有人觉#for, #forEnd这样的语法糖比较丑，无问题，这个可以改，主要我们的tokenize方法足够强大，就能实现mustache这样的模板引擎。但所有模板引擎也基本上是这么实现的，有的还支持过滤器，也就是在js 类型的语句再进行处理，将｜后面的字符器再切割出来。\x3c\/p\x3e\n\x3cp\x3e如果虚拟DOM呢？那就需要一个html parser，这个工程巨大，比如reactive这个库，早期不使用html parser与虚拟DOM，只有3，4千行，加入这些炫酷功能后就达到1W6K行。返回一个字符串与返回一个类似DOM树的对象树结构是不一样。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>前端模板的原理与实现</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006990480">https://segmentfault.com/a/1190000006990480</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/g6kvbj2tctr/" target="_blank">https://alili.tech/archive/g6kvbj2tctr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>