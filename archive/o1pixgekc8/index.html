<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="在 Node.js 中引入模块：你所需要知道的一切都在这里"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>在 Node.js 中引入模块：你所需要知道的一切都在这里 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/o1pixgekc8/",
				"appid": "1613049289050283", 
				"title": "在 Node.js 中引入模块：你所需要知道的一切都在这里 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-16T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/06scw6kxmvf5/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/h21nmsbcbm7/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&text=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&text=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&title=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&is_video=false&description=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&title=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&title=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&title=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo1pixgekc8%2f&title=%e5%9c%a8%20Node.js%20%e4%b8%ad%e5%bc%95%e5%85%a5%e6%a8%a1%e5%9d%97%ef%bc%9a%e4%bd%a0%e6%89%80%e9%9c%80%e8%a6%81%e7%9f%a5%e9%81%93%e7%9a%84%e4%b8%80%e5%88%87%e9%83%bd%e5%9c%a8%e8%bf%99%e9%87%8c"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">在 Node.js 中引入模块：你所需要知道的一切都在这里</h1><div class="meta"><div class="postdate"><time datetime="2019-01-16" itemprop="datePublished">2019-01-16</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009060869?w=1794\x26amp;h=648\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009060869?w=1794\x26amp;h=648\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e本文作者：Jacob Beltran \x3cbr\x3e编译：\x3ca href=\x22https:\/\/www.zhihu.com\/people\/hu-zi-da-ha\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e胡子大哈\x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e翻译原文：\x3ca href=\x22http:\/\/huziketang.com\/blog\/posts\/detail?postId=58eaf471a58c240ae35bb8e3\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/huziketang.com\/blog\/posts\/detail?postId=58eaf471a58c240ae35bb8e3\x3c\/a\x3e  \x3cbr\x3e英文连接：\x3ca href=\x22https:\/\/medium.freecodecamp.com\/requiring-modules-in-node-js-everything-you-need-to-know-e7fbd119be8#.5czdrc1aa\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eRequiring modules in Node.js: Everything you need to know\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3eNode 中有两个核心模块来对模块依赖进行管理：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erequire\x3c\/code\x3e 模块。全局范围生效，不需要 \x3ccode\x3erequire(\x27require\x27)\x3c\/code\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emodule\x3c\/code\x3e 模块。全局范围生效，不需要 \x3ccode\x3erequire(\x27module\x27)\x3c\/code\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你可以把 \x3ccode\x3erequire\x3c\/code\x3e 当做是命令行，而把 \x3ccode\x3emodule\x3c\/code\x3e 当做是所有引入模块的组织者。\x3c\/p\x3e\n\x3cp\x3e在 Node 中引入模块并不是什么复杂的概念，见下面例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const config = require(\x27\/path\/to\/file\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22JavaScript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/path\/to\/file\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3erequire\x3c\/code\x3e 引入的对象主要是函数。当 Node 调用 \x3ccode\x3erequire()\x3c\/code\x3e 函数，并且传递一个文件路径给它的时候，Node 会经历如下几个步骤：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eResolving\x3c\/strong\x3e：找到文件的绝对路径；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eLoading\x3c\/strong\x3e：判断文件内容类型；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eWrapping\x3c\/strong\x3e：打包，给这个文件赋予一个私有作用范围。这是使 \x3ccode\x3erequire\x3c\/code\x3e 和 \x3ccode\x3emodule\x3c\/code\x3e 模块在本地引用的一种方法；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eEvaluating\x3c\/strong\x3e：VM 对加载的代码进行处理的地方；\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eCaching\x3c\/strong\x3e：当再次需要用这个文件的时候，不需要重复一遍上面步骤。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e本文中，我会用不同的例子来解释上面的各个步骤，并且介绍在 Node 中它们对我们写的模块有什么样的影响。\x3c\/p\x3e\n\x3cp\x3e为了方便大家看文章和理解命令，我首先创建一个目录，后面的操作都会在这个目录中进行。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    mkdir ~\/learn-node \x26amp;\x26amp; cd ~\/learn-node\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode class=\x22Linux\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e    mkdir ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e\x26amp;\x26amp; cd\x3c\/span\x3e ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3c\/code\x3e\x3cspan class=\x22hljs-title\x22\x3e\x3c\/span\x3e\x3c\/pre\x3e\n\x3cp\x3e文章中接下来的部分都会在 \x3ccode\x3e~\/learn-node\x3c\/code\x3e 文件夹下运行。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e1. Resolving - 解析本地路径\x3c\/h2\x3e\n\x3cp\x3e首先来为你介绍 \x3ccode\x3emodule\x3c\/code\x3e 对象，可以先在控制台中看一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node\n    \x3e module\n    Module {\n      id: \x27\x3crepl\x3e\x27,\n      exports: {},\n      parent: undefined,\n      filename: null,\n      loaded: false,\n      children: [],\n      paths: [ ... ] }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-string\x22\x3e~\/learn-node\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x26gt; module\n    Module {\n\x3c\/span\x3e\x3cspan class=\x22hljs-attr\x22\x3e      id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x26lt;repl\x26gt;\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      parent:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eundefined,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      filename:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e每一个模块都有 \x3ccode\x3eid\x3c\/code\x3e 属性来唯一标示它。\x3ccode\x3eid\x3c\/code\x3e 通常是文件的完整路径，但是在控制台中一般显示成 \x3ccode\x3e\x26lt;repl\x26gt;\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3eNode 模块和文件系统中的文件通常是一一对应的，引入一个模块需要把文件内容加载到内存中。因为 Node 有很多种方法引入一个文件（例如相对路径，或者提前配置好的路径），所以首先需要找到文件的绝对路径。\x3c\/p\x3e\n\x3cp\x3e如果我引入了一个 \x3ccode\x3e\x27find-me\x27\x3c\/code\x3e 模块，并没有指定它的路径的话：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    require(\x27find-me\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27find-me\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eNode 会按照 \x3ccode\x3emodule.paths\x3c\/code\x3e 所指定的文件目录顺序依次寻找 \x3ccode\x3efind-me.js\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node\n    \x3e module.paths\n    [ \x27\/Users\/samer\/learn-node\/repl\/node_modules\x27,\n      \x27\/Users\/samer\/learn-node\/node_modules\x27,\n      \x27\/Users\/samer\/node_modules\x27,\n      \x27\/Users\/node_modules\x27,\n      \x27\/node_modules\x27,\n      \x27\/Users\/samer\/.node_modules\x27,\n      \x27\/Users\/samer\/.node_libraries\x27,\n      \x27\/usr\/local\/Cellar\/node\/7.7.1\/lib\/node\x27 ]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; module\x3c\/span\x3e.paths\n    [ \x27\/Users\/samer\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\/repl\x3c\/span\x3e\/node_modules\x27,\n      \x27\/Users\/samer\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\/node_modules\x3c\/span\x3e\x27,\n      \x27\/Users\/samer\/node_modules\x27,\n      \x27\/Users\/node_modules\x27,\n      \x27\/node_modules\x27,\n      \x27\/Users\/samer\/.node_modules\x27,\n      \x27\/Users\/samer\/.node_libraries\x27,\n      \x27\/usr\/local\/Cellar\/\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\/7\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e7.1\x3c\/span\x3e\/lib\/\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e\x27 ]\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个路径列表基本上包含了从当前目录到根目录的所有路径中的 node_modules 目录。其中还包含了一些不建议使用的遗留目录。如果 Node 在上面所有的目录中都没有找到 \x3ccode\x3efind-me.js\x3c\/code\x3e，会抛出一个“cannot find module error.”错误。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27)\n    Error: Cannot find module \x27find-me\x27\n        at Function.Module._resolveFilename (module.js:470:15)\n        at Function.Module._load (module.js:418:25)\n        at Module.require (module.js:498:17)\n        at require (internal\/module.js:20:19)\n        at repl:1:1\n        at ContextifyScript.Script.runInThisContext (vm.js:23:33)\n        at REPLServer.defaultEval (repl.js:336:29)\n        at bound (domain.js:280:14)\n        at REPLServer.runBound [as eval] (domain.js:293:12)\n        at REPLServer.onLine (repl.js:533:10)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e    ~\/learn-node $ node\n    \x26gt; require(\x3cspan class=\x22hljs-string\x22\x3e\x27find-me\x27\x3c\/span\x3e)\n    Error: Cannot find module \x3cspan class=\x22hljs-string\x22\x3e\x27find-me\x27\x3c\/span\x3e\n        at Function\x3cspan class=\x22hljs-selector-class\x22\x3e.Module\x3c\/span\x3e._resolveFilename (module\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e470\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e)\n        at Function\x3cspan class=\x22hljs-selector-class\x22\x3e.Module\x3c\/span\x3e._load (module\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e418\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e25\x3c\/span\x3e)\n        at Module\x3cspan class=\x22hljs-selector-class\x22\x3e.require\x3c\/span\x3e (module\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e498\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e17\x3c\/span\x3e)\n        at require (internal\/module\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e19\x3c\/span\x3e)\n        at repl:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n        at ContextifyScript\x3cspan class=\x22hljs-selector-class\x22\x3e.Script\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.runInThisContext\x3c\/span\x3e (vm\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e23\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e33\x3c\/span\x3e)\n        at REPLServer\x3cspan class=\x22hljs-selector-class\x22\x3e.defaultEval\x3c\/span\x3e (repl\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e336\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e)\n        at bound (domain\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e280\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e)\n        at REPLServer\x3cspan class=\x22hljs-selector-class\x22\x3e.runBound\x3c\/span\x3e [as eval] (domain\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e293\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e)\n        at REPLServer\x3cspan class=\x22hljs-selector-class\x22\x3e.onLine\x3c\/span\x3e (repl\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e533\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果现在创建一个 \x3ccode\x3enode_modules\x3c\/code\x3e，并把 \x3ccode\x3efind-me.js\x3c\/code\x3e 放进去，那么 \x3ccode\x3erequire(\x27find-me\x27)\x3c\/code\x3e 就能找到了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ mkdir node_modules \n    ~\/learn-node $ echo \x26quot;console.log(\x27I am not lost\x27);\x26quot; \x3e node_modules\/find-me.js\n    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27);\n    I am not lost\n    {}\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e mkdir node_modules \n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27I am not lost\x27);\x22\x3c\/span\x3e \x26gt; node_modules\/find-me.js\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; require\x3c\/span\x3e(\x27find-me\x27);\n    I am not lost\n    {}\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e假设还有另一个目录中存在 \x3ccode\x3efind-me.js\x3c\/code\x3e，例如在 home\/node_modules 目录中有另一个 \x3ccode\x3efind-me.js\x3c\/code\x3e 文件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    $ mkdir ~\/node_modules\n    $ echo \x26quot;console.log(\x27I am the root of all problems\x27);\x26quot; \x3e ~\/node_modules\/find-me.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vim\x22\x3e\x3ccode\x3e    $ \x3cspan class=\x22hljs-built_in\x22\x3emkdir\x3c\/span\x3e ~\/node_modules\n    $ \x3cspan class=\x22hljs-keyword\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27I am the root of all problems\x27);\x22\x3c\/span\x3e \x26gt; ~\/node_modules\/\x3cspan class=\x22hljs-keyword\x22\x3efind\x3c\/span\x3e-\x3cspan class=\x22hljs-keyword\x22\x3eme\x3c\/span\x3e.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当我们从 \x3ccode\x3elearn-node\x3c\/code\x3e 目录中执行 \x3ccode\x3erequire(\x27find-me\x27)\x3c\/code\x3e 的时候，由于 \x3ccode\x3elearn-node\x3c\/code\x3e 有自己的 \x3ccode\x3enode_modules\/find-me.js\x3c\/code\x3e，这时不会加载 home 目录下的 \x3ccode\x3efind-me.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27)\n    I am not lost\n    {}\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; require\x3c\/span\x3e(\x27find-me\x27)\n    I am not lost\n    {}\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e假设我们把 \x3ccode\x3elearn-node\x3c\/code\x3e 目录下的 \x3ccode\x3enode_modules\x3c\/code\x3e 移到 \x3ccode\x3e~\/learn-node\x3c\/code\x3e，再重新执行 \x3ccode\x3erequire(\x27find-me\x27)\x3c\/code\x3e 的话，按照上面规定的顺序查找文件，这时候 home 目录下的 \x3ccode\x3enode_modules\x3c\/code\x3e 就会被使用了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ rm -r node_modules\/\n    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27)\n    I am the root of all problems\n    {}\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e rm -r node_modules\/\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; require\x3c\/span\x3e(\x27find-me\x27)\n    I am the root of all problems\n    {}\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3erequire 一个文件夹\x3c\/h3\x3e\n\x3cp\x3e模块不一定非要是文件，也可以是个文件夹。我们可以在 \x3ccode\x3enode_modules\x3c\/code\x3e 中创建一个 \x3ccode\x3efind-me\x3c\/code\x3e 文件夹，并且放一个 \x3ccode\x3eindex.js\x3c\/code\x3e 文件在其中。那么执行 \x3ccode\x3erequire(\x27find-me\x27)\x3c\/code\x3e 将会使用 \x3ccode\x3eindex.js\x3c\/code\x3e 文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ mkdir -p node_modules\/find-me\n    ~\/learn-node $ echo \x26quot;console.log(\x27Found again.\x27);\x26quot; \x3e node_modules\/find-me\/index.js\n    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27);\n    Found again.\n    {}\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e mkdir -p node_modules\/find-me\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27Found again.\x27);\x22\x3c\/span\x3e \x26gt; node_modules\/find-me\/index.js\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; require\x3c\/span\x3e(\x27find-me\x27);\n    Found again.\n    {}\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里注意，我们本目录下创建了 \x3ccode\x3enode_modules\x3c\/code\x3e 文件夹，就不会使用 home 目录下的 \x3ccode\x3enode_modules\x3c\/code\x3e 了。\x3c\/p\x3e\n\x3cp\x3e当引入一个文件夹的时候，默认会去找 \x3ccode\x3eindex.js\x3c\/code\x3e 文件，这也可以手动控制指定到其他文件，利用 \x3ccode\x3epackage.json\x3c\/code\x3e 的 \x3ccode\x3emain\x3c\/code\x3e 属性就可以。例如，我们执行 \x3ccode\x3erequire(\x27find-me\x27)\x3c\/code\x3e，并且要从 \x3ccode\x3efind-me\x3c\/code\x3e 文件夹下的 \x3ccode\x3estart.js\x3c\/code\x3e 文件开始解析，那么用 \x3ccode\x3epackage.json\x3c\/code\x3e 的做法如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ echo \x26quot;console.log(\x27I rule\x27);\x26quot; \x3e node_modules\/find-me\/start.js\n    ~\/learn-node $ echo \x27{ \x26quot;name\x26quot;: \x26quot;find-me-folder\x26quot;, \x26quot;main\x26quot;: \x26quot;start.js\x26quot; }\x27 \x3e node_modules\/find-me\/package.json\n    ~\/learn-node $ node\n    \x3e require(\x27find-me\x27);\n    I rule\n    {}\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27I rule\x27);\x22\x3c\/span\x3e \x26gt; node_modules\/find-me\/\x3cspan class=\x22hljs-literal\x22\x3estart\x3c\/span\x3e.js\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x27{ \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22find-me-folder\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22main\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22start.js\x22\x3c\/span\x3e }\x27 \x26gt; node_modules\/find-me\/package.json\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e\n    \x3cspan class=\x22hljs-title\x22\x3e\x26gt; require\x3c\/span\x3e(\x27find-me\x27);\n    I \x3cspan class=\x22hljs-keyword\x22\x3erule\x3c\/span\x3e\n    {}\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3erequire.resolve\x3c\/h3\x3e\n\x3cp\x3e如果你只是想解析模块，而不执行的话，可以使用 \x3ccode\x3erequire.resolve\x3c\/code\x3e 函数。它和主 \x3ccode\x3erequire\x3c\/code\x3e 函数所做的事情一模一样，除了不加载文件。当没找到文件的时候也会抛出错误，如果找到会返回文件的完整路径。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \x3e require.resolve(\x27find-me\x27);\n    \x27\/Users\/samer\/learn-node\/node_modules\/find-me\/start.js\x27\n    \x3e require.resolve(\x27not-there\x27);\n    Error: Cannot find module \x27not-there\x27\n        at Function.Module._resolveFilename (module.js:470:15)\n        at Function.resolve (internal\/module.js:27:19)\n        at repl:1:9\n        at ContextifyScript.Script.runInThisContext (vm.js:23:33)\n        at REPLServer.defaultEval (repl.js:336:29)\n        at bound (domain.js:280:14)\n        at REPLServer.runBound [as eval] (domain.js:293:12)\n        at REPLServer.onLine (repl.js:533:10)\n        at emitOne (events.js:101:20)\n        at REPLServer.emit (events.js:191:7)\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e    \x26gt; require.resolve(\x3cspan class=\x22hljs-symbol\x22\x3e\x27find\x3c\/span\x3e-me\x27);\n    \x27\/Users\/samer\/learn-node\/node_modules\/find-me\/start.js\x27\n    \x26gt; require.resolve(\x3cspan class=\x22hljs-symbol\x22\x3e\x27not\x3c\/span\x3e-there\x27);\n    Error: Cannot find module \x3cspan class=\x22hljs-symbol\x22\x3e\x27not\x3c\/span\x3e-there\x27\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e.Module._resolveFilename (module.js:\x3cspan class=\x22hljs-number\x22\x3e470\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eFunction\x3c\/span\x3e.resolve (internal\/module.js:\x3cspan class=\x22hljs-number\x22\x3e27\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e19\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e repl:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e ContextifyScript.Script.runInThisContext (vm.js:\x3cspan class=\x22hljs-number\x22\x3e23\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e33\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e REPLServer.defaultEval (repl.js:\x3cspan class=\x22hljs-number\x22\x3e336\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e bound (domain.js:\x3cspan class=\x22hljs-number\x22\x3e280\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e REPLServer.runBound [as eval] (domain.js:\x3cspan class=\x22hljs-number\x22\x3e293\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e12\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e REPLServer.onLine (repl.js:\x3cspan class=\x22hljs-number\x22\x3e533\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e emitOne (events.js:\x3cspan class=\x22hljs-number\x22\x3e101\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3eat\x3c\/span\x3e REPLServer.emit (events.js:\x3cspan class=\x22hljs-number\x22\x3e191\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e)\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e它可以用于检查一个包是否已经安装，只有当包存在的时候才使用该包。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e相对路径和绝对路径\x3c\/h3\x3e\n\x3cp\x3e除了可以把模块放在 \x3ccode\x3enode_modules\x3c\/code\x3e 目录中，还有更自由的方法。我们可以把模块放在任何地方，然后通过相对路径（\x3ccode\x3e.\/\x3c\/code\x3e 和 \x3ccode\x3e..\/\x3c\/code\x3e）或者绝对路径（\x3ccode\x3e\/\x3c\/code\x3e)来指定文件路径。\x3c\/p\x3e\n\x3cp\x3e例如 \x3ccode\x3efind-me.js\x3c\/code\x3e 文件是在 \x3ccode\x3elib\x3c\/code\x3e 目录下，而不是在 \x3ccode\x3enode_modules\x3c\/code\x3e 下，我们可以这样引入：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    require(\x27.\/lib\/find-me\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/lib\/find-me\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e文件的 parent-child 关系\x3c\/h3\x3e\n\x3cp\x3e创建一个文件 \x3ccode\x3elib\/util.js\x3c\/code\x3e 并且写一行 \x3ccode\x3econsole.log\x3c\/code\x3e 在里面来标识它，当然，这个 \x3ccode\x3econsole.log\x3c\/code\x3e 就是模块本身。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ mkdir lib\n    ~\/learn-node $ echo \x26quot;console.log(\x27In util\x27, module);\x26quot; \x3e lib\/util.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crystal\x22\x3e\x3ccode\x3e    ~\x3cspan class=\x22hljs-regexp\x22\x3e\/learn-node $ mkdir lib\n    ~\/learn\x3c\/span\x3e-node $ echo \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27In util\x27, module);\x22\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e\/\x3cspan class=\x22hljs-title\x22\x3eutil\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ejs\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 \x3ccode\x3eindex.js\x3c\/code\x3e 中写上将要执行的 node 命令，并且在 \x3ccode\x3eindex.js\x3c\/code\x3e 中引入 \x3ccode\x3elib\/util.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ echo \x26quot;console.log(\x27In index\x27, module); require(\x27.\/lib\/util\x27);\x26quot; \x3e index.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(\x27In index\x27, module); require(\x27.\/lib\/util\x27);\x22\x3c\/span\x3e \x26gt; index.js\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在在 node 中执行 \x3ccode\x3eindex.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node index.js\n    In index Module {\n      id: \x27.\x27,\n      exports: {},\n      parent: null,\n      filename: \x27\/Users\/samer\/learn-node\/index.js\x27,\n      loaded: false,\n      children: [],\n      paths: [ ... ] }\n    In util Module {\n      id: \x27\/Users\/samer\/learn-node\/lib\/util.js\x27,\n      exports: {},\n      parent:\n       Module {\n         id: \x27.\x27,\n         exports: {},\n         parent: null,\n         filename: \x27\/Users\/samer\/learn-node\/index.js\x27,\n         loaded: false,\n         children: [ [Circular] ],\n         paths: [...] },\n      filename: \x27\/Users\/samer\/learn-node\/lib\/util.js\x27,\n      loaded: false,\n      children: [],\n      paths: [...] }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-string\x22\x3e~\/learn-node\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eindex.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3eIn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eindex\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      parent:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3eIn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eutil\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/lib\/util.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      parent:\x3c\/span\x3e\n       \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         parent:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[Circular]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[...]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/lib\/util.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[...]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意到这里，\x3ccode\x3eindex\x3c\/code\x3e 模块（\x3ccode\x3eid:\x27.\x27\x3c\/code\x3e）被列到了 \x3ccode\x3elib\/util\x3c\/code\x3e 的 parent 属性中。而 \x3ccode\x3elib\/util\x3c\/code\x3e 并没有被列到 \x3ccode\x3eindex\x3c\/code\x3e 的 children 属性，而是用一个 \x3ccode\x3e[Circular]\x3c\/code\x3e 代替的。这是因为这是个循环引用，如果这里使用 \x3ccode\x3elib\/util\x3c\/code\x3e 的话，那就变成一个无限循环了。这就是为什么在 \x3ccode\x3eindex\x3c\/code\x3e 中使用 \x3ccode\x3e[Circular]\x3c\/code\x3e 来替代 \x3ccode\x3elib\/util\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e那么重点来了，如果在 \x3ccode\x3elib\/util\x3c\/code\x3e 中引入了 \x3ccode\x3eindex\x3c\/code\x3e 模块会怎么样？这就是我们所谓的模块循环依赖问题，在 Node 中是允许这样做的。\x3c\/p\x3e\n\x3cp\x3e但是 Node 如何处理这种情况呢？为了更好地理解这一问题，我们先来了解一下模块对象的其他知识。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e2. Loading - exports，module.exports，和模块的同步加载\x3c\/h2\x3e\n\x3cp\x3e在所有的模块中，exports 都是一个特殊的对象。如果你有注意的话，上面我们每次打印模块信息的时候，都有一个是空值的 exports 属性。我们可以给这个 exports 对象加任何想加的属性，例如在 \x3ccode\x3eindex.js\x3c\/code\x3e 和 \x3ccode\x3elib\/util.js\x3c\/code\x3e 中给它添加一个 \x3ccode\x3eid\x3c\/code\x3e 属性：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 在 lib\/util.js 的最上面添加这行\n    exports.id = \x27lib\/util\x27;\n    \/\/ 在 index.js 的最上面添加这行\n    exports.id = \x27index\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 lib\/util.js 的最上面添加这行\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eexports\x3c\/span\x3e.id = \x3cspan class=\x22hljs-string\x22\x3e\x27lib\/util\x27\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在 index.js 的最上面添加这行\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eexports\x3c\/span\x3e.id = \x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e执行 \x3ccode\x3eindex.js\x3c\/code\x3e，可以看到我们添加的属性已经存在于模块对象中：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node index.js\n    In index Module {\n      id: \x27.\x27,\n      exports: { id: \x27index\x27 },\n      loaded: false,\n      ... }\n    In util Module {\n      id: \x27\/Users\/samer\/learn-node\/lib\/util.js\x27,\n      exports: { id: \x27lib\/util\x27 },\n      parent:\n       Module {\n         id: \x27.\x27,\n         exports: { id: \x27index\x27 },\n         loaded: false,\n         ... },\n      loaded: false,\n      ... }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-string\x22\x3e~\/learn-node\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eindex.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3eIn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eindex\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3eIn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eutil\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/lib\/util.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lib\/util\x27\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      parent:\x3c\/span\x3e\n       \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27index\x27\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n         \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面为了输出结果简洁，我删掉了一些属性。你可以往 exports 对象中添加任意多的属性，甚至可以把 exports 对象变成其他类型，比如把 exports 对象变成函数，做法如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 在 index.js 的 console.log 前面添加这行\n    module.exports = function() {};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e    \/\/ 在 \x3cspan class=\x22hljs-built_in\x22\x3eindex\x3c\/span\x3e.js 的 console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e 前面添加这行\n    \x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当你执行 \x3ccode\x3eindex.js\x3c\/code\x3e 的时候，你会看到如下信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node index.js\n    In index Module {\n      id: \x27.\x27,\n      exports: [Function],\n      loaded: false,\n      ... }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eindex\x3c\/span\x3e.js\n    \x3cspan class=\x22hljs-keyword\x22\x3eIn\x3c\/span\x3e index Module {\n      id: \x27.\x27,\n      exports: [Function],\n      loaded: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n      ... }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里注意我们没有使用 \x3ccode\x3eexport = function() {}\x3c\/code\x3e 来改变 \x3ccode\x3eexports\x3c\/code\x3e 对象。没有这样做是因为在模块中的 \x3ccode\x3eexports\x3c\/code\x3e 变量实际上是 \x3ccode\x3emodule.exports\x3c\/code\x3e 的一个引用，而 \x3ccode\x3emodule.exports\x3c\/code\x3e 才是控制所有对外属性的。\x3ccode\x3eexports\x3c\/code\x3e 和 \x3ccode\x3emodule.exports\x3c\/code\x3e 指向同一块内存，如果把 \x3ccode\x3eexports\x3c\/code\x3e 指向一个函数，那么相当于改变了 \x3ccode\x3eexports\x3c\/code\x3e 的指向，\x3ccode\x3eexports\x3c\/code\x3e 就不再是引用了。即便你改变了 \x3ccode\x3eexports\x3c\/code\x3e，\x3ccode\x3emodule.exports\x3c\/code\x3e 也是不变的。\x3c\/p\x3e\n\x3cp\x3e模块的 \x3ccode\x3emodule.exports\x3c\/code\x3e 是一个模块的对外接口，就是当你使用 \x3ccode\x3erequire\x3c\/code\x3e 函数时所返回的东西。例如把 \x3ccode\x3eindex.js\x3c\/code\x3e 中的代码改一下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const UTIL = require(\x27.\/lib\/util\x27);\n    console.log(\x27UTIL:\x27, UTIL);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e UTIL = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/lib\/util\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27UTIL:\x27\x3c\/span\x3e, UTIL);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的代码将会捕获 \x3ccode\x3elib\/util\x3c\/code\x3e 中输出的属性，赋值给 \x3ccode\x3eUTIL\x3c\/code\x3e 常量。当执行 \x3ccode\x3eindex.js\x3c\/code\x3e 的时候，最后一行将会输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    UTIL: { id: \x27lib\/util\x27 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-selector-tag\x22\x3eUTIL\x3c\/span\x3e: { \x3cspan class=\x22hljs-attribute\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27lib\/util\x27\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来聊一下 \x3ccode\x3eloaded\x3c\/code\x3e 属性。上面我们每次输出模块信息，都能看到一个 \x3ccode\x3eloaded\x3c\/code\x3e 属性，值是 \x3ccode\x3efalse\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3emodule\x3c\/code\x3e 模块使用 \x3ccode\x3eloaded\x3c\/code\x3e 属性来追踪哪些模块已经加载完毕，哪些模块正在加载。例如我们可以调用 \x3ccode\x3esetImmediate\x3c\/code\x3e 来打印 \x3ccode\x3emodule\x3c\/code\x3e 对象，用它可以看到 \x3ccode\x3eindex.js\x3c\/code\x3e 的完全加载信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ In index.js\n    setImmediate(() =\x3e {\n      console.log(\x27The index.js module object is now loaded!\x27, module)\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e In index.js\n    setImmediate(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27The index.js module object is now loaded!\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e)\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e输出结果：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    The index.js module object is now loaded! Module {\n      id: \x27.\x27,\n      exports: [Function],\n      parent: null,\n      filename: \x27\/Users\/samer\/learn-node\/index.js\x27,\n      loaded: true,\n      children:\n       [ Module {\n           id: \x27\/Users\/samer\/learn-node\/lib\/util.js\x27,\n           exports: [Object],\n           parent: [Circular],\n           filename: \x27\/Users\/samer\/learn-node\/lib\/util.js\x27,\n           loaded: true,\n           children: [],\n           paths: [Object] } ],\n      paths:\n       [ \x27\/Users\/samer\/learn-node\/node_modules\x27,\n         \x27\/Users\/samer\/node_modules\x27,\n         \x27\/Users\/node_modules\x27,\n         \x27\/node_modules\x27 ] }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-selector-tag\x22\x3eThe\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3emodule\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eobject\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eis\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3enow\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eloaded\x3c\/span\x3e! \x3cspan class=\x22hljs-selector-tag\x22\x3eModule\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-attribute\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attribute\x22\x3eexports\x3c\/span\x3e: [Function],\n      \x3cspan class=\x22hljs-attribute\x22\x3eparent\x3c\/span\x3e: null,\n      \x3cspan class=\x22hljs-attribute\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/index.js\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attribute\x22\x3eloaded\x3c\/span\x3e: true,\n      \x3cspan class=\x22hljs-attribute\x22\x3echildren\x3c\/span\x3e:\n       [ Module {\n           \x3cspan class=\x22hljs-attribute\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/lib\/util.js\x27\x3c\/span\x3e,\n           \x3cspan class=\x22hljs-attribute\x22\x3eexports\x3c\/span\x3e: [Object],\n           \x3cspan class=\x22hljs-attribute\x22\x3eparent\x3c\/span\x3e: [Circular],\n           \x3cspan class=\x22hljs-attribute\x22\x3efilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/lib\/util.js\x27\x3c\/span\x3e,\n           \x3cspan class=\x22hljs-attribute\x22\x3eloaded\x3c\/span\x3e: true,\n           \x3cspan class=\x22hljs-attribute\x22\x3echildren\x3c\/span\x3e: [],\n           \x3cspan class=\x22hljs-attribute\x22\x3epaths\x3c\/span\x3e: [Object] } ],\n      \x3cspan class=\x22hljs-attribute\x22\x3epaths\x3c\/span\x3e:\n       [ \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/learn-node\/node_modules\x27\x3c\/span\x3e,\n         \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/node_modules\x27\x3c\/span\x3e,\n         \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/node_modules\x27\x3c\/span\x3e,\n         \x3cspan class=\x22hljs-string\x22\x3e\x27\/node_modules\x27\x3c\/span\x3e ] }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以注意到 \x3ccode\x3elib\/util.js\x3c\/code\x3e 和 \x3ccode\x3eindex.js\x3c\/code\x3e 都已经加载完毕了。\x3c\/p\x3e\n\x3cp\x3e当一个模块加载完成的时候，\x3ccode\x3eexports\x3c\/code\x3e 对象才完整，整个加载的过程都是同步的。这也是为什么在一个事件循环后所有的模块都处于完全加载状态的原因。\x3c\/p\x3e\n\x3cp\x3e这也意味着不能异步改变 \x3ccode\x3eexports\x3c\/code\x3e 对象，例如，对任何模块做下面这样的事情：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    fs.readFile(\x27\/etc\/passwd\x27, (err, data) =\x3e {\n      if (err) throw err;\n      exports.data = data; \/\/ Will not work.\n    });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e    fs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27\/etc\/passwd\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(err, data)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err;\n      exports.data = data; \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e Will \x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e work.\n    });\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e模块循环依赖\x3c\/h3\x3e\n\x3cp\x3e我们现在来回答上面说到的循环依赖的问题：模块 1 依赖模块 2，模块 2 也依赖模块 1，会发生什么？\x3c\/p\x3e\n\x3cp\x3e现在来创建两个文件，\x3ccode\x3elib\/module1.js\x3c\/code\x3e 和 \x3ccode\x3elib\/module2.js\x3c\/code\x3e，并且让它们相互引用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ lib\/module1.js\n    exports.a = 1;\n    require(\x27.\/module2\x27);\n    exports.b = 2;\n    exports.c = 3;\n    \n    \/\/ lib\/module2.js\n    const Module1 = require(\x27.\/module1\x27);\n    console.log(\x27Module1 is partially loaded here\x27, Module1);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crystal\x22\x3e\x3ccode\x3e    \/\x3cspan class=\x22hljs-regexp\x22\x3e\/ lib\/module\x3c\/span\x3e1.js\n    exports.a = \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/module2\x27\x3c\/span\x3e);\n    exports.b = \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n    exports.c = \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e;\n    \n    \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e\/\x3cspan class=\x22hljs-title\x22\x3emodule2\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3ejs\x3c\/span\x3e\x3c\/span\x3e\n    const Module1 = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/module1\x27\x3c\/span\x3e);\n    console.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Module1 is partially loaded here\x27\x3c\/span\x3e, Module1);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来执行 \x3ccode\x3emodule1.js\x3c\/code\x3e，可以看到：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node lib\/module1.js\n    Module1 is partially loaded here { a: 1 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3elib\x3c\/span\x3e\/module1.js\n    Module1 is partially loaded here { a: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 \x3ccode\x3emodule1\x3c\/code\x3e 完全加载之前需要先加载 \x3ccode\x3emodule2\x3c\/code\x3e，而 \x3ccode\x3emodule2\x3c\/code\x3e 的加载又需要 \x3ccode\x3emodule1\x3c\/code\x3e。这种状态下，我们从 \x3ccode\x3eexports\x3c\/code\x3e 对象中能得到的就是在发生循环依赖之前的这部分。上面代码中，只有 \x3ccode\x3ea\x3c\/code\x3e 属性被引入，因为 \x3ccode\x3eb\x3c\/code\x3e 和 \x3ccode\x3ec\x3c\/code\x3e 都需要在引入 \x3ccode\x3emodule2\x3c\/code\x3e 之后才能加载进来。\x3c\/p\x3e\n\x3cp\x3eNode 使这个问题简单化，在一个模块加载期间开始创建 \x3ccode\x3eexports\x3c\/code\x3e 对象。如果它需要引入其他模块，并且有循环依赖，那么只能部分引入，也就是只能引入发生循环依赖之前所定义的这部分。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eJSON 和 C\/C\x2b\x2b 扩展文件\x3c\/h3\x3e\n\x3cp\x3e我们可以使用 require 函数本地引入 JSON 文件和 C\x2b\x2b 扩展文件，理论上来讲，不需要指定其扩展名。\x3c\/p\x3e\n\x3cp\x3e如果没有指定扩展名，Node 会先尝试将其按 \x3ccode\x3e.js\x3c\/code\x3e 文件来解析，如果不是 \x3ccode\x3e.js\x3c\/code\x3e 文件，再尝试按 \x3ccode\x3e.json\x3c\/code\x3e 文件来解析。如果都不是，会尝试按 \x3ccode\x3e.node\x3c\/code\x3e 二进制文件解析。但是为了使程序更清晰，当引入除了 \x3ccode\x3e.js\x3c\/code\x3e 文件的时候，你都应该指定文件扩展名。\x3c\/p\x3e\n\x3cp\x3e如果你要操作的文件是一些静态配置值，或者是需要定期从外部文件中读取的值，那么引入 JSON 是很好的一个选择。例如有如下的 \x3ccode\x3econfig.json\x3c\/code\x3e 文件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    {\n      \x26quot;host\x26quot;: \x26quot;localhost\x26quot;,\n      \x26quot;port\x26quot;: 8080\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs json\x22\x3e\x3ccode\x3e    {\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22host\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22localhost\x22\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3e\x22port\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们可以直接像这样引用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const { host, port } = require(\x27.\/config\x27);\n    console.log(`Server will run at http:\/\/${host}:${port}`);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { host, port } = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/config\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Server will run at http:\/\/\x3cspan class=\x22hljs-subst\x22\x3e${host}\x3c\/span\x3e:\x3cspan class=\x22hljs-subst\x22\x3e${port}\x3c\/span\x3e`\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行上面的代码会得到这样的输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    Server will run at http:\/\/localhost:8080\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs arduino\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eServer\x3c\/span\x3e will \x3cspan class=\x22hljs-built_in\x22\x3erun\x3c\/span\x3e at http:\x3cspan class=\x22hljs-comment\x22\x3e\/\/localhost:8080\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果 Node 按 \x3ccode\x3e.js\x3c\/code\x3e 和 \x3ccode\x3e.json\x3c\/code\x3e 解析都失败的话，它会按 \x3ccode\x3e.node\x3c\/code\x3e 解析，把这个文件当做一个已编译的扩展模块来解析。\x3c\/p\x3e\n\x3cp\x3eNode 文档中有一个 C\x2b\x2b 写的\x3ca href=\x22https:\/\/nodejs.org\/api\/addons.html#addons_hello_world\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e示例扩展文件\x3c\/a\x3e，它只暴露出一个 \x3ccode\x3ehello()\x3c\/code\x3e 函数，并且函数输出 “world”。\x3c\/p\x3e\n\x3cp\x3e你可以使用 \x3ccode\x3enode-gyp\x3c\/code\x3e 包编译 \x3ccode\x3e.cc\x3c\/code\x3e 文件，生成 \x3ccode\x3e.addon\x3c\/code\x3e 文件。只需要配置 \x3ca href=\x22https:\/\/nodejs.org\/api\/addons.html#addons_building\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebinding.gyp\x3c\/a\x3e 文件来告诉 \x3ccode\x3enode-gyp\x3c\/code\x3e 需要做什么就可以了。\x3c\/p\x3e\n\x3cp\x3e当你有了 \x3ccode\x3eaddon.node\x3c\/code\x3e 文件（名字你可以在 \x3ccode\x3ebinding.gyp\x3c\/code\x3e 中随意配置）以后，你就可以在本地像引入其他模块一样引入它了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const addon = require(\x27.\/addon\x27);\n    console.log(addon.hello());\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e addon = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/addon\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(addon.hello());\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以通过 \x3ccode\x3erequire.extensions\x3c\/code\x3e 来查看对三种文件的支持情况：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009060870?w=800\x26amp;h=443\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009060870?w=800\x26amp;h=443\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以清晰地看到 Node 对每种扩展名所使用的函数及其操作：对 \x3ccode\x3e.js\x3c\/code\x3e 文件使用 \x3ccode\x3emodule._compile\x3c\/code\x3e；对 \x3ccode\x3e.json\x3c\/code\x3e 文件使用 \x3ccode\x3eJSON.parse\x3c\/code\x3e；对 \x3ccode\x3e.node\x3c\/code\x3e 文件使用 \x3ccode\x3eprocess.dlopen\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e3. Wrapping - 你在 Node 中所写的所有代码都会被打包成函数\x3c\/h2\x3e\n\x3cp\x3eNode 的打包模块不是很好理解，首先要先知道 \x3ccode\x3eexports\x3c\/code\x3e \/ \x3ccode\x3emodule.exports\x3c\/code\x3e 的关系。\x3c\/p\x3e\n\x3cp\x3e我们可以用 \x3ccode\x3eexports\x3c\/code\x3e 对象来输出属性，但是不能直接对 \x3ccode\x3eexports\x3c\/code\x3e 进行赋值（替换整个 \x3ccode\x3eexports\x3c\/code\x3e 对象），因为它仅仅是 \x3ccode\x3emodule.exports\x3c\/code\x3e 的引用。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    exports.id = 42; \/\/ This is ok.\n    exports = { id: 42 }; \/\/ This will not work.\n    module.exports = { id: 42 }; \/\/ This is ok.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs java\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3eexports\x3c\/span\x3e.id = \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ This is ok.\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eexports\x3c\/span\x3e = { id: \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e }; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ This will not work.\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eexports\x3c\/span\x3e = { id: \x3cspan class=\x22hljs-number\x22\x3e42\x3c\/span\x3e }; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ This is ok.\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在介绍 Node 的打包过程之前先来了解另一个问题，通常情况下，在浏览器中我们在脚本中定义一个变量：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var answer = 42;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3e    var answer\x3c\/span\x3e = 42;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种方式定义以后，\x3ccode\x3eanswer\x3c\/code\x3e 变量就是一个全局变量了。其他脚本中依然可以访问。而 Node 中不是这样，你在一个模块中定义一个变量，程序的其他模块是不能访问的。Node 是如何做到的呢？\x3c\/p\x3e\n\x3cp\x3e答案很简单，在编译成模块之前，Node 把模块代码都打包成函数，可以用 \x3ccode\x3emodule\x3c\/code\x3e 的 \x3ccode\x3ewrapper\x3c\/code\x3e 属性来查看。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~ $ node\n    \x3e require(\x27module\x27).wrapper\n    [ \x27(function (exports, require, module, __filename, __dirname) { \x27,\n      \x27\\n});\x27 ]\n    \x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ruby\x22\x3e\x3ccode\x3e    ~ $ node\n    \x26gt; \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27module\x27\x3c\/span\x3e).wrapper\n    [ \x3cspan class=\x22hljs-string\x22\x3e\x27(function (exports, require, module, __filename, __dirname) { \x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-string\x22\x3e\x27\\n});\x27\x3c\/span\x3e ]\n    \x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eNode 并不直接执行你所写的代码，而是把你的代码打包成函数后，执行这个函数。这就是为什么一个模块的顶层变量的作用域依然仅限于本模块的原因。\x3c\/p\x3e\n\x3cp\x3e这个打包函数有 5 个参数：\x3ccode\x3eexports\x3c\/code\x3e，\x3ccode\x3erequire\x3c\/code\x3e，\x3ccode\x3emodule\x3c\/code\x3e，\x3ccode\x3e__filename\x3c\/code\x3e，\x3ccode\x3e__dirname\x3c\/code\x3e。函数使变量看起来全局生效，但实际上只在模块内生效。所有的这些参数都在 Node 执行函数时赋值。\x3ccode\x3eexports\x3c\/code\x3e 定义成 \x3ccode\x3emodule.exports\x3c\/code\x3e 的引用；\x3ccode\x3erequire\x3c\/code\x3e 和 \x3ccode\x3emodule\x3c\/code\x3e 都指定为将要执行的这个函数；\x3ccode\x3e__filename\x3c\/code\x3e 和 \x3ccode\x3e__dirname\x3c\/code\x3e 指这个打包模块的绝对路径和目录路径。\x3c\/p\x3e\n\x3cp\x3e在脚本的第一行输入有问题的代码，就能看到 Node 打包的行为；\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ echo \x26quot;euaohseu\x26quot; \x3e bad.js\n    ~\/learn-node $ node bad.js\n    ~\/bad.js:1\n    (function (exports, require, module, __filename, __dirname) { euaohseu\n                                                                  ^\n    ReferenceError: euaohseu is not defined\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e echo \x3cspan class=\x22hljs-string\x22\x3e\x22euaohseu\x22\x3c\/span\x3e \x26gt; bad.js\n    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebad\x3c\/span\x3e.js\n    ~\/bad.js:\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    (function (exports, require, module, __filename, __dirname) { euaohseu\n                                                                  ^\n    ReferenceError: euaohseu is not \x3cspan class=\x22hljs-keyword\x22\x3edefined\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意这里报告出错误的就是打包函数。\x3c\/p\x3e\n\x3cp\x3e另外，模块都打包成函数了，我们可以使用 \x3ccode\x3earguments\x3c\/code\x3e 关键字来访问函数的参数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ echo \x26quot;console.log(arguments)\x26quot; \x3e index.js\n    ~\/learn-node $ node index.js\n    { \x270\x27: {},\n      \x271\x27:\n       { [Function: require]\n         resolve: [Function: resolve],\n         main:\n          Module {\n            id: \x27.\x27,\n            exports: {},\n            parent: null,\n            filename: \x27\/Users\/samer\/index.js\x27,\n            loaded: false,\n            children: [],\n            paths: [Object] },\n         extensions: { ... },\n         cache: { \x27\/Users\/samer\/index.js\x27: [Object] } },\n      \x272\x27:\n       Module {\n         id: \x27.\x27,\n         exports: {},\n         parent: null,\n         filename: \x27\/Users\/samer\/index.js\x27,\n         loaded: false,\n         children: [],\n         paths: [ ... ] },\n      \x273\x27: \x27\/Users\/samer\/index.js\x27,\n      \x274\x27: \x27\/Users\/samer\x27 }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-string\x22\x3e~\/learn-node\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22console.log(arguments)\x22\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x26gt; index.js\n    ~\/learn-node $ node index.js\n    { \x270\x27: {},\n      \x271\x27:\n       { [Function: require]\n\x3c\/span\x3e\x3cspan class=\x22hljs-attr\x22\x3e         resolve:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[Function:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3eresolve],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         main:\x3c\/span\x3e\n          \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            parent:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e            paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[Object]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         extensions:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         cache:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[Object]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x272\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e:\x3c\/span\x3e\n       \x3cspan class=\x22hljs-string\x22\x3eModule\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         id:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         exports:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{},\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         parent:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         filename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         loaded:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         children:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[],\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e         paths:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e...\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e]\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\/index.js\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x274\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/Users\/samer\x27\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一个参数是 \x3ccode\x3eexports\x3c\/code\x3e 对象，初始为空；\x3ccode\x3erequire\x3c\/code\x3e 和 \x3ccode\x3emodule\x3c\/code\x3e 对象都是即将执行的 \x3ccode\x3eindex.js\x3c\/code\x3e 的实例；最后两个参数是文件路径和目录路径。\x3c\/p\x3e\n\x3cp\x3e打包函数的返回值是 \x3ccode\x3emodule.exports\x3c\/code\x3e。在模块内部，可以使用 \x3ccode\x3eexports\x3c\/code\x3e 对象来改变 \x3ccode\x3emodule.exports\x3c\/code\x3e 属性，但是不能对 \x3ccode\x3eexports\x3c\/code\x3e 重新赋值，因为它只是 \x3ccode\x3emodule.exports\x3c\/code\x3e 的引用。\x3c\/p\x3e\n\x3cp\x3e相当于如下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function (require, module, __filename, __dirname) {\n      let exports = module.exports;\n      \/\/ Your Code...\n      return module.exports;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e, __filename, __dirname\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e exports = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports;\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Your Code...\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果对 \x3ccode\x3eexports\x3c\/code\x3e 重新赋值（改变整个 \x3ccode\x3eexports\x3c\/code\x3e 对象），那它就不是 \x3ccode\x3emodule.exports\x3c\/code\x3e 的引用了。这是 JavaScript 引用的工作原理，不仅仅是在这里是这样。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e4. Evaluating - require 对象\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3erequire\x3c\/code\x3e 没有什么特别的，通常作为一个函数返回 \x3ccode\x3emodule.exports\x3c\/code\x3e 对象，函数参数是一个模块名或者一个路径。如果你想的话，尽可以根据自己的逻辑重写 \x3ccode\x3erequire\x3c\/code\x3e 对象。\x3c\/p\x3e\n\x3cp\x3e例如，为了达到测试的目的，我们希望所有的 \x3ccode\x3erequire\x3c\/code\x3e 都默认返回一个 mock 值来替代真实的模块返回值。可以简单地实现如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    require = function() {\n      return { mocked: true };\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3emocked\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e };\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样重写了 \x3ccode\x3erequire\x3c\/code\x3e 以后，每个 \x3ccode\x3erequire(\x27something\x27)\x3c\/code\x3e 调用都会返回一个模拟对象。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3erequire\x3c\/code\x3e 对象也有自己的属性。上面已经见过了 \x3ccode\x3eresolve\x3c\/code\x3e 属性，它的任务是处理引入模块过程中的解析步骤，上面还提到过 \x3ccode\x3erequire.extensions\x3c\/code\x3e 也是 \x3ccode\x3erequire\x3c\/code\x3e 的属性。还有 \x3ccode\x3erequire.main\x3c\/code\x3e，它用于判断一个脚本是否应该被引入还是直接执行。\x3c\/p\x3e\n\x3cp\x3e例如，在 \x3ccode\x3eprint-in-frame.js\x3c\/code\x3e 中有一个 \x3ccode\x3eprintInFrame\x3c\/code\x3e 函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ In print-in-frame.js\n    const printInFrame = (size, header) =\x3e {\n      console.log(\x27*\x27.repeat(size));\n      console.log(header);\n      console.log(\x27*\x27.repeat(size));\n    };\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e    \/\/ \x3cspan class=\x22hljs-keyword\x22\x3eIn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eprint\x3c\/span\x3e-\x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e-frame.js\n    const printInFrame = (\x3cspan class=\x22hljs-built_in\x22\x3esize\x3c\/span\x3e, header) =\x26gt; {\n      console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3erepeat\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3esize\x3c\/span\x3e));\n      console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(header);\n      console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e.\x3cspan class=\x22hljs-built_in\x22\x3erepeat\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3esize\x3c\/span\x3e));\n    };\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e函数有两个参数，一个是数字类型参数 \x3ccode\x3esize\x3c\/code\x3e，一个是字符串类型参数 \x3ccode\x3eheader\x3c\/code\x3e。函数功能很简单，这里不赘述。\x3c\/p\x3e\n\x3cp\x3e我们想用两种方式使用这个文件：\x3c\/p\x3e\n\x3cp\x3e1.直接使用命令行：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    ~\/learn-node $ node print-in-frame 8 Hello\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crmsh\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e    ~\/learn-\x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e$\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enode\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprint-in-frame\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e Hello\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e传递 8 和 “Hello” 两个参数进去，打印 8 个星星包裹下的 “Hello”。\x3c\/p\x3e\n\x3cp\x3e2.使用 \x3ccode\x3erequire\x3c\/code\x3e。假设所引入的模块对外接口是 \x3ccode\x3eprintInFrame\x3c\/code\x3e 函数，我们可以这样调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    const print = require(\x27.\/print-in-frame\x27);\n    print(5, \x27Hey\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livescript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eprint\x3c\/span\x3e = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/print-in-frame\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3eprint\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Hey\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e传递的参数是 5 和 “Hey”。\x3c\/p\x3e\n\x3cp\x3e这是两种不同的用法，我们需要一种方法来判断这个文件是作为独立的脚本来运行，还是需要被引入到其他的脚本中才能执行。可以使用简单的 if 语句来实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    if (require.main === module) {\n      \/\/ 这个文件直接执行（不需要 require）\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.main === \x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个文件直接执行（不需要 require）\x3c\/span\x3e\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e继续演化，可以使用不同的调用方式来实现最初的需求：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ In print-in-frame.js\n    const printInFrame = (size, header) =\x3e {\n      console.log(\x27*\x27.repeat(size));\n      console.log(header);\n      console.log(\x27*\x27.repeat(size));\n    };\n    if (require.main === module) {\n      printInFrame(process.argv[2], process.argv[3]);\n    } else {\n      module.exports = printInFrame;\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e In \x3cspan class=\x22hljs-built_in\x22\x3eprint\x3c\/span\x3e-\x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e-frame.js\n    const printInFrame = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(size, header)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e.repeat(size));\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(header);\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e.repeat(size));\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e.main === \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e) {\n      printInFrame(process.argv[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e], process.argv[\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = printInFrame;\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当文件不需要被 require 时，直接通过 \x3ccode\x3eprocess.argv\x3c\/code\x3e 调用 \x3ccode\x3eprintInFrame\x3c\/code\x3e 函数即可。否则直接把 \x3ccode\x3emodule.exports\x3c\/code\x3e 变成 \x3ccode\x3eprintInFrame\x3c\/code\x3e 就可以了，即模块接口是 \x3ccode\x3eprintInFrame\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e5. Caching - 所有的模块都会被缓存\x3c\/h2\x3e\n\x3cp\x3e对缓存的理解特别重要，我用简单的例子来解释缓存。\x3c\/p\x3e\n\x3cp\x3e假设你有一个 \x3ccode\x3eascii-art.js\x3c\/code\x3e 文件，打印很酷的 header:\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009060871?w=1000\x26amp;h=275\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009060871?w=1000\x26amp;h=275\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们想要在每次 \x3ccode\x3erequire\x3c\/code\x3e 这个文件的时候，都打印出 header。所以把这个文件引入两次：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    require(\x27.\/ascii-art\x27) \/\/ 显示 header\n    require(\x27.\/ascii-art\x27) \/\/ 不显示 header.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/ascii-art\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 显示 header\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/ascii-art\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不显示 header.\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二个 require 不会显示 header，因为模块被缓存了。Node 把第一个调用缓存起来，第二次调用的时候就不加载文件了。\x3c\/p\x3e\n\x3cp\x3e可以在第一次引入文件以后，使用 \x3ccode\x3erequire.cache\x3c\/code\x3e 来看一下都缓存了什么。缓存中实际上是一个对象，这个对象中包含了引入模块的属性。我们可以从 \x3ccode\x3erequire.cache\x3c\/code\x3e 中把相应的属性删掉，以使缓存失效，这样 Node 就会重新加载模块并且将其重新缓存起来。\x3c\/p\x3e\n\x3cp\x3e对于这个问题，这并不是最有效的解决方案。最简单的解决方案是把 \x3ccode\x3eascii-art.js\x3c\/code\x3e 中的打印代码打包成一个函数，并且 export 这个函数。这样当我们引入 \x3ccode\x3eascii-art.js\x3c\/code\x3e 文件时，我们获取到的是这个函数，所以可以每次都能打印出想要的内容了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27.\/ascii-art\x27)() \/\/ 打印出 header.\nrequire(\x27.\/ascii-art\x27)() \/\/ 也会打印出 header.\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3erequire\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/ascii-art\x27\x3c\/span\x3e)\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打印出 header.\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3erequire\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/ascii-art\x27\x3c\/span\x3e)\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 也会打印出 header.\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader11\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e这就是我所要介绍的内容。回顾一下通篇，分别讲述了：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eResolving\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eLoading\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eWrapping\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eEvaluating\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eCaching\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e即解析、加载、打包、VM功能处理和缓存五大步骤，以及五大步骤中每个步骤都涉及到了什么内容。\x3c\/p\x3e\n\x3cp\x3e如果本文对你有帮助，欢迎关注我的专栏-\x3ca href=\x22https:\/\/zhuanlan.zhihu.com\/qianduandaha\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端大哈\x3c\/a\x3e，定期发布高质量前端文章。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e我最近正在写一本\x3ca href=\x22http:\/\/huziketang.com\/books\/react\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《React.js 小书》\x3c\/a\x3e，对 React.js 感兴趣的童鞋，\x3ca href=\x22http:\/\/huziketang.com\/books\/react\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e欢迎指点\x3c\/a\x3e。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>在 Node.js 中引入模块：你所需要知道的一切都在这里</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009060866">https://segmentfault.com/a/1190000009060866</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/o1pixgekc8/" target="_blank">https://alili.tech/archive/o1pixgekc8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>