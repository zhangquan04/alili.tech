<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="渐进式Web PWA"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>渐进式Web PWA | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/wa8a3i7gv6/",
				"appid": "1613049289050283", 
				"title": "渐进式Web PWA | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-25T02:30:23"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/lmej6cr9lw/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/j51wgb2aor/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&text=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&text=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&title=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&is_video=false&description=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&title=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&title=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&title=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwa8a3i7gv6%2f&title=%e6%b8%90%e8%bf%9b%e5%bc%8fWeb%20PWA"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">渐进式Web PWA</h1><div class="meta"><div class="postdate"><time datetime="2019-01-25" itemprop="datePublished">2019-01-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e如果你一直在关注最近几个月的web开发大会，你应该有机会了解到\x3ca href=\x22https:\/\/www.smashingmagazine.com\/2016\/08\/a-beginners-guide-to-progressive-web-apps\/\x22\x3e渐进式web app\x3c\/a\x3e(PWA)。总的来说，web体验得到极大提升。他们还推出了丰富的原生应用：\x3ca href=\x22https:\/\/www.smashingmagazine.com\/2016\/02\/making-a-service-worker\/\x22\x3e支持完全离线\x3c\/a\x3e,\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/engage-and-retain\/app-install-banners\/?hl=en\x22\x3e安装简单\x3c\/a\x3e,\x22Retina\x22,图片还原度100%，个性化登录支持，超快速度，app内流畅的浏览体验,推送通知以及非常棒的用户界面。\n\x3ca href=\x22http:\/\/p0.qhimg.com\/t013f8d9e468f4db4bc.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t013f8d9e468f4db4bc.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e一些谷歌的PWA示例\x3c\/p\x3e\n\x3cp\x3e即使新版本的\x3ca href=\x22https:\/\/developers.google.com\/web\/fundamentals\/primers\/service-worker\/\x22\x3eService Worker API\x3c\/a\x3e允许你使用即时_延迟_加载来缓存你的网站的所有资源，就像和陌生的人第一次见面，第一印象很重要。如果首次加载时间超过3秒，最新的\x3ca href=\x22https:\/\/www.doubleclickbygoogle.com\/articles\/mobile-speed-matters\/\x22\x3eDoubleClick调查报告\x3c\/a\x3e显示超过53%的用户会退出。\x3c\/p\x3e\n\x3cp\x3e3秒钟已经是一个残酷的指标。移动连接平均有300ms的潜在延迟，另外还有诸如带宽限制和偶发的信号连接等问题，你可能只剩下小于1秒的总负载性能预算，以便执行初始化应用程序所需的操作。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/p0.qhimg.com\/t018a329e815b23fd18.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t018a329e815b23fd18.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e你的用户和请求内容间存在的延迟\x3c\/p\x3e\n\x3cp\x3e的确，有不少方法可以\x3ca href=\x22https:\/\/codelabs.developers.google.com\/codelabs\/your-first-pwapp\/#4\x22\x3e缓解\x3c\/a\x3e首次加载缓慢这个问题—在服务器上提前渲染出页面基本布局，延迟加载函数功能模块等等—但你使用这个策略只能将速度有限地提高，因此你必须招聘一个前端性能优化人员，当然也可以是你本人。\x3c\/p\x3e\n\x3cp\x3e所以，如果首屏加载体验与原生app完全，我们要如何实现？\x3c\/p\x3e\n\x3ch3\x3eAMP,快速加载的移动网页\x3c\/h3\x3e\n\x3cp\x3e网站最重要的优点之一是访问便捷—不需安装，几乎立即加载。用户从头至尾只需要点击一下。\x3c\/p\x3e\n\x3cp\x3e为了让网站浏览变得毫不费力，你需要加载速度很快的网站。要做什么才能让你的网站变得很快呢？惯例是：拒绝高像素的图片，拒绝阻塞渲染的广告，拒绝很大的JS文件，我们需要的只是内容。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/www.ampproject.org\/\x22\x3eAMPs\x3c\/a\x3e,即快速加载的移动网页，\x3ca href=\x22https:\/\/www.ampproject.org\/docs\/get_started\/technical_overview.html\x22\x3e拥有快速加载优势\x3c\/a\x3e.事实上，这正是它们的增长策略。它就像汽车行驶时要注意交通规则一样，通过制定一系列规定来快速加载页面内容。由于规则很严格，并且很清晰，它允许谷歌搜索来提前一步\x3ca href=\x22https:\/\/www.ampproject.org\/docs\/get_started\/technical_overview.html#load-pages-in-an-instant\x22\x3e预先加载页面视图\x3c\/a\x3e.\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/p0.qhimg.com\/t012924440770305a77.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t012924440770305a77.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e首屏图片和页面标题会被预先渲染，所以浏览者可以直接看到页面内容。\x3c\/p\x3e\n\x3ch3\x3eAMP 还是 PWA？\x3c\/h3\x3e\n\x3cp\x3e为了使加载过程更加真实可信，你需要在加载AMP页面时使用一些限制措施。当你需要高度动态的函数处理时，比如推送通知和网络支付，甚至是任何需要额外引入JS文件的操作，AMP并不有效。除此之外，由于AMP页面常常来自于AMP缓存，你在第一次点击时不会得到更大的PWA，因为你自己的Service Worker无法运行。另一方面，在首次点击时PWA的加载速度要慢于AMP。因为AMP页面能更安全便捷地预先渲染—这个特性也让嵌入更加简单(比如导入行内查看)。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/p0.qhimg.com\/t01ce061a82b03c2457.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t01ce061a82b03c2457.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e一旦用户点击一个内置链接，他就离开了AMP缓存，你可以增加网站的功能，比如安装service worker让网站可以离线使用(当然还有更多)。\x3c\/p\x3e\n\x3cp\x3e所以，是AMP还是PWA?即时交付和优化后交付，或者是最新的高级平台功能和灵活的应用代码？如果有一种方法能综合两者的优点呢？\x3c\/p\x3e\n\x3ch3\x3e完美的用户体验之旅\x3c\/h3\x3e\n\x3cp\x3e最后，起决定性作用的是你所在乎的\x3cstrong\x3e用户体验\x3c\/strong\x3e。就像下面说的一样：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e一个用户发现了一个你的内容链接并点击了它。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e内容几乎是立即加载的，这很棒。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用户被提醒并自动更新到新版本，和app一样的体验，推送通知和离线支持。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用户可以拥有接近于app的使用体验,他们可以把网站添加到主屏幕上。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e跳转到你的网站首先要快速，浏览过程应该更能让人更多地参与进来。\x3c\/p\x3e\n\x3cp\x3e听着有点不太现实？好吧，如果我们能\x3cstrong\x3e合并这两种技术\x3c\/strong\x3e—尽管第一眼看起来他们不太相关并且满足的需求不同？\x3c\/p\x3e\n\x3ch3\x3ePWAMP 合并示例\x3c\/h3\x3e\n\x3cp\x3e为了实现j即时加载，自动更新的功能，你需要做的就是通过以下方式将AMP的优点和PWA的丰富功能合为一体：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cstrong\x3e和PWA类似的AMP\x3c\/strong\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当你可以忍受AMP的局限性。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cstrong\x3e从AMP到PWA\x3c\/strong\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当你想要在两者间平稳的转换。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cstrong\x3ePWA中的AMP\x3c\/strong\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当你想要复用多个AMP作为PWA的数据源。\x3c\/p\x3e\n\x3cp\x3e我们会一一为大家介绍。\x3c\/p\x3e\n\x3ch3\x3e和PWA类似的AMP\x3c\/h3\x3e\n\x3cp\x3e许多网站不需要措施来克服AMP的界限。\x3ca href=\x22https:\/\/ampbyexample.com\/\x22\x3eAMP示例\x3c\/a\x3e就是一个AMP和PWA的综合体。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e它有service worker，所以允许离线访问。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e它有一个清单，提醒人们“添加程序到主屏幕”\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当一个用户用谷歌搜索浏览\x3ca href=\x22https:\/\/ampbyexample.com\/\x22\x3eAMP示例\x3c\/a\x3e，在示例网站点击了一个链接，他们就会离开AMP缓存回到原始状态。网站仍然使用AMP库，但因为是原始状态，它可以使用service worker，可以提示添加程序到主屏。\x3c\/p\x3e\n\x3cp\x3e你可以使用这个技巧来实现离线访问你的AMP站点,在它们的服务还是原生情况下扩展你的页面，因为你可以通过service worker的\x3ccode\x3efetch\x3c\/code\x3e事件修改响应，并返回一个你想要的响应。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs ada\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateCompleteResponse\x3c\/span\x3e (header, body) {\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-type\x22\x3ePromise.all([\x3c\/span\x3e\n    header.text(),\n    getTemplate(RANDOM STUFF AMP DOESN’T LIKE),\n    \x3cspan class=\x22hljs-keyword\x22\x3ebody\x3c\/span\x3e.text()\n  ]).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(html =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Response(html[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] \x2b html[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] \x2b html[\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e], {\n      headers: {\n        \x3cspan class=\x22hljs-symbol\x22\x3e\x27Content\x3c\/span\x3e-\x3cspan class=\x22hljs-keyword\x22\x3eType\x3c\/span\x3e\x27: \x3cspan class=\x22hljs-symbol\x22\x3e\x27text\x3c\/span\x3e\/html\x27\n      }\n    });\n  });\n\n} \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个技术允许你在AMPs范围之外，在随后的点击中加入脚本和更多高级功能。\x3c\/p\x3e\n\x3ch4\x3e从AMP到PWA\x3c\/h4\x3e\n\x3cp\x3e当以上的一切还不够时，你想要完全不同的PWA体验，是时候尝试下更先进的模式了：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e所有的内容类页面（即那些有特别内容的页面而不是概览页面）以AMP形式发布，这样可以更快地加载内容。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eThese AMPs use AMP’s special element \x3ca href=\x22https:\/\/www.ampproject.org\/docs\/reference\/extended\/amp-install-serviceworker.html\x22\x3e\x3ccode\x3e\x3c\/code\x3e\x3c\/a\x3e to warm up a cache and the PWA shell \x3cstrong\x3ewhile the user is enjoying\x3c\/strong\x3e your content.\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e这些AMP使用AMP的\x3ca href=\x22https:\/\/www.ampproject.org\/docs\/reference\/extended\/amp-install-serviceworker.html\x22\x3e特殊元素\x3c\/a\x3e来警告会使用缓存和\x3cstrong\x3e当用户正在浏览\x3c\/strong\x3e内容时使用PWA的“壳子”。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当用户在你的网站点击另外一个链接（比如，为了获得接近于app的使用体验在页面底部进行更多操作），service worker会拦截请求，接管页面并加载PWA外壳。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e你可以分为简单的三步来完成以上操作，假设你已经了解service work是如何工作的。（如果你不了解。我推荐我的大学同学 \x3ca href=\x22https:\/\/www.udacity.com\/course\/offline-web-applications--ud899\x22\x3e杰克的优达课程\x3c\/a\x3e）。首先，在你所有的AMP页面安装service worker。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eamp-install-serviceworker\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/www.your-domain.com\/serviceworker.js\x22\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3elayout\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22nodisplay\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eamp-install-serviceworker\x3c\/span\x3e\x26gt;\x3c\/span\x3e \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e第二步，在service worker的安装过程中，缓存PWA需要的任何资源。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e CACHE_NAME = \x3cspan class=\x22hljs-string\x22\x3e\x27my-site-cache-v1\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e urlsToCache = [\n  \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27\/styles\/main.css\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27\/script\/main.js\x27\x3c\/span\x3e\n];\n\nself.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27install\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Perform install steps\x3c\/span\x3e\n  event.waitUntil(\n    caches.open(CACHE_NAME)\n      .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecache\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Opened cache\x27\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e cache.addAll(urlsToCache);\n      })\n  );\n}); \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e最后，在service worker中对于导航部分的请求用PWA响应而不是AMP。（接下来的代码，仅仅是很简洁的一个函数。文章最后会有一个稍微复杂的例子）\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs cs\x22\x3eself.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27fetch\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eevent\x3c\/span\x3e =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eevent\x3c\/span\x3e.request.mode === \x3cspan class=\x22hljs-string\x22\x3e\x27navigate\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eevent\x3c\/span\x3e.respondWith(fetch(\x3cspan class=\x22hljs-string\x22\x3e\x27\/pwa\x27\x3c\/span\x3e));\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Immediately start downloading the actual resource.\x3c\/span\x3e\n      fetch(\x3cspan class=\x22hljs-keyword\x22\x3eevent\x3c\/span\x3e.request.url);\n    }\n\n}); \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在，无论用户何时点击你从AMP缓存得到的页面中的链接，service worker都会注册\x3ccode\x3e导航\x3c\/code\x3e模式并接管服务，然后返回已经缓存的PWA。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/p0.qhimg.com\/t011fbe6c206d70b3a3.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t011fbe6c206d70b3a3.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e你可以通过安装service worker 来显著提升网站的性能。对于那些不支持service worker的浏览器，它们会跳转到无AMP缓存的另外一个页面。\x3c\/p\x3e\n\x3cp\x3e让人感兴趣的是你现在使用了渐进增强的方法从AMP过渡到PWA。然而，这也意味着还未支持service worker的浏览器可以从AMP升级到PWA，而且不会动态地跳转到PWA。\x3c\/p\x3e\n\x3cp\x3eAMP用 \x3ca href=\x22https:\/\/www.ampproject.org\/docs\/reference\/components\/amp-install-serviceworker#shell-url-rewrite\x22\x3e重写shell URL\x3c\/a\x3e解决了这个问题。通过为\x3ccode\x3e标签\x3c\/code\x3e增加一个回退URL模式，用构造的AMP来重写给定页面中所有匹配的跳转到另外一个私有shell URL的链接，当然，是在检测到没有service worker支持的情况下才这样做。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e\x26lt;amp-install-serviceworker\n      src=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/www.your-domain.com\/serviceworker.js\x22\x3c\/span\x3e\n      layout=\x3cspan class=\x22hljs-string\x22\x3e\x22nodisplay\x22\x3c\/span\x3e\n      data-\x3cspan class=\x22hljs-keyword\x22\x3eno\x3c\/span\x3e-service-worker-fallback-url-\x3cspan class=\x22hljs-keyword\x22\x3ematch\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22.*\x22\x3c\/span\x3e\n      data-\x3cspan class=\x22hljs-keyword\x22\x3eno\x3c\/span\x3e-service-worker-fallback-\x3cspan class=\x22hljs-keyword\x22\x3eshell\x3c\/span\x3e-url=\x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/www.your-domain.com\/pwa\x22\x3c\/span\x3e\x26gt;\n\x26lt;\/amp-install-serviceworker\x26gt; \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e当这些特性设置完毕，所有AMP上的导航链接都会跳转到你的PWA，无论有没有service worker。代码整洁了不少是吧？\x3c\/p\x3e\n\x3ch4\x3ePWA里的AMP\x3c\/h4\x3e\n\x3cp\x3e所以，现在用户使用的是PWA，你正在使用一些AJAX驱动的导航来获取JSON格式的内容。你可以这么做，但现在你需要两个完全不同的内容后端—一个生成AMP页面，另一个为你的PWA提供基于JSON的API。\x3c\/p\x3e\n\x3cp\x3e但是仔细想想AMP到底是什么。它不仅仅是一个网站。它被设计为一个便捷内容单元。一个AMP设计为自包含并可以安全地嵌入另一个网站。如果我们可以通过增加额外的JSON API并且复用AMP作为我们PWA的数据格式来简化后端的复杂度呢？\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/p0.qhimg.com\/t015f274f0436e49bb6.png\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t015f274f0436e49bb6.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eAMP页面可以安全地嵌入其他网站—PWA中AMP库仅被编译和加载一次。\x3c\/p\x3e\n\x3cp\x3e当然，一个简单的方法是在框架中加载AMP页面。但iframes很慢，你需要反复重新编译并重新初始化AMP库。如今的前沿技术提供了一个更好的办法：Shadow DOM。\x3c\/p\x3e\n\x3cp\x3e过程如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3ePWA劫持所有的导航点击。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e接下来，发出XMLHttpRequest来获取请求的AMP页面。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e它把内容放进一个新的shadow root下。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e最后告诉主AMP库，“你好，这有一个新文档给你。检查下吧。”（在运行时调用\x3ccode\x3eattachShadowDoc\x3c\/code\x3e）\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e使用这项技术，对于整个PWA而言AMP库仅执行一次编译和加载，然后每一个你给它绑定的shadow文档都是可请求的。因为你是用XMLHttpRequest来请求页面，你可以在将它插入一个新的shadow文档之前修改AMP源。你可以这样做：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e剥离不必要的东西，比如标题和页脚；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e插入额外的内容，比如广告和工具提示；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用动态内容来替代静态内容。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e现在，你已经简化了你的PWA，并且降低了后端复杂度。\x3c\/p\x3e\n\x3ch3\x3e准备，设置，开始！\x3c\/h3\x3e\n\x3cp\x3e为了演示Shadow DOM操作（一个不附带PWA的AMP），AMP团队开发了一个基于React的demo\x3ca href=\x22https:\/\/choumx.github.io\/amp-pwa\/\x22\x3eThe Scenic\x3c\/a\x3e,虚构了一个旅游杂志。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/choumx.github.io\/amp-pwa\/\x22\x3e\x3cimg src=\x22http:\/\/p0.qhimg.com\/t0187193e851dba142b.png\x22 alt=\x22从谷歌的AMP到PWA\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e整个 \x3ca href=\x22https:\/\/github.com\/ampproject\/amp-publisher-sample\/blob\/master\/amp-pwa\x22\x3edemo\x3c\/a\x3e都能在Github上访问，但还有更奇妙的\x3ca href=\x22https:\/\/github.com\/ampproject\/amp-publisher-sample\/blob\/master\/amp-pwa\/src\/components\/amp-document\/amp-document.js#L92\x22\x3e\x3ccode\x3eamp-document.js\x3c\/code\x3e’ React组件\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3e展示实例\x3c\/h4\x3e\n\x3cp\x3e如果你想看真实的产品，请移步\x3ca href=\x22https:\/\/beta.mic.com\x22\x3eMic的新版PWA\x3c\/a\x3e （测试版）：如果你使用shift键重新加载\x3ca href=\x22https:\/\/beta.mic.com\/articles\/161568\/arrow-season-5-episode-9-a-major-character-returns-in-midseason-finale-maybe\x22\x3e随机文章\x3c\/a\x3e（它通常会忽略Service Worker）并查看源代码，你就会知道它是一个AMP页面。现在尝试点击汉堡菜单：它会重新加载最近访问的页面，但自从_使用_了PWA app的壳，看起来没有重新加载。但你确实是在PWA里（嵌入了AMP页面），还有一些花里胡哨的东西。有点偷偷摸摸，但效果很好。\x3c\/p\x3e\n\x3ch3\x3e最后的话\x3c\/h3\x3e\n\x3cp\x3e不得不说，我对将二者合并起来很激动。这是最佳方案。\x3c\/p\x3e\n\x3cp\x3e请重温这些要点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e一定要快；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e对于內建部分要花功夫（通过AMP的版本协同）；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e渐进增强；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一个后端负责全部；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e更低的客户端复杂度；\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e更少的整体耗时\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e但我们刚开始探索这种模式的演化，这是一个全新的模式。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/Web_Components\/Shadow_DOM\x22\x3eShadow DOM参考链接\x3c\/a\x3e\n\x3ca href=\x22https:\/\/aotu.io\/notes\/2016\/06\/24\/Shadow-DOM\/index.html\x22\x3eShadow DOM参考文章\x3c\/a\x3e\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>渐进式Web PWA</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/progressive-web-amps-ndash-smashing-magazine">https://www.zcfy.cc/article/progressive-web-amps-ndash-smashing-magazine</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/wa8a3i7gv6/" target="_blank">https://alili.tech/archive/wa8a3i7gv6/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>