<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="图像颜色提取"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>图像颜色提取 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/7whfo06mqrw/",
				"appid": "1613049289050283", 
				"title": "图像颜色提取 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-12T02:30:24"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/h8mmqc892l6/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/ttxrrkxx989/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&text=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&text=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&title=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&is_video=false&description=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&title=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&title=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&title=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f7whfo06mqrw%2f&title=%e5%9b%be%e5%83%8f%e9%a2%9c%e8%89%b2%e6%8f%90%e5%8f%96"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">图像颜色提取</h1><div class="meta"><div class="postdate"><time datetime="2019-01-12" itemprop="datePublished">2019-01-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e\x3cstrong\x3e本文github项目：\x3ca href=\x22https:\/\/github.com\/woshizja\/colorful-color\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecolorful color\x3c\/a\x3e\x3c\/strong\x3e  \x3cbr\x3e\x3cstrong\x3e我的codepen链接：\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/post\/cc\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e图像颜色提取\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/post\/cc\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3ethe \x3ca href=\x22https:\/\/woshizja.github.io\/colorful-color\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edemo\x3c\/a\x3e\x3c\/strong\x3e  \x3cbr\x3e\x3cstrong\x3e原创文章，转载请注明\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e最近想找个小项目练练手，以便熟悉React，于是想到了“图像颜色提取”这个方向，也有的说法是\x3cstrong\x3e图像主题色提取\x3c\/strong\x3e，\x3cstrong\x3e颜色量子化\x3c\/strong\x3e，或者是叫\x3cstrong\x3e由图像生成调色板\x3c\/strong\x3e，原因无他，只是因为漂亮！\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833001?w=1196\x26amp;h=1090\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833001?w=1196\x26amp;h=1090\x22 alt=\x22design-seeds.com\x22 title=\x22design-seeds.com\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e“分析”的目的有这么几个：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cstrong\x3e主要颜色：\x3c\/strong\x3e main color 就是出现频率最高的颜色，这样色颜色在设计中常常是用于背景色，提供沉浸式的体验：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833002?w=373\x26amp;h=166\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833002?w=373\x26amp;h=166\x22 alt=\x22main color\x22 title=\x22main color\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3e平均颜色：\x3c\/strong\x3e average color 是所有颜色的平均值，和主要颜色一样可以用作背景色；\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3e颜色量子化：\x3c\/strong\x3e 颜色量子化在这里相当于是在提取主题色，结果是图像中一系列主要颜色的集合，这些颜色可以通过统计分析得到，也可以通过聚类算法生成。同时，\x3cstrong\x3e主要颜色\x3c\/strong\x3e，\x3cstrong\x3e平均颜色\x3c\/strong\x3e和\x3cstrong\x3e主题色\x3c\/strong\x3e这几个因子都可以作为图像的\x3cstrong\x3e特征\x3c\/strong\x3e，特征可以用于图像进一步分析，比如图像识别与检索，压缩等；\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833003?w=367\x26amp;h=132\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833003?w=367\x26amp;h=132\x22 alt=\x22color theme\x22 title=\x22color theme\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\n\x3cstrong\x3e颜色可视化：\x3c\/strong\x3e 图像本身就是颜色的容器，这个“容器”也是一种可视化的呈现，我想我们也可以从另一个角度观察颜色——去除图像内容，仅呈现不同颜色的值和他们的权重，比如下面这样星星点点像星空一样可视化方案：\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833004?w=368\x26amp;h=356\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833004?w=368\x26amp;h=356\x22 alt=\x22color bubble\x22 title=\x22color bubble\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e一、常见颜色量子化算法\x3c\/h3\x3e\n\x3ch4\x3e1.1 中位切分法\x3c\/h4\x3e\n\x3cp\x3e中位切分算法首先把所有像素映射到RGB空间，在这个三维的空间里反复切分出子空间，最后将切分空间的像素求均值作为提取结果。分割区块时都选择所有区块中最大（最长的边长最大，或体积最大，或像素最多）的区块，切割点应位于边方向上，使得分割后两个区块的像素各一半的位置，以上是为\x3cstrong\x3e中位切分法\x3c\/strong\x3e。流程如下（推荐阅读：\x3ca href=\x22http:\/\/acm.nudt.edu.cn\/~twcourse\/ColorQuantization.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《Color Quantization》\x3c\/a\x3e）：\x3c\/p\x3e\n\x3cp\x3e1.像素映射到RGB空间：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833005?w=403\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833005?w=403\x26amp;h=283\x22 alt=\x22median cut 1\x22 title=\x22median cut 1\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e2.区块计算：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833006?w=403\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833006?w=403\x26amp;h=283\x22 alt=\x22median cut 2\x22 title=\x22median cut 2\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e3.中位切分：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833007?w=403\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833007?w=403\x26amp;h=283\x22 alt=\x22median cut 3\x22 title=\x22median cut 3\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e4.反复切分：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833008?w=403\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833008?w=403\x26amp;h=283\x22 alt=\x22median cut 4\x22 title=\x22median cut 4\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e5.计算区块的平均颜色：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833009?w=403\x26amp;h=283\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833009?w=403\x26amp;h=283\x22 alt=\x22median cut 5\x22 title=\x22median cut 5\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里推荐一个采用中位切分法实现（JavaScript）的颜色量子化项目：\x3ca href=\x22https:\/\/github.com\/lokesh\/color-thief\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eColor Thief\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3e1.2 八叉树算法\x3c\/h4\x3e\n\x3cp\x3e八叉树算法的核心理念是用八叉树来划分颜色空间，然后合并叶节点来逐步聚拢颜色（量子化），八叉树的解释可参考\x3ca href=\x22https:\/\/www.zhihu.com\/question\/25111128\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《游戏场景管理的八叉树算法是怎样的？》\x3c\/a\x3e，关键就是下面这两幅图：\x3c\/p\x3e\n\x3cp\x3e1.建树过程：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833010\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833010\x22 alt=\x22octree\x22 title=\x22octree\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e2.合并叶节点：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833011?w=411\x26amp;h=311\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833011?w=411\x26amp;h=311\x22 alt=\x22reduce\x22 title=\x22reduce\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e具体的解释可参考文章：\x3ca href=\x22https:\/\/xcoder.in\/2014\/09\/17\/theme-color-extract\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《图片主题色提取算法小结》\x3c\/a\x3e，作者还写了一个颜色量子化的node模块：\x3ca href=\x22https:\/\/github.com\/XadillaX\/thmclrx\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e A theme color extractor module for Node.js\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e1.3 K-Means聚类法\x3c\/h4\x3e\n\x3cp\x3eK均值聚类的思想十分简单，可分这几步：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e选取初始的K个质心；\x3c\/li\x3e\n\x3cli\x3e按照距离质心的远近对所有样本进行分类；\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e重新计算质心，判断是否退出条件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e两次质心的距离足够小视为满足退出条件；\x3c\/li\x3e\n\x3cli\x3e不退出则重新回到步骤2；\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e来看js的实现：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/*\ncolors: 所有样本\nseeds: 初始质心\nmax_step: 最大迭代次数\n*\/\nkMC(colors, seeds, max_step) {\n    let iteration_count = 0;\n    while (iteration_count\x2b\x2b \x3c max_step) {\n      \/\/ divide colors into different categories with duff\x27s device\n      classifyColor(colors, seeds);\n\n      \/\/ compute center of category\n      let len = colors.length;\n      let hsl_count = [];\n      let category;\n      while (len--) {\n        category = colors[len].category;\n        \/\/ ......\n      }\n      \n      \/\/ quit or not\n      let flag = hsl_count.every((ele, index) =\x3e {\n        \/\/ ......\n      });\n      if (flag) {\n        break;\n      }\n    }\n    console.log(\x26quot;KMC iteration \x26quot; \x2b iteration_count);\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/*\ncolors: 所有样本\nseeds: 初始质心\nmax_step: 最大迭代次数\n*\/\x3c\/span\x3e\nkMC(colors, seeds, max_step) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e iteration_count = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (iteration_count\x2b\x2b \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt; \x3cspan class=\x22hljs-attr\x22\x3emax_step\x3c\/span\x3e) {\n      \/\/ \x3cspan class=\x22hljs-attr\x22\x3edivide\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecolors\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3einto\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edifferent\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecategories\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ewith\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eduff\x3c\/span\x3e\x27\x3cspan class=\x22hljs-attr\x22\x3es\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3edevice\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3eclassifyColor\x3c\/span\x3e(\x3cspan class=\x22hljs-attr\x22\x3ecolors\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eseeds\x3c\/span\x3e);\n\n      \/\/ \x3cspan class=\x22hljs-attr\x22\x3ecompute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecenter\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eof\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecategory\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elen\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3ecolors.length;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehsl_count\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e[];\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecategory\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-attr\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-attr\x22\x3elen--\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-attr\x22\x3ecategory\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3ecolors[len].category;\x3c\/span\x3e\n        \/\/ \x3cspan class=\x22hljs-attr\x22\x3e......\x3c\/span\x3e\n      }\n      \n      \/\/ \x3cspan class=\x22hljs-attr\x22\x3equit\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eor\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3enot\x3c\/span\x3e\n      \x3cspan class=\x22hljs-attr\x22\x3elet\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eflag\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3ehsl_count.every((ele,\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eindex\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \/\/ ......\n      });\n      if (flag) {\n        break;\n      }\n    }\n    console.log(\x22KMC iteration \x22 \x2b iteration_count);\n  }\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e二、简单实现\x3c\/h3\x3e\n\x3ch4\x3e2.1 大致流程\x3c\/h4\x3e\n\x3col\x3e\n\x3cli\x3ecanvas读取本地图像，做适当缩放；\x3c\/li\x3e\n\x3cli\x3e统计颜色信息：颜色需要做量子化处理（\x3cstrong\x3eColor Quantization\x3c\/strong\x3e），RGB空间中一共有255的三次方约1600多万种颜色，除以8能降采样到32000多种。RGB值组合为\x3cstrong\x3e键值\x3c\/strong\x3e，统计每种颜色出现的次数：\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let r_key = Math.floor(r \/ 8) * 1000000;\nlet g_key = Math.floor(g \/ 8) * 1000;\nlet b_key = Math.floor(b \/ 8);\nlet key = r_one \x2b g_one \x2b b_one;\nif(keys.indexOf(key)\x3c0){\n  \/\/ 未找到key，则新加入key\n}else{\n  \/\/ 找到则出现次数加1\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e r_key = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(r \/ \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e) * \x3cspan class=\x22hljs-number\x22\x3e1000000\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e g_key = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(g \/ \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e) * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e b_key = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(b \/ \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e key = r_one \x2b g_one \x2b b_one;\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(keys.indexOf(key)\x26lt;\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e){\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 未找到key，则新加入key\x3c\/span\x3e\n}\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 找到则出现次数加1\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e过滤颜色：过滤孤立的颜色（出现次数太少）和过亮过黑的颜色；\x3c\/li\x3e\n\x3cli\x3eK均值聚类：选取出现频率最高的K种颜色所谓初始值，由算法聚类出新的稳定的颜色中心；\x3c\/li\x3e\n\x3cli\x3e计算主要颜色和均值颜色；\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch4\x3e2.2 实验结果\x3c\/h4\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009833012?w=522\x26amp;h=515\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009833012?w=522\x26amp;h=515\x22 alt=\x22cc example\x22 title=\x22cc example\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这张图的原始分辨率是 1080 x 1800 ，缩放到canvas中分辨率是 \x3cstrong\x3e216 x 360\x3c\/strong\x3e （缩放规则是固定最大高度为360，按原始宽高比例缩放）。选择颜色降采样的间隔为 \x3cstrong\x3e5\x3c\/strong\x3e，一共是提取了 \x3cstrong\x3e6251\x3c\/strong\x3e 种颜色，过滤掉出现次数小于 \x3cstrong\x3e4\x3c\/strong\x3e 和过黑过亮的颜色后剩余 \x3cstrong\x3e2555\x3c\/strong\x3e 种颜色。K均值聚类的K设为 \x3cstrong\x3e6\x3c\/strong\x3e ，最终迭代次数是 \x3cstrong\x3e10\x3c\/strong\x3e ，耗时 \x3cstrong\x3e106ms\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3ecodepen的原始例子如下：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/gmvQNw\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecensus color\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/gmvQNw\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3cp\x3e这方案执行下来会有一些问题：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eK均值种子点的选取对结果的影响较大；\x3c\/li\x3e\n\x3cli\x3e计算聚类中心的时候不光是RGB三个值，还加入了颜色出现次数这个值，所以K比较小时，新的聚类中心可能不会收敛到\x3cstrong\x3e醒目的点缀\x3c\/strong\x3e颜色上，这和我们的视觉感受是不一致的，但是如果选择K为10，对于上面的图像是能够收敛到红色的。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e三、神经网络评分\x3c\/h3\x3e\n\x3cp\x3e这部分采用了\x3ca href=\x22https:\/\/github.com\/harthur\/brain\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebrain\x3c\/a\x3e，它应该是简单的\x3cstrong\x3eBP神经网络\x3c\/strong\x3e。训练数据采用的是\x3ca href=\x22https:\/\/tuchong.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e图虫网\x3c\/a\x3e的热门图片。目前带评分的图像数据库比较少，而且评分往往是综合的，掺杂了其它（构图，主题，光影，人物等）因素，难以分离出\x3cstrong\x3e只与色彩相关\x3c\/strong\x3e的评分，所以我是按照自己的喜好对训练数据进行了评分，所以结果会非常强烈的接近我个人的喜好。  \x3cbr\x3e另外神经网络的输入项也是比较关键的，因为它必须要正确反映颜色相关的图像信息，我提取的是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let info = {\n  colorCount: (Math.log10(colorInfo.length)),\n  average:0,\n  variance: 0,\n  top50Count: 0,\n  top50Average: 0,\n  top50Variance: 0,\n  top20Count: 0,\n  top20Average: 0,\n  top20Variance: 0,\n  top10Count: 0,\n  top10Average: 0,\n  top10Variance: 0,\n  top5Count: 0,\n  top5Average: 0,\n  top5Variance: 0\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e info = {\n  \x3cspan class=\x22hljs-attr\x22\x3ecolorCount\x3c\/span\x3e: (\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.log10(colorInfo.length)),\n  \x3cspan class=\x22hljs-attr\x22\x3eaverage\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3evariance\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop50Count\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop50Average\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop50Variance\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop20Count\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop20Average\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop20Variance\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop10Count\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop10Average\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop10Variance\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop5Count\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop5Average\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3etop5Variance\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e数据分为四类，评分从高到低分别是：100，85，75，65。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e四、改进\x3c\/h3\x3e\n\x3ch4\x3e4.1 颜色空间的选择\x3c\/h4\x3e\n\x3cp\x3e之前是采用的RGB空间，三个冷冰冰的数字并不能让我们很好的分辨不同色彩，于是这里我试着转换到HSL空间：\x3cstrong\x3e色相\x3c\/strong\x3e(H)、\x3cstrong\x3e饱和度\x3c\/strong\x3e(S)、\x3cstrong\x3e明度\x3c\/strong\x3e(L)，这三个颜色通道相互之间的叠加能得到各式各样的颜色，这个颜色空间几乎包括了人类视力所能感知的所有颜色，是目前运用最广的颜色系统之一。\x3cbr\x3eRGB和HSL的转换可参考\x3ca href=\x22http:\/\/www.zhangxinxu.com\/wordpress\/2010\/03\/javascript-hex-rgb-hsl-color-convert\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e《javascript HEX十六进制与RGB, HSL颜色的相互转换》\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e转换到HSL空间对于我们提取颜色的目标有以下好处：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e原来的RGB中三个值一样重要，对于HSL我们可以使用不同的参数分别去处理三个通道，比如对于色相可以稠密采样，对于明度和饱和度可以适当稀疏采样；\x3c\/li\x3e\n\x3cli\x3e对于不同颜色的控制更加精细准确，原始的RGB空间中我们很难判断两个不同颜色之间他们的RGB值关系，但是对于HSL我们只要关注色相就可以了（其它两个通道也很有用，只是这里选择忽略它们）；\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e4.2 二叉树与indexOf\x3c\/h4\x3e\n\x3cp\x3e影响整个算法运行时间的关键步骤是颜色信息的统计，而统计环节中最耗时的是key的检测，存储key的容器长度会越来越长，采用\x3ccode\x3eindexOf\x3c\/code\x3e的方式会越来越耗时，实验证明绝大部分的时间都是耗费在这一步上。所以不妨试试\x3cstrong\x3e查找二叉树\x3c\/strong\x3e这样的数据结构，二叉树的优势在于每次查找的时间会指数级下降，以此加快程序运行。  \x3cbr\x3e\x3cstrong\x3e但是\x3c\/strong\x3e，我用js实现这种数据结构的结果并不理想，运行时间基本与\x3ccode\x3eindexOf\x3c\/code\x3e一致，甚至大部分时候还会略微多一点。我觉得原因在于：虽然每次查找重复key的时间减少了，但是每次新加入key的步骤变得复杂了，而且\x3ccode\x3eindexOf()\x3c\/code\x3e是 \x3cstrong\x3enative code\x3c\/strong\x3e ，运行效率应该比我们自己实现的js代码高。综合起来看，在一定的样本量区间，还是使用原生的\x3ccode\x3eindexOf\x3c\/code\x3e效率更高，这个区间在本文指的是 \x3cstrong\x3e1000~3000\x3c\/strong\x3e 种颜色，当然我还是相信当颜色更多的时候，二叉树还是有它的优势的。我实现的代码如下：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/xOBbyz\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e二叉树前序\/中序\/后序遍历\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/xOBbyz\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3ch4\x3e4.3 duff\x27s device\x3c\/h4\x3e\n\x3cp\x3e这是个非常实用的技巧（经过我多次验证），感觉已经离不开它了！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let len = colors.length;\nlet count = (len \/ 8) ^ 0;\nlet start = len % 8;\nwhile (start--) {\n  \/\/ do something\n}\nwhile (count--) {\n  \/\/ do something  \n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e len = colors.length;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e count = (len \/ \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e) ^ \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e start = len % \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (start--) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (count--) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something  \x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e测试结果：\x3ca href=\x22https:\/\/jsperf.com\/duffs-device\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejsprof\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch4\x3e4.4 模糊加速\x3c\/h4\x3e\n\x3cp\x3e对图像进行模糊可以减少色彩的种类，从而加速提取算法，这应该是可行的，但是我还没有加入到项目中，我探索的比较快，效果比较好的模糊算法的实现如下：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/zZmRQe\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecanvas blur\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/zZmRQe\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e五、SVG与canvas动画\x3c\/h3\x3e\n\x3cp\x3e最开始只是想熟悉react，结果到后面，项目的重心就完全偏向于算法和动画了。我觉得React对SVG还是比较友好的，各种动画属性都可以放到state中。个人感受SVG动画相对于CSS的优势在于：更加灵活，更加容易完成复杂动画效果，兼容性更好，底层优化更流畅。  \x3cbr\x3ecanvas动画的优势是比较流畅，SVG动画在移动端还是有很多肉眼可见的掉帧卡顿的，而且SVG会让HTML变得很大很乱，可能让有洁癖的你不舒服。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/qjbXYm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSVG halo animation\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/qjbXYm\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3cp\x3e不管什么动画最终都还是归结于：\x3cstrong\x3e数学\x3c\/strong\x3e，比如：\x3c\/p\x3e\n\x3ch5\x3e这个动画的难点在于随机的布局算法，关键在于碰撞的检测与碰撞后的移动，本质依赖于几何和物理中的运动定律：\x3c\/h5\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/bqPxPg\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebubble chart\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/bqPxPg\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3ch5\x3e这个动画的难点在于找到一个神奇的数学公式，虽然我自己也不知道怎么回事，但是变换数学公式，有时候就能实现有规律的动画，而有规律再加上色彩，很大概率就是好的动画：\x3c\/h5\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/codepen.io\/zhaojun\/pen\/VpJjJG\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecanvas wave\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaojun\/pen\/VpJjJG\x22 data-typeid=\x223\x22\x3e点击预览\x3c\/button\x3e\x3c\/p\x3e\n\x3chr\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>图像颜色提取</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009832996">https://segmentfault.com/a/1190000009832996</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/7whfo06mqrw/" target="_blank">https://alili.tech/archive/7whfo06mqrw/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>