<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/rch68e1crso/",
				"appid": "1613049289050283", 
				"title": "用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-21T02:30:06"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6dtzin0so6e/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dagwxuophhg/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&text=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&text=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&title=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&is_video=false&description=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&title=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&title=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&title=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2frch68e1crso%2f&title=%e7%94%a8%20Apache%20%e6%9c%8d%e5%8a%a1%e5%99%a8%e6%a8%a1%e5%9d%97%e4%bf%9d%e6%8a%a4%e6%82%a8%e7%9a%84%e7%bd%91%e7%ab%99%e5%85%8d%e5%8f%97%e5%ba%94%e7%94%a8%e5%b1%82%20DOS%20%e6%94%bb%e5%87%bb"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击</h1><div class="meta"><div class="postdate"><time datetime="2019-01-21" itemprop="datePublished">2019-01-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#用-apache-服务器模块保护您的网站免受应用层-dos-攻击\x22\x3e\x3c\/a\x3e用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击\x3c\/h1\x3e\n\x3cp\x3e有多种可以导致网站下线的攻击方法，比较复杂的方法要涉及数据库和编程方面的技术知识。一个更简单的方法被称为“拒绝服务Denial Of Service”（DOS）攻击。这个攻击方法的名字来源于它的意图：使普通客户或网站访问者的正常服务请求被拒绝。\x3c\/p\x3e\n\x3cp\x3e一般来说，有两种形式的 DOS 攻击：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3eOSI 模型的三、四层，即网络层攻击\x3c\/li\x3e\n\x3cli\x3eOSI 模型的七层，即应用层攻击\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e第一种类型的 DOS 攻击——网络层，发生于当大量的垃圾流量流向网页服务器时。当垃圾流量超过网络的处理能力时，网站就会宕机。\x3c\/p\x3e\n\x3cp\x3e第二种类型的 DOS 攻击是在应用层，是利用合法的服务请求，而不是垃圾流量。当页面请求数量超过网页服务器能承受的容量时，即使是合法访问者也将无法使用该网站。\x3c\/p\x3e\n\x3cp\x3e本文将着眼于缓解应用层攻击，因为减轻网络层攻击需要大量的可用带宽和上游提供商的合作，这通常不是通过配置网络服务器就可以做到的。\x3c\/p\x3e\n\x3cp\x3e通过配置普通的网页服务器，可以保护网页免受应用层攻击，至少是适度的防护。防止这种形式的攻击是非常重要的，因为 \x3ca href=\x22https:\/\/www.cloudflare.com\x22\x3eCloudflare\x3c\/a\x3e 最近 \x3ca href=\x22https:\/\/blog.cloudflare.com\/the-new-ddos-landscape\/\x22\x3e报告称\x3c\/a\x3e 网络层攻击的数量正在减少，而应用层攻击的数量则在增加。\x3c\/p\x3e\n\x3cp\x3e本文将介绍如何使用 \x3ca href=\x22https:\/\/www.zdziarski.com\/blog\/\x22\x3ezdziarski\x3c\/a\x3e 开发的 Apache2 的模块 \x3ca href=\x22https:\/\/github.com\/jzdziarski\/mod_evasive\x22\x3emod_evasive\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e另外，mod_evasive 会阻止攻击者通过尝试数百个用户名和密码的组合来进行猜测（即暴力攻击）的企图。\x3c\/p\x3e\n\x3cp\x3emod_evasive 会记录来自每个 IP 地址的请求的数量。当这个数字超过相应 IP 地址的几个阈值之一时，会出现一个错误页面。错误页面所需的资源要比一个能够响应合法访问的在线网站少得多。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#在-ubuntu-1604-上安装-mod_evasive\x22\x3e\x3c\/a\x3e在 Ubuntu 16.04 上安装 mod_evasive\x3c\/h3\x3e\n\x3cp\x3eUbuntu 16.04 默认的软件库中包含了 mod_evasive，名称为 “libapache2-mod-evasive”。您可以使用 \x3ccode\x3eapt-get\x3c\/code\x3e 来完成安装：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3eapt-\x3cspan class=\x22hljs-builtin-name\x22\x3eget\x3c\/span\x3e update\napt-\x3cspan class=\x22hljs-builtin-name\x22\x3eget\x3c\/span\x3e\x3cspan class=\x22hljs-built_in\x22\x3e upgrade\n\x3c\/span\x3eapt-\x3cspan class=\x22hljs-builtin-name\x22\x3eget\x3c\/span\x3e install libapache2-mod-evasive\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在我们需要配置 mod_evasive。\x3c\/p\x3e\n\x3cp\x3e它的配置文件位于 \x3ccode\x3e\/etc\/apache2\/mods-available\/evasive.conf\x3c\/code\x3e。默认情况下，所有模块的设置在安装后都会被注释掉。因此，在修改配置文件之前，模块不会干扰到网站流量。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e\x26lt;IfModule mod_evasive20.c\x26gt;\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSHashTableSize\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e3097\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSPageCount\x3c\/span\x3e        \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSSiteCount\x3c\/span\x3e        \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSPageInterval\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSSiteInterval\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSBlockingPeriod\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSEmailNotify\x3c\/span\x3e      you@yourdomain\x3cspan class=\x22hljs-selector-class\x22\x3e.com\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSSystemCommand\x3c\/span\x3e    \x3cspan class=\x22hljs-string\x22\x3e\x22su - someuser -c \x27\/sbin\/... %s ...\x27\x22\x3c\/span\x3e\n   \x3cspan class=\x22hljs-selector-id\x22\x3e#DOSLogDir\x3c\/span\x3e           \x3cspan class=\x22hljs-string\x22\x3e\x22\/var\/log\/mod_evasive\x22\x3c\/span\x3e\n\x26lt;\/IfModule\x26gt;\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e第一部分的参数的含义如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3eDOSHashTableSize\x3c\/code\x3e - 正在访问网站的 IP 地址列表及其请求数的当前列表。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSPageCount\x3c\/code\x3e - 在一定的时间间隔内，每个页面的请求次数。时间间隔由 DOSPageInterval 定义。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSPageInterval\x3c\/code\x3e - mod_evasive 统计页面请求次数的时间间隔。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSSiteCount\x3c\/code\x3e - 与 \x3ccode\x3eDOSPageCount\x3c\/code\x3e 相同，但统计的是来自相同 IP 地址对网站内任何页面的请求数量。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSSiteInterval\x3c\/code\x3e - mod_evasive 统计网站请求次数的时间间隔。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSBlockingPeriod\x3c\/code\x3e - 某个 IP 地址被加入黑名单的时长（以秒为单位）。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果使用上面显示的默认配置，则在如下情况下，一个 IP 地址会被加入黑名单：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e每秒请求同一页面超过两次。\x3c\/li\x3e\n\x3cli\x3e每秒请求 50 个以上不同页面。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e如果某个 IP 地址超过了这些阈值，则被加入黑名单 10 秒钟。\x3c\/p\x3e\n\x3cp\x3e这看起来可能不算久，但是，mod_evasive 将一直监视页面请求，包括在黑名单中的 IP 地址，并重置其加入黑名单的起始时间。只要一个 IP 地址一直尝试使用 DOS 攻击该网站，它将始终在黑名单中。\x3c\/p\x3e\n\x3cp\x3e其余的参数是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3eDOSEmailNotify\x3c\/code\x3e - 用于接收 DOS 攻击信息和 IP 地址黑名单的电子邮件地址。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSSystemCommand\x3c\/code\x3e - 检测到 DOS 攻击时运行的命令。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3eDOSLogDir\x3c\/code\x3e - 用于存放 mod_evasive 的临时文件的目录。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3\x3e\x3ca href=\x22#配置-mod_evasive\x22\x3e\x3c\/a\x3e配置 mod_evasive\x3c\/h3\x3e\n\x3cp\x3e默认的配置是一个很好的开始，因为它不会阻塞任何合法的用户。取消配置文件中的所有参数（\x3ccode\x3eDOSSystemCommand\x3c\/code\x3e 除外）的注释，如下所示：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e\x26lt;IfModule mod_evasive20.c\x26gt;\n   DOSHashTableSize   \x3cspan class=\x22hljs-number\x22\x3e3097\x3c\/span\x3e\n   DOSPageCount       \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n   DOSSiteCount       \x3cspan class=\x22hljs-number\x22\x3e50\x3c\/span\x3e\n   DOSPageInterval    \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n   DOSSiteInterval    \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n   DOSBlockingPeriod  \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n\n   DOSEmailNotify       JohnW@example.com\n   #DOSSystemCommand    \x3cspan class=\x22hljs-string\x22\x3e\x22su - someuser -c \x27\/sbin\/... %s ...\x27\x22\x3c\/span\x3e\n   DOSLogDir            \x3cspan class=\x22hljs-string\x22\x3e\x22\/var\/log\/mod_evasive\x22\x3c\/span\x3e\n\x26lt;\/IfModule\x26gt;\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e必须要创建日志目录并且要赋予其与 apache 进程相同的所有者。这里创建的目录是 \x3ccode\x3e\/var\/log\/mod_evasive\x3c\/code\x3e ，并且在 Ubuntu 上将该目录的所有者和组设置为 \x3ccode\x3ewww-data\x3c\/code\x3e ，与 Apache 服务器相同：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs maxima\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emkdir\x3c\/span\x3e \/\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e\/mod_evasive\nchown www-data:www-data \/\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e\/mod_evasive\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在编辑了 Apache 的配置之后，特别是在正在运行的网站上，在重新启动或重新加载之前，最好检查一下语法，因为语法错误将影响 Apache 的启动从而使网站宕机。\x3c\/p\x3e\n\x3cp\x3eApache 包含一个辅助命令，是一个配置语法检查器。只需运行以下命令来检查您的语法：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs ebnf\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eapachectl configtest\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e如果您的配置是正确的，会得到如下结果：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs ebnf\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eSyntax OK\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是，如果出现问题，您会被告知在哪部分发生了什么错误，例如：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stata\x22\x3eAH00526: \x3cspan class=\x22hljs-keyword\x22\x3eSyntax\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eline\x3c\/span\x3e 6 of \/etc\/apache2\/mods-enabled\/evasive.\x3cspan class=\x22hljs-keyword\x22\x3econf\x3c\/span\x3e:\nDOSSiteInterval takes \x3cspan class=\x22hljs-keyword\x22\x3eone\x3c\/span\x3e argument, \x3cspan class=\x22hljs-keyword\x22\x3eSet\x3c\/span\x3e site interval\nAction \x27configtest\x27 failed.\nThe Apache \x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elog\x3c\/span\x3e may have \x3cspan class=\x22hljs-keyword\x22\x3emore\x3c\/span\x3e information.\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e如果您的配置通过了 configtest 的测试，那么这个模块可以安全地被启用并且 Apache 可以重新加载：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3ea2enmod evasive\nsystemctl reload apache2\x3cspan class=\x22hljs-selector-class\x22\x3e.service\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3emod_evasive 现在已配置好并正在运行了。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#测试\x22\x3e\x3c\/a\x3e测试\x3c\/h3\x3e\n\x3cp\x3e为了测试 mod_evasive，我们只需要向服务器提出足够的网页访问请求，以使其超出阈值，并记录来自 Apache 的响应代码。\x3c\/p\x3e\n\x3cp\x3e一个正常并成功的页面请求将收到如下响应：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs http\x22\x3eHTTP\/1.1 \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e OK\n\n\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是，被 mod_evasive 拒绝的将返回以下内容：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs http\x22\x3eHTTP\/1.1 \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\n\n\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e以下脚本会尽可能迅速地向本地主机（127.0.0.1，localhost）的 80 端口发送 HTTP 请求，并打印出每个请求的响应代码。\x3c\/p\x3e\n\x3cp\x3e你所要做的就是把下面的 bash 脚本复制到一个文件中，例如 \x3ccode\x3emod_evasive_test.sh\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs bash\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/bin\/bash\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eset\x3c\/span\x3e -e\n\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e i \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e {1..50}; \x3cspan class=\x22hljs-keyword\x22\x3edo\x3c\/span\x3e\n        curl -s -I 127.0.0.1 | head -n 1\n\x3cspan class=\x22hljs-keyword\x22\x3edone\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个脚本的部分含义如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3ecurl\x3c\/code\x3e - 这是一个发出网络请求的命令。\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e-s\x3c\/code\x3e - 隐藏进度表。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3e-I\x3c\/code\x3e - 仅显示响应头部信息。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3ehead\x3c\/code\x3e - 打印文件的第一部分。\x3cul\x3e\n\x3cli\x3e\x3ccode\x3e-n 1\x3c\/code\x3e - 只显示第一行。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e然后赋予其执行权限：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3echmod \x3cspan class=\x22hljs-number\x22\x3e755\x3c\/span\x3e mod_evasive_test\x3cspan class=\x22hljs-selector-class\x22\x3e.sh\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在启用 mod_evasive \x3cstrong\x3e之前\x3c\/strong\x3e，脚本运行时，将会看到 50 行 “HTTP \/ 1.1 200 OK” 的返回值。\x3c\/p\x3e\n\x3cp\x3e但是，启用 mod_evasive 后，您将看到以下内容：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3eHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e OK\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e OK\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\nHTTP\/\x3cspan class=\x22hljs-number\x22\x3e1.1\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e403\x3c\/span\x3e Forbidden\n...\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e前两个请求被允许，但是在同一秒内第三个请求发出时，mod_evasive 拒绝了任何进一步的请求。您还将收到一封电子邮件（邮件地址在选项 \x3ccode\x3eDOSEmailNotify\x3c\/code\x3e 中设置），通知您有 DOS 攻击被检测到。\x3c\/p\x3e\n\x3cp\x3emod_evasive 现在已经在保护您的网站啦！\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3evia: \x3ca href=\x22https:\/\/bash-prompt.net\/guides\/mod_proxy\/\x22\x3ehttps:\/\/bash-prompt.net\/guides\/mod_proxy\/\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22https:\/\/bash-prompt.net\/about\/\x22\x3eElliot Cooper\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/jessie-pang\x22\x3ejessie-pang\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 原创编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 Apache 服务器模块保护您的网站免受应用层 DOS 攻击</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/protecting-your-website-from-application-layer-dos-attacks-with-mod">https://www.zcfy.cc/article/protecting-your-website-from-application-layer-dos-attacks-with-mod</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/rch68e1crso/" target="_blank">https://alili.tech/archive/rch68e1crso/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>