<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Web图片资源的加载与渲染时机"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Web图片资源的加载与渲染时机 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/93mr2t7cheg/",
				"appid": "1613049289050283", 
				"title": "Web图片资源的加载与渲染时机 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-10T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/hl1fwwzz34a/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/s4ad000ol4b/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&text=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&text=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&title=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&is_video=false&description=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&title=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&title=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&title=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f93mr2t7cheg%2f&title=Web%e5%9b%be%e7%89%87%e8%b5%84%e6%ba%90%e7%9a%84%e5%8a%a0%e8%bd%bd%e4%b8%8e%e6%b8%b2%e6%9f%93%e6%97%b6%e6%9c%ba"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Web图片资源的加载与渲染时机</h1><div class="meta"><div class="postdate"><time datetime="2019-01-10" itemprop="datePublished">2019-01-10</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e此文研究页面中的图片资源的加载和渲染时机，使得我们能更好的管理图片资源，避免不必要的流量和提高用户体验。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e浏览器的工作流程\x3c\/h2\x3e\n\x3cp\x3e要研究图片资源的加载和渲染，我们先要了解浏览器的工作原理。以\x3cstrong\x3eWebkit\x3c\/strong\x3e引擎的工作流程为例：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032506\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032506\x22 alt=\x22webkitflow\x22 title=\x22webkitflow\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e从上图可看出，浏览器加载一个HTML页面后进行如下操作：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e解析HTML —\x26gt; 构建DOM树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e加载样式 —\x26gt; 解析样式 —\x26gt; 构建样式规则树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e加载javascript —\x26gt; 执行javascript代码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e把DOM树和样式规则树匹配构建渲染树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e计算元素位置进行布局\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e绘制\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e从上图我们不能很直观的看出图片资源从什么时候开始加载，下图标出图片加载和渲染的时机：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e解析HTML【遇到\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签加载图片】 —\x26gt; 构建DOM树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e加载样式 —\x26gt; 解析样式【遇到背景图片链接不加载】 —\x26gt; 构建样式规则树\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e加载javascript —\x26gt; 执行javascript代码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e把DOM树和样式规则树匹配构建渲染树【遍历DOM树时加载对应样式规则上的背景图片】\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e计算元素位置进行布局\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e绘制【开始渲染图片】\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e图片加载与渲染规则\x3c\/h2\x3e\n\x3cp\x3e页面中不是所有的\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签图片和样式表背景图片都会加载。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e\x3cstrong\x3edisplay:none\x3c\/strong\x3e\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n.img-purple {\n    background-image: url(..\/image\/purple.png);\n}\n\x3c\/style\x3e\n\x3cimg src=\x26quot;..\/image\/pink.png\x26quot; style=\x26quot;display:none\x26quot;\x3e\n\x3cdiv class=\x26quot;img-purple\x26quot; style=\x26quot;display:none\x26quot;\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.img-purple\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground-image\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e(..\/image\/purple.png);\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22..\/image\/pink.png\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22display:none\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22img-purple\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22display:none\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032507\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032507\x22 alt=\x22display-none\x22 title=\x22display-none\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e设置了\x3ccode\x3edisplay:none\x3c\/code\x3e属性的元素，图片不会渲染出来，但会加载。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e把DOM树和样式规则树匹配构建渲染树时，只会把可见元素和它对应的样式规则结合一起产出到渲染树，这就意味有不可见元素，当匹配DOM树和样式规则树时，若发现一个元素的对应的样式规则上有\x3ccode\x3edisplay:none\x3c\/code\x3e，浏览器会认为该元素是不可见的，因此不会把该元素产出到渲染树上。\x3c\/p\x3e\n\x3cp\x3e上面代码中，当解析HTML时会加载\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签元素上的图片。\x3c\/p\x3e\n\x3cp\x3e当把DOM树和样式规则树匹配构建渲染树时，遍历DOM树上的元素，发现元素对应的样式规则上有\x3ccode\x3ebackground-image\x3c\/code\x3e属性时会加载背景图片，但是因为这个元素是不可见元素（对应的样式规则上有\x3ccode\x3ediaplay:none\x3c\/code\x3e），不会把该元素和它对应的样式规则产出到渲染树。\x3c\/p\x3e\n\x3cp\x3e当绘制时因为渲染树上没有该元素，因此不会绘制该元素的背景图片。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cstyle\x3e\n.img-yellow {\n    background-image: url(..\/image\/yellow.png);\n}\n\x3c\/style\x3e\n\x3cdiv style=\x26quot;display:none\x26quot;\x3e\n    \x3cimg src=\x26quot;..\/image\/red.png\x26quot;\x3e\n    \x3cdiv class=\x26quot;img-yellow\x26quot;\x3e\x3c\/div\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22css\x22\x3e\n\x3cspan class=\x22hljs-selector-class\x22\x3e.img-yellow\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attribute\x22\x3ebackground-image\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e(..\/image\/yellow.png);\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3estyle\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22display:none\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22..\/image\/red.png\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22img-yellow\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032508\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032508\x22 alt=\x22display-none\x22 title=\x22display-none\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e设置了\x3ccode\x3edisplay:none\x3c\/code\x3e属性元素的子元素，样式表中的背景图片不会渲染出来，也不会加载；而\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签的图片不会渲染出来，但会加载。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e正如上面所说的，当匹配DOM树和样式规则树时，若发现元素的对应的样式规则上有\x3ccode\x3edisplay:none\x3c\/code\x3e，浏览器会认为该元素的子元素是不可见的，因此不会把该元素的子元素产出到渲染树上。\x3c\/p\x3e\n\x3cp\x3e当构建渲染树遇到了设置了\x3ccode\x3edisplay:none\x3c\/code\x3e属性的不可见元素时，不会继续遍历不可见元素的子元素，因此不会加载该元素中子元素的背景图片。\x3c\/p\x3e\n\x3cp\x3e当绘制时也因为渲染树上没有设置了\x3ccode\x3edisplay:none\x3c\/code\x3e属性元素，也没有改元素的子元素，因此该元素中子元素的背景图片不会渲染出来。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e重复图片\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.img-blue {\n    background-image: url(..\/image\/blue.png);\n}\n\x3cdiv class=\x26quot;img-blue\x26quot;\x3e\x3c\/div\x3e\n\x3cimg src=\x26quot;..\/image\/blue.png\x26quot;\x3e\n\x3cimg src=\x26quot;..\/image\/blue.png\x26quot;\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e.img-blue {\n    background-image: url(..\/image\/blue.png);\n}\n\x26lt;div \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22img-blue\x22\x3c\/span\x3e\x26gt;\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\x26lt;img src=\x3cspan class=\x22hljs-string\x22\x3e\x22..\/image\/blue.png\x22\x3c\/span\x3e\x26gt;\n\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22..\/image\/blue.png\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032509\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032509\x22 alt=\x22repeat-image\x22 title=\x22repeat-image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e页面中多个\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签或样式表中的背景图片图片路径是同一个，图片只加载一次。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e浏览器请求资源时，都会先判断是否有缓存，若有缓存且未过期则会从缓存中读取，不会再次请求。先加载的图片会存储到浏览器缓存中，后面再次请求同路径图片时会直接读取缓存中的图片。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e不存在元素的背景图片\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.img-blue {\n    background-image: url(..\/image\/blue.png);\n}\n.img-orange{\n    background-image: url(..\/image\/orange.png);\n}\n\x3cdiv class=\x26quot;img-orange\x26quot;\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs processing\x22\x3e\x3ccode\x3e.img-\x3cspan class=\x22hljs-built_in\x22\x3eblue\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e-\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e: url(..\/\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3eblue\x3c\/span\x3e.png);\n}\n.img-orange{\n    \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e-\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e: url(..\/\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e\/orange.png);\n}\n\x26lt;div class=\x3cspan class=\x22hljs-string\x22\x3e\x22img-orange\x22\x3c\/span\x3e\x26gt;\x26lt;\/div\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032510\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032510\x22 alt=\x22no-image\x22 title=\x22no-image\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e不存在元素的背景图片不会加载。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e不存在的元素不会产出到DOM树上，构建渲染树过程中遍历DOM树时无法遍历不存在的元素，因此不会加载图片，也不会产出到渲染树上。当解析渲染树时无法解析不存在的元素，不存在的元素自然也不会渲染。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e伪类的背景图片\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.img-green {\n    background-image: url(..\/image\/green.png);\n}\n.img-green:hover{\n    background-image: url(..\/image\/red.png);\n}\n\x3cdiv class=\x26quot;img-green\x26quot;\x3e\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs processing\x22\x3e\x3ccode\x3e.img-\x3cspan class=\x22hljs-built_in\x22\x3egreen\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e-\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e: url(..\/\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3egreen\x3c\/span\x3e.png);\n}\n.img-\x3cspan class=\x22hljs-built_in\x22\x3egreen\x3c\/span\x3e:hover{\n    \x3cspan class=\x22hljs-built_in\x22\x3ebackground\x3c\/span\x3e-\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e: url(..\/\x3cspan class=\x22hljs-built_in\x22\x3eimage\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3ered\x3c\/span\x3e.png);\n}\n\x26lt;div class=\x3cspan class=\x22hljs-string\x22\x3e\x22img-green\x22\x3c\/span\x3e\x26gt;\x26lt;\/div\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e触发hover前的图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032511\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032511\x22 alt=\x22class-image\x22 title=\x22class-image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e触发hover后的图片资源请求如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010032512\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010032512\x22 alt=\x22class-image\x22 title=\x22class-image\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当触发伪类的时候，伪类样式上的背景图片才会加载。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原理\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e触发hover前，构建渲染树过程中，遍历DOM树时，该元素匹配的样式规则是无hover状态选择器\x3ccode\x3e.img-green\x3c\/code\x3e的样式，因此加载无hover状态选择器\x3ccode\x3e.img-green\x3c\/code\x3e的样式上\x3cem\x3egreen.png\x3c\/em\x3e图片。该元素是可见元素，因此会被产出到渲染树上，绘制时渲染的也是\x3cem\x3egreen.png\x3c\/em\x3e。\x3c\/p\x3e\n\x3cp\x3e触发hover后，因为\x3ccode\x3e.img-green:hover\x3c\/code\x3e的优先级比较高，构建新的渲染树过程中，该元素匹配的是有hover状态选择器，因此加载有hover状态选择器\x3ccode\x3e.img-green:hover\x3c\/code\x3e的样式上的\x3cem\x3ered.png\x3c\/em\x3e图片。该元素是可见元素，因此会被产出到渲染树上，绘制时渲染的也是\x3cem\x3ered.png\x3c\/em\x3e。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e应用\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e占位图\x3c\/h3\x3e\n\x3cp\x3e当使用样式表中的背景图片作为占位符时，要把背景图片转为base64格式。这是因为背景图片加载的顺序在\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签后面，背景图片可能会在\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签图片加载完成后才开始加载，达不到想要的效果。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e预加载\x3c\/h3\x3e\n\x3cp\x3e很多场景里图片是在改变或触发状态后才显示出来的，例如点击一个Tab后，一个设置\x3ccode\x3edisplay:none\x3c\/code\x3e隐藏的父元素变为显示，这个父元素里的子元素图片会在父元素显示后才开始加载；又如当鼠标hover到图标后，改变图标图片，图片会在hover上去后才开始加载，导致出现闪一下这种不友好的体验。\x3c\/p\x3e\n\x3cp\x3e在这种场景下，我们就需要把图片预加载，预加载有很多种方式:\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e若是小图标，可以合并成雪碧图，在改变状态前就把所有图标都一起加载了。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用上文讲到的，设置了display:none属性的元素，图片不会渲染出来，但会加载。把要预加载的图片加到设置了\x3ccode\x3edisplay:none\x3c\/code\x3e的元素背景图或\x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e标签里。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在javascript创建img对象，把图片url设置到img对象的src属性里。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\n\x3cp\x3e欢迎关注：\x3ca href=\x22https:\/\/segmentfault.com\/u\/leechikit\/articles\x22\x3eLeechikit\x3c\/a\x3e\x3cbr\x3e原文链接：\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000010032501\x22 target=\x22_blank\x22\x3esegmentfault.com\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e到此本文结束，欢迎提问和指正。\x3cbr\x3e写原创文章不易，若本文对你有帮助，请点赞、推荐和关注作者支持。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Web图片资源的加载与渲染时机</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010032501">https://segmentfault.com/a/1190000010032501</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/93mr2t7cheg/" target="_blank">https://alili.tech/archive/93mr2t7cheg/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>