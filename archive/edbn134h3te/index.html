<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript 进阶之深入理解数据双向绑定"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript 进阶之深入理解数据双向绑定 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/edbn134h3te/",
				"appid": "1613049289050283", 
				"title": "JavaScript 进阶之深入理解数据双向绑定 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-06T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xxmcm35hzlh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/o1al63hwi7t/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&text=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&text=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&title=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&is_video=false&description=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&title=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&title=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&title=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fedbn134h3te%2f&title=JavaScript%20%e8%bf%9b%e9%98%b6%e4%b9%8b%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3%e6%95%b0%e6%8d%ae%e5%8f%8c%e5%90%91%e7%bb%91%e5%ae%9a"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript 进阶之深入理解数据双向绑定</h1><div class="meta"><div class="postdate"><time datetime="2019-01-06" itemprop="datePublished">2019-01-06</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e谈起当前前端最热门的 js 框架，必少不了 Vue、React、Angular，对于大多数人来说，我们更多的是在使用框架，对于框架解决痛点背后使用的基本原理往往关注不多，近期在研读 Vue.js 源码，也在写源码解读的系列文章。和多数源码解读的文章不同的是，我会尝试从一个初级前端的角度入手，由浅入深去讲解源码实现思路和基本的语法知识，通过一些基础事例一步步去实现一些小功能。\x3c\/p\x3e\n\x3cp\x3e本场 Chat 是系列 Chat 的开篇，我会首先讲解一下数据双向绑定的基本原理，介绍对比一下三大框架的不同实现方式，同时会一步步完成一个简单的mvvm示例。读源码不是目的，只是一种学习的方式，目的是在读源码的过程中提升自己，学习基本原理，拓展编码的思维方式。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e模板引擎实现原理\x3c\/h2\x3e\n\x3cp\x3e对于页面渲染，一般分为服务器端渲染和浏览器端渲染。一般来说服务器端吐html页面的方式渲染速度更快、更利于SEO，但是浏览器端渲染更利于提高开发效率和减少维护成本，是一种相关舒服的前后端协作模式，后端提供接口，前端做视图和交互逻辑。前端通过Ajax请求数据然后拼接html字符串或者使用js模板引擎、数据驱动的框架如Vue进行页面渲染。\x3c\/p\x3e\n\x3cp\x3e在ES6和Vue这类框架出现以前，前端绑定数据的方式是动态拼接html字符串和js模板引擎。模板引擎起到数据和视图分离的作用，模板对应视图，关注如何展示数据，在模板外头准备的数据， 关注那些数据可以被展示。模板引擎的工作原理可以简单地分成两个步骤：模板解析 \/ 编译（Parse \/ Compile）和数据渲染（Render）两部分组成，当今主流的前端模板有三种方式：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eString-based templating (基于字符串的parse和compile过程)\x3c\/li\x3e\n\x3cli\x3eDom-based templating (基于Dom的link或compile过程)\x3c\/li\x3e\n\x3cli\x3eLiving templating (基于字符串的parse 和 基于dom的compile过程)\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eString-based templating\x3c\/h3\x3e\n\x3cp\x3e基于字符串的模板引擎，本质上依然是字符串拼接的形式，只是一般的库做了封装和优化，提供了更多方便的语法简化了我们的工作。基本原理如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010065090?w=1008\x26amp;h=458\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010065090?w=1008\x26amp;h=458\x22 alt=\x22String-based-Template\x22 title=\x22String-based-Template\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e典型的库：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/aui\/art-template\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eart-template\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/janl\/mustache.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emustache.js\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/olado\/doT\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edoT\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e之前的一篇文章中我介绍了js模板引擎的实现思路，感兴趣的朋友可以看看这里：\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000005804719\x22\x3eJavaScript进阶学习（一）—— 基于正则表达式的简单js模板引擎实现\x3c\/a\x3e。这篇文章中我们利用正则表达式实现了一个简单的js模板引擎，利用正则匹配查找出模板中\x3ccode\x3e\x22{{\x22\x22}}\x22\x3c\/code\x3e之间的内容，然后替换为模型中的数据，从而实现视图的渲染。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var template = function(tpl, data) {\n  var re = \/\x22{{\x22(.\x2b?)\x22}}\x22\/g,\n    cursor = 0,\n    reExp = \/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?\/g,    \n    code = \x27var r=[];\\n\x27;\n\n  \/\/ 解析html\n  function parsehtml(line) {\n    \/\/ 单双引号转义，换行符替换为空格,去掉前后的空格\n    line = line.replace(\/(\x27|\x26quot;)\/g, \x27\\\\$1\x27).replace(\/\\n\/g, \x27 \x27).replace(\/(^\\s\x2b)|(\\s\x2b$)\/g,\x26quot;\x26quot;);\n    code \x2b=\x27r.push(\x26quot;\x27 \x2b line \x2b \x27\x26quot;);\\n\x27;\n  }\n  \n  \/\/ 解析js代码        \n  function parsejs(line) {   \n    \/\/ 去掉前后的空格\n    line = line.replace(\/(^\\s\x2b)|(\\s\x2b$)\/g,\x26quot;\x26quot;);\n    code \x2b= line.match(reExp)? line \x2b \x27\\n\x27 : \x27r.push(\x27 \x2b \x27this.\x27 \x2b line \x2b \x27);\\n\x27;\n  }    \n    \n  \/\/ 编译模板\n  while((match = re.exec(tpl))!== null) {\n    \/\/ 开始标签  \x22{{\x22 前的内容和结束标签 \x22}}\x22 后的内容\n    parsehtml(tpl.slice(cursor, match.index));\n    \/\/ 开始标签  \x22{{\x22 和 结束标签 \x22}}\x22 之间的内容\n    parsejs(match[1]);\n    \/\/ 每一次匹配完成移动指针\n    cursor = match.index \x2b match[0].length;\n  }\n  \/\/ 最后一次匹配完的内容\n  parsehtml(tpl.substr(cursor, tpl.length - cursor));\n  code \x2b= \x27return r.join(\x26quot;\x26quot;);\x27;\n  return new Function(code.replace(\/[\\r\\t\\n]\/g, \x27\x27)).apply(data);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e template = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etpl, data\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e re = \x3cspan class=\x22hljs-regexp\x22\x3e\/\x22{{\x22(.\x2b?)\x22}}\x22\/g\x3c\/span\x3e,\n    cursor = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n    reExp = \x3cspan class=\x22hljs-regexp\x22\x3e\/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?\/g\x3c\/span\x3e,    \n    code = \x3cspan class=\x22hljs-string\x22\x3e\x27var r=[];\\n\x27\x3c\/span\x3e;\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解析html\x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eparsehtml\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 单双引号转义，换行符替换为空格,去掉前后的空格\x3c\/span\x3e\n    line = line.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/(\x27|\x22)\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\\\\$1\x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\n\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e).replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/(^\\s\x2b)|(\\s\x2b$)\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n    code \x2b=\x3cspan class=\x22hljs-string\x22\x3e\x27r.push(\x22\x27\x3c\/span\x3e \x2b line \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x22);\\n\x27\x3c\/span\x3e;\n  }\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解析js代码        \x3c\/span\x3e\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eparsejs\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eline\x3c\/span\x3e) \x3c\/span\x3e{   \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 去掉前后的空格\x3c\/span\x3e\n    line = line.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/(^\\s\x2b)|(\\s\x2b$)\/g\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22\x22\x3c\/span\x3e);\n    code \x2b= line.match(reExp)? line \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x27r.push(\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27this.\x27\x3c\/span\x3e \x2b line \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27);\\n\x27\x3c\/span\x3e;\n  }    \n    \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 编译模板\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e((match = re.exec(tpl))!== \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开始标签  \x22{{\x22 前的内容和结束标签 \x22}}\x22 后的内容\x3c\/span\x3e\n    parsehtml(tpl.slice(cursor, match.index));\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开始标签  \x22{{\x22 和 结束标签 \x22}}\x22 之间的内容\x3c\/span\x3e\n    parsejs(match[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 每一次匹配完成移动指针\x3c\/span\x3e\n    cursor = match.index \x2b match[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].length;\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后一次匹配完的内容\x3c\/span\x3e\n  parsehtml(tpl.substr(cursor, tpl.length - cursor));\n  code \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27return r.join(\x22\x22);\x27\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e(code.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/[\\r\\t\\n]\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)).apply(data);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e源代码：\x3ca href=\x22http:\/\/jsfiddle.net\/zhaomenghuan\/bw468orv\/embedded\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/jsfiddle.net\/zhaomengh...\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaomenghuan\/bw468orv\/embedded\/\x22 data-typeid=\x220\x22\x3e点击预览\x3c\/button\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e现在ES6支持了模板字符串，我们可以用比较简单的代码就可以实现类似的功能：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const template = data =\x3e `\n  \x3cp\x3ename: ${data.name}\x3c\/p\x3e\n  \x3cp\x3eage: ${data.profile.age}\x3c\/p\x3e\n  \x3cul\x3e\n    ${data.skills.map(skill =\x3e `\n      \x3cli\x3e${skill}\x3c\/li\x3e\n    `).join(\x27\x27)}\n  \x3c\/ul\x3e`\n\nconst data = {\n  name: \x27zhaomenghuan\x27,\n  profile: { age: 24 },\n  skills: [\x27html5\x27, \x27javascript\x27, \x27android\x27]\n}\n\ndocument.body.innerHTML = template(data)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e template = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`\n  \x26lt;p\x26gt;name: \x3cspan class=\x22hljs-subst\x22\x3e${data.name}\x3c\/span\x3e\x26lt;\/p\x26gt;\n  \x26lt;p\x26gt;age: \x3cspan class=\x22hljs-subst\x22\x3e${data.profile.age}\x3c\/span\x3e\x26lt;\/p\x26gt;\n  \x26lt;ul\x26gt;\n    \x3cspan class=\x22hljs-subst\x22\x3e${data.skills.map(skill =\x26gt; \x3cspan class=\x22hljs-string\x22\x3e`\n      \x26lt;li\x26gt;\x3cspan class=\x22hljs-subst\x22\x3e${skill}\x3c\/span\x3e\x26lt;\/li\x26gt;\n    `\x3c\/span\x3e).join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)}\x3c\/span\x3e\n  \x26lt;\/ul\x26gt;`\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e data = {\n  \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27zhaomenghuan\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eprofile\x3c\/span\x3e: { \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e },\n  \x3cspan class=\x22hljs-attr\x22\x3eskills\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27html5\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27javascript\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27android\x27\x3c\/span\x3e]\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body.innerHTML = template(data)\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eDom-based templating\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010065091?w=827\x26amp;h=458\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010065091?w=827\x26amp;h=458\x22 alt=\x22Dom-based-Template\x22 title=\x22Dom-based-Template\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eDom-based templating 则是从DOM的角度去实现数据的渲染，我们通过遍历DOM树，提取属性与DOM内容，然后将数据写入到DOM树中，从而实现页面渲染。一个简单的例子如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function MVVM(opt) {\n  this.dom = document.querySelector(opt.el);\n  this.data = opt.data || {};\n  this.renderDom(this.dom);\n}\n\nMVVM.prototype = {\n  init: {\n    sTag: \x27\x22{{\x22\x27,\n    eTag: \x27\x22}}\x22\x27\n  },\n  render: function (node) {\n    var self = this;\n    var sTag = self.init.sTag;\n    var eTag = self.init.eTag;\n\n    var matchs = node.textContent.split(sTag);\n    if (matchs.length){\n      var ret = \x27\x27;\n      for (var i = 0; i \x3c matchs.length; i\x2b\x2b) {\n        var match = matchs[i].split(eTag);\n        if (match.length == 1) {\n            ret \x2b= matchs[i];\n        } else {\n            ret = self.data[match[0]];\n        }\n        node.textContent = ret;\n      }\n    }\n  },\n  renderDom: function(dom) {\n    var self = this;\n\n    var attrs = dom.attributes;\n    var nodes = dom.childNodes;\n\n    Array.prototype.forEach.call(attrs, function(item) {\n      self.render(item);\n    });\n\n    Array.prototype.forEach.call(nodes, function(item) {\n      if (item.nodeType === 1) {\n        return self.renderDom(item);\n      }\n      self.render(item);\n    });\n  }\n}\n\nvar app = new MVVM({\n  el: \x27#app\x27,\n  data: {\n    name: \x27zhaomenghuan\x27,\n    age: \x2724\x27,\n    color: \x27red\x27\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMVVM\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(opt)\x3c\/span\x3e \x3c\/span\x3e{\n  this.dom = document.querySelector(opt.el);\n  this.data = opt.data || {};\n  this.renderDom(this.dom);\n}\n\nMVVM.prototype = {\n  init: {\n    sTag: \x3cspan class=\x22hljs-string\x22\x3e\x27\x22{{\x22\x27\x3c\/span\x3e,\n    eTag: \x3cspan class=\x22hljs-string\x22\x3e\x27\x22}}\x22\x27\x3c\/span\x3e\n  },\n  render: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-params\x22\x3e(node)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e = this;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e sTag = \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.init.sTag;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e eTag = \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.init.eTag;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e matchs = node.textContent.split(sTag);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (matchs.length){\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ret = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; matchs.length; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e match = matchs[i].split(eTag);\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (match.length == \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n            ret \x2b= matchs[i];\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            ret = \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.data[match[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]];\n        }\n        node.textContent = ret;\n      }\n    }\n  },\n  renderDom: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(dom)\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e = this;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e attrs = dom.attributes;\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e nodes = dom.childNodes;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eArray\x3c\/span\x3e.prototype.\x3cspan class=\x22hljs-keyword\x22\x3eforEach\x3c\/span\x3e.call(attrs, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(item)\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.render(item);\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eArray\x3c\/span\x3e.prototype.\x3cspan class=\x22hljs-keyword\x22\x3eforEach\x3c\/span\x3e.call(nodes, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(item)\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (item.nodeType === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.renderDom(item);\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3eself\x3c\/span\x3e.render(item);\n    });\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MVVM({\n  el: \x3cspan class=\x22hljs-string\x22\x3e\x27#app\x27\x3c\/span\x3e,\n  data: {\n    name: \x3cspan class=\x22hljs-string\x22\x3e\x27zhaomenghuan\x27\x3c\/span\x3e,\n    age: \x3cspan class=\x22hljs-string\x22\x3e\x2724\x27\x3c\/span\x3e,\n    color: \x3cspan class=\x22hljs-string\x22\x3e\x27red\x27\x3c\/span\x3e\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e源代码：\x3ca href=\x22http:\/\/jsfiddle.net\/zhaomenghuan\/6e3yg6Lq\/embedded\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/jsfiddle.net\/zhaomengh...\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22zhaomenghuan\/6e3yg6Lq\/embedded\/\x22 data-typeid=\x220\x22\x3e点击预览\x3c\/button\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e页面渲染的函数 renderDom 是直接遍历DOM树，而不是遍历html字符串。遍历DOM树节点属性（attributes）和子节点（childNodes），然后调用渲染函数render。当DOM树子节点的类型是元素时，递归调用遍历DOM树的方法。根据DOM树节点类型一直遍历子节点，直到文本节点。\x3c\/p\x3e\n\x3cp\x3erender的函数作用是提取\x3ccode\x3e\x22{{\x22\x22}}\x22\x3c\/code\x3e中的关键词，然后使用数据模型中的数据进行替换。我们通过textContent获取Node节点的nodeValue，然后使用字符串的split方法对nodeValue进行分割，提取\x3ccode\x3e\x22{{\x22\x22}}\x22\x3c\/code\x3e中的关键词然后替换为数据模型中的值。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3eDOM 的相关基础\x3c\/strong\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注：元素类型对应NodeType\x3c\/strong\x3e\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth align=\x22center\x22\x3e元素类型\x3c\/th\x3e\n\x3cth align=\x22center\x22\x3eNodeType\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd align=\x22center\x22\x3e元素\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e1\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22center\x22\x3e属性\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e2\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22center\x22\x3e文本\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e3\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22center\x22\x3e注释\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e8\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd align=\x22center\x22\x3e文档\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e9\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3echildNodes 属性返回包含被选节点的子节点的 NodeList。childNodes包含的不仅仅只有html节点，所有属性，文本、注释等节点都包含在childNodes里面。children只返回元素如input, span, script, div等，不会返回TextNode，注释。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e数据双向绑定实现原理\x3c\/h2\x3e\n\x3cp\x3ejs模板引擎可以认为是一个基于MVC的结构，我们通过建立模板作为视图，然后通过引擎函数作为控制器实现数据和视图的绑定，从而实现实现数据在页面渲染，但是当数据模型发生变化时，视图不能自动更新；当视图数据发生变化时，模型数据不能实现更新，这个时候双向数据绑定应运而生。检测视图数据更新实现数据绑定的方法有很多种，目前主要分为三个流派，Angular使用的是脏检查，只在特定的事件下才会触发视图刷新，Vue使用的是Getter\/Setter机制，而React则是通过 Virtual DOM 算法检查DOM的变动的刷新机制。\x3c\/p\x3e\n\x3cp\x3e本文限于篇幅和内容在此只探讨一下 Vue.js 数据绑定的实现，对于 angular 和 react 后续再做说明，读者也可以自行阅读源码。Vue 监听数据变化的机制是把一个普通 JavaScript 对象传给 Vue 实例的 data 选项，Vue 将遍历此对象所有的属性，并使用 Object.defineProperty 把这些属性全部转为 getter\/setter。Vue 2.x 对 Virtual DOM 进行了支持，这部分内容后续我们再做探讨。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e引子\x3c\/h3\x3e\n\x3cp\x3e为了更好的理解Vue中视图和数据更新的机制，我们先看一个简单的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var o = {\n  a: 0 \n}\nObject.defineProperty(o, \x26quot;b\x26quot;, { \n  get: function () { \n    return this.a \x2b 1; \n  },\n  set: function (value) { \n    this.a = value \/ 2; \n  }\n});\nconsole.log(o.a); \/\/ \x26quot;0\x26quot;\nconsole.log(o.b); \/\/ \x26quot;1\x26quot;\n\n\/\/ 更新o.a\no.a = 5;\nconsole.log(o.a); \/\/ \x26quot;5\x26quot;\nconsole.log(o.b); \/\/ \x26quot;6\x26quot;\n\n\/\/ 更新o.b\no.b = 10; \nconsole.log(o.a); \/\/ \x26quot;5\x26quot;\nconsole.log(o.b); \/\/ \x26quot;6\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e o = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \n}\n\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(o, \x3cspan class=\x22hljs-string\x22\x3e\x22b\x22\x3c\/span\x3e, { \n  \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; \n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.a = value \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; \n  }\n});\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x220\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x221\x22\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新o.a\x3c\/span\x3e\no.a = \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x225\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x226\x22\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新o.b\x3c\/span\x3e\no.b = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e; \n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x225\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x226\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里我们可以看出对象o的b属性的值依赖于a属性的值，同时b属性值的变化又可以改变a属性的值，这个过程相关的属性值的变化都会影响其他相关的值进行更新。反过来我们看看如果不使用Object.defineProperty()方法，上述的问题通过直接给对象属性赋值的方法实现，代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var o = {\n  a: 0\n}    \no.b = o.a \x2b 1;\nconsole.log(o.a); \/\/ \x26quot;0\x26quot;\nconsole.log(o.b); \/\/ \x26quot;1\x26quot;\n\n\/\/ 更新o.a\no.a = 5;\no.b = o.a \x2b 1;\nconsole.log(o.a); \/\/ \x26quot;5\x26quot;\nconsole.log(o.b); \/\/ \x26quot;6\x26quot;\n\n\/\/ 更新o.b\no.b = 10; \no.a = o.b \/ 2;\no.b = o.a \x2b 1;\nconsole.log(o.a); \/\/ \x26quot;5\x26quot;\nconsole.log(o.b); \/\/ \x26quot;6\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e o = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}    \no.b = o.a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x220\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x221\x22\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新o.a\x3c\/span\x3e\no.a = \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e;\no.b = o.a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x225\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x226\x22\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新o.b\x3c\/span\x3e\no.b = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e; \no.a = o.b \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\no.b = o.a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.a); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x225\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(o.b); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x226\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e很显然使用\x3ccode\x3eObject.defineProperty()\x3c\/code\x3e方法可以更方便的监听一个对象的变化。当我们的视图和数据任何一方发生变化的时候，我们希望能够通知对方也更新，这就是所谓的数据双向绑定。既然明白这个道理我们就可以看看Vue源码中相关的处理细节。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Object\/defineProperty\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eObject.defineProperty()\x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3eObject.defineProperty()方法可以直接在一个对象上定义一个新属性，或者修改一个已经存在的属性， 并返回这个对象。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e语法：Object.defineProperty(obj, prop, descriptor)\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e参数：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eobj：需要定义属性的对象。\x3c\/li\x3e\n\x3cli\x3eprop：需被定义或修改的属性名。\x3c\/li\x3e\n\x3cli\x3edescriptor：需被定义或修改的属性的描述符。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e返回值：\x3c\/strong\x3e返回传入函数的对象，即第一个参数obj\x3c\/p\x3e\n\x3cp\x3e该方法重点是描述，对象里目前存在的属性描述符有两种主要形式：\x3cstrong\x3e数据描述符\x3c\/strong\x3e和\x3cstrong\x3e存取描述符\x3c\/strong\x3e。\x3cstrong\x3e数据描述符\x3c\/strong\x3e是一个拥有可写或不可写值的属性。\x3cstrong\x3e存取描述符\x3c\/strong\x3e是由一对 getter-setter 函数功能来描述的属性。描述符必须是两种形式之一；不能同时是两者。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e数据描述符\x3c\/strong\x3e和\x3cstrong\x3e存取描述符\x3c\/strong\x3e均具有以下可选键值：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3econfigurable\x3c\/strong\x3e：当且仅当该属性的 configurable 为 true 时，该属性才能够被改变，也能够被删除。默认为 false。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3eenumerable\x3c\/strong\x3e：当且仅当该属性的 enumerable 为 true 时，该属性才能够出现在对象的枚举属性中。默认为 false。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e数据描述符\x3c\/strong\x3e同时具有以下可选键值：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3evalue\x3c\/strong\x3e：该属性对应的值。可以是任何有效的 JavaScript 值（数值，对象，函数等）。默认为 undefined。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3ewritable\x3c\/strong\x3e：当且仅当仅当该属性的writable为 true 时，该属性才能被赋值运算符改变。默认为 false。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e存取描述符\x3c\/strong\x3e同时具有以下可选键值：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cstrong\x3eget\x3c\/strong\x3e：一个给属性提供 getter 的方法，如果没有 getter 则为 undefined。该方法返回值被用作属性值。默认为undefined。\x3c\/li\x3e\n\x3cli\x3e\n\x3cstrong\x3eset\x3c\/strong\x3e：一个给属性提供 setter 的方法，如果没有 setter 则为 undefined。该方法将接受唯一参数，并将该参数的新值分配给该属性。默认为undefined。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我们可以通过Object.defineProperty()方法精确添加或修改对象的属性。比如，直接赋值创建的属性默认情况是可以枚举的，但是我们可以通过Object.defineProperty()方法设置enumerable属性为false为不可枚举。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var obj = {\n  a: 0,\n  b: 1\n}\nfor (var prop in obj) {\n  console.log(`obj.${prop} = ${obj[prop]}`);\n}\n\n结果：\n\x26quot;obj.a = 0\x26quot;\n\x26quot;obj.b = 1\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e obj = {\n  a: 0,\n  b: 1\n}\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eprop\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(`obj.\x3cspan class=\x22hljs-variable\x22\x3e${prop}\x3c\/span\x3e = \x3cspan class=\x22hljs-variable\x22\x3e${obj\x3c\/span\x3e[\x3cspan class=\x22hljs-keyword\x22\x3eprop\x3c\/span\x3e]}`);\n}\n\n结果：\n\x3cspan class=\x22hljs-string\x22\x3e\x22obj.a = 0\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e\x22obj.b = 1\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们通过Object.defineProperty()修改如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var obj = {\n  a: 0,\n  b: 1\n}\nObject.defineProperty(obj, \x27b\x27, {\n  enumerable: false\n})\nfor (var prop in obj) {\n  console.log(`obj.${prop} = ${obj[prop]}`);\n}\n\n结果：\n\x26quot;obj.a = 0\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e obj = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3eb\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e, {\n  \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n})\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e prop \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`obj.\x3cspan class=\x22hljs-subst\x22\x3e${prop}\x3c\/span\x3e = \x3cspan class=\x22hljs-subst\x22\x3e${obj[prop]}\x3c\/span\x3e`\x3c\/span\x3e);\n}\n\n结果：\n\x3cspan class=\x22hljs-string\x22\x3e\x22obj.a = 0\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里需要说明的是我们使用Object.defineProperty()默认情况下是enumerable属性为false，例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var obj = {\n  a: 0\n}\nObject.defineProperty(obj, \x27b\x27, {\n  value: 1\n})\nfor (var prop in obj) {\n  console.log(`obj.${prop} = ${obj[prop]}`);\n}\n\n结果：\n\x26quot;obj.a = 0\x26quot;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e obj = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, \x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e, {\n  \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n})\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e prop \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e obj) {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`obj.\x3cspan class=\x22hljs-subst\x22\x3e${prop}\x3c\/span\x3e = \x3cspan class=\x22hljs-subst\x22\x3e${obj[prop]}\x3c\/span\x3e`\x3c\/span\x3e);\n}\n\n结果：\n\x3cspan class=\x22hljs-string\x22\x3e\x22obj.a = 0\x22\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其他描述属性使用方法类似，不做赘述。Vue源码\x3ccode\x3ecore\/util\/lang.js\x3c\/code\x3eS中定义了这样一个方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * Define a property.\n *\/\nexport function def (obj: Object, key: string, val: any, enumerable?: boolean) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Define a property.\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edef\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eobj: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e, key: \x3cspan class=\x22hljs-built_in\x22\x3estring\x3c\/span\x3e, val: \x3cspan class=\x22hljs-built_in\x22\x3eany\x3c\/span\x3e, enumerable?: \x3cspan class=\x22hljs-built_in\x22\x3eboolean\x3c\/span\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    configurable: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Object\/getOwnPropertyDescriptor\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eObject.getOwnPropertyDescriptor() \x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3eObject.getOwnPropertyDescriptor() 返回指定对象上一个自有属性对应的属性描述符。（自有属性指的是直接赋予该对象的属性，不需要从原型链上进行查找的属性）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e语法：Object.getOwnPropertyDescriptor(obj, prop)\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e参数：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eobj：在该对象上查看属性\x3c\/li\x3e\n\x3cli\x3eprop：一个属性名称，该属性的属性描述符将被返回\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e返回值：\x3c\/strong\x3e如果指定的属性存在于对象上，则返回其属性描述符（property descriptor），否则返回 undefined。可以访问“属性描述符”内容，例如前面的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var o = {\n  a: 0 \n}\n            \nObject.defineProperty(o, \x26quot;b\x26quot;, { \n  get: function () { \n    return this.a \x2b 1; \n  },\n  set: function (value) { \n    this.a = value \/ 2; \n  }\n});\n            \nvar des = Object.getOwnPropertyDescriptor(o,\x27b\x27);\nconsole.log(des);\nconsole.log(des.get);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e o = {\n  \x3cspan class=\x22hljs-attr\x22\x3ea\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \n}\n            \n\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(o, \x3cspan class=\x22hljs-string\x22\x3e\x22b\x22\x3c\/span\x3e, { \n  \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e; \n  },\n  \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{ \n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.a = value \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e; \n  }\n});\n            \n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e des = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.getOwnPropertyDescriptor(o,\x3cspan class=\x22hljs-string\x22\x3e\x27b\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(des);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(des.get);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eVue源码分析\x3c\/h3\x3e\n\x3cp\x3e本次我们主要分析一下Vue 数据绑定的源码，这里我直接将 \x3ca href=\x22https:\/\/github.com\/vuejs\/vue\/blob\/v1.0.28\/src\/observer\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue.js 1.0.28\x3c\/a\x3e 版本的代码稍作删减拿过来进行，2.x 的代码基于 flow 静态类型检查器书写的，代码除了编码风格在整体结构上基本没有太大改动，所以依然基于 1.x 进行分析，对于存在差异的部分加以说明。\x3c\/p\x3e\n\x3cp\x3e\x3cimg alt=\x22Alt text\x22 title=\x22Alt text\x22 src=\x22https:\/\/static.alili.techundefined\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/p\x3e\n\x3ch4\x3e监听对象变动\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 观察者构造函数\nfunction Observer (value) {\n  this.value = value\n  this.walk(value)\n}\n\n\/\/ 递归调用，为对象绑定getter\/setter\nObserver.prototype.walk = function (obj) {\n  var keys = Object.keys(obj)\n  for (var i = 0, l = keys.length; i \x3c l; i\x2b\x2b) {\n    this.convert(keys[i], obj[keys[i]])\n  }\n}\n\n\/\/ 将属性转换为getter\/setter\nObserver.prototype.convert = function (key, val) {\n  defineReactive(this.value, key, val)\n}\n\n\/\/ 创建数据观察者实例\nfunction observe (value) {\n  \/\/ 当值不存在或者不是对象类型时，不需要继续深入监听\n  if (!value || typeof value !== \x27object\x27) {\n    return\n  }\n  return new Observer(value)\n}\n\n\/\/ 定义对象属性的getter\/setter\nfunction defineReactive (obj, key, val) {\n  var property = Object.getOwnPropertyDescriptor(obj, key)\n  if (property \x26amp;\x26amp; property.configurable === false) {\n    return\n  }\n\n  \/\/ 保存对象属性预先定义的getter\/setter\n  var getter = property \x26amp;\x26amp; property.get\n  var setter = property \x26amp;\x26amp; property.set\n\n  var childOb = observe(val)\n  Object.defineProperty(obj, key, {\n    enumerable: true,\n    configurable: true,\n    get: function reactiveGetter () {\n      var value = getter ? getter.call(obj) : val\n      console.log(\x26quot;访问：\x26quot;\x2bkey)\n      return value\n    },\n    set: function reactiveSetter (newVal) {\n      var value = getter ? getter.call(obj) : val\n      if (newVal === value) {\n        return\n      }\n      if (setter) {\n        setter.call(obj, newVal)\n      } else {\n        val = newVal\n      }\n      \/\/ 对新值进行监听\n      childOb = observe(newVal)\n      console.log(\x27更新：\x27 \x2b key \x2b \x27 = \x27 \x2b newVal)\n    }\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 观察者构造函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eObserver\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = value\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.walk(value)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 递归调用，为对象绑定getter\/setter\x3c\/span\x3e\nObserver.prototype.walk = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eobj\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e keys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(obj)\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = keys.length; i \x26lt; l; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.convert(keys[i], obj[keys[i]])\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将属性转换为getter\/setter\x3c\/span\x3e\nObserver.prototype.convert = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey, val\x3c\/span\x3e) \x3c\/span\x3e{\n  defineReactive(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value, key, val)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建数据观察者实例\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eobserve\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当值不存在或者不是对象类型时，不需要继续深入监听\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!value || \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e value !== \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Observer(value)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 定义对象属性的getter\/setter\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edefineReactive\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eobj, key, val\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e \x3c\/span\x3e= \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.getOwnPropertyDescriptor(obj, key)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e \x26amp;\x26amp; property.configurable \x3c\/span\x3e=== \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存对象属性预先定义的getter\/setter\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e getter = \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e \x26amp;\x26amp; property.get\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e setter = \x3cspan class=\x22hljs-keyword\x22\x3eproperty\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e \x26amp;\x26amp; property.set\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e childOb = observe(val)\n  \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n    \x3cspan class=\x22hljs-attribute\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attribute\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attribute\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereactiveGetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e value = getter ? getter.call(obj) : val\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22访问：\x22\x3c\/span\x3e\x2bkey)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value\n    },\n    \x3cspan class=\x22hljs-attribute\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereactiveSetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enewVal\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e value = getter ? getter.call(obj) : val\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (newVal === value) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (setter) {\n        setter.call(obj, newVal)\n      } \x3cspan class=\x22hljs-title\x22\x3eelse\x3c\/span\x3e {\n        val = newVal\n      }\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 对新值进行监听\x3c\/span\x3e\n      childOb = observe(newVal)\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27更新：\x27\x3c\/span\x3e \x2b key \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 = \x27\x3c\/span\x3e \x2b newVal)\n    }\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e定义一个对象作为数据模型，并监听这个对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let data = {\n  user: {\n    name: \x27zhaomenghuan\x27,\n    age: \x2724\x27\n  },\n  address: {\n    city: \x27beijing\x27\n  }\n}\nobserve(data)\n\nconsole.log(data.user.name) \n\/\/ 访问：user \n\/\/ 访问：name\n\ndata.user.name = \x27ZHAO MENGHUAN\x27\n\/\/ 访问：user\n\/\/ 更新：name = ZHAO MENGHUAN\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3elet data = {\n  user: {\n    name: \x3cspan class=\x22hljs-string\x22\x3e\x27zhaomenghuan\x27\x3c\/span\x3e,\n    age: \x3cspan class=\x22hljs-string\x22\x3e\x2724\x27\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-selector-tag\x22\x3eaddress\x3c\/span\x3e: {\n    city: \x3cspan class=\x22hljs-string\x22\x3e\x27beijing\x27\x3c\/span\x3e\n  }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3eobserve\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(data)\x3c\/span\x3e\x3c\/span\x3e\n\nconsole.log(data\x3cspan class=\x22hljs-selector-class\x22\x3e.user\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.name\x3c\/span\x3e) \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 访问：user \x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 访问：name\x3c\/span\x3e\n\ndata\x3cspan class=\x22hljs-selector-class\x22\x3e.user\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.name\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27ZHAO MENGHUAN\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 访问：user\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新：name = ZHAO MENGHUAN\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e效果如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010065093?w=679\x26amp;h=544\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010065093?w=679\x26amp;h=544\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e监听数组变动\x3c\/h4\x3e\n\x3cp\x3e上面我们通过Object.defineProperty把对象的属性全部转为 getter\/setter 从而实现监听对象的变动，但是对于数组对象无法通过Object.defineProperty实现监听。Vue 包含一组观察数组的变异方法，所以它们也将会触发视图更新。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const arrayProto = Array.prototype\nconst arrayMethods = Object.create(arrayProto)\n\nfunction def(obj, key, val, enumerable) {\n  Object.defineProperty(obj, key, {\n    value: val,\n    enumerable: !!enumerable,\n    writable: true,\n    configurable: true\n  })\n}\n\n\/\/ 数组的变异方法\n;[\n  \x27push\x27,\n  \x27pop\x27,\n  \x27shift\x27,\n  \x27unshift\x27,\n  \x27splice\x27,\n  \x27sort\x27,\n  \x27reverse\x27\n]\n.forEach(function (method) {\n  \/\/ 缓存数组原始方法\n  var original = arrayProto[method]\n  def(arrayMethods, method, function mutator () {\n    var i = arguments.length\n    var args = new Array(i)\n    while (i--) {\n      args[i] = arguments[i]\n    }\n    console.log(\x27数组变动\x27)\n    return original.apply(this, args)\n  })\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arrayProto = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.prototype\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arrayMethods = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(arrayProto)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edef\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, key, val, enumerable\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n    \x3cspan class=\x22hljs-attr\x22\x3evalue\x3c\/span\x3e: val,\n    \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: !!enumerable,\n    \x3cspan class=\x22hljs-attr\x22\x3ewritable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数组的变异方法\x3c\/span\x3e\n;[\n  \x3cspan class=\x22hljs-string\x22\x3e\x27push\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27pop\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27shift\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27unshift\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27splice\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27sort\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x27reverse\x27\x3c\/span\x3e\n]\n.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3emethod\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 缓存数组原始方法\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e original = arrayProto[method]\n  def(arrayMethods, method, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emutator\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e.length\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e args = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e(i)\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (i--) {\n      args[i] = \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e[i]\n    }\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27数组变动\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e original.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, args)\n  })\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eVue.js 1.x 在Array.prototype原型对象上添加了\x3ccode\x3e$set\x3c\/code\x3e 和 \x3ccode\x3e$remove\x3c\/code\x3e方法，在2.X后移除了，使用全局 API \x3ccode\x3eVue.set\x3c\/code\x3e 和 \x3ccode\x3eVue.delete\x3c\/code\x3e代替了，后续我们再分析。\x3c\/p\x3e\n\x3cp\x3e定义一个数组作为数据模型，并对这个数组调用变异的七个方法实现监听。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let skills = [\x27JavaScript\x27, \x27Node.js\x27, \x27html5\x27]\n\/\/ 原型指针指向具有变异方法的数组对象\nskills.__proto__ = arrayMethods\n\nskills.push(\x27java\x27)\n\/\/ 数组变动\nskills.pop()\n\/\/ 数组变动\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gradle\x22\x3e\x3ccode\x3elet skills = [\x3cspan class=\x22hljs-string\x22\x3e\x27JavaScript\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Node.js\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27html5\x27\x3c\/span\x3e]\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 原型指针指向具有变异方法的数组对象\x3c\/span\x3e\nskills.__proto__ = arrayMethods\n\nskills.\x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27java\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数组变动\x3c\/span\x3e\nskills.\x3cspan class=\x22hljs-keyword\x22\x3epop\x3c\/span\x3e()\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数组变动\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e效果如下：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010065094?w=679\x26amp;h=544\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010065094?w=679\x26amp;h=544\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e我们将需要监听的数组的原型指针指向我们定义的数组对象，这样我们的数组在调用上面七个数组的变异方法时，能够监听到变动从而实现对数组进行跟踪。\x3c\/p\x3e\n\x3cp\x3e对于\x3ccode\x3e__proto__\x3c\/code\x3e属性，在ES2015中正式被加入到规范中，标准明确规定，只有浏览器必须部署这个属性，其他运行环境不一定需要部署，所以 Vue 是先进行了判断，当\x3ccode\x3e__proto__\x3c\/code\x3e属性存在时将原型指针\x3ccode\x3e__proto__\x3c\/code\x3e指向具有变异方法的数组对象，不存在时直接将具有变异方法挂在需要追踪的对象上。\x3c\/p\x3e\n\x3cp\x3e我们可以在上面Observer观察者构造函数中添加对数组的监听，源码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const hasProto = \x27__proto__\x27 in {}\nconst arrayKeys = Object.getOwnPropertyNames(arrayMethods)\n\n\/\/ 观察者构造函数\nfunction Observer (value) {\n  this.value = value\n  if (Array.isArray(value)) {\n    var augment = hasProto\n      ? protoAugment\n      : copyAugment\n    augment(value, arrayMethods, arrayKeys)\n    this.observeArray(value)\n  } else {\n    this.walk(value)\n  }\n}\n\n\/\/ 观察数组的每一项\nObserver.prototype.observeArray = function (items) {\n  for (var i = 0, l = items.length; i \x3c l; i\x2b\x2b) {\n    observe(items[i])\n  }\n}\n\n\/\/ 将目标对象\/数组的原型指针__proto__指向src\nfunction protoAugment (target, src) {\n  target.__proto__ = src\n}\n\n\/\/ 将具有变异方法挂在需要追踪的对象上\nfunction copyAugment (target, src, keys) {\n  for (var i = 0, l = keys.length; i \x3c l; i\x2b\x2b) {\n    var key = keys[i]\n    def(target, key, src[key])\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e hasProto = \x3cspan class=\x22hljs-string\x22\x3e\x27__proto__\x27\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e {}\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arrayKeys = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.getOwnPropertyNames(arrayMethods)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 观察者构造函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eObserver\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = value\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(value)) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e augment = hasProto\n      ? protoAugment\n      : copyAugment\n    augment(value, arrayMethods, arrayKeys)\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.observeArray(value)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.walk(value)\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 观察数组的每一项\x3c\/span\x3e\nObserver.prototype.observeArray = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eitems\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = items.length; i \x26lt; l; i\x2b\x2b) {\n    observe(items[i])\n  }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将目标对象\/数组的原型指针__proto__指向src\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eprotoAugment\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etarget, src\x3c\/span\x3e) \x3c\/span\x3e{\n  target.__proto__ = src\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将具有变异方法挂在需要追踪的对象上\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecopyAugment\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3etarget, src, keys\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = keys.length; i \x26lt; l; i\x2b\x2b) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e key = keys[i]\n    def(target, key, src[key])\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3e原型链\x3c\/strong\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e对于不了解原型链的朋友可以看一下我这里画的一个基本关系图：\x3cbr\x3e\x3cimg alt=\x22Alt text\x22 title=\x22Alt text\x22 src=\x22https:\/\/static.alili.techundefined\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e原型对象是构造函数的prototype属性，是所有实例化对象共享属性和方法的原型对象；\x3c\/li\x3e\n\x3cli\x3e实例化对象通过new构造函数得到，都继承了原型对象的属性和方法；\x3c\/li\x3e\n\x3cli\x3e原型对象中有个隐式的constructor，指向了构造函数本身。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3cstrong\x3eObject.create\x3c\/strong\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eObject.create 使用指定的原型对象和其属性创建了一个新的对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const arrayProto = Array.prototype\nconst arrayMethods = Object.create(arrayProto)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs delphi\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arrayProto = \x3cspan class=\x22hljs-keyword\x22\x3eArray\x3c\/span\x3e.prototype\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e arrayMethods = \x3cspan class=\x22hljs-keyword\x22\x3eObject\x3c\/span\x3e.create(arrayProto)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这一步是通过 Object.create 创建了一个原型对象为Array.prototype的空对象。然后通过Object.defineProperty方法对这个对象定义几个变异的数组方法。有些新手可能会直接修改 Array.prototype 上的方法，这是很危险的行为，这样在引入的时候会全局影响Array 对象的方法，而使用Object.create实质上是完全了一份拷贝，新生成的arrayMethods对象的原型指针\x3ccode\x3e__proto__\x3c\/code\x3e指向了Array.prototype，修改arrayMethods 对象不会影响Array.prototype。\x3c\/p\x3e\n\x3cp\x3e基于这种原理，我们通常会使用Object.create 实现类式继承。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 实现继承\nvar extend = function(Child, Parent) {\n    \/\/ 拷贝Parent原型对象\n    Child.prototype = Object.create(Parent.prototype);\n    \/\/ 将Child构造函数赋值给Child的原型对象\n    Child.prototype.constructor = Child;\n}\n\n\/\/ 实例\nvar Parent = function () {\n    this.name = \x27Parent\x27;\n}\nParent.prototype.getName = function () {\n    return this.name;\n}\nvar Child = function () {\n    this.name = \x27Child\x27;\n}\nextend(Child, Parent);\nvar child = new Child();\nconsole.log(child.getName())\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实现继承\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e extend = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eChild, Parent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 拷贝Parent原型对象\x3c\/span\x3e\n    Child.prototype = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.create(Parent.prototype);\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将Child构造函数赋值给Child的原型对象\x3c\/span\x3e\n    Child.prototype.constructor = Child;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实例\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Parent = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = \x3cspan class=\x22hljs-string\x22\x3e\x27Parent\x27\x3c\/span\x3e;\n}\nParent.prototype.getName = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name;\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Child = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.name = \x3cspan class=\x22hljs-string\x22\x3e\x27Child\x27\x3c\/span\x3e;\n}\nextend(Child, Parent);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e child = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Child();\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(child.getName())\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e发布-订阅模式\x3c\/h4\x3e\n\x3cp\x3e在上面一部分我们通过Object.defineProperty把对象的属性全部转为 getter\/setter 以及 数组变异方法实现了对数据模型变动的监听，在数据变动的时候，我们通过console.log打印出来提示了，但是对于框架而言，我们相关的逻辑如果直接写在那些地方，自然是不够优雅和灵活的，这个时候就需要引入常用的设计模式去实现，vue.js采用了发布-订阅模式。发布-订阅模式主要是为了达到一种“高内聚、低耦合\x22的效果。\x3c\/p\x3e\n\x3cp\x3eVue的Watcher订阅者作为Observer和Compile之间通信的桥梁，能够订阅并收到每个属性变动的通知，执行指令绑定的相应回调函数，从而更新视图。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * 观察者对象\n *\/\nfunction Watcher(vm, expOrFn, cb) {\n    this.vm = vm\n    this.cb = cb\n    this.depIds = {}\n    if (typeof expOrFn === \x27function\x27) {\n        this.getter = expOrFn\n    } else {\n        this.getter = this.parseExpression(expOrFn)\n    }\n    this.value = this.get()\n}\n\n\/**\n * 收集依赖\n *\/\nWatcher.prototype.get = function () {\n    \/\/ 当前订阅者(Watcher)读取被订阅数据的最新更新后的值时，通知订阅者管理员收集当前订阅者\n    Dep.target = this\n    \/\/ 触发getter，将自身添加到dep中\n    const value = this.getter.call(this.vm, this.vm)\n    \/\/ 依赖收集完成，置空，用于下一个Watcher使用\n    Dep.target = null\n    return value\n}\n\nWatcher.prototype.addDep = function (dep) {\n    if (!this.depIds.hasOwnProperty(dep.id)) {\n        dep.addSub(this)\n        this.depIds[dep.id] = dep\n    }\n}\n\n\/**\n * 依赖变动更新\n *\n * @param {Boolean} shallow\n *\/\nWatcher.prototype.update = function () {\n    this.run()\n}\n\nWatcher.prototype.run = function () {\n    var value = this.get()\n    if (value !== this.value) {\n        var oldValue = this.value\n        this.value = value\n        \/\/ 将newVal, oldVal挂载到MVVM实例上\n        this.cb.call(this.vm, value, oldValue)\n    }\n}\n\nWatcher.prototype.parseExpression = function (exp) {\n    if (\/[^\\w.$]\/.test(exp)) {\n        return\n    }\n    var exps = exp.split(\x27.\x27)\n    \n    return function(obj) {\n        for (var i = 0, len = exps.length; i \x3c len; i\x2b\x2b) {\n            if (!obj) return\n            obj = obj[exps[i]]\n        }\n        return obj\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs kotlin\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 观察者对象\n *\/\x3c\/span\x3e\nfunction Watcher(vm, expOrFn, cb) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm = vm\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.cb = cb\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.depIds = {}\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (typeof expOrFn === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getter = expOrFn\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getter = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.parseExpression(expOrFn)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e()\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 收集依赖\n *\/\x3c\/span\x3e\nWatcher.prototype.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e = function () {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当前订阅者(Watcher)读取被订阅数据的最新更新后的值时，通知订阅者管理员收集当前订阅者\x3c\/span\x3e\n    Dep.target = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发getter，将自身添加到dep中\x3c\/span\x3e\n    const value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.getter.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm)\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 依赖收集完成，置空，用于下一个Watcher使用\x3c\/span\x3e\n    Dep.target = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value\n}\n\nWatcher.prototype.addDep = function (dep) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.depIds.hasOwnProperty(dep.id)) {\n        dep.addSub(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.depIds[dep.id] = dep\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 依赖变动更新\n *\n * \x3cspan class=\x22hljs-doctag\x22\x3e@param\x3c\/span\x3e {Boolean} shallow\n *\/\x3c\/span\x3e\nWatcher.prototype.update = function () {\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.run()\n}\n\nWatcher.prototype.run = function () {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e()\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (value !== \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value) {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e oldValue = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value = value\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将newVal, oldVal挂载到MVVM实例上\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.cb.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.vm, value, oldValue)\n    }\n}\n\nWatcher.prototype.parseExpression = function (exp) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\/[^\\w.$]\/.test(exp)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e exps = exp.split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e)\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e function(obj) {\n        \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, len = exps.length; i \x26lt; len; i\x2b\x2b) {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!obj) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n            obj = obj[exps[i]]\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e obj\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eDep 是一个数据结构，其本质是维护了一个watcher队列，负责添加watcher，更新watcher，移除watcher，通知watcher更新。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let uid = 0\n\nfunction Dep() {\n    this.id = uid\x2b\x2b\n    this.subs = []\n}\n\nDep.target = null\n\n\/**\n * 添加一个订阅者\n *\n * @param {Directive} sub\n *\/\nDep.prototype.addSub = function (sub) {\n    this.subs.push(sub)\n}\n\n\/**\n * 移除一个订阅者\n *\n * @param {Directive} sub\n *\/\nDep.prototype.removeSub = function (sub) {\n    let index = this.subs.indexOf(sub);\n    if (index !== -1) {\n        this.subs.splice(index, 1);\n    }\n}\n\n\/**\n * 将自身作为依赖添加到目标watcher\n *\/\nDep.prototype.depend = function () {\n    Dep.target.addDep(this)\n}\n\n\/**\n * 通知数据变更\n *\/\nDep.prototype.notify = function () {\n    var subs = toArray(this.subs)\n    \/\/ stablize the subscriber list first\n    for (var i = 0, l = subs.length; i \x3c l; i\x2b\x2b) {\n        \/\/ 执行订阅者的update更新函数\n        subs[i].update()\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e uid = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.id = uid\x2b\x2b\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs = []\n}\n\nDep.target = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 添加一个订阅者\n *\n * @param {Directive} sub\n *\/\x3c\/span\x3e\nDep.prototype.addSub = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esub\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.push(sub)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 移除一个订阅者\n *\n * @param {Directive} sub\n *\/\x3c\/span\x3e\nDep.prototype.removeSub = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esub\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e index = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.indexOf(sub);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (index !== \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.splice(index, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 将自身作为依赖添加到目标watcher\n *\/\x3c\/span\x3e\nDep.prototype.depend = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    Dep.target.addDep(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 通知数据变更\n *\/\x3c\/span\x3e\nDep.prototype.notify = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e subs = toArray(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs)\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ stablize the subscriber list first\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, l = subs.length; i \x26lt; l; i\x2b\x2b) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 执行订阅者的update更新函数\x3c\/span\x3e\n        subs[i].update()\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e模板编译\x3c\/h4\x3e\n\x3cp\x3ecompile主要做的事情是解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function Compile(el, value) {\n    this.$vm = value\n    this.$el = this.isElementNode(el) ? el : document.querySelector(el)\n    if (this.$el) {\n        this.compileElement(this.$el)\n    }\n}\n\nCompile.prototype.compileElement = function (el) {\n    let self = this\n    let childNodes = el.childNodes\n\n    ;[].slice.call(childNodes).forEach(node =\x3e {\n        let text = node.textContent\n        let reg = \/\\{\\{((?:.|\\n)\x2b?)\\}\\}\/\n        \/\/ 处理element节点\n        if (self.isElementNode(node)) {\n            self.compile(node)\n        } else if (self.isTextNode(node) \x26amp;\x26amp; reg.test(text)) { \/\/ 处理text节点\n            self.compileText(node, RegExp.$1.trim())\n        }\n        \/\/ 解析子节点包含的指令\n        if (node.childNodes \x26amp;\x26amp; node.childNodes.length) {\n            self.compileElement(node)\n        }\n    })\n}\n\nCompile.prototype.compile = function (node) {\n    let nodeAttrs = node.attributes\n    let self = this\n\n    ;[].slice.call(nodeAttrs).forEach(attr =\x3e {\n        var attrName = attr.name\n        if (self.isDirective(attrName)) {\n            let exp = attr.value\n            let dir = attrName.substring(2)\n            if (self.isEventDirective(dir)) {\n                compileUtil.eventHandler(node, self.$vm, exp, dir)\n            } else {\n                compileUtil[dir] \x26amp;\x26amp; compileUtil[dir](node, self.$vm, exp)\n            }\n            node.removeAttribute(attrName)\n        }\n    });\n}\n\nCompile.prototype.compileText = function (node, exp) {\n    compileUtil.text(node, this.$vm, exp);\n}\n\nCompile.prototype.isDirective = function (attr) {\n    return attr.indexOf(\x27v-\x27) === 0\n}\n\nCompile.prototype.isEventDirective = function (dir) {\n    return dir.indexOf(\x27on\x27) === 0;\n}\n\nCompile.prototype.isElementNode = function (node) {\n    return node.nodeType === 1\n}\n\nCompile.prototype.isTextNode = function (node) {\n    return node.nodeType === 3\n}\n\n\/\/ 指令处理集合\nvar compileUtil = {\n    text: function (node, vm, exp) {\n        this.bind(node, vm, exp, \x27text\x27)\n    },\n    html: function (node, vm, exp) {\n        this.bind(node, vm, exp, \x27html\x27)\n    },\n    model: function (node, vm, exp) {\n        this.bind(node, vm, exp, \x27model\x27)\n\n        let self = this, val = this._getVMVal(vm, exp)\n        node.addEventListener(\x27input\x27, function (e) {\n            var newValue = e.target.value\n            if (val === newValue) {\n                return\n            }\n            self._setVMVal(vm, exp, newValue)\n            val = newValue\n        });\n    },\n    bind: function (node, vm, exp, dir) {\n        var updaterFn = updater[dir \x2b \x27Updater\x27]\n        updaterFn \x26amp;\x26amp; updaterFn(node, this._getVMVal(vm, exp))\n        new Watcher(vm, exp, function (value, oldValue) {\n            updaterFn \x26amp;\x26amp; updaterFn(node, value, oldValue)\n        })\n    },\n    eventHandler: function (node, vm, exp, dir) {\n        var eventType = dir.split(\x27:\x27)[1],\n            fn = vm.$options.methods \x26amp;\x26amp; vm.$options.methods[exp];\n\n        if (eventType \x26amp;\x26amp; fn) {\n            node.addEventListener(eventType, fn.bind(vm), false);\n        }\n    },\n    _getVMVal: function (vm, exp) {\n        var val = vm\n        exp = exp.split(\x27.\x27)\n        exp.forEach(function (k) {\n            val = val[k]\n        })\n        return val\n    },\n    _setVMVal: function (vm, exp, value) {\n        var val = vm;\n        exp = exp.split(\x27.\x27)\n        exp.forEach(function (k, i) {\n            \/\/ 非最后一个key，更新val的值\n            if (i \x3c exp.length - 1) {\n                val = val[k]\n            } else {\n                val[k] = value\n            }\n        })\n    }\n}\n\nvar updater = {\n    textUpdater: function (node, value) {\n        node.textContent = typeof value == \x27undefined\x27 ? \x27\x27 : value\n    },\n    htmlUpdater: function (node, value) {\n        node.innerHTML = typeof value == \x27undefined\x27 ? \x27\x27 : value\n    },\n    modelUpdater: function (node, value, oldValue) {\n        node.value = typeof value == \x27undefined\x27 ? \x27\x27 : value\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eCompile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eel, value\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$vm = value\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$el = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.isElementNode(el) ? el : \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(el)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$el) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.compileElement(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$el)\n    }\n}\n\nCompile.prototype.compileElement = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eel\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e childNodes = el.childNodes\n\n    ;[].slice.call(childNodes).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e text = node.textContent\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e reg = \x3cspan class=\x22hljs-regexp\x22\x3e\/\\{\\{((?:.|\\n)\x2b?)\\}\\}\/\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理element节点\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (self.isElementNode(node)) {\n            self.compile(node)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (self.isTextNode(node) \x26amp;\x26amp; reg.test(text)) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理text节点\x3c\/span\x3e\n            self.compileText(node, \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e.$\x3cspan class=\x22hljs-number\x22\x3e1.\x3c\/span\x3etrim())\n        }\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 解析子节点包含的指令\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (node.childNodes \x26amp;\x26amp; node.childNodes.length) {\n            self.compileElement(node)\n        }\n    })\n}\n\nCompile.prototype.compile = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e nodeAttrs = node.attributes\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n\n    ;[].slice.call(nodeAttrs).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eattr\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e attrName = attr.name\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (self.isDirective(attrName)) {\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e exp = attr.value\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e dir = attrName.substring(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (self.isEventDirective(dir)) {\n                compileUtil.eventHandler(node, self.$vm, exp, dir)\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                compileUtil[dir] \x26amp;\x26amp; compileUtil[dir](node, self.$vm, exp)\n            }\n            node.removeAttribute(attrName)\n        }\n    });\n}\n\nCompile.prototype.compileText = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, exp\x3c\/span\x3e) \x3c\/span\x3e{\n    compileUtil.text(node, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$vm, exp);\n}\n\nCompile.prototype.isDirective = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eattr\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e attr.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27v-\x27\x3c\/span\x3e) === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\nCompile.prototype.isEventDirective = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edir\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dir.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27on\x27\x3c\/span\x3e) === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\n\nCompile.prototype.isElementNode = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e node.nodeType === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n}\n\nCompile.prototype.isTextNode = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e node.nodeType === \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 指令处理集合\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compileUtil = {\n    \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, vm, exp\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bind(node, vm, exp, \x3cspan class=\x22hljs-string\x22\x3e\x27text\x27\x3c\/span\x3e)\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ehtml\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, vm, exp\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bind(node, vm, exp, \x3cspan class=\x22hljs-string\x22\x3e\x27html\x27\x3c\/span\x3e)\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3emodel\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, vm, exp\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.bind(node, vm, exp, \x3cspan class=\x22hljs-string\x22\x3e\x27model\x27\x3c\/span\x3e)\n\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, val = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._getVMVal(vm, exp)\n        node.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e newValue = e.target.value\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (val === newValue) {\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n            }\n            self._setVMVal(vm, exp, newValue)\n            val = newValue\n        });\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ebind\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, vm, exp, dir\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e updaterFn = updater[dir \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27Updater\x27\x3c\/span\x3e]\n        updaterFn \x26amp;\x26amp; updaterFn(node, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._getVMVal(vm, exp))\n        \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Watcher(vm, exp, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue, oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n            updaterFn \x26amp;\x26amp; updaterFn(node, value, oldValue)\n        })\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eeventHandler\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, vm, exp, dir\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e eventType = dir.split(\x3cspan class=\x22hljs-string\x22\x3e\x27:\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e],\n            fn = vm.$options.methods \x26amp;\x26amp; vm.$options.methods[exp];\n\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (eventType \x26amp;\x26amp; fn) {\n            node.addEventListener(eventType, fn.bind(vm), \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n        }\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3e_getVMVal\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evm, exp\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e val = vm\n        exp = exp.split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e)\n        exp.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ek\x3c\/span\x3e) \x3c\/span\x3e{\n            val = val[k]\n        })\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3e_setVMVal\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evm, exp, value\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e val = vm;\n        exp = exp.split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e)\n        exp.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ek, i\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 非最后一个key，更新val的值\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (i \x26lt; exp.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n                val = val[k]\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                val[k] = value\n            }\n        })\n    }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e updater = {\n    \x3cspan class=\x22hljs-attr\x22\x3etextUpdater\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, value\x3c\/span\x3e) \x3c\/span\x3e{\n        node.textContent = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e value == \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : value\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ehtmlUpdater\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, value\x3c\/span\x3e) \x3c\/span\x3e{\n        node.innerHTML = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e value == \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : value\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3emodelUpdater\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3enode, value, oldValue\x3c\/span\x3e) \x3c\/span\x3e{\n        node.value = \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e value == \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : value\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种实现和我们讲到的Dom-based templating类似，只是更加完备，具有自定义指令的功能。在遍历节点属性和文本节点的时候，可以编译具备\x3ccode\x3e\x22{{\x22\x22}}\x22\x3c\/code\x3e表达式或\x3ccode\x3ev-xxx\x3c\/code\x3e的属性值的节点，并且通过添加 \x3ccode\x3enew Watcher()\x3c\/code\x3e及绑定事件函数，监听数据的变动从而对视图实现双向绑定。\x3c\/p\x3e\n\x3ch4\x3eMVVM实例\x3c\/h4\x3e\n\x3cp\x3e在数据绑定初始化的时候，我们需要通过\x3ccode\x3enew Observer()\x3c\/code\x3e来监听数据模型变化，通过\x3ccode\x3enew Compile()\x3c\/code\x3e来解析编译模板指令，并利用Watcher搭起Observer和Compile之间的通信桥梁。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * @class 双向绑定类 MVVM\n * @param {[type]} options [description]\n *\/\nfunction MVVM(options) {\n    this.$options = options || {}\n    \/\/ 简化了对data的处理\n    let data = this._data = this.$options.data\n    \/\/ 监听数据\n    observe(data)\n    new Compile(options.el || document.body, this)\n}\n\nMVVM.prototype.$watch = function (expOrFn, cb) {\n    new Watcher(this, expOrFn, cb)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * @class 双向绑定类 MVVM\n * @param {[type]} options [description]\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eMVVM\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoptions\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options = options || {}\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 简化了对data的处理\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._data = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options.data\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听数据\x3c\/span\x3e\n    observe(data)\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Compile(options.el || \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.body, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n}\n\nMVVM.prototype.$watch = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eexpOrFn, cb\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Watcher(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, expOrFn, cb)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了能够直接通过实例化对象操作数据模型，我们需要为MVVM实例添加一个数据模型代理的方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22MVVM.prototype._proxy = function (key) {\n    Object.defineProperty(this, key, {\n        configurable: true,\n        enumerable: true,\n        get: () =\x3e this._data[key],\n        set: (val) =\x3e {\n            this._data[key] = val\n        }\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3eMVVM.prototype._proxy = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, key, {\n        configurable: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        enumerable: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-keyword\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._data[key],\n        \x3cspan class=\x22hljs-keyword\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._data[key] = val\n        }\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e至此我们可以通过一个小例子来说明本文的内容：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv id=\x26quot;app\x26quot;\x3e\n    \x3ch3\x3e\x22{{\x22user.name\x22}}\x22\x3c\/h3\x3e\n    \x3cinput type=\x26quot;text\x26quot; v-model=\x26quot;modelValue\x26quot;\x3e\n    \x3cp\x3e\x22{{\x22modelValue\x22}}\x22\x3c\/p\x3e\n\x3c\/div\x3e\n\x3cscript\x3e\n    let vm = new MVVM({\n        el: \x27#app\x27,\n        data: {\n            modelValue: \x27\x27,\n            user: {\n                name: \x27zhaomenghuan\x27,\n                age: \x2724\x27\n            },\n            address: {\n                city: \x27beijing\x27\n            },\n            skills: [\x27JavaScript\x27, \x27Node.js\x27, \x27html5\x27]\n        }\n    })\n    \n    vm.$watch(\x27modelValue\x27, val =\x3e console.log(`watch modelValue ：${val}`))\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs django\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22app\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh3\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22user.name\x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh3\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ev-model\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22modelValue\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-variable\x22\x3e\x22{{\x22modelValue\x22}}\x22\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e vm = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MVVM({\n        \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#app\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3emodelValue\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27zhaomenghuan\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2724\x27\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3eaddress\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3ecity\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27beijing\x27\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3eskills\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27JavaScript\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Node.js\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27html5\x27\x3c\/span\x3e]\n        }\n    })\n    \n    vm.$watch(\x3cspan class=\x22hljs-string\x22\x3e\x27modelValue\x27\x3c\/span\x3e, val =\x26gt; \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`watch modelValue ：\x3cspan class=\x22hljs-subst\x22\x3e${val}\x3c\/span\x3e`\x3c\/span\x3e))\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e本文目的不是为了造一个轮子，而是在学习优秀框架实现的过程中去提升自己，搞清楚框架发展的前因后果，由浅及深去学习基础，本文参考了网上很多优秀博主的文章，由于时间关系，有些内容没有做深入探讨，觉得还是有些遗憾，在后续的学习中会更多的独立思考，提出更多自己的想法。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e参考文档\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/leeluolee.github.io\/2014\/10\/10\/template-engine\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e前端模板技术面面观\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Object\/defineProperty\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eObject.defineProperty()\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/jiongks.name\/blog\/vue-code-review\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVue.js 源码学习笔记\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/youngwind\/blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue早期源码学习系列\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/georgebbbb\/fakeVue\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e解析最简单的observer和watcher\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/github.com\/DMQ\/mvvm\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e剖析Vue实现原理 - 如何实现双向绑定mvvm\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e说明\x3c\/h2\x3e\n\x3cblockquote\x3e\x3cp\x3e本文的完整代码及图片可以在这里下载：\x3cstrong\x3e\x3ca href=\x22https:\/\/github.com\/zhaomenghuan\/learn-javascript\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elearn-javascript\/mvvm\x3c\/a\x3e\x3c\/strong\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3chr\x3e\n\x3cp\x3e原文首发于 GitChat ：\x3ca href=\x22http:\/\/gitbook.cn\/books\/593faaf7d3845323661a4cec\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/gitbook.cn\/books\/593fa...\x3c\/a\x3e，欢迎关注我的新话题：\x3ca href=\x22http:\/\/gitbook.cn\/m\/mazi\/activity\/596a301db5bcf446af77f0f8\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJavaScript 进阶之 Vue.js \x2b Node.js 入门实战开发\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e我在segmentfault上有两期讲座，欢迎来围观：\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/l\/1500000009542402?r=bPqXdU\x22\x3ehtml5\x2b App开发工程化实践之路\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/l\/1500000010042078?r=bPqXdU\x22 target=\x22_blank\x22\x3ehtml5\x2b App开发之 Android 平台离线集成 5\x2b SDK\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript 进阶之深入理解数据双向绑定</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010456158">https://segmentfault.com/a/1190000010456158</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/edbn134h3te/" target="_blank">https://alili.tech/archive/edbn134h3te/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>