<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Promise 的链式调用与中止"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Promise 的链式调用与中止 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/z4ymvs0jz2h/",
				"appid": "1613049289050283", 
				"title": "Promise 的链式调用与中止 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-31T02:31:16"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/672s4hjh70k/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/06cwh88ankmd/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&text=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&text=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&title=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&is_video=false&description=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&title=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&title=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&title=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fz4ymvs0jz2h%2f&title=Promise%20%e7%9a%84%e9%93%be%e5%bc%8f%e8%b0%83%e7%94%a8%e4%b8%8e%e4%b8%ad%e6%ad%a2"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Promise 的链式调用与中止</h1><div class="meta"><div class="postdate"><time datetime="2019-01-31" itemprop="datePublished">2019-01-31</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3eAbstract\x3c\/h2\x3e\n\x3cp\x3e本文主要讲的是如何实现 Promise 的链式调用。也就是 \x3ccode\x3epromise().then().then().catch()\x3c\/code\x3e 的形式，然后讨论如何在某一个 \x3ccode\x3ethen()\x3c\/code\x3e 里面中止 Promise。\x3c\/p\x3e\n\x3cp\x3e在程序中，只要返回了一个 promise 对象，如果 promise 对象不是 Rejected 或 Fulfilled 状态，then 方法就会继续调用。利用这个特性，可以处理多个异步逻辑。但有时候某个 then 方法的执行结果可能会决定是否需要执行下一个 then，这个时候就需中止 promise，主要思想就是使用 reject 来中止 promise 的 then 继续执行。\x3c\/p\x3e\n\x3cp\x3e“中止”这个词不知道用得是否准确。这里可能还是 \x3ccode\x3ebreak\x3c\/code\x3e 的含义更精确，跳出本次 promise，不继续执行后面的 then 方法。但 promise 依旧会继续执行。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eCan I use promises\x3c\/h2\x3e\n\x3cp\x3e当前浏览器对 Promise 的支持情况见下图：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/caniuse.com\/#search=promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/caniuse.com\/#search=promise\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007598897?w=2328\x26amp;h=978\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007598897?w=2328\x26amp;h=978\x22 alt=\x22caniusepromise\x22 title=\x22caniusepromise\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3ePromise\x3c\/h2\x3e\n\x3cp\x3e先简单复习一下 Promise。Promise 其实很简单，就是一个处理异步的方法。一般可以通过 \x3ccode\x3enew\x3c\/code\x3e 方法来调用 \x3ccode\x3ePromise\x3c\/code\x3e 的构造器实例化一个 promise 对象：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var promise = new Promise((resolve, reject) =\x3e {\n    \/\/ 异步处理\n    \/\/ 处理结束后，调用 resolve 或 reject\n    \/\/      成功时就调用 resolve\n    \/\/      失败时就调用 reject\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 异步处理\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 处理结束后，调用 resolve 或 reject\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/      成功时就调用 resolve\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/      失败时就调用 reject\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e用 \x3ccode\x3enew Promise\x3c\/code\x3e 实例化的 promise 对象有以下三个状态：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x22has-resolution\x22 - Fulfilled。resolve(成功)时，此时会调用 onFulfilled\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x22has-rejection\x22 - Rejected。reject(失败)时，此时会调用 onRejected\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x22unresolved\x22 - Pending。既不是resolve也不是reject的状态，也就是promise对象刚被创建后的初始化状态等\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e关于上面这三种状态的读法，其中左侧为在 ES6 Promises 规范中定义的术语， 而右侧则是在 Promises\/A\x2b 中描述状态的术语。基本上状态在代码中是不会涉及到的，所以名称也无需太在意。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007598898\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007598898\x22 alt=\x22promise state\x22 title=\x22promise state\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3ePromise Chain\x3c\/h2\x3e\n\x3cp\x3e先来假设一个业务需求：在系统中使用教务系统账号进行登录。首先用户在登录页面输入用户名（教务系统账号）和密码（教务系统密码）；然后判断数据库中是否存在该用户；如果不存在则使用用户名和密码模拟登录教务系统，如果模拟登录成功，则存储用户名和密码，并返回登录成功。\x3c\/p\x3e\n\x3cp\x3e听起来就有点复杂对不对？于是画了个流程图来解释整个业务逻辑：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007598899?w=1402\x26amp;h=1426\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007598899?w=1402\x26amp;h=1426\x22 alt=\x22flow char\x22 title=\x22flow char\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e上图只是一个简化版本，比如密码加密、session设置等没有表现出来，大家知道就好。图中 \x3ccode\x3e(1)\x3c\/code\x3e、\x3ccode\x3e(2)\x3c\/code\x3e、\x3ccode\x3e(3)\x3c\/code\x3e 三个地方就是会进行异步处理的地方，一般数据库操作、网络请求都是异步的。\x3c\/p\x3e\n\x3cp\x3e如果用传统的回调函数 \x3ccode\x3ecallback\x3c\/code\x3e 来处理上面的逻辑，嵌套的层级就会比较深，上面的业务因为有三个异步操作所以有三层回调，代码大概会是下面的样子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 根据 name 查询用户信息\nfindUserByName(name, function(err, userinfo) {\n  if (err) {\n    return res.json({\n      code: 1000,\n      message: \x27查询用户信息，数据库操作数出现异常\x27,\n    });\n  }\n\n\n  if (userinfo.length \x3e 0) {\n  \/\/ 用户存在\n  if (userinfo[0].pwd === pwd)\n    \/\/ 密码正确\n    return res.json({\n      code: 0,\n      message: \x27登录成功\x27,\n    });\n  }\n\n  \/\/ 数据库中不存在该用户，模拟登录教务系统\n  loginEducationSystem(name, pwd, function(err, result) {\n    if (err) {\n      return res.json({\n        code: 1001,\n        message: \x27模拟登录教务系统出现异常\x27,\n      });\n    }\n\n    \/\/ 约定正确情况下，code 为 0\n    if (result.code !== 0) {\n      return res.json({\n        code: 1002,\n        message: \x27模拟登录教务系统失败，可能是用户名或密码错误\x27,\n      });\n    }\n\n    \/\/ 模拟登录成功，将用户名密码存入数据库\n    saveUserToDB(name, pwd, function(err, result) {\n      if (err) {\n        return res.json({\n          code: 1003,\n          message: \x27将用户名密码存入数据库出现异常\x27,\n        });\n      }\n      if (result.code !== 0) {\n        return res.json({\n          code: 1004,\n          message: \x27将用户名密码存入数据库出现异常\x27,\n        });\n      }\n\n      return res.json({\n        code: 0,\n        message: \x27登录成功!\x27,\n      });\n    });\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scilab\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据 name 查询用户信息\x3c\/span\x3e\nfindUserByName(name, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(err, userinfo)\x3c\/span\x3e {\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n      code: \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e,\n      message: \x3cspan class=\x22hljs-string\x22\x3e\x27查询用户信息，数据库操作数出现异常\x27\x3c\/span\x3e,\n    });\n  }\n\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (userinfo.\x3cspan class=\x22hljs-built_in\x22\x3elength\x3c\/span\x3e \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用户存在\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (userinfo[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].\x3cspan class=\x22hljs-built_in\x22\x3epwd\x3c\/span\x3e === \x3cspan class=\x22hljs-built_in\x22\x3epwd\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 密码正确\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n      code: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n      message: \x3cspan class=\x22hljs-string\x22\x3e\x27登录成功\x27\x3c\/span\x3e,\n    });\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库中不存在该用户，模拟登录教务系统\x3c\/span\x3e\n  loginEducationSystem(name, \x3cspan class=\x22hljs-built_in\x22\x3epwd\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(err, result)\x3c\/span\x3e {\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n        code: \x3cspan class=\x22hljs-number\x22\x3e1001\x3c\/span\x3e,\n        message: \x3cspan class=\x22hljs-string\x22\x3e\x27模拟登录教务系统出现异常\x27\x3c\/span\x3e,\n      });\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 约定正确情况下，code 为 0\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.code !== \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n        code: \x3cspan class=\x22hljs-number\x22\x3e1002\x3c\/span\x3e,\n        message: \x3cspan class=\x22hljs-string\x22\x3e\x27模拟登录教务系统失败，可能是用户名或密码错误\x27\x3c\/span\x3e,\n      });\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模拟登录成功，将用户名密码存入数据库\x3c\/span\x3e\n    saveUserToDB(name, \x3cspan class=\x22hljs-built_in\x22\x3epwd\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(err, result)\x3c\/span\x3e {\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n          code: \x3cspan class=\x22hljs-number\x22\x3e1003\x3c\/span\x3e,\n          message: \x3cspan class=\x22hljs-string\x22\x3e\x27将用户名密码存入数据库出现异常\x27\x3c\/span\x3e,\n        });\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (result.code !== \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n          code: \x3cspan class=\x22hljs-number\x22\x3e1004\x3c\/span\x3e,\n          message: \x3cspan class=\x22hljs-string\x22\x3e\x27将用户名密码存入数据库出现异常\x27\x3c\/span\x3e,\n        });\n      }\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json({\n        code: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n        message: \x3cspan class=\x22hljs-string\x22\x3e\x27登录成功!\x27\x3c\/span\x3e,\n      });\n    });\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的代码可能存在的不优雅之处：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e随着业务逻辑变负责，回调层级会越来越深\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e代码耦合度比较高，不易修改\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e每一步操作都需要手动进行异常处理，比较麻烦\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e接下来再用 promise 实现此处的业务需求。使用 promise 编码之前，可以先思考两个问题。\x3c\/p\x3e\n\x3cp\x3e一是如何链式调用，二是如何中止链式调用。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3eHow to Use Promise Chain\x3c\/h2\x3e\n\x3cp\x3e业务中有三个需要异步处理的功能，所以会分别实例化三个 promise 对象，然后对 promise 进行链式调用。那么，如何进行链式调用？\x3c\/p\x3e\n\x3cp\x3e其实也很简单，直接在 promise 的 then 方法里面返回另一个 promise 即可。例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function start() {\n  return new Promise((resolve, reject) =\x3e {\n    resolve(\x27start\x27);\n  });\n}\n\nstart()\n  .then(data =\x3e {\n    \/\/ promise start\n    console.log(\x27result of start: \x27, data);\n    return Promise.resolve(1); \/\/ p1\n  })\n  .then(data =\x3e {\n    \/\/ promise p1\n    console.log(\x27result of p1: \x27, data);\n    return Promise.reject(2); \/\/ p2\n  })\n  .then(data =\x3e {\n    \/\/ promise p2\n    console.log(\x27result of p2: \x27, data);\n    return Promise.resolve(3); \/\/ p3\n  })\n  .catch(ex =\x3e {\n    \/\/ promise p3\n    console.log(\x27ex: \x27, ex);\n    return Promise.resolve(4); \/\/ p4\n  })\n  .then(data =\x3e {\n    \/\/ promise p4\n    console.log(\x27result of p4: \x27, data);\n  });\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3estart\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27start\x27\x3c\/span\x3e);\n  });\n}\n\nstart()\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise start\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of start: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p1\x3c\/span\x3e\n  })\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of p1: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p2\x3c\/span\x3e\n  })\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p2\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of p2: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p3\x3c\/span\x3e\n  })\n  .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p3\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ex: \x27\x3c\/span\x3e, ex);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p4\x3c\/span\x3e\n  })\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p4\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of p4: \x27\x3c\/span\x3e, data);\n  });\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的代码最终会输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22result of start:  start\nresult of p1:  1\nex:  2\nresult of p4:  4\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livecodeserver\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3eresult\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3estart\x3c\/span\x3e:  \x3cspan class=\x22hljs-built_in\x22\x3estart\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eresult\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e p1:  \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\nex:  \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3eresult\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e p4:  \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码的执行逻辑如图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000007598900?w=952\x26amp;h=1050\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000007598900?w=952\x26amp;h=1050\x22 alt=\x22promise chain\x22 title=\x22promise chain\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e从图中可以看出来，代码的执行逻辑是 \x3ccode\x3epromise start --\x26gt; promise p1 --\x26gt; promise p3 --\x26gt; promise p4\x3c\/code\x3e。所以结合输出结果和执行逻辑图，总结出以下几点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3epromise 的 then 方法里面可以继续返回一个新的 promise 对象\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e下一个 then 方法的参数是上一个 promise 对象的 resolve 参数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecatch 方法的参数是其之前某个 promise 对象的 rejecte 参数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一旦某个 then 方法里面的 promise 状态改变为了 rejected，则promise 方法连会跳过后面的 then 直接执行 catch\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ecatch 方法里面依旧可以返回一个新的 promise 对象\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3eHow to Break Promise Chain\x3c\/h2\x3e\n\x3cp\x3e接下来就该讨论如何中止 promise 方法链了。\x3c\/p\x3e\n\x3cp\x3e通过上面的例子，我们可以知道 promise 的状态改变为 rejected 后，promise 就会跳过后面的 then 方法。\x3c\/p\x3e\n\x3cp\x3e也就是，某个 then 里面发生异常后，就会跳过 then 方法，直接执行 catch。\x3c\/p\x3e\n\x3cp\x3e所以，当在构造的 promise 方法链中，如果在某个 then 后面，不需要再执行 then 方法了，就可以把它当作一个异常来处理，返回一个异常信息给 catch，其参数可自定义，比如该异常的参数信息为 \x3ccode\x3e{ notRealPromiseException: true}\x3c\/code\x3e，然后在 catch 里面判断一下 \x3ccode\x3enotRealPromiseException\x3c\/code\x3e 是否为 \x3ccode\x3etrue\x3c\/code\x3e，如果为 \x3ccode\x3etrue\x3c\/code\x3e，就说明不是程序出现异常，而是在正常逻辑里面中止 then 方法的执行。\x3c\/p\x3e\n\x3cp\x3e代码大概就这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22start()\n  .then(data =\x3e {\n    \/\/ promise start\n    console.log(\x27result of start: \x27, data);\n    return Promise.resolve(1); \/\/ p1\n    )\n  .then(data =\x3e {\n    \/\/ promise p1\n    console.log(\x27result of p1: \x27, data);\n    return Promise.reject({\n      notRealPromiseException: true,\n    }); \/\/ p2\n  })\n  .then(data =\x3e {\n    \/\/ promise p2\n    console.log(\x27result of p2: \x27, data);\n    return Promise.resolve(3); \/\/ p3\n  })\n  .catch(ex =\x3e {\n    console.log(\x27ex: \x27, ex);\n    if (ex.notRealPromiseException) {\n      \/\/ 一切正常，只是通过 catch 方法来中止 promise chain\n      \/\/ 也就是中止 promise p2 的执行\n      return true;\n    }\n    \/\/ 真正发生异常\n    return false;\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3estart()\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise start\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of start: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p1\x3c\/span\x3e\n    )\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of p1: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject({\n      \x3cspan class=\x22hljs-attr\x22\x3enotRealPromiseException\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    }); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p2\x3c\/span\x3e\n  })\n  .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ promise p2\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27result of p2: \x27\x3c\/span\x3e, data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ p3\x3c\/span\x3e\n  })\n  .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eex\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27ex: \x27\x3c\/span\x3e, ex);\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (ex.notRealPromiseException) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一切正常，只是通过 catch 方法来中止 promise chain\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 也就是中止 promise p2 的执行\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 真正发生异常\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  });\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样的做法可能不符合 \x3ccode\x3ecatch\x3c\/code\x3e 的语义。不过从某种意义上来说，promise 方法链没有继续执行，也可以算是一种“异常”。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3eRefactor Callback with Promise\x3c\/h2\x3e\n\x3cp\x3e讲了那么多道理，现在就改来使用 promise 重构之前用回调函数写的异步逻辑了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 据 name 查询用户信息\nconst findUserByName = (name, pwd) =\x3e {\n  return new Promise((resolve, reject) =\x3e {\n    \/\/ 数据库查询操作\n    if (dbError) {\n      \/\/ 数据库查询出错，将 promise 设置为 rejected\n      reject({\n        code: 1000,\n        message: \x27查询用户信息，数据库操作数出现异常\x27,\n      });\n    }\n    \/\/ 将查询结果赋给 userinfo 变量\n    if (userinfo.length === 0) {\n      \/\/ 数据库中不存在该用户\n      resolve();\n    }\n    \/\/ 数据库存在该用户，判断密码是否正确\n    if (pwd === userinfo[0].pwd) {\n      \/\/ 密码正确，中止 promise 执行\n      reject({\n        notRealPromiseException: true,\n        data: {\n          code: 0,\n          message: \x27密码正确，登录成功\x27,\n        }\n      });\n    }\n    \/\/ 密码不正确，登录失败，将 Promise 设置为 Rejected 状态\n    reject({\n      code: 1001,\n      message: \x27密码不正确，登录失败\x27,\n    });\n  });\n};\n\n\n\/\/ 模拟登录教务系统\nconst loginEducationSystem = (name, pwd) =\x3e {\n  \/\/ 登录逻辑...\n  \/\/ 登录成功\n  resolve();\n  \/\/ 登录失败\n  reject({\n    code: 1002,\n    message: \x27模拟登录教务系统失败\x27,\n  });\n};\n\n\n\/\/ 将用户名密码存入数据库\nconst saveUserToDB(name, pwd) =\x3e {\n  \/\/ 数据库存储操作\n  if (dbError) {\n    \/\/ 数据库存储出错，将 promise 设置为 rejected\n    reject({\n      code: 1004,\n      message: \x27数据库存储出错，将出现异常\x27,\n    });\n  }\n  \/\/ 数据库存储操作成功\n  resolve();\n};\n\n\nfindUserByName(name)\n.then(() =\x3e {\n  return loginEducationSystem(name, pwd);\n})\n.then(() =\x3e {\n  return saveUserToDB(name, pwd);\n})\n.catch(e =\x3e {\n  \/\/ 判断异常出现原因\n  if (e.notRealPromiseException) {\n    \/\/ 正常中止 promise 而故意设置的异常\n    return res.json(e.data);\n  }\n  \/\/ 出现错误或异常\n  return res.json(e);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 据 name 查询用户信息\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e findUserByName = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ename, pwd\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库查询操作\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dbError) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库查询出错，将 promise 设置为 rejected\x3c\/span\x3e\n      reject({\n        \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27查询用户信息，数据库操作数出现异常\x27\x3c\/span\x3e,\n      });\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将查询结果赋给 userinfo 变量\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (userinfo.length === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库中不存在该用户\x3c\/span\x3e\n      resolve();\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库存在该用户，判断密码是否正确\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (pwd === userinfo[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].pwd) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 密码正确，中止 promise 执行\x3c\/span\x3e\n      reject({\n        \x3cspan class=\x22hljs-attr\x22\x3enotRealPromiseException\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n          \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27密码正确，登录成功\x27\x3c\/span\x3e,\n        }\n      });\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 密码不正确，登录失败，将 Promise 设置为 Rejected 状态\x3c\/span\x3e\n    reject({\n      \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1001\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27密码不正确，登录失败\x27\x3c\/span\x3e,\n    });\n  });\n};\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模拟登录教务系统\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e loginEducationSystem = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ename, pwd\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录逻辑...\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录成功\x3c\/span\x3e\n  resolve();\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录失败\x3c\/span\x3e\n  reject({\n    \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1002\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27模拟登录教务系统失败\x27\x3c\/span\x3e,\n  });\n};\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 将用户名密码存入数据库\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e saveUserToDB(name, pwd) =\x26gt; {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库存储操作\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (dbError) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库存储出错，将 promise 设置为 rejected\x3c\/span\x3e\n    reject({\n      \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1004\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27数据库存储出错，将出现异常\x27\x3c\/span\x3e,\n    });\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库存储操作成功\x3c\/span\x3e\n  resolve();\n};\n\n\nfindUserByName(name)\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e loginEducationSystem(name, pwd);\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e saveUserToDB(name, pwd);\n})\n.catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断异常出现原因\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.notRealPromiseException) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 正常中止 promise 而故意设置的异常\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json(e.data);\n  }\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 出现错误或异常\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json(e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的代码中，实例化了三个 promise 对象，分别实现业务需求中的三个功能。然后通过 promise 方法链来调用。相比用回调函数而言，代码结构更加清晰，也更易读易懂耦合度更低更易扩展了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3ePromise.all \x26amp;\x26amp; Promise.race\x3c\/h2\x3e\n\x3cp\x3e仔细观察可以发现，在上面的 promise 代码中，\x3ccode\x3eloginEducationSystem\x3c\/code\x3e 和 \x3ccode\x3esaveUserToDB\x3c\/code\x3e 两个方法执行有先后顺序要求，但没有数据传递。\x3c\/p\x3e\n\x3cp\x3e其实 promise 方法链更好用的一点是，当下一个操作依赖于上一个操作的结果的时候，可以很方便地通过 then 方法的参数来传递数据。前面页提到过，下一个 then 方法的参数就是上一个 then 方法里面 \x3ccode\x3eresolve\x3c\/code\x3e 的参数，所以当然就可以把上一个 then 方法的执行结果作为参数传递给下一个 then 方法了。\x3c\/p\x3e\n\x3cp\x3e还有些时候，可能 then 方法的执行顺序也没有太多要求，只需要 promise 方法链中的两个或多个 promise 全部都执行正确。这时，如果依旧一个一个去写 then 可能就比较麻烦，比如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function p1() {\n  return new Promise((resolve) =\x3e {\n    console.log(1);\n    resolve();\n  });\n}\n\nfunction p2() {\n  return new Promise((resolve) =\x3e {\n    console.log(2);\n    resolve();\n  });\n}\n\nfunction p3() {\n  return new Promise((resolve) =\x3e {\n    console.log(3);\n    resolve();\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ep1\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n    resolve();\n  });\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ep2\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n    resolve();\n  });\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ep3\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e);\n    resolve();\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在只需要 \x3ccode\x3ep1\x3c\/code\x3e \x3ccode\x3ep2\x3c\/code\x3e  \x3ccode\x3ep3\x3c\/code\x3e 这三个 promise 都执行，并且 promise 最终状态都是 Fulfilled，那么如果还是使用方法链，这是这样调用：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22p1()\n.then(() =\x3e {\n  return p2();\n})\n.then(() =\x3e {\n  return p3();\n})\n.then(() =\x3e {\n  console.log(\x27all done\x27);\n})\n.catch(e =\x3e {\n  console.log(\x27e: \x27, e);\n});\n\n\/\/ 输出结果：\n\/\/ 1\n\/\/ 2\n\/\/ 3\n\/\/ all done\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3ep1()\n.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e p2();\n})\n.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e p3();\n})\n.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27all done\x27\x3c\/span\x3e);\n})\n.\x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(e =\x26gt; {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27e: \x27\x3c\/span\x3e, e);\n});\n\n\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e 输出结果：\n\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\/\/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\/\/ \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n\/\/ all done\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e代码貌似就不那么精炼了。这个时候就有了 \x3ccode\x3ePromise.all\x3c\/code\x3e 这个方法。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ePromise.all\x3c\/code\x3e 接收一个 promise对象的数组作为参数，当这个数组里的所有 promise 对象全部变为 resolve 或 reject 状态的时候，它才会去调用 \x3ccode\x3ethen\x3c\/code\x3e 方法。\x3c\/p\x3e\n\x3cp\x3e于是，调用这几个 promise 的代码就可以这样写了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22p1()\n.then(() =\x3e {\n  return Promise.all([\n    p2(),\n    p3(),\n  ]);\n})\n.then(() =\x3e {\n  console.log(\x27all done\x27);\n})\n.catch((e) =\x3e {\n  console.log(\x27e: \x27, e);\n});\n\n\/\/ 输出结果：\n\/\/ 1\n\/\/ 2\n\/\/ 3\n\/\/ all done\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3ep1()\n.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Promise.all([\n    p2(),\n    p3(),\n  ]);\n})\n.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27all done\x27\x3c\/span\x3e);\n})\n.\x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(e)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27e: \x27\x3c\/span\x3e, e);\n});\n\n\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e 输出结果：\n\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\/\/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n\/\/ \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n\/\/ all done\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样看起来貌似就精炼些了。\x3c\/p\x3e\n\x3cp\x3e而对于 \x3ccode\x3ePromise.race\x3c\/code\x3e，其参数也跟 \x3ccode\x3ePromise.all\x3c\/code\x3e 一样是一个数组。只是数组中的任何一个 promise 对象如果变为 resolve 或者reject 的话，该函数就会返回，并使用这个 promise 对象的值进行 resolve 或者 reject。\x3c\/p\x3e\n\x3cp\x3e这里就不举例了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3eConclusion\x3c\/h2\x3e\n\x3cp\x3e到目前为止，我们就基本了解了 Promise 的用法及特点，并实现用 Promise 重构用回调函数写的异步操作。现在对 Promise 的使用，应该驾轻就熟了。\x3c\/p\x3e\n\x3cp\x3e完。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3eGithub Issue: \x3ca href=\x22https:\/\/github.com\/nodejh\/nodejh.github.io\/issues\/23\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/nodejh\/nodejh.github.io\/issues\/23\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Promise 的链式调用与中止</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007598894">https://segmentfault.com/a/1190000007598894</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/z4ymvs0jz2h/" target="_blank">https://alili.tech/archive/z4ymvs0jz2h/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>