<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript 异常的防范与监控"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript 异常的防范与监控 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/hpvs2alnsol/",
				"appid": "1613049289050283", 
				"title": "JavaScript 异常的防范与监控 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-11T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/2xw87tktubt/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/srk0js3d93o/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&text=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&text=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&title=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&is_video=false&description=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&title=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&title=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&title=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhpvs2alnsol%2f&title=JavaScript%20%e5%bc%82%e5%b8%b8%e7%9a%84%e9%98%b2%e8%8c%83%e4%b8%8e%e7%9b%91%e6%8e%a7"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript 异常的防范与监控</h1><div class="meta"><div class="postdate"><time datetime="2019-01-11" itemprop="datePublished">2019-01-11</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e一套完善的前端体系应少不了异常统计与监控，即使有足够的质量保证体系，难免会出现一些意料之外的事，尤其是在复杂的网路环境和运行环境之下。为了保证代码的健壮性以及页面的稳定性，我们从多个方面来做异常的防范和监控。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e三种思路\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e主动防御\x3c\/h3\x3e\n\x3cp\x3e对于我们操作的数据，尤其是由 API 接口返回的，时常会有一个很复杂的深层嵌套的数据结构。为了代码的健壮性，很多时候需要对每一层访问都作空值判断，就像这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22props.user \x26amp;\x26amp;\nprops.user.posts \x26amp;\x26amp;\nprops.user.posts[0] \x26amp;\x26amp;\nprops.user.posts[0].comments \x26amp;\x26amp;\nprops.user.posts[0].comments[0]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eprops.user \x26amp;\x26amp;\nprops.user.posts \x26amp;\x26amp;\nprops.user.posts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] \x26amp;\x26amp;\nprops.user.posts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].comments \x26amp;\x26amp;\nprops.user.posts[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].comments[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e类似的代码大家可能都写过，没写过大概也见到别人写过。看起来确实相当地不美观，有句话说得很棒：\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eThe opposite of beautiful is not ugly, but wrong.\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e我们得找到一种，更简单、更优雅、更安全的方式来处理这种情形。参考这篇文章：\x3ca href=\x22https:\/\/medium.com\/javascript-inside\/safely-accessing-deeply-nested-values-in-javascript-99bf72a0855a\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eSafely Accessing Deeply Nested Values In JavaScript\x3c\/a\x3e，文章提到借助 Ramda、Lenses、Lodash 以及 Immutable.js 等类库的方式，并提供一个非常简洁明了的原生解决方案：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getIn(p, o) {\n    return p.reduce(function(xs, x) {\n        return (xs \x26amp;\x26amp; xs[x]) ? xs[x] : null;\n    }, o);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetIn\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ep, o\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e p.reduce(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3exs, x\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (xs \x26amp;\x26amp; xs[x]) ? xs[x] : \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n    }, o);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来我们这样访问就可以了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22getIn([\x27user\x27, \x27posts\x27, 0, \x27comments\x27], props)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3egetIn([\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27posts\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27comments\x27\x3c\/span\x3e], props)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果正常访问到，则返回对应的值，否则返回 \x3ccode\x3enull\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这里提供的只是主动防御的一种情形，关于如何编写更安全的代码这里不作深入展开。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e全局监控\x3c\/h3\x3e\n\x3cp\x3e浏览器提供 \x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/GlobalEventHandlers\/onerror\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ewindow.onerror\x3c\/code\x3e\x3c\/a\x3e API 来帮助我们进行全局的错误监控：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当 JavaScript 运行时错误（包括语法错误）发生时，会执行 \x3ccode\x3ewindow.onerror()\x3c\/code\x3e`\x3c\/li\x3e\n\x3cli\x3e当一项资源（如 \x3ccode\x3e\x26lt;img\x26gt;\x3c\/code\x3e 或 \x3ccode\x3e\x26lt;script\x26gt;\x3c\/code\x3e ）加载失败，能被单一的 \x3ccode\x3ewindow.addEventListener\x3c\/code\x3e 捕获\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * @param  {String} message 错误信息\n * @param  {String} source  发生错误的脚本URL\n * @param  {Number} lineno  发生错误的行号\n * @param  {Number} colno   发生错误的列号\n * @param  {Object} error   Error对象\n *\/\nwindow.onerror = function(message, source, lineno, colno, error) {\n  \/\/ ...\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * @param  {String} message 错误信息\n * @param  {String} source  发生错误的脚本URL\n * @param  {Number} lineno  发生错误的行号\n * @param  {Number} colno   发生错误的列号\n * @param  {Object} error   Error对象\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, source, lineno, colno, error\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中 error 对象包含详细的错误堆栈信息，在 IE9 以前，没有这个参数。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e针对性捕获 try..catch\x3c\/h3\x3e\n\x3cp\x3e可以通过 try..catch 来主动抓取错误，想要对一段代码 try..catch，我们可以这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22try {\n  \/\/ ...\n} catch (error) {\n  handler(error)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (error) {\n  handler(error)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对一个函数做 try..catch 封装:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function tryify(func) {\n  return function() {\n    try {\n      return func.apply(this, arguments)\n    } catch (error) {\n      handleError(error)\n\n      throw error\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etryify\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efunc\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e func.apply(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3earguments\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (error) {\n      handleError(error)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e为什么是 script error\x3c\/h2\x3e\n\x3cp\x3e方案已经明确，但还有一些问题。在查看 JavaScript 错误统计时，发现 80% 以上都是 \x22script error\x22。原来，当加载自不同域的脚本中发生语法错误时，为避免信息泄露，语法错误的细节将不会报告，而代之简单的 \x22Script error.\x22\x3c\/p\x3e\n\x3cp\x3e而在大多数情况下，我们的静态资源放在专门的 CDN 服务器上，跟站点并不在一个域，所以如果只是简单的抓取，只会得到一堆意义不大的 \x3ccode\x3escript error\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e解决方案：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e添加 CORS 支持\x3c\/li\x3e\n\x3cli\x3e使用 try..catch\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e添加 CORS 支持\x3c\/h3\x3e\n\x3cp\x3e需要做两点：\x3c\/p\x3e\n\x3cp\x3e1.在 script 便签添加 crossorigin，默认值 \x3ccode\x3ecrossorigin=\x22anonymous\x22\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript src=\x26quot;\/\/xxx.com\/example.js\x26quot; crossorigin\x3e\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/xxx.com\/example.js\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecrossorigin\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 require.js 里提供一个 \x3ca href=\x22https:\/\/github.com\/requirejs\/requirejs\/blob\/e97fe4dd894d8a07712156e17cefa28b954a9c3e\/require.js#L1946\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eonNodeCreated hook\x3c\/a\x3e，供我们提供扩展，要添加 crossorigin 属性，如下所示：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3e\n\/\/ 如果在 require.js 加载之前定义了 requirejs，require.js 会将其作为一个对象传入 requirejs.config\nvar requirejs = {\n  onNodeCreated: function(node, config, id, url) {\n    node.setAttribute(\x27crossorigin\x27, \x27anonymous\x27)\n  }\n}\n\x3c\/script\x3e\n\x3cscript src=\x26quot;\/\/xxx.com\/require.js\x26quot; charset=\x26quot;utf-8\x26quot;\x3e\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22actionscript\x22\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果在 require.js 加载之前定义了 requirejs，require.js 会将其作为一个对象传入 requirejs.config\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e requirejs = {\n  onNodeCreated: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(node, config, id, url)\x3c\/span\x3e \x3c\/span\x3e{\n    node.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27crossorigin\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27anonymous\x27\x3c\/span\x3e)\n  }\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/xxx.com\/require.js\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3echarset\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22utf-8\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 2.2.0 版本以上可用（很遗憾的是，目前的集成解决方案版本刚好低于这个版本）。\x3c\/p\x3e\n\x3cp\x3e2.同时在 CDN 服务器增加响应头 \x3ccode\x3eaccess-control-allow-orgin\x3c\/code\x3e，配置允许访问 CORS 的域，否则浏览器直接将禁止加载。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3etry..catch\x3c\/h3\x3e\n\x3cp\x3e这一点上面也有提到，算是一种比较通用，可定制强的方案。当然，在性能上也会有一些损耗。\x3c\/p\x3e\n\x3cp\x3e综合考虑，try..catch 通用性更好，但由于其在性能方面的一些损耗，CORS 优于 try..catch\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e一个监控小工具\x3c\/h2\x3e\n\x3cp\x3e随后，介绍一个 JavaScript stack trace 的小工具：\x3ca href=\x22https:\/\/github.com\/CurtisCBS\/monitor\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/CurtisCBS\/...\x3c\/a\x3e ，工具由 \x3ca href=\x22https:\/\/github.com\/CurtisCBS\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eCurtis\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/github.com\/mirreal\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3emirreal\x3c\/a\x3e 共同完成。\x3c\/p\x3e\n\x3cp\x3e主要是用于捕获页面 JavaScript 异常报错，捕获异常类型包含:\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eJavaScript runtime 异常捕捉 √\x3c\/li\x3e\n\x3cli\x3e静态资源 load faided 异常捕捉 √\x3c\/li\x3e\n\x3cli\x3econsole.error 的异常捕获 √\x3c\/li\x3e\n\x3cli\x3etry..catch 错误捕获 √\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e使用方式也很简单，但使用 script mode 引入文件后，调用 init 函数，进行初始化配置和监听\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript src=\x26quot;\/\/unpkg.com\/jstracker@latest\/dist\/jstracker.js\x26quot;\x3e\x3c\/script\x3e\n\n\x3cscript\x3e\n  jstracker.init({\n    delay: 1000,\n    maxError: 10,\n    sampling: 1,\n    report: function(errorLogs) {\n      console.table(errorLogs)\n    }\n  })\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/\/unpkg.com\/jstracker@latest\/dist\/jstracker.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n  jstracker.init({\n    \x3cspan class=\x22hljs-attr\x22\x3edelay\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emaxError\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3esampling\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ereport\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerrorLogs\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.table(errorLogs)\n    }\n  })\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果是使用 module mode，如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ npm install jstracker --save\nimport jstracker from \x27jstracker\x27\n\njstracker.init({\n  concat: false,\n  report: function(errorLogs) {\n    \/\/ console.log(\x27send\x27)\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ npm install jstracker --save\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e jstracker \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27jstracker\x27\x3c\/span\x3e\n\njstracker.init({\n  \x3cspan class=\x22hljs-attr\x22\x3econcat\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3ereport\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerrorLogs\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ console.log(\x27send\x27)\x3c\/span\x3e\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要使用 try..catch 捕获，jstracker 暴露出一个 \x3ccode\x3etryJS\x3c\/code\x3e 对象，可以处理 try..catch 包装，就像这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import jstracker from \x27jstracker\x27;\n\nthis.handleSelect = jstracker.tryJS.wrap(this.handleSelect);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e jstracker \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27jstracker\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleSelect = jstracker.tryJS.wrap(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.handleSelect);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e所有错误信息统一由 report 函数处理，可以在此之上做数据处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ ubt.js\nimport jstracker from \x27jstracker\x27;\nimport utility from \x27utility\x27;\n\njstracker.init({\n    concat: false,\n    report: function(errorLogs) {\n        const errorLog = errorLogs[0];\n        errorLog.ua = window.navigator.userAgent;\n        ubtTracker.send(errorLog);\n    }\n});\n\nconst ubtTracker = {\n    key: {\n        UBT_JS_TRACKER: \x27xxxx-xxxx-xxxx\x27\n    },\n\n    send(data) {\n        const value = utility.deserializeUrl(data);\n        \n        xxxx.send([\x27trace\x27, this.key.UBT_JS_TRACKER, value]);\n    }\n};\n\nfunction wrapContext(ctx) {\n    for (const func in ctx) {\n        ctx[func] = jstracker.tryJS.wrap(ctx[func]);\n    }\n}\n\nexport {\n    wrapContext,\n    ubtTracker,\n    jstracker\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ ubt.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e jstracker \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27jstracker\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e utility \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27utility\x27\x3c\/span\x3e;\n\njstracker.init({\n    \x3cspan class=\x22hljs-attr\x22\x3econcat\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ereport\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerrorLogs\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e errorLog = errorLogs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e];\n        errorLog.ua = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.navigator.userAgent;\n        ubtTracker.send(errorLog);\n    }\n});\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ubtTracker = {\n    \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eUBT_JS_TRACKER\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27xxxx-xxxx-xxxx\x27\x3c\/span\x3e\n    },\n\n    send(data) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e value = utility.deserializeUrl(data);\n        \n        xxxx.send([\x3cspan class=\x22hljs-string\x22\x3e\x27trace\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.key.UBT_JS_TRACKER, value]);\n    }\n};\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewrapContext\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ectx\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e func \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e ctx) {\n        ctx[func] = jstracker.tryJS.wrap(ctx[func]);\n    }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e {\n    wrapContext,\n    ubtTracker,\n    jstracker\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e概述\x3c\/h2\x3e\n\x3cp\x3e作为开发者以及项目维护者的身份，我们应当编写更安全健壮的代码。但由于环境的多样性，无论再完善的测试，code review 都难免都所疏漏，我们需要一套监控系统来完善整个前端体系。\x3c\/p\x3e\n\x3cp\x3e在监控的时候，出于同源安全策略无法拿到准确的错误信息，在此，有两种解决方案：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e增加 CORS 支持\x3c\/li\x3e\n\x3cli\x3e使用 try..catch 进行异常捕获\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e最后，我们对整个监控工作封装了一个基础的核心，可以监控 JavaScript Runtime 异常，资源加载异常，以及 try..catch 捕获异常等，并给出一个实际工作中的示例。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript 异常的防范与监控</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009875977">https://segmentfault.com/a/1190000009875977</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/hpvs2alnsol/" target="_blank">https://alili.tech/archive/hpvs2alnsol/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>