<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="dva源码解析（一）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>dva源码解析（一） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/cj2admd85n5/",
				"appid": "1613049289050283", 
				"title": "dva源码解析（一） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-12T02:30:24"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/adrdwat2hcg/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/k10d0an1g0d/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&text=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&text=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&title=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&is_video=false&description=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&title=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&title=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&title=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fcj2admd85n5%2f&title=dva%e6%ba%90%e7%a0%81%e8%a7%a3%e6%9e%90%ef%bc%88%e4%b8%80%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">dva源码解析（一）</h1><div class="meta"><div class="postdate"><time datetime="2019-01-12" itemprop="datePublished">2019-01-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e写在前面\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3edva\x3c\/code\x3e是蚂蚁金服推出的一个单页应用框架，对\x3ccode\x3eredux\x3c\/code\x3e，\x3ccode\x3ereact-router\x3c\/code\x3e，\x3ccode\x3eredux-saga\x3c\/code\x3e进行了上层封装，没有引入新的概念，但是极大的程度上提升了开发效率；下面内容为本人理解，如有错误，还请指出，不胜感激。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eredux的痛苦\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eredux\x3c\/code\x3e的优点很多，痛点也有，比如异步控制，\x3ccode\x3eredux-saga\x3c\/code\x3e的出现使得异步操作变得优雅，但是基于\x3ccode\x3eredux-saga\x3c\/code\x3e不得不承认的一点就是开发过程实在是太麻烦了，假若增加一个操作，不得不操作\x3ccode\x3eactions\x3c\/code\x3e，\x3ccode\x3ereducers\x3c\/code\x3e，\x3ccode\x3esagas\x3c\/code\x3e，对于\x3ccode\x3esagas\x3c\/code\x3e可以还需要进行\x3ccode\x3ewatch\x3c\/code\x3e，而后还要进行\x3ccode\x3efork\x3c\/code\x3e；（PS: 本来就够麻烦了，再加上一个\x3ccode\x3esagas\x3c\/code\x3e）；在添加一个操作时，不得不操作这么多的文件，实在是麻烦，而\x3ccode\x3edva\x3c\/code\x3e的出现在一定程度上解决了这个问题。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3edva基本概念\x3c\/h2\x3e\n\x3cp\x3e未使用\x3ccode\x3edva\x3c\/code\x3e下的目录经常是这样的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22actions\n   --\/ user.js\n   --\/ team.js\nreducers\n   --\/ user.js\n   --\/ team.js\nsagas\/\n   --\/ user.js\n   --\/ team.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haml\x22\x3e\x3ccode\x3eactions\n   -\x3cspan class=\x22ruby\x22\x3e-\x3cspan class=\x22hljs-regexp\x22\x3e\/ user.js\n\x3c\/span\x3e\x3c\/span\x3e   -\x3cspan class=\x22ruby\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e-\/\x3c\/span\x3e team.js\n\x3c\/span\x3ereducers\n   -\x3cspan class=\x22ruby\x22\x3e-\x3cspan class=\x22hljs-regexp\x22\x3e\/ user.js\n\x3c\/span\x3e\x3c\/span\x3e   -\x3cspan class=\x22ruby\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e-\/\x3c\/span\x3e team.js\n\x3c\/span\x3esagas\/\n   -\x3cspan class=\x22ruby\x22\x3e-\x3cspan class=\x22hljs-regexp\x22\x3e\/ user.js\n\x3c\/span\x3e\x3c\/span\x3e   -\x3cspan class=\x22ruby\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e-\/\x3c\/span\x3e team.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3edva\x3c\/code\x3e将其合并：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22models\n   --\/ user.js\n   --\/ team.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haml\x22\x3e\x3ccode\x3emodels\n   -\x3cspan class=\x22ruby\x22\x3e-\x3cspan class=\x22hljs-regexp\x22\x3e\/ user.js\n\x3c\/span\x3e\x3c\/span\x3e   -\x3cspan class=\x22ruby\x22\x3e\x3cspan class=\x22hljs-regexp\x22\x3e-\/\x3c\/span\x3e team.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3edva\x3c\/code\x3e中有着几个概念：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22namespace       =\x3e  combineReducers中对应的key值\nstate           =\x3e  对应初始的state,也就是initialState\neffects         =\x3e  saga的处理函数\nreducers        =\x3e  对应reducers,不同的是,写法上将switch...case转化为对象  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3enamespace       =\x26gt;  combineReducers中对应的key值\n\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e           =\x26gt;  对应初始的\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e,也就是initialState\neffects         =\x26gt;  saga的处理函数\nreducers        =\x26gt;  对应reducers,不同的是,写法上将switch...case转化为对象  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e除了这些以外，\x3ccode\x3edva\x3c\/code\x3e中还有\x3ccode\x3esubscriptions\x3c\/code\x3e，这一概念来源于\x3ccode\x3eelm\x3c\/code\x3e，\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3edva的实现\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e初始化\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const app = dva({\n    history: browserHistory\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3econst app\x3c\/span\x3e = dva({\n    history: browserHistory\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的过程发生了什么？\x3cbr\x3e\x3ccode\x3edva\x3c\/code\x3e本质上调用了下面函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function dva(hooks = {}) {\n    const history = hooks.history || defaultHistory;\n    const initialState = hooks.initialState || {};\n    delete hooks.history;\n    delete hooks.initialState;\n\n    const plugin = new Plugin();\n    plugin.use(hooks);\n\n    const app = {\n      \/\/ properties\n      _models: [],\n      _router: null,\n      _store: null,\n      _history: null,\n      _plugin: plugin,\n      _getProvider: null,\n      \/\/ methods\n      use,\n      model,\n      router,\n      start,\n    };\n    return app;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edva\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(hooks = {})\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e history = hooks.history || defaultHistory;\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e initialState = hooks.initialState || {};\n    \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e hooks.history;\n    \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e hooks.initialState;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e plugin = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Plugin();\n    plugin.use(hooks);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ properties\x3c\/span\x3e\n      _models: [],\n      _router: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n      _store: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n      _history: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n      _plugin: plugin,\n      _getProvider: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ methods\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e,\n      model,\n      router,\n      start,\n    };\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e app;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ehooks\x3c\/code\x3e为传入的一些配置，例如可以通过传入\x3ccode\x3ehistory\x3c\/code\x3e来改变路由的实现，\x3ccode\x3edva\x3c\/code\x3e默认采用的是\x3ccode\x3ehashHistory\x3c\/code\x3e；从这里可以看出\x3ccode\x3edva\x3c\/code\x3e暴露出来的方法：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eapp.router()\x3c\/code\x3e：指定路由，需要传入一个函数，一般类似于\x3ccode\x3e({ history }) =\x26gt; (\x26lt;Router\x26gt;...\x26lt;\/Router\x26gt;)\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eapp.use()\x3c\/code\x3e：添加插件，这个稍后来看~\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3eapp.model()\x3c\/code\x3e：添加\x3ccode\x3emodel\x3c\/code\x3e，也就是对应的添加一个\x3ccode\x3estore\x3c\/code\x3e下的数据，该方法做的就是对传入的\x3ccode\x3emodel\x3c\/code\x3e进行检查，对\x3ccode\x3ereducers\x3c\/code\x3e添加命名空间，而后将其\x3ccode\x3epush\x3c\/code\x3e到\x3ccode\x3e_models\x3c\/code\x3e中。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3enamespace\x3c\/code\x3e必须且唯一，因为内置了\x3ccode\x3ereact-redux-router\x3c\/code\x3e，所以\x3ccode\x3enamespace\x3c\/code\x3e也不能为\x3ccode\x3erouting\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esubscriptions\x3c\/code\x3e与\x3ccode\x3eeffects\x3c\/code\x3e均为可选参数，传入的话必须为对象\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ereducers\x3c\/code\x3e为可选，支持对象和数组两种传入方式（传入数组的方式，往往伴随着高阶\x3ccode\x3ereducer\x3c\/code\x3e的应用，具体稍后再看~）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eapp.start()\x3c\/code\x3e：初始化应用，接受参数为选择器或者\x3ccode\x3eDOM\x3c\/code\x3e节点\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e需要注意的是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e\x3ccode\x3ereducers\x3c\/code\x3e和\x3ccode\x3eeffects\x3c\/code\x3e的\x3ccode\x3ekey\x3c\/code\x3e不需要用\x3ccode\x3enamespace\/action\x3c\/code\x3e的形式了，因为\x3ccode\x3edva\x3c\/code\x3e会自动将其加上，\x3ccode\x3edispatch\x3c\/code\x3e的时候，\x3ccode\x3esaga\x3c\/code\x3e需要加上\x3ccode\x3enamespace\x3c\/code\x3e，而\x3ccode\x3esaga\x3c\/code\x3e中的\x3ccode\x3eput\x3c\/code\x3e不需要加入\x3ccode\x3enamespace\x3c\/code\x3e，原因是\x3ccode\x3edva\x3c\/code\x3e对\x3ccode\x3eput进行了重载\x3c\/code\x3e\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3e\x3ccode\x3edva\x3c\/code\x3e同时支持rn应用，引入\x3ccode\x3edva\/mobile\x3c\/code\x3e即可，这时\x3ccode\x3ereact-router\x3c\/code\x3e不在需要，利用rn中的\x3ccode\x3eNavigator\x3c\/code\x3e即可，不会引用\x3ccode\x3ereact-router\x3c\/code\x3e与\x3ccode\x3ereact-redux-router\x3c\/code\x3e，\x3ccode\x3enamespace\x3c\/code\x3e可以命名为\x3ccode\x3erouting\x3c\/code\x3e；正是由于这点差异，作者将路由相关的内容作为参数传入了进去，具体可以参见这个文件。\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e创建\x3c\/h3\x3e\n\x3cp\x3e将一些配置项初始化好后，就可以\x3ccode\x3eapp.start\x3c\/code\x3e就是来创建一个应用，下面就一点点的看看\x3ccode\x3estart\x3c\/code\x3e的过程（以下基于默认情况，也就是使用了\x3ccode\x3ereact-router\x3c\/code\x3e)：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e参数校验，是否为\x3ccode\x3eDOM\x3c\/code\x3e元素或者检查是否可以根据传入的选择器字符串找到对应的\x3ccode\x3eDOM\x3c\/code\x3e，这个\x3ccode\x3eDOM\x3c\/code\x3e对应的就是\x3ccode\x3eReactDOM.render\x3c\/code\x3e的第二个参数。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e错误处理，使得发生错误时，不至于应用奔溃，当然需要传入自定义\x3ccode\x3ehooks.onError\x3c\/code\x3e来处理：\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ 传入hooks.onError则调用，反之调用默认函数处理，抛出异常即可\n  const onError = plugin.apply(\x27onError\x27, (err) =\x3e {\n    throw new Error(err.stack || err);\n  });\n  \/\/ 目的是出现错误时，也可以进行dispatch操作\n  const onErrorWrapper = (err) =\x3e {\n    if (err) {\n      if (typeof err === \x27string\x27) err = new Error(err);\n      onError(err, app._store.dispatch);\n    }\n  };\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stata\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 传入hooks.onError则调用，反之调用默认函数处理，抛出异常即可\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e onError = \x3cspan class=\x22hljs-keyword\x22\x3eplugin\x3c\/span\x3e.apply(\x27onError\x27, (\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e) =\x26gt; {\n    throw new \x3cspan class=\x22hljs-keyword\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3estack\x3c\/span\x3e || \x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e);\n  });\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 目的是出现错误时，也可以进行dispatch操作\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e onErrorWrapper = (\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e === \x27string\x27) \x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e = new \x3cspan class=\x22hljs-keyword\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e);\n      onError(\x3cspan class=\x22hljs-keyword\x22\x3eerr\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eapp\x3c\/span\x3e._store.dispatch);\n    }\n  };\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e遍历\x3ccode\x3e_models\x3c\/code\x3e，初始化\x3ccode\x3ereducers,sagas\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const sagas = [];\n\/\/ initalReducer为{ routing: routerReducer }\nconst reducers = { ...initialReducer };  \/\/ 为rootReducer\nfor (const m of this._models) {\n    \/\/ 得到默认的state\n    reducers[m.namespace] = getReducer(m.reducers, m.state);\n    if (m.effects) sagas.push(getSaga(m.effects, m, onErrorWrapper));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3econst sagas = [];\n\/\/ initalReducer为{ routing: routerReducer }\nconst reducers = { ...initialReducer };  \/\/ 为rootReducer\n\x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (const m of this._models) {\n    \/\/ 得到默认的\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e\n    reducers[m.namespace] = getReducer(m.reducers, m.\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e);\n    if (m.effects) sagas.push(getSaga(m.effects, m, \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3eErrorWrapper));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e处理reducers\x3c\/h3\x3e\n\x3cp\x3e对于\x3ccode\x3eredux\x3c\/code\x3e的\x3ccode\x3ereducers\x3c\/code\x3e最常见的是基于\x3ccode\x3eswitch..case\x3c\/code\x3e的，而\x3ccode\x3edva\x3c\/code\x3e做出了一些改变，将每一个\x3ccode\x3ecase\x3c\/code\x3e分支变作了一个函数：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVOFye?w=772\x26amp;h=147\x22 src=\x22https:\/\/static.alili.tech\/img\/bVOFye?w=772\x26amp;h=147\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e（PS: 本人认为，这个可以块可以更改，利用\x3ccode\x3esome\x3c\/code\x3e操作来尽可能少的调用无意义的\x3ccode\x3ereducer\x3c\/code\x3e，于是我提了一个pr）\x3c\/p\x3e\n\x3cp\x3e每一个\x3ccode\x3ereducer\x3c\/code\x3e的实现如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ actionType对应的是dva的reducers中的key值\n(state, action) =\x3e {\n    const { type } = action;\n    if (type \x26amp;\x26amp; actionType !== type) {\n        return state;\n    }\n    return reducer(state, action);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pf\x22\x3e\x3ccode\x3e\/\/ actionType对应的是dva的reducers中的key值\n(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e, action) =\x26gt; {\n    const { type } = action;\n    if (type \x26amp;\x26amp; actionType !== type) {\n        return \x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e;\n    }\n    return reducer(\x3cspan class=\x22hljs-keyword\x22\x3estate\x3c\/span\x3e, action);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e处理sagas\x3c\/h3\x3e\n\x3cp\x3e看完了对于\x3ccode\x3ereducers\x3c\/code\x3e的处理，下面来看一下对于\x3ccode\x3esagas\x3c\/code\x3e的处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getSaga(effects, model, onError) {\n  return function *() {\n    for (const key in effects) {\n      if (Object.prototype.hasOwnProperty.call(effects, key)) {\n        const watcher = getWatcher(key, effects[key], model, onError);\n        const task = yield sagaEffects.fork(watcher);\n        \/\/ 为了移除时可以将saga任务注销\n        yield sagaEffects.fork(function *() {\n          yield sagaEffects.take(`${model.namespace}\/@@CANCEL_EFFECTS`);\n          yield sagaEffects.cancel(task);\n        });\n      }\n    }\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetSaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eeffects, model, onError\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e *(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e effects) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.prototype.hasOwnProperty.call(effects, key)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e watcher = getWatcher(key, effects[key], model, onError);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e task = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e sagaEffects.fork(watcher);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为了移除时可以将saga任务注销\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e sagaEffects.fork(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e *(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e sagaEffects.take(\x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${model.namespace}\x3c\/span\x3e\/@@CANCEL_EFFECTS`\x3c\/span\x3e);\n          \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e sagaEffects.cancel(task);\n        });\n      }\n    }\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3egetWatcher\x3c\/code\x3e返回一个\x3ccode\x3esaga\x3c\/code\x3e监听函数，也就是通常写的\x3ccode\x3ewatchXXX\x3c\/code\x3e，\x3ccode\x3emodel.effects[key]\x3c\/code\x3e可以是一个任务函数；也可以是个数组，第一个参数为任务函数，第二为配置对象，可以传入\x3ccode\x3etype\x3c\/code\x3e，\x3ccode\x3etype\x3c\/code\x3e有4个可选值，\x3ccode\x3etakeEvery\x3c\/code\x3e（默认），\x3ccode\x3etakeLatest\x3c\/code\x3e，\x3ccode\x3ethrottle\x3c\/code\x3e，\x3ccode\x3ewatcher\x3c\/code\x3e四种，\x3ccode\x3edva\x3c\/code\x3e对\x3ccode\x3eeffects\x3c\/code\x3e做了一个错误处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22effect =\x3e function *(...args) {\n  try {\n    yield effect(...args.concat(createEffects(model)));\n  } catch (e) {\n    onError(e);   \/\/ 为之前的onErrorWrapper\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3eeffect =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e *\x3cspan class=\x22hljs-params\x22\x3e(...args)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e effect(...args.concat(createEffects(model)));\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n    onError(e);   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 为之前的onErrorWrapper\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ewatcher\x3c\/code\x3e是指传入的任务函数就是一个\x3ccode\x3ewatcher\x3c\/code\x3e直接\x3ccode\x3efork\x3c\/code\x3e就好\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ethrottle\x3c\/code\x3e还要传入一个\x3ccode\x3ems\x3c\/code\x3e配置，这个\x3ccode\x3ems\x3c\/code\x3e代表着在多少毫秒内只触发一次同一类型\x3ccode\x3esaga\x3c\/code\x3e任务，而\x3ccode\x3etakeEvery\x3c\/code\x3e是不会限制同一类型执行次数，\x3ccode\x3etakeLatest\x3c\/code\x3e只能执行一个同一类型任务，有执行中的再次执行就会取消\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e由\x3ccode\x3egetSaga\x3c\/code\x3e可以看出，\x3ccode\x3e${namespace}\/@@CANCEL_EFFECTS\x3c\/code\x3e可以取消对应的任务监听\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e可以通过配置\x3ccode\x3ehooks.onEffect\x3c\/code\x3e来增加\x3ccode\x3esaga\x3c\/code\x3e的\x3ccode\x3ewatcher\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e增强\x3ccode\x3eredux\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eredux\x3c\/code\x3e中间件，由\x3ccode\x3esagaMiddware\x3c\/code\x3e，\x3ccode\x3erouterMiddware\x3c\/code\x3e（启用\x3ccode\x3ereact-router\x3c\/code\x3e时），\x3ccode\x3ehooks.onAction\x3c\/code\x3e传入的其它中间件，如\x3ccode\x3eredux-logger\x3c\/code\x3e等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e其它增强，如\x3ccode\x3eredux-devtools\x3c\/code\x3e，内置了\x3ccode\x3eredux-devtools\x3c\/code\x3e，另需的话在\x3ccode\x3ehooks.extraReducers\x3c\/code\x3e传入\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  const enhancers = [\n    applyMiddleware(...middlewares),\n    devtools(),\n    ...extraEnhancers,\n  ];\n  const store = this._store = createStore(  \/\/ eslint-disable-line\n    createReducer(),\n    initialState,\n    compose(...enhancers),\n  );\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e enhancers = [\n    applyMiddleware(...middlewares),\n    devtools(),\n    ...extraEnhancers,\n  ];\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e store = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._store = createStore(  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ eslint-disable-line\x3c\/span\x3e\n    createReducer(),\n    initialState,\n    compose(...enhancers),\n  );\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e设置redux的回调函数\x3c\/h3\x3e\n\x3cp\x3e通过配置\x3ccode\x3ehooks.onStateChange\x3c\/code\x3e可以指定\x3ccode\x3eredux\x3c\/code\x3e的\x3ccode\x3estate\x3c\/code\x3e改变后所触发的回调函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const listeners = plugin.get(\x27onStateChange\x27);\n  for (const listener of listeners) {\n    store.subscribe(() =\x3e {\n      listener(store.getState());\n    });\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e listeners = plugin.get(\x3cspan class=\x22hljs-string\x22\x3e\x27onStateChange\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e listener \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e listeners) {\n    store.subscribe(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      listener(store.getState());\n    });\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e新概念subscriptions\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3esubscriptions\x3c\/code\x3e是一个新概念，会在\x3ccode\x3edom ready\x3c\/code\x3e之后执行，在这里面可以做一些基础数据的获取：\x3cbr\x3e一般会将初始数据的获取放在\x3ccode\x3ereact\x3c\/code\x3e的生命周期中，比如\x3ccode\x3ecomponentWillMount\x3c\/code\x3e，但是假设我们做了代码分割，实现了按需加载，那么我们开始获取数据的时间为：获取相应的\x3ccode\x3ejs\x3c\/code\x3e\x2b解析\x3ccode\x3ejs\x3c\/code\x3e\x2b执行\x3ccode\x3ereact\x3c\/code\x3e生命周期，但是\x3ccode\x3eredux\x3c\/code\x3e的数据加载和\x3ccode\x3eui\x3c\/code\x3e组件没有太大关系，可以将数据获取的时间点提前，\x3ccode\x3esubscriptions\x3c\/code\x3e提供了解决方法，其意义为订阅，对于上面的场景，我们可以订阅路由，到了执行的路由执行相应的\x3ccode\x3edispatch()\x3c\/code\x3e，如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22setup({ dispatch, history }) {\n  return history.listen(({ pathname, query }) =\x3e {\n    if (pathname === \x27\/users\x27) {\n      dispatch({ type: \x27fetch\x27, payload: query });\n    }\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xquery\x22\x3e\x3ccode\x3esetup({ dispatch, history }) {\n  return history.listen(({ pathname, query }) =\x26gt; {\n    if (pathname === \x3cspan class=\x22hljs-string\x22\x3e\x27\/users\x27\x3c\/span\x3e) {\n      dispatch({ type: \x3cspan class=\x22hljs-string\x22\x3e\x27fetch\x27\x3c\/span\x3e, payload: query });\n    }\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e（PS: 对于这个新概念，我也不是很清楚，后面的文章会有专门的描述，大家先有一个概念就好）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e挂载\x3c\/h3\x3e\n\x3cp\x3e上述过程均为初始化的过程，就是获取到需要的\x3ccode\x3ereducers\x3c\/code\x3e，\x3ccode\x3esagas\x3c\/code\x3e以及对于一些中间件和插件的配置，下面要进行的就是挂载了，也就熟悉的\x3ccode\x3erender(\x26lt;Provider\x26gt;, container)\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e动态处理model\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3edva.model\x3c\/code\x3e与\x3ccode\x3edva.unmodel\x3c\/code\x3e，封装了在运行时的\x3ccode\x3estore\x3c\/code\x3e进行一类增加和删除的操作，例如可以再切换到某一路由时动态的加入一个\x3ccode\x3emodel\x3c\/code\x3e(个人猜测，热更新很有可能也利用了这个两个\x3ccode\x3eapi\x3c\/code\x3e与\x3ccode\x3ehooks.onHmr\x3c\/code\x3e)。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader13\x22\x3e未完结\x3c\/h2\x3e\n\x3cp\x3e关于\x3ccode\x3eredux\x3c\/code\x3e还有一个利器，那就是高阶\x3ccode\x3ereduce\x3c\/code\x3e，当然在\x3ccode\x3edva\x3c\/code\x3e中也有体现，这篇文章已经很长了，这些内容留在下一篇中介绍。以上是本人对于\x3ccode\x3edva\x3c\/code\x3e的粗略的理解，内容如有错误，还请大家指出。\x3ccode\x3edva\x3c\/code\x3e的确简化了开发的流程，而且在蚂蚁金服的很多业务线也有着应用，是一个很值得大家一试！\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>dva源码解析（一）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009800398">https://segmentfault.com/a/1190000009800398</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/cj2admd85n5/" target="_blank">https://alili.tech/archive/cj2admd85n5/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>