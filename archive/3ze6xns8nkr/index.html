<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="编译器简介： 在 Siri 前时代如何与计算机对话"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>编译器简介： 在 Siri 前时代如何与计算机对话 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/3ze6xns8nkr/",
				"appid": "1613049289050283", 
				"title": "编译器简介： 在 Siri 前时代如何与计算机对话 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-22T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/npnty89ra3j/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/xu4fhzlw7af/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&text=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&text=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&title=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&is_video=false&description=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&title=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&title=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&title=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f3ze6xns8nkr%2f&title=%e7%bc%96%e8%af%91%e5%99%a8%e7%ae%80%e4%bb%8b%ef%bc%9a%20%e5%9c%a8%20Siri%20%e5%89%8d%e6%97%b6%e4%bb%a3%e5%a6%82%e4%bd%95%e4%b8%8e%e8%ae%a1%e7%ae%97%e6%9c%ba%e5%af%b9%e8%af%9d"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">编译器简介： 在 Siri 前时代如何与计算机对话</h1><div class="meta"><div class="postdate"><time datetime="2019-01-22" itemprop="datePublished">2019-01-22</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#编译器简介-在-siri-前时代如何与计算机对话\x22\x3e\x3c\/a\x3e编译器简介： 在 Siri 前时代如何与计算机对话\x3c\/h1\x3e\n\x3cp\x3e简单说来，一个编译器compiler不过是一个可以翻译其他程序的程序。传统的编译器可以把源代码翻译成你的计算机能够理解的可执行机器代码。（一些编译器将源代码翻译成别的程序语言，这样的编译器称为源到源翻译器或转化器transpilers。）\x3ca href=\x22http:\/\/llvm.org\/\x22\x3eLLVM\x3c\/a\x3e 是一个广泛使用的编译器项目，包含许多模块化的编译工具。\x3c\/p\x3e\n\x3cp\x3e传统的编译器设计包含三个部分：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/e9e8707ccfa75c722ca2b73c71f25414be67d2ea\/68747470733a2f2f6e69636f6c656f7263686172642e636f6d2f696d672f626c6f672f636f6d70696c6572732f636f6d70696c6572312e6a7067\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01ff8f0c70040ba300.jpg\x22 alt=\x22\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e前端Frontend将源代码翻译为中间表示intermediate representation (IR)* 。\x3ca href=\x22http:\/\/clang.llvm.org\/\x22\x3eclang\x3c\/a\x3e 是 LLVM 中用于 C 家族语言的前端工具。\x3c\/li\x3e\n\x3cli\x3e优化器Optimizer分析 IR 然后将其转化为更高效的形式。\x3ca href=\x22http:\/\/llvm.org\/docs\/CommandGuide\/opt.html\x22\x3eopt\x3c\/a\x3e 是 LLVM 的优化工具。\x3c\/li\x3e\n\x3cli\x3e后端Backend通过将 IR 映射到目标硬件指令集从而生成机器代码。\x3ca href=\x22http:\/\/llvm.org\/docs\/CommandGuide\/llc.html\x22\x3ellc\x3c\/a\x3e 是 LLVM 的后端工具。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e注：LLVM 的 IR 是一种和汇编类似的低级语言。然而，它抽离了特定硬件信息。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#hello-compiler\x22\x3e\x3c\/a\x3eHello, Compiler\x3c\/h3\x3e\n\x3cp\x3e下面是一个打印 “Hello, Compiler!” 到标准输出的简单 C 程序。C 语法是人类可读的，但是计算机却不能理解，不知道该程序要干什么。我将通过三个编译阶段使该程序变成机器可执行的程序。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs cpp\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ compile_me.c\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Wave to the compiler. The world can wait.\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;stdio.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3eprintf\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, Compiler!\\n\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#前端\x22\x3e\x3c\/a\x3e前端\x3c\/h4\x3e\n\x3cp\x3e正如我在上面所提到的，\x3ccode\x3eclang\x3c\/code\x3e 是 LLVM 中用于 C 家族语言的前端工具。Clang 包含 C 预处理器C preprocessor、词法分析器lexer、语法解析器parser、语义分析器semantic analyzer和 IR 生成器IR generator。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eC 预处理器\x3c\/strong\x3e在将源程序翻译成 IR 前修改源程序。预处理器处理外部包含文件，比如上面的 \x3ccode\x3e#include \x26lt;stdio.h\x26gt;\x3c\/code\x3e。 它将会把这一行替换为 \x3ccode\x3estdio.h\x3c\/code\x3e C 标准库文件的完整内容，其中包含 \x3ccode\x3eprintf\x3c\/code\x3e 函数的声明。\x3c\/p\x3e\n\x3cp\x3e通过运行下面的命令来查看预处理步骤的输出：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3eclang -E compile_me\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e -o preprocessed\x3cspan class=\x22hljs-selector-class\x22\x3e.i\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3cstrong\x3e词法分析器\x3c\/strong\x3e（或扫描器scanner或分词器tokenizer）将一串字符转化为一串单词。每一个单词或记号token，被归并到五种语法类别之一：标点符号、关键字、标识符、文字或注释。\x3c\/p\x3e\n\x3cp\x3ecompile_me.c 的分词过程：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/ea8c0cef3eeea3c9c058f87bb2949684dd7408df\/68747470733a2f2f6e69636f6c656f7263686172642e636f6d2f696d672f626c6f672f636f6d70696c6572732f6c657865722e6a7067\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01c2fb0f4137f11e6b.jpg\x22 alt=\x22\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e语法分析器\x3c\/strong\x3e确定源程序中的单词流是否组成了合法的句子。在分析记号流的语法后，它会输出一个抽象语法树abstract syntax tree（AST）。Clang 的 AST 中的节点表示声明、语句和类型。\x3c\/p\x3e\n\x3cp\x3ecompile_me.c 的语法树：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/609046c6a698383910b23ceafae5bf2e71328c95\/68747470733a2f2f6e69636f6c656f7263686172642e636f6d2f696d672f626c6f672f636f6d70696c6572732f747265652e6a7067\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t015ff11b1628d4933b.jpg\x22 alt=\x22\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e语义分析器\x3c\/strong\x3e会遍历抽象语法树，从而确定代码语句是否有正确意义。这个阶段会检查类型错误。如果 \x3ccode\x3ecompile_me.c\x3c\/code\x3e 的 main 函数返回 \x3ccode\x3e\x22zero\x22\x3c\/code\x3e而不是 \x3ccode\x3e0\x3c\/code\x3e， 那么语义分析器将会抛出一个错误，因为 \x3ccode\x3e\x22zero\x22\x3c\/code\x3e 不是 \x3ccode\x3eint\x3c\/code\x3e 类型。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eIR 生成器\x3c\/strong\x3e将抽象语法树翻译为 IR。\x3c\/p\x3e\n\x3cp\x3e对 compile_me.c 运行 clang 来生成 LLVM IR：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3eclang -S -emit-llvm -o llvm_ir\x3cspan class=\x22hljs-selector-class\x22\x3e.ll\x3c\/span\x3e compile_me\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在 \x3ccode\x3ellvm_ir.ll\x3c\/code\x3e 中的 main 函数：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs llvm\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e; llvm_ir.ll\n\x3c\/span\x3e\x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eunnamed_addr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econstant\x3c\/span\x3e [\x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e] \x3cspan class=\x22hljs-keyword\x22\x3ec\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, Compiler!\\0A\\00\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3edefine\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@main\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ealloca\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- memory allocated on the stack\n\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3estore\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n  \x3cspan class=\x22hljs-symbol\x22\x3e%2\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ecall\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e*, ...) \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3egetelementptr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einbounds\x3c\/span\x3e ([\x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e]* \x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e))\n  \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3edeclare\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e*, ...)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch4\x3e\x3ca href=\x22#优化程序\x22\x3e\x3c\/a\x3e优化程序\x3c\/h4\x3e\n\x3cp\x3e优化程序的工作是基于其对程序的运行时行为的理解来提高代码效率。优化程序将 IR 作为输入，然后生成改进后的 IR 作为输出。LLVM 的优化工具 \x3ccode\x3eopt\x3c\/code\x3e 将会通过标记 \x3ccode\x3e-O2\x3c\/code\x3e（大写字母 \x3ccode\x3eo\x3c\/code\x3e，数字 2）来优化处理器速度，通过标记 \x3ccode\x3eOs\x3c\/code\x3e（大写字母 \x3ccode\x3eo\x3c\/code\x3e，小写字母 \x3ccode\x3es\x3c\/code\x3e）来减少指令数目。\x3c\/p\x3e\n\x3cp\x3e看一看上面的前端工具生成的 LLVM IR 代码和运行下面的命令生成的结果之间的区别：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3eopt -O2 -S llvm_ir\x3cspan class=\x22hljs-selector-class\x22\x3e.ll\x3c\/span\x3e -o optimized\x3cspan class=\x22hljs-selector-class\x22\x3e.ll\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在 \x3ccode\x3eoptimized.ll\x3c\/code\x3e 中的 main 函数：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs llvm\x22\x3eoptimized.ll\n\n\x3cspan class=\x22hljs-title\x22\x3e@str\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eunnamed_addr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econstant\x3c\/span\x3e [\x3cspan class=\x22hljs-number\x22\x3e17\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e] \x3cspan class=\x22hljs-keyword\x22\x3ec\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22Hello, Compiler!\\00\x22\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3edefine\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@main\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-symbol\x22\x3e%puts\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3etail\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ecall\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@puts\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3egetelementptr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einbounds\x3c\/span\x3e ([\x3cspan class=\x22hljs-number\x22\x3e17\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e17\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e]* \x3cspan class=\x22hljs-title\x22\x3e@str\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei64\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei64\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e))\n  \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3edeclare\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@puts\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3enocapture\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e优化后的版本中， main 函数没有在栈中分配内存，因为它不使用任何内存。优化后的代码中调用 \x3ccode\x3eputs\x3c\/code\x3e 函数而不是 \x3ccode\x3eprintf\x3c\/code\x3e 函数，因为程序中并没有使用 \x3ccode\x3eprintf\x3c\/code\x3e 函数的格式化功能。\x3c\/p\x3e\n\x3cp\x3e当然，优化程序不仅仅知道何时可以把 \x3ccode\x3eprintf\x3c\/code\x3e 函数用 \x3ccode\x3eputs\x3c\/code\x3e 函数代替。优化程序也能展开循环并内联简单计算的结果。考虑下面的程序，它将两个整数相加并打印出结果。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs cpp\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ add.c\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;stdio.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emain\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e a = \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, b = \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, c = a \x2b b;\n  \x3cspan class=\x22hljs-built_in\x22\x3eprintf\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22%i \x2b %i = %i\\n\x22\x3c\/span\x3e, a, b, c);\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e下面是未优化的 LLVM IR：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs llvm\x22\x3e\x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eunnamed_addr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econstant\x3c\/span\x3e [\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e] \x3cspan class=\x22hljs-keyword\x22\x3ec\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22%i \x2b %i = %i\\0A\\00\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3edefine\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@main\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ealloca\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- allocate stack space for var a\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%2\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ealloca\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- allocate stack space for var b\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%3\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ealloca\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- allocate stack space for var c\n\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3estore\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e  \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- store 5 at memory location %1\n\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3estore\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%2\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- store 10 at memory location %2\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%4\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eload\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- load the value at memory address %1 into register %4\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%5\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eload\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%2\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- load the value at memory address %2 into register %5\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%6\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ensw\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e%4\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3e%5\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- add the values in registers %4 and %5\\. put the result in register %6\n\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3estore\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e%6\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%3\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- put the value of register %6 into memory address %3\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%7\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eload\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- load the value at memory address %1 into register %7\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%8\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eload\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%2\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- load the value at memory address %2 into register %8\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%9\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eload\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e* \x3cspan class=\x22hljs-symbol\x22\x3e%3\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e; \x26lt;- load the value at memory address %3 into register %9\n\x3c\/span\x3e  \x3cspan class=\x22hljs-symbol\x22\x3e%10\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3ecall\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e*, ...) \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3egetelementptr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einbounds\x3c\/span\x3e ([\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e]* \x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e), \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e%7\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e%8\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e%9\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3edeclare\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e*, ...)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e下面是优化后的 LLVM IR：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs llvm\x22\x3e\x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3eprivate\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eunnamed_addr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econstant\x3c\/span\x3e [\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e] \x3cspan class=\x22hljs-keyword\x22\x3ec\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22%i \x2b %i = %i\\0A\\00\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ealign\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3edefine\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@main\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-symbol\x22\x3e%1\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3etail\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ecall\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e*, ...) \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3egetelementptr\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3einbounds\x3c\/span\x3e ([\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e], [\x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e]* \x3cspan class=\x22hljs-title\x22\x3e@.str\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei64\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei64\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e), \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3edeclare\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ei32\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3e@printf\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3ei8\x3c\/span\x3e* \x3cspan class=\x22hljs-keyword\x22\x3enocapture\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ereadonly\x3c\/span\x3e, ...)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e优化后的 main 函数本质上是未优化版本的第 17 行和 18 行，伴有变量值内联。\x3ccode\x3eopt\x3c\/code\x3e 计算加法，因为所有的变量都是常数。很酷吧，对不对？\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#后端\x22\x3e\x3c\/a\x3e后端\x3c\/h4\x3e\n\x3cp\x3eLLVM 的后端工具是 \x3ccode\x3ellc\x3c\/code\x3e。它分三个阶段将 LLVM IR 作为输入生成机器代码。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cstrong\x3e指令选择\x3c\/strong\x3e是将 IR 指令映射到目标机器的指令集。这个步骤使用虚拟寄存器的无限名字空间。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e寄存器分配\x3c\/strong\x3e是将虚拟寄存器映射到目标体系结构的实际寄存器。我的 CPU 是 x86 结构，它只有 16 个寄存器。然而，编译器将会尽可能少的使用寄存器。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e指令安排\x3c\/strong\x3e是重排操作，从而反映出目标机器的性能约束。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e运行下面这个命令将会产生一些机器代码：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3ellc -o compiled-assembly\x3cspan class=\x22hljs-selector-class\x22\x3e.s\x3c\/span\x3e optimized\x3cspan class=\x22hljs-selector-class\x22\x3e.ll\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cpre\x3e\x3ccode class=\x22hljs cos\x22\x3e_main:\n    pushq    \x3cspan class=\x22hljs-built_in\x22\x3e%rbp\x3c\/span\x3e\n    movq    \x3cspan class=\x22hljs-built_in\x22\x3e%rsp\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3e%rbp\x3c\/span\x3e\n    leaq    L_str(\x3cspan class=\x22hljs-built_in\x22\x3e%rip\x3c\/span\x3e), \x3cspan class=\x22hljs-built_in\x22\x3e%rdi\x3c\/span\x3e\n    callq    _puts\n    xorl    \x3cspan class=\x22hljs-built_in\x22\x3e%eax\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3e%eax\x3c\/span\x3e\n    popq    \x3cspan class=\x22hljs-built_in\x22\x3e%rbp\x3c\/span\x3e\n    retq\nL_str:\n    .asciz    \x3cspan class=\x22hljs-string\x22\x3e\x22Hello, Compiler!\x22\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个程序是 x86 汇编语言，它是计算机所说的语言，并具有人类可读语法。某些人最后也许能理解我。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e相关资源：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.amazon.com\/Engineering-Compiler-Second-Keith-Cooper\/dp\/012088478X\x22\x3e设计一个编译器\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/www.amazon.com\/Getting-Started-LLVM-Core-Libraries\/dp\/1782166920\x22\x3e开始探索 LLVM 核心库\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3chr\x3e\n\x3cp\x3evia: \x3ca href=\x22https:\/\/nicoleorchard.com\/blog\/compilers\x22\x3ehttps:\/\/nicoleorchard.com\/blog\/compilers\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22https:\/\/nicoleorchard.com\/\x22\x3eNicole Orchard\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/ucasFL\x22\x3eucasFL\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 原创编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>编译器简介： 在 Siri 前时代如何与计算机对话</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/an-intro-to-compilers">https://www.zcfy.cc/article/an-intro-to-compilers</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/3ze6xns8nkr/" target="_blank">https://alili.tech/archive/3ze6xns8nkr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>