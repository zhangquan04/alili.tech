<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="调试器工作原理（三）：调试信息"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>调试器工作原理（三）：调试信息 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/w21fxru93an/",
				"appid": "1613049289050283", 
				"title": "调试器工作原理（三）：调试信息 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-23T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6ba23a78y68/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/795bewwzbpb/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&text=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&text=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&title=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&is_video=false&description=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&title=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&title=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&title=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw21fxru93an%2f&title=%e8%b0%83%e8%af%95%e5%99%a8%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86%ef%bc%88%e4%b8%89%ef%bc%89%ef%bc%9a%e8%b0%83%e8%af%95%e4%bf%a1%e6%81%af"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">调试器工作原理（三）：调试信息</h1><div class="meta"><div class="postdate"><time datetime="2019-01-23" itemprop="datePublished">2019-01-23</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#调试器工作原理三调试信息\x22\x3e\x3c\/a\x3e调试器工作原理（三）：调试信息\x3c\/h1\x3e\n\x3cp\x3e这是调试器的工作原理系列文章的第三篇。阅读这篇文章之前应当先阅读\x3ca href=\x22https:\/\/linux.cn\/article-8552-1.html\x22\x3e第一篇\x3c\/a\x3e与\x3ca href=\x22https:\/\/linux.cn\/article-8418-1.html\x22\x3e第二篇\x3c\/a\x3e。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#这篇文章的主要内容\x22\x3e\x3c\/a\x3e这篇文章的主要内容\x3c\/h3\x3e\n\x3cp\x3e本文将解释调试器是如何在机器码中查找它将 C 语言源代码转换成机器语言代码时所需要的 C 语言函数、变量、与数据。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#调试信息\x22\x3e\x3c\/a\x3e调试信息\x3c\/h3\x3e\n\x3cp\x3e现代编译器能够将有着各种缩进或嵌套的程序流程、各种数据类型的变量的高级语言代码转换为一大堆称之为机器码的 0\/1 数据，这么做的唯一目的是尽可能快的在目标 CPU 上运行程序。通常来说一行 C 语言代码能够转换为若干条机器码。变量被分散在机器码中的各个部分，有的在堆栈中，有的在寄存器中，或者直接被优化掉了。数据结构与对象在机器码中甚至不“存在”，它们只是用于将数据按一定的结构编码存储进缓存。\x3c\/p\x3e\n\x3cp\x3e那么调试器怎么知道，当你需要在某个函数入口处暂停时，程序要在哪停下来呢？它怎么知道当你查看某个变量值时，它怎么找到这个值？答案是，调试信息。\x3c\/p\x3e\n\x3cp\x3e编译器在生成机器码时同时会生成相应的调试信息。调试信息代表了可执行程序与源代码之间的关系，并以一种提前定义好的格式，同机器码存放在一起。过去的数年里，人们针对不同的平台与可执行文件发明了很多种用于存储这些信息的格式。不过我们这篇文章不会讲这些格式的历史，而是将阐述这些调试信息是如何工作的，所以我们将专注于一些事情，比如 \x3ccode\x3eDWARF\x3c\/code\x3e。\x3ccode\x3eDWARF\x3c\/code\x3e 如今十分广泛的用作 Linux 和类 \x3ccode\x3eUnix\x3c\/code\x3e 平台上的可执行文件的调试格式。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#elf-中的-dwarf\x22\x3e\x3c\/a\x3eELF 中的 DWARF\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/6596d9f128e85a13523264dd386b84d4840dd9a5\/687474703a2f2f656c692e746865677265656e706c6163652e6e65742f696d616765732f323031312f30322f64776172665f6c6f676f2e676966\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01b081e8457ff312f1.gif\x22 alt=\x22\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e根据\x3ca href=\x22http:\/\/en.wikipedia.org\/wiki\/DWARF\x22\x3e它的维基百科\x3c\/a\x3e 所描述，虽然 \x3ccode\x3eDWARF\x3c\/code\x3e 是同 \x3ccode\x3eELF\x3c\/code\x3e 一同设计的（\x3ccode\x3eDWARF\x3c\/code\x3e 是由 \x3ccode\x3eDWARF\x3c\/code\x3e 标准委员会推出的开放标准。上文中展示的图标就来自这个网站。），但 \x3ccode\x3eDWARF\x3c\/code\x3e 在理论上来说也可以嵌入到其他的可执行文件格式中。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eDWARF\x3c\/code\x3e 是一种复杂的格式，它吸收了过去许多年各种不同的架构与操作系统的格式的经验。正是因为它解决了一个在任何平台与 ABI （应用二进制接口）上为任意高级语言产生调试信息这样棘手的难题，它也必须很复杂。想要透彻的讲解 \x3ccode\x3eDWARF\x3c\/code\x3e 仅仅是通过这单薄的一篇文章是远远不够的，说实话我也并没有充分地了解 \x3ccode\x3eDWARF\x3c\/code\x3e 到每一个微小的细节，所以我也不能十分透彻的讲解 （如果你感兴趣的话，文末有一些能够帮助你的资源。建议从 \x3ccode\x3eDWARF\x3c\/code\x3e 教程开始上手）。这篇文章中我将以浅显易懂的方式展示 \x3ccode\x3eDWARF\x3c\/code\x3e，以说明调试信息是如何实际工作的。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#elf-文件中的调试部分\x22\x3e\x3c\/a\x3eELF 文件中的调试部分\x3c\/h3\x3e\n\x3cp\x3e首先让我们看看 \x3ccode\x3eDWARF\x3c\/code\x3e 处在 ELF 文件中的什么位置。\x3ccode\x3eELF\x3c\/code\x3e 定义了每一个生成的目标文件中的每一节。 节头表section header table 声明并定义了每一节及其名字。不同的工具以不同的方式处理不同的节，例如连接器会寻找连接器需要的部分，调试器会查找调试器需要的部分。\x3c\/p\x3e\n\x3cp\x3e我们本文的实验会使用从这个 C 语言源文件构建的可执行文件，编译成 \x3ccode\x3etracedprog2\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs arduino\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3einclude\x3c\/span\x3e \x3cspan class=\x22hljs-meta-string\x22\x3e\x26lt;stdio.h\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e do_stuff(\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e my_arg)、\n{\n    \x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e my_local = my_arg \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e i;\n\n    \x3cspan class=\x22hljs-built_in\x22\x3efor\x3c\/span\x3e (i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; my_local; \x2b\x2bi)\n        printf(\x3cspan class=\x22hljs-string\x22\x3e\x22i = %d\\n\x22\x3c\/span\x3e, i);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eint\x3c\/span\x3e main()\n{\n    do_stuff(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n}\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e使用 \x3ccode\x3eobjdump -h\x3c\/code\x3e 命令检查 \x3ccode\x3eELF\x3c\/code\x3e 可执行文件中的节头section header，我们会看到几个以 \x3ccode\x3e.debug_\x3c\/code\x3e 开头的节，这些就是 \x3ccode\x3eDWARF\x3c\/code\x3e 的调试部分。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e26\x3c\/span\x3e .debug_aranges \x3cspan class=\x22hljs-number\x22\x3e00000020\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00001037\x3c\/span\x3e\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e27\x3c\/span\x3e .debug_pubnames \x3cspan class=\x22hljs-number\x22\x3e00000028\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00001057\x3c\/span\x3e\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e28\x3c\/span\x3e .debug_info   \x3cspan class=\x22hljs-number\x22\x3e000000\x3c\/span\x3ecc  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e0000107\x3c\/span\x3ef\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e .debug_abbrev \x3cspan class=\x22hljs-number\x22\x3e0000008\x3c\/span\x3ea  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e0000114\x3c\/span\x3eb\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e30\x3c\/span\x3e .debug_line   \x3cspan class=\x22hljs-number\x22\x3e0000006\x3c\/span\x3eb  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e000011\x3c\/span\x3ed5\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e31\x3c\/span\x3e .debug_frame  \x3cspan class=\x22hljs-number\x22\x3e00000044\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00001240\x3c\/span\x3e\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e32\x3c\/span\x3e .debug_str    \x3cspan class=\x22hljs-number\x22\x3e000000\x3c\/span\x3eae  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00001284\x3c\/span\x3e\n                 CONTENTS, READONLY, DEBUGGING\n\x3cspan class=\x22hljs-number\x22\x3e33\x3c\/span\x3e .debug_loc    \x3cspan class=\x22hljs-number\x22\x3e00000058\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e00001332\x3c\/span\x3e\n                 CONTENTS, READONLY, DEBUGGING\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e每个节的第一个数字代表了该节的大小，最后一个数字代表了这个节开始位置距离 \x3ccode\x3eELF\x3c\/code\x3e 的偏移量。调试器利用这些信息从可执行文件中读取节。\x3c\/p\x3e\n\x3cp\x3e现在让我们看看一些在 \x3ccode\x3eDWARF\x3c\/code\x3e 中查找有用的调试信息的实际例子。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#查找函数\x22\x3e\x3c\/a\x3e查找函数\x3c\/h3\x3e\n\x3cp\x3e调试器的最基础的任务之一，就是当我们在某个函数处设置断点时，调试器需要能够在入口处暂停。为此，必须为高级代码中的函数名称与函数在机器码中指令开始的地址这两者之间建立起某种映射关系。\x3c\/p\x3e\n\x3cp\x3e为了获取这种映射关系，我们可以查找 \x3ccode\x3eDWARF\x3c\/code\x3e 中的 \x3ccode\x3e.debug_info\x3c\/code\x3e 节。在我们深入之前，需要一点基础知识。\x3ccode\x3eDWARF\x3c\/code\x3e 中每一个描述类型被称之为调试信息入口（\x3ccode\x3eDIE\x3c\/code\x3e）。每个 \x3ccode\x3eDIE\x3c\/code\x3e 都有关于它的类型、属性之类的标签。\x3ccode\x3eDIE\x3c\/code\x3e 之间通过兄弟节点或子节点相互连接，属性的值也可以指向其它的 \x3ccode\x3eDIE\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e运行以下命令：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs nginx\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eobjdump\x3c\/span\x3e --dwarf=\x3cspan class=\x22hljs-literal\x22\x3einfo\x3c\/span\x3e tracedprog2\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e输出文件相当的长，为了方便举例我们只关注这些行（从这里开始，无用的冗长信息我会以 （...）代替，方便排版）：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;1\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;71\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e (DW_TAG_subprogram)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;72\x26gt;\x3c\/span\x3e   DW_AT_external    : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;73\x26gt;\x3c\/span\x3e   DW_AT_name        : (...): do_stuff\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;77\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;78\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;79\x26gt;\x3c\/span\x3e   DW_AT_prototyped  : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;7a\x26gt;\x3c\/span\x3e   DW_AT_low_pc      : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048604\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;7e\x26gt;\x3c\/span\x3e   DW_AT_high_pc     : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804863e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;82\x26gt;\x3c\/span\x3e   DW_AT_frame_base  : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex0      (location \x3cspan class=\x22hljs-keyword\x22\x3elist\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;86\x26gt;\x3c\/span\x3e   DW_AT_sibling     : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0xb3\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;1\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;b3\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e (DW_TAG_subprogram)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;b4\x26gt;\x3c\/span\x3e   DW_AT_external    : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;b5\x26gt;\x3c\/span\x3e   DW_AT_name        : (...): main\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;b9\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;ba\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;bb\x26gt;\x3c\/span\x3e   DW_AT_type        : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0x4b\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;bf\x26gt;\x3c\/span\x3e   DW_AT_low_pc      : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804863e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;c3\x26gt;\x3c\/span\x3e   DW_AT_high_pc     : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804865a\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;c7\x26gt;\x3c\/span\x3e   DW_AT_frame_base  : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex2c     (location \x3cspan class=\x22hljs-keyword\x22\x3elist\x3c\/span\x3e)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e上面的代码中有两个带有 \x3ccode\x3eDW_TAG_subprogram\x3c\/code\x3e 标签的入口，在 \x3ccode\x3eDWARF\x3c\/code\x3e 中这是对函数的指代。注意，这是两个节的入口，其中一个是 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数的入口，另一个是主（\x3ccode\x3emain\x3c\/code\x3e）函数的入口。这些信息中有很多值得关注的属性，但其中最值得注意的是 \x3ccode\x3eDW_AT_low_pc\x3c\/code\x3e。它代表了函数开始处程序指针的值（在 x86 平台上是 \x3ccode\x3eEIP\x3c\/code\x3e）。此处 \x3ccode\x3e0x8048604\x3c\/code\x3e 代表了 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数开始处的程序指针。下面我们将利用 \x3ccode\x3eobjdump -d\x3c\/code\x3e 命令对可执行文件进行反汇编。来看看这块地址中都有什么：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs x86asm\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e08048604\x3c\/span\x3e \x26lt;do_stuff\x26gt;:\n \x3cspan class=\x22hljs-number\x22\x3e8048604\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e55\x3c\/span\x3e           \x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e   \x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048605\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e e5        \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048607\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e83\x3c\/span\x3e ec \x3cspan class=\x22hljs-number\x22\x3e28\x3c\/span\x3e     \x3cspan class=\x22hljs-keyword\x22\x3esub\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0x28\x3c\/span\x3e\n 804860a:       8b \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08\x3c\/span\x3e     \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-number\x22\x3e0x8\x3c\/span\x3e]\n \x3cspan class=\x22hljs-number\x22\x3e804860d\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e83\x3c\/span\x3e c0 \x3cspan class=\x22hljs-number\x22\x3e02\x3c\/span\x3e     \x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0x2\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048610\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e f4     \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0xc\x3c\/span\x3e],\x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048613\x3c\/span\x3e:       c7 \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e (...)  \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0x10\x3c\/span\x3e],\x3cspan class=\x22hljs-number\x22\x3e0x0\x3c\/span\x3e\n 804861a:       eb \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e        \x3cspan class=\x22hljs-keyword\x22\x3ejmp\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e8048634\x3c\/span\x3e \x26lt;do_stuff\x2b\x3cspan class=\x22hljs-number\x22\x3e0x30\x3c\/span\x3e\x26gt;\n 804861c:       b8 \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e (...)  \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0x8048720\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048621\x3c\/span\x3e:       8b \x3cspan class=\x22hljs-number\x22\x3e55\x3c\/span\x3e f0     \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eedx\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0x10\x3c\/span\x3e]\n \x3cspan class=\x22hljs-number\x22\x3e8048624\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e54\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e04\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-number\x22\x3e0x4\x3c\/span\x3e],\x3cspan class=\x22hljs-built_in\x22\x3eedx\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048628\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e04\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e     \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e],\x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e\n 804862b:       e8 \x3cspan class=\x22hljs-number\x22\x3e04\x3c\/span\x3e (...)  \x3cspan class=\x22hljs-keyword\x22\x3ecall\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e8048534\x3c\/span\x3e \x26lt;printf@plt\x26gt;\n \x3cspan class=\x22hljs-number\x22\x3e8048630\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e83\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e f0 \x3cspan class=\x22hljs-number\x22\x3e01\x3c\/span\x3e  \x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0x10\x3c\/span\x3e],\x3cspan class=\x22hljs-number\x22\x3e0x1\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048634\x3c\/span\x3e:       8b \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e f0     \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0x10\x3c\/span\x3e]\n \x3cspan class=\x22hljs-number\x22\x3e8048637\x3c\/span\x3e:       3b \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e f4     \x3cspan class=\x22hljs-keyword\x22\x3ecmp\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0xc\x3c\/span\x3e]\n 804863a:       7c e0        \x3cspan class=\x22hljs-keyword\x22\x3ejl\x3c\/span\x3e     804861c \x26lt;do_stuff\x2b\x3cspan class=\x22hljs-number\x22\x3e0x18\x3c\/span\x3e\x26gt;\n 804863c:       c9           \x3cspan class=\x22hljs-keyword\x22\x3eleave\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e804863d\x3c\/span\x3e:       c3           \x3cspan class=\x22hljs-keyword\x22\x3eret\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e显然，\x3ccode\x3e0x8048604\x3c\/code\x3e 是 \x3ccode\x3edo_stuff\x3c\/code\x3e 的开始地址，这样一来，调试器就可以建立函数与其在可执行文件中的位置间的映射关系。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#查找变量\x22\x3e\x3c\/a\x3e查找变量\x3c\/h3\x3e\n\x3cp\x3e假设我们当前在 \x3ccode\x3edo_staff\x3c\/code\x3e 函数中某个位置上设置断点停了下来。我们想通过调试器取得 \x3ccode\x3emy_local\x3c\/code\x3e 这个变量的值。调试器怎么知道在哪里去找这个值呢？很显然这要比查找函数更为困难。变量可能存储在全局存储区、堆栈、甚至是寄存器中。此外，同名变量在不同的作用域中可能有着不同的值。调试信息必须能够反映所有的这些变化，当然，\x3ccode\x3eDWARF\x3c\/code\x3e 就能做到。\x3c\/p\x3e\n\x3cp\x3e我不会逐一去将每一种可能的状况，但我会以调试器在 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数中查找 \x3ccode\x3emy_local\x3c\/code\x3e 变量的过程来举个例子。下面我们再看一遍 \x3ccode\x3e.debug_info\x3c\/code\x3e 中 \x3ccode\x3edo_stuff\x3c\/code\x3e 的每一个入口，这次连它的子入口也要一起看。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs vim\x22\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;1\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;71\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e (DW_TAG_subprogram)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;72\x26gt;\x3c\/span\x3e   DW_AT_external    : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;73\x26gt;\x3c\/span\x3e   DW_AT_name        : (...): do_stuff\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;77\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;78\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;79\x26gt;\x3c\/span\x3e   DW_AT_prototyped  : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;7a\x26gt;\x3c\/span\x3e   DW_AT_low_pc      : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048604\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;7e\x26gt;\x3c\/span\x3e   DW_AT_high_pc     : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804863e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;82\x26gt;\x3c\/span\x3e   DW_AT_frame_base  : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex0      (location \x3cspan class=\x22hljs-keyword\x22\x3elist\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;86\x26gt;\x3c\/span\x3e   DW_AT_sibling     : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0xb3\x26gt;\x3c\/span\x3e\n \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;2\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;8a\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e (DW_TAG_formal_parameter)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;8b\x26gt;\x3c\/span\x3e   DW_AT_name        : (...): my_arg\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;8f\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;90\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;91\x26gt;\x3c\/span\x3e   DW_AT_type        : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0x4b\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;95\x26gt;\x3c\/span\x3e   DW_AT_location    : (...)       (DW_OP_fbre\x3cspan class=\x22hljs-variable\x22\x3eg:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e)\n \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;2\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;98\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e (DW_TAG_variable)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;99\x26gt;\x3c\/span\x3e   DW_AT_name        : (...): my_local\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;9d\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;9e\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;9f\x26gt;\x3c\/span\x3e   DW_AT_type        : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0x4b\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;a3\x26gt;\x3c\/span\x3e   DW_AT_location    : (...)      (DW_OP_fbre\x3cspan class=\x22hljs-variable\x22\x3eg:\x3c\/span\x3e -\x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e)\n\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;2\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;a6\x26gt;\x3c\/span\x3e: Abbrev Number: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e (DW_TAG_variable)\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;a7\x26gt;\x3c\/span\x3e   DW_AT_name        : i\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;a9\x26gt;\x3c\/span\x3e   DW_AT_decl_file   : \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;aa\x26gt;\x3c\/span\x3e   DW_AT_decl_line   : \x3cspan class=\x22hljs-number\x22\x3e7\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;ab\x26gt;\x3c\/span\x3e   DW_AT_type        : \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;0x4b\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-symbol\x22\x3e\x26lt;af\x26gt;\x3c\/span\x3e   DW_AT_location    : (...)      (DW_OP_fbre\x3cspan class=\x22hljs-variable\x22\x3eg:\x3c\/span\x3e -\x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e看到每个入口处第一对尖括号中的数字了吗？这些是嵌套的等级，在上面的例子中，以 \x3ccode\x3e\x26lt;2\x26gt;\x3c\/code\x3e 开头的入口是以 \x3ccode\x3e\x26lt;1\x26gt;\x3c\/code\x3e 开头的子入口。因此我们得知 \x3ccode\x3emy_local\x3c\/code\x3e 变量（以 \x3ccode\x3eDW_TAG_variable\x3c\/code\x3e 标签标记）是 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数的局部变量。除此之外，调试器也需要知道变量的数据类型，这样才能正确的使用与显示变量。上面的例子中 \x3ccode\x3emy_local\x3c\/code\x3e 的变量类型指向另一个 \x3ccode\x3eDIE\x3c\/code\x3e \x3ccode\x3e\x26lt;0x4b\x26gt;\x3c\/code\x3e。如果使用 \x3ccode\x3eobjdump\x3c\/code\x3e 命令查看这个 \x3ccode\x3eDIE\x3c\/code\x3e 的话，我们会发现它是一个有符号 4 字节整型数据。\x3c\/p\x3e\n\x3cp\x3e而为了在实际运行的程序内存中查找变量的值，调试器需要使用到 \x3ccode\x3eDW_AT_location\x3c\/code\x3e 属性。对于 \x3ccode\x3emy_local\x3c\/code\x3e 而言，是 \x3ccode\x3eDW_OP_fbreg: -20\x3c\/code\x3e。这个代码段的意思是说 \x3ccode\x3emy_local\x3c\/code\x3e 存储在距离它所在函数起始地址偏移量为 \x3ccode\x3e-20\x3c\/code\x3e 的地方。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3edo_stuff\x3c\/code\x3e 函数的 \x3ccode\x3eDW_AT_frame_base\x3c\/code\x3e 属性值为 \x3ccode\x3e0x0 (location list)\x3c\/code\x3e。这意味着这个属性的值需要在 \x3ccode\x3elocation list\x3c\/code\x3e 中查找。下面我们来一起看看。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dns\x22\x3e$ objdump --dwarf=loc tracedprog2\n\ntracedprog2:     file format elf32-i386\n\nContents of the .debug_loc section:\n\n    Offset   Begin    End      Expression\n    \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08048604\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08048605\x3c\/span\x3e (DW_OP_breg4: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08048605\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08048607\x3c\/span\x3e (DW_OP_breg4: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08048607\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0804863\x3c\/span\x3ee (DW_OP_breg5: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e00000000\x3c\/span\x3e \x26lt;End of list\x26gt;\n    \x3cspan class=\x22hljs-number\x22\x3e0000002\x3c\/span\x3ec \x3cspan class=\x22hljs-number\x22\x3e0804863\x3c\/span\x3ee \x3cspan class=\x22hljs-number\x22\x3e0804863\x3c\/span\x3ef (DW_OP_breg4: \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e0000002\x3c\/span\x3ec \x3cspan class=\x22hljs-number\x22\x3e0804863\x3c\/span\x3ef \x3cspan class=\x22hljs-number\x22\x3e08048641\x3c\/span\x3e (DW_OP_breg4: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e0000002\x3c\/span\x3ec \x3cspan class=\x22hljs-number\x22\x3e08048641\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0804865\x3c\/span\x3ea (DW_OP_breg5: \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e )\n    \x3cspan class=\x22hljs-number\x22\x3e0000002\x3c\/span\x3ec \x26lt;End of list\x26gt;\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e我们需要关注的是第一列（\x3ccode\x3edo_stuff\x3c\/code\x3e 函数的 \x3ccode\x3eDW_AT_frame_base\x3c\/code\x3e 属性包含 \x3ccode\x3elocation list\x3c\/code\x3e 中 \x3ccode\x3e0x0\x3c\/code\x3e 的偏移量。而 \x3ccode\x3emain\x3c\/code\x3e 函数的相同属性包含 \x3ccode\x3e0x2c\x3c\/code\x3e 的偏移量，这个偏移量是第二套地址列表的偏移量）。对于调试器可能定位到的每一个地址，它都会指定当前栈帧到变量间的偏移量，而这个偏移就是通过寄存器来计算的。对于 x86 平台而言，\x3ccode\x3ebpreg4\x3c\/code\x3e 指向 \x3ccode\x3eesp\x3c\/code\x3e，而 \x3ccode\x3ebpreg5\x3c\/code\x3e 指向 \x3ccode\x3eebp\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e让我们再看看 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数的头几条指令。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs x86asm\x22\x3e\x3cspan class=\x22hljs-number\x22\x3e08048604\x3c\/span\x3e \x26lt;do_stuff\x26gt;:\n \x3cspan class=\x22hljs-number\x22\x3e8048604\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e55\x3c\/span\x3e          \x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e   \x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048605\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e e5       \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048607\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e83\x3c\/span\x3e ec \x3cspan class=\x22hljs-number\x22\x3e28\x3c\/span\x3e    \x3cspan class=\x22hljs-keyword\x22\x3esub\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eesp\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0x28\x3c\/span\x3e\n 804860a:       8b \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e08\x3c\/span\x3e    \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e\x2b\x3cspan class=\x22hljs-number\x22\x3e0x8\x3c\/span\x3e]\n \x3cspan class=\x22hljs-number\x22\x3e804860d\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e83\x3c\/span\x3e c0 \x3cspan class=\x22hljs-number\x22\x3e02\x3c\/span\x3e    \x3cspan class=\x22hljs-keyword\x22\x3eadd\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e0x2\x3c\/span\x3e\n \x3cspan class=\x22hljs-number\x22\x3e8048610\x3c\/span\x3e:       \x3cspan class=\x22hljs-number\x22\x3e89\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e45\x3c\/span\x3e f4    \x3cspan class=\x22hljs-keyword\x22\x3emov\x3c\/span\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eDWORD\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePTR\x3c\/span\x3e [\x3cspan class=\x22hljs-built_in\x22\x3eebp\x3c\/span\x3e-\x3cspan class=\x22hljs-number\x22\x3e0xc\x3c\/span\x3e],\x3cspan class=\x22hljs-built_in\x22\x3eeax\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e只有当第二条指令执行后，\x3ccode\x3eebp\x3c\/code\x3e 寄存器才真正存储了有用的值。当然，前两条指令的基址是由上面所列出来的地址信息表计算出来的。一但 \x3ccode\x3eebp\x3c\/code\x3e 确定了，计算偏移量就十分方便了，因为尽管 \x3ccode\x3eesp\x3c\/code\x3e 在操作堆栈的时候需要移动，但 \x3ccode\x3eebp\x3c\/code\x3e 作为栈底并不需要移动。\x3c\/p\x3e\n\x3cp\x3e究竟我们应该去哪里找 \x3ccode\x3emy_local\x3c\/code\x3e 的值呢？在 \x3ccode\x3e0x8048610\x3c\/code\x3e 这块地址后， \x3ccode\x3emy_local\x3c\/code\x3e 的值经过在 \x3ccode\x3eeax\x3c\/code\x3e 中的计算后被存在了内存中，从这里开始我们才需要关注 \x3ccode\x3emy_local\x3c\/code\x3e 的值。调试器会利用 \x3ccode\x3eDW_OP_breg5: 8\x3c\/code\x3e 这个栈帧来查找。我们回想下，\x3ccode\x3emy_local\x3c\/code\x3e 的 \x3ccode\x3eDW_AT_location\x3c\/code\x3e 属性值为 \x3ccode\x3eDW_OP_fbreg: -20\x3c\/code\x3e。所以应当从基址中 \x3ccode\x3e-20\x3c\/code\x3e ，同时由于 \x3ccode\x3eebp\x3c\/code\x3e 寄存器需要 \x3ccode\x3e\x2b8\x3c\/code\x3e，所以最终结果为 \x3ccode\x3eebp - 12\x3c\/code\x3e。现在再次查看反汇编代码，来看看数据从 \x3ccode\x3eeax\x3c\/code\x3e 中被移动到哪里了。当然，这里 \x3ccode\x3emy_local\x3c\/code\x3e 应当被存储在了 \x3ccode\x3eebp - 12\x3c\/code\x3e 的地址中。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#查看行号\x22\x3e\x3c\/a\x3e查看行号\x3c\/h3\x3e\n\x3cp\x3e当我们谈到在调试信息寻找函数的时候，我们利用了些技巧。当调试 C 语言源代码并在某个函数出放置断点的时候，我们并不关注第一条“机器码”指令（函数的调用准备工作已经完成而局部变量还没有初始化）。我们真正关注的是函数的第一行“C 代码”。\x3c\/p\x3e\n\x3cp\x3e这就是 \x3ccode\x3eDWARF\x3c\/code\x3e 完全覆盖映射 C 源代码中的行与可执行文件中机器码地址的原因。下面是 \x3ccode\x3e.debug_line\x3c\/code\x3e 节中所包含的内容，我们将其转换为可读的格式展示如下。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e$ objdump --dwarf=decodedline tracedprog2\n\ntracedprog2:     file format elf32-i386\n\nDecoded dump of debug contents of \x3cspan class=\x22hljs-selector-tag\x22\x3esection\x3c\/span\x3e \x3cspan class=\x22hljs-selector-class\x22\x3e.debug_line\x3c\/span\x3e:\n\nCU: \/home\/eliben\/eli\/eliben-code\/debugger\/tracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e:\nFile name           Line number    Starting \x3cspan class=\x22hljs-selector-tag\x22\x3eaddress\x3c\/span\x3e\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e                \x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048604\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e                \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804860a\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e                \x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048613\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804861c\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e                \x3cspan class=\x22hljs-number\x22\x3e9\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048630\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804863c\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e15\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex804863e\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048647\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e17\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048653\ntracedprog2\x3cspan class=\x22hljs-selector-class\x22\x3e.c\x3c\/span\x3e               \x3cspan class=\x22hljs-number\x22\x3e18\x3c\/span\x3e           \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3ex8048658\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e很容易就可以看出其中 C 源代码与反汇编代码之间的对应关系。第 5 行指向 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数的入口，\x3ccode\x3e0x8040604\x3c\/code\x3e。第 6 行，指向 \x3ccode\x3e0x804860a\x3c\/code\x3e ，正是调试器在调试 \x3ccode\x3edo_stuff\x3c\/code\x3e 函数时需要停下来的地方。这里已经完成了函数调用的准备工作。上面的这些信息形成了行号与地址间的双向映射关系。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当在某一行设置断点的时候，调试器会利用这些信息去查找相应的地址来做断点工作（还记得上篇文章中的 \x3ccode\x3eint 3\x3c\/code\x3e 指令吗？）\x3c\/li\x3e\n\x3cli\x3e当指令造成段错误时，调试器会利用这些信息来查看源代码中发生问题的行。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3\x3e\x3ca href=\x22#libdwarf---用-dwarf-编程\x22\x3e\x3c\/a\x3elibdwarf - 用 DWARF 编程\x3c\/h3\x3e\n\x3cp\x3e尽管使用命令行工具来获得 \x3ccode\x3eDWARF\x3c\/code\x3e 很有用，但这仍然不够易用。作为程序员，我们希望知道当我们需要这些调试信息时应当怎么编程来获取这些信息。\x3c\/p\x3e\n\x3cp\x3e自然我们想到的第一种方法就是阅读 \x3ccode\x3eDWARF\x3c\/code\x3e 规范并按规范操作阅读使用。有句话说的好，分析 HTML 应当使用库函数，永远不要手工分析。对于 \x3ccode\x3eDWARF\x3c\/code\x3e 来说正是如此。\x3ccode\x3eDWARF\x3c\/code\x3e 比 HTML 要复杂得多。上面所展示出来的只是冰山一角。更糟糕的是，在实际的目标文件中，大部分信息是以非常紧凑的压缩格式存储的，分析起来更加复杂（信息中的某些部分，例如位置信息与行号信息，在某些虚拟机下是以指令的方式编码的）。\x3c\/p\x3e\n\x3cp\x3e所以我们要使用库来处理 \x3ccode\x3eDWARF\x3c\/code\x3e。下面是两种我熟悉的主要的库（还有些不完整的库这里没有写）\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3ccode\x3eBFD\x3c\/code\x3e （libbfd），包含了 \x3ccode\x3eobjdump\x3c\/code\x3e （对，就是这篇文章中我们一直在用的这货），\x3ccode\x3eld\x3c\/code\x3e（\x3ccode\x3eGNU\x3c\/code\x3e 连接器）与 \x3ccode\x3eas\x3c\/code\x3e（\x3ccode\x3eGNU\x3c\/code\x3e 编译器）。\x3ccode\x3eBFD\x3c\/code\x3e 主要用于 \x3ca href=\x22http:\/\/www.gnu.org\/software\/binutils\/\x22\x3eGNU binutils\x3c\/a\x3e。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3elibdwarf\x3c\/code\x3e ，同它的哥哥 \x3ccode\x3elibelf\x3c\/code\x3e 一同用于 \x3ccode\x3eSolaris\x3c\/code\x3e 与 \x3ccode\x3eFreeBSD\x3c\/code\x3e 中的调试信息分析。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e相比较而言我更倾向于使用 \x3ccode\x3elibdwarf\x3c\/code\x3e，因为我对它了解的更多，并且 \x3ccode\x3elibdwarf\x3c\/code\x3e 的开源协议更开放（\x3ccode\x3eLGPL\x3c\/code\x3e 对比 \x3ccode\x3eGPL\x3c\/code\x3e）。\x3c\/p\x3e\n\x3cp\x3e因为 \x3ccode\x3elibdwarf\x3c\/code\x3e 本身相当复杂，操作起来需要相当多的代码，所以我在这不会展示所有代码。你可以在 \x3ca href=\x22https:\/\/github.com\/eliben\/code-for-blog\/blob\/master\/2011\/dwarf_get_func_addr.c\x22\x3e这里\x3c\/a\x3e 下载代码并运行试试。运行这些代码需要提前安装 \x3ccode\x3elibelfand\x3c\/code\x3e 与 \x3ccode\x3elibdwarf\x3c\/code\x3e ，同时在使用连接器的时候要使用参数 \x3ccode\x3e-lelf\x3c\/code\x3e 与 \x3ccode\x3e-ldwarf\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这个示例程序可以接受可执行文件并打印其中的函数名称与函数入口地址。下面是我们整篇文章中使用的 C 程序经过示例程序处理后的输出。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs groovy\x22\x3e$ dwarf_get_func_addr tracedprog2\n\x3cspan class=\x22hljs-string\x22\x3eDW_TAG_subprogram:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27do_stuff\x27\x3c\/span\x3e\nlow \x3cspan class=\x22hljs-string\x22\x3epc  :\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0x08048604\x3c\/span\x3e\nhigh \x3cspan class=\x22hljs-string\x22\x3epc :\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0x0804863e\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3eDW_TAG_subprogram:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27main\x27\x3c\/span\x3e\nlow \x3cspan class=\x22hljs-string\x22\x3epc  :\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0x0804863e\x3c\/span\x3e\nhigh \x3cspan class=\x22hljs-string\x22\x3epc :\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0x0804865a\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3elibdwarf\x3c\/code\x3e 的文档很棒，如果你花些功夫，利用 \x3ccode\x3elibdwarf\x3c\/code\x3e 获得这篇文章中所涉及到的 \x3ccode\x3eDWARF\x3c\/code\x3e 信息应该并不困难。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#结论与计划\x22\x3e\x3c\/a\x3e结论与计划\x3c\/h3\x3e\n\x3cp\x3e原理上讲，调试信息是个很简单的概念。尽管实现细节可能比较复杂，但经过了上面的学习我想你应该了解了调试器是如何从可执行文件中获取它需要的源代码信息的了。对于程序员而言，程序只是代码段与数据结构；对可执行文件而言，程序只是一系列存储在内存或寄存器中的指令或数据。但利用调试信息，调试器就可以将这两者连接起来，从而完成调试工作。\x3c\/p\x3e\n\x3cp\x3e此文与这系列的前两篇，一同介绍了调试器的内部工作过程。利用这里所讲到的知识，再敲些代码，应该可以完成一个 Linux 中最简单、基础但也有一定功能的调试器。\x3c\/p\x3e\n\x3cp\x3e下一步我并不确定要做什么，这个系列文章可能就此结束，也有可能我要讲些堆栈调用的事情，又或者讲 Windows 下的调试。你们有什么好的点子或者相关材料，可以直接评论或者发邮件给我。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#参考\x22\x3e\x3c\/a\x3e参考\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3eobjdump 参考手册\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/en.wikipedia.org\/wiki\/Executable_and_Linkable_Format\x22\x3eELF\x3c\/a\x3e 与 \x3ca href=\x22http:\/\/en.wikipedia.org\/wiki\/DWARF\x22\x3eDWARF\x3c\/a\x3e 的维基百科\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/dwarfstd.org\/\x22\x3eDwarf Debugging Standard 主页\x3c\/a\x3e，这里有很棒的 DWARF 教程与 DWARF 标准，作者是 Michael Eager。第二版基于 GCC 也许更能吸引你。\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/reality.sgiweb.org\/davea\/dwarf.html\x22\x3elibdwarf 主页\x3c\/a\x3e，这里可以下载到 libwarf 的完整库与参考手册\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/sourceware.org\/binutils\/docs-2.21\/bfd\/index.html\x22\x3eBFD 文档\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3chr\x3e\n\x3chr\x3e\n\x3cp\x3evia: \x3ca href=\x22http:\/\/eli.thegreenplace.net\/2011\/02\/07\/how-debuggers-work-part-3-debugging-information\x22\x3ehttp:\/\/eli.thegreenplace.net\/2011\/02\/07\/how-debuggers-work-part-3-debugging-information\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22http:\/\/eli.thegreenplace.net\/\x22\x3eEli Bendersky\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/YYforymj\x22\x3eYYforymj\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 原创编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>调试器工作原理（三）：调试信息</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/how-debuggers-work-part-3-debugging-information">https://www.zcfy.cc/article/how-debuggers-work-part-3-debugging-information</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/w21fxru93an/" target="_blank">https://alili.tech/archive/w21fxru93an/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>