<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="7 个使用 bcc/BPF 的性能分析神器"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>7 个使用 bcc/BPF 的性能分析神器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/iksbk0p5k29/",
				"appid": "1613049289050283", 
				"title": "7 个使用 bcc/BPF 的性能分析神器 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-21T02:30:06"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/lxcn150vbf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/2jht7yu2u9e/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&text=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&text=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&title=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&is_video=false&description=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&title=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&title=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&title=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fiksbk0p5k29%2f&title=7%20%e4%b8%aa%e4%bd%bf%e7%94%a8%20bcc%2fBPF%20%e7%9a%84%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e7%a5%9e%e5%99%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">7 个使用 bcc/BPF 的性能分析神器</h1><div class="meta"><div class="postdate"><time datetime="2019-01-21" itemprop="datePublished">2019-01-21</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch1\x3e\x3ca href=\x22#7-个使用-bccbpf-的性能分析神器\x22\x3e\x3c\/a\x3e7 个使用 bcc\/BPF 的性能分析神器\x3c\/h1\x3e\n\x3cblockquote\x3e\n\x3cp\x3e使用伯克利包过滤器Berkeley Packet Filter（BPF）编译器集合Compiler Collection（BCC）工具深度探查你的 linux 代码。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/8672dd995fc51fcd5fa8c8a7e3f90cc5bad3001e\/68747470733a2f2f6f70656e736f757263652e636f6d2f73697465732f64656661756c742f66696c65732f7374796c65732f696d6167652d66756c6c2d73697a652f7075626c69632f6c6561642d696d616765732f70656e6775696e73253230696e25323073706163655f302e6a70673f69746f6b3d756d70435441756c\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t0113ff115bf8265227.jpg\x22 alt=\x227 superpowers for Fedora bcc\/BPF performance analysis\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e在 Linux 中出现的一种新技术能够为系统管理员和开发者提供大量用于性能分析和故障排除的新工具和仪表盘。它被称为增强的伯克利数据包过滤器enhanced Berkeley Packet Filter（eBPF，或 BPF），虽然这些改进并不是由伯克利开发的，而且它们不仅仅是处理数据包，更多的是过滤。我将讨论在 Fedora 和 Red Hat Linux 发行版中使用 BPF 的一种方法，并在 Fedora 26 上演示。\x3c\/p\x3e\n\x3cp\x3eBPF 可以在内核中运行由用户定义的沙盒程序，可以立即添加新的自定义功能。这就像按需给 Linux 系统添加超能力一般。 你可以使用它的例子包括如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cstrong\x3e高级性能跟踪工具\x3c\/strong\x3e：对文件系统操作、TCP 事件、用户级事件等的可编程的低开销检测。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e网络性能\x3c\/strong\x3e： 尽早丢弃数据包以提高对 DDoS 的恢复能力，或者在内核中重定向数据包以提高性能。\x3c\/li\x3e\n\x3cli\x3e\x3cstrong\x3e安全监控\x3c\/strong\x3e： 7x24 小时的自定义检测和记录内核空间与用户空间内的可疑事件。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在可能的情况下，BPF 程序必须通过一个内核验证机制来保证它们的安全运行，这比写自定义的内核模块更安全。我在此假设大多数人并不编写自己的 BPF 程序，而是使用别人写好的。在 GitHub 上的 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\x22\x3eBPF Compiler Collection (bcc)\x3c\/a\x3e 项目中，我已发布许多开源代码。bcc 为 BPF 开发提供了不同的前端支持，包括 Python 和 Lua，并且是目前最活跃的 BPF 工具项目。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#7-个有用的-bccbpf-新工具\x22\x3e\x3c\/a\x3e7 个有用的 bcc\/BPF 新工具\x3c\/h3\x3e\n\x3cp\x3e为了了解 bcc\/BPF 工具和它们的检测内容，我创建了下面的图表并添加到 bcc 项目中。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/camo.githubusercontent.com\/f7a7950340893c3c6be15498a2aef4156ec9e69d\/68747470733a2f2f6f70656e736f757263652e636f6d2f73697465732f64656661756c742f66696c65732f753132383635312f6263635f74726163696e675f746f6f6c732e706e67\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t0112ac0bf7eea0d191.png\x22 alt=\x22Linux bcc\/BPF 跟踪工具图\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e这些是命令行界面工具，你可以通过 SSH 使用它们。目前大多数分析，包括我的老板，都是用 GUI 和仪表盘进行的。SSH 是最后的手段。但这些命令行工具仍然是预览 BPF 能力的好方法，即使你最终打算通过一个可用的 GUI 使用它。我已着手向一个开源 GUI 添加 BPF 功能，但那是另一篇文章的主题。现在我想向你分享今天就可以使用的 CLI 工具。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#1-execsnoop\x22\x3e\x3c\/a\x3e1、 execsnoop\x3c\/h4\x3e\n\x3cp\x3e从哪儿开始呢？如何查看新的进程。那些会消耗系统资源，但很短暂的进程，它们甚至不会出现在 \x3ccode\x3etop(1)\x3c\/code\x3e 命令或其它工具中的显示之中。这些新进程可以使用 \x3ca href=\x22https:\/\/github.com\/brendangregg\/perf-tools\/blob\/master\/execsnoop\x22\x3eexecsnoop\x3c\/a\x3e 进行检测（或使用行业术语说，可以被追踪traced）。 在追踪时，我将在另一个窗口中通过 SSH 登录：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs tap\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# \/usr\/share\/bcc\/tools\/execsnoop\x3c\/span\x3e\nPCOMM            PID    PPID   RET ARGS\nsshd            \x3cspan class=\x22hljs-number\x22\x3e 12234 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 727 \x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/sbin\/sshd -D -R\nunix_chkpwd     \x3cspan class=\x22hljs-number\x22\x3e 12236 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12234 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/sbin\/unix_chkpwd root nonull\nunix_chkpwd     \x3cspan class=\x22hljs-number\x22\x3e 12237 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12234 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/sbin\/unix_chkpwd root chkexpiry\nbash            \x3cspan class=\x22hljs-number\x22\x3e 12239 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12238 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/bin\/bash\nid              \x3cspan class=\x22hljs-number\x22\x3e 12241 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12240 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/id -un\nhostname        \x3cspan class=\x22hljs-number\x22\x3e 12243 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12242 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/hostname\npkg-config      \x3cspan class=\x22hljs-number\x22\x3e 12245 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12244 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/pkg-config --variable=completionsdir bash-completion\ngrepconf.sh     \x3cspan class=\x22hljs-number\x22\x3e 12246 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12239 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/libexec\/grepconf.sh -c\ngrep            \x3cspan class=\x22hljs-number\x22\x3e 12247 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12246 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/grep -qsi ^COLOR.*none \/etc\/GREP_COLORS\ntty             \x3cspan class=\x22hljs-number\x22\x3e 12249 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12248 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/tty -s\ntput            \x3cspan class=\x22hljs-number\x22\x3e 12250 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12248 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/tput colors\ndircolors       \x3cspan class=\x22hljs-number\x22\x3e 12252 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12251 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/dircolors --sh \/etc\/DIR_COLORS\ngrep            \x3cspan class=\x22hljs-number\x22\x3e 12253 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12239 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/grep -qi ^COLOR.*none \/etc\/DIR_COLORS\ngrepconf.sh     \x3cspan class=\x22hljs-number\x22\x3e 12254 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12239 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/libexec\/grepconf.sh -c\ngrep            \x3cspan class=\x22hljs-number\x22\x3e 12255 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12254 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/grep -qsi ^COLOR.*none \/etc\/GREP_COLORS\ngrepconf.sh     \x3cspan class=\x22hljs-number\x22\x3e 12256 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12239 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/libexec\/grepconf.sh -c\ngrep            \x3cspan class=\x22hljs-number\x22\x3e 12257 \x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e 12256 \x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e\/usr\/bin\/grep -qsi ^COLOR.*none \/etc\/GREP_COLORS\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e哇哦。 那是什么？ 什么是 \x3ccode\x3egrepconf.sh\x3c\/code\x3e？ 什么是 \x3ccode\x3e\/etc\/GREP_COLORS\x3c\/code\x3e？ 是 \x3ccode\x3egrep\x3c\/code\x3e 在读取它自己的配置文件……由 \x3ccode\x3egrep\x3c\/code\x3e 运行的？ 这究竟是怎么工作的？\x3c\/p\x3e\n\x3cp\x3e欢迎来到有趣的系统追踪世界。 你可以学到很多关于系统是如何工作的（或者根本不工作，在有些情况下），并且发现一些简单的优化方法。 \x3ccode\x3eexecsnoop\x3c\/code\x3e 通过跟踪 \x3ccode\x3eexec()\x3c\/code\x3e 系统调用来工作，\x3ccode\x3eexec()\x3c\/code\x3e 通常用于在新进程中加载不同的程序代码。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#2-opensnoop\x22\x3e\x3c\/a\x3e2、 opensnoop\x3c\/h4\x3e\n\x3cp\x3e接着上面继续，所以，\x3ccode\x3egrepconf.sh\x3c\/code\x3e 可能是一个 shell 脚本，对吧？ 我将运行 \x3ccode\x3efile(1)\x3c\/code\x3e 来检查它，并使用\x3ca href=\x22https:\/\/github.com\/brendangregg\/perf-tools\/blob\/master\/opensnoop\x22\x3eopensnoop\x3c\/a\x3e bcc 工具来查看打开的文件：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e# \/usr\/share\/bcc\/tools\/opensnoop\nPID    COMM               FD ERR PATH\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/etc\/ld.so.cache\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libmagic.so\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libz.so\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libc.so\x3cspan class=\x22hljs-number\x22\x3e.6\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/usr\/lib\/locale\/locale-archive\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file               \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e \/etc\/magic.mgc\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/etc\/magic\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/usr\/share\/misc\/magic.mgc\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/usr\/lib64\/gconv\/gconv-modules.cache\n\x3cspan class=\x22hljs-number\x22\x3e12420\x3c\/span\x3e  file                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/usr\/libexec\/grepconf.sh\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e      systemd            \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/proc\/\x3cspan class=\x22hljs-number\x22\x3e565\x3c\/span\x3e\/cgroup\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e      systemd            \x3cspan class=\x22hljs-number\x22\x3e16\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/proc\/\x3cspan class=\x22hljs-number\x22\x3e536\x3c\/span\x3e\/cgroup\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e像 \x3ccode\x3eexecsnoop\x3c\/code\x3e 和 \x3ccode\x3eopensnoop\x3c\/code\x3e 这样的工具会将每个事件打印一行。上图显示 \x3ccode\x3efile(1)\x3c\/code\x3e 命令当前打开（或尝试打开）的文件：返回的文件描述符（“FD” 列）对于 \x3ccode\x3e\/etc\/magic.mgc\x3c\/code\x3e 是 -1，而 “ERR” 列指示它是“文件未找到”。我不知道该文件，也不知道 \x3ccode\x3efile(1)\x3c\/code\x3e 正在读取的 \x3ccode\x3e\/usr\/share\/misc\/magic.mgc\x3c\/code\x3e 文件是什么。我不应该感到惊讶，但是 \x3ccode\x3efile(1)\x3c\/code\x3e 在识别文件类型时没有问题：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs gradle\x22\x3e# \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e \x3cspan class=\x22hljs-regexp\x22\x3e\/usr\/\x3c\/span\x3eshare\x3cspan class=\x22hljs-regexp\x22\x3e\/misc\/m\x3c\/span\x3eagic.mgc \x3cspan class=\x22hljs-regexp\x22\x3e\/etc\/m\x3c\/span\x3eagic\n\x3cspan class=\x22hljs-regexp\x22\x3e\/usr\/\x3c\/span\x3eshare\x3cspan class=\x22hljs-regexp\x22\x3e\/misc\/m\x3c\/span\x3eagic.mgc: magic binary \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) cmd (version \x3cspan class=\x22hljs-number\x22\x3e14\x3c\/span\x3e) (little endian)\n\x3cspan class=\x22hljs-regexp\x22\x3e\/etc\/m\x3c\/span\x3eagic:                magic text \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) cmd, ASCII text\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3ccode\x3eopensnoop\x3c\/code\x3e 通过跟踪 \x3ccode\x3eopen()\x3c\/code\x3e 系统调用来工作。为什么不使用 \x3ccode\x3estrace -feopen file\x3c\/code\x3e 命令呢？ 在这种情况下是可以的。然而，\x3ccode\x3eopensnoop\x3c\/code\x3e 的一些优点在于它能在系统范围内工作，并且跟踪所有进程的 \x3ccode\x3eopen()\x3c\/code\x3e 系统调用。注意上例的输出中包括了从 systemd 打开的文件。\x3ccode\x3eopensnoop\x3c\/code\x3e 应该系统开销更低：BPF 跟踪已经被优化过，而当前版本的 \x3ccode\x3estrace(1)\x3c\/code\x3e 仍然使用较老和较慢的 \x3ccode\x3eptrace(2)\x3c\/code\x3e 接口。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#3-xfsslower\x22\x3e\x3c\/a\x3e3、 xfsslower\x3c\/h4\x3e\n\x3cp\x3ebcc\/BPF 不仅仅可以分析系统调用。\x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/xfsslower.py\x22\x3exfsslower\x3c\/a\x3e 工具可以跟踪大于 1 毫秒（参数）延迟的常见 XFS 文件系统操作。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs tap\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# \/usr\/share\/bcc\/tools\/xfsslower 1\x3c\/span\x3e\nTracing XFS operations slower than\x3cspan class=\x22hljs-number\x22\x3e 1 \x3c\/span\x3ems\nTIME     COMM           PID    T BYTES   OFF_KB   LAT(ms) FILENAME\n14:17:34 systemd-journa\x3cspan class=\x22hljs-number\x22\x3e 530 \x3c\/span\x3e   S\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.69 system.journal\n14:17:35 auditd        \x3cspan class=\x22hljs-number\x22\x3e 651 \x3c\/span\x3e   S\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          2.43 audit.log\n14:17:42 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4167 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 52976 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.04 at\n14:17:45 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 53264 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.62 [\n14:17:45 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 65536 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.01 certutil\n14:17:45 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 65536 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.01 dir\n14:17:45 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 65536 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.17 dirmngr-client\n14:17:46 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 65536 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e          1.06 grub2-file\n14:17:46 cksum         \x3cspan class=\x22hljs-number\x22\x3e 4168 \x3c\/span\x3e  R\x3cspan class=\x22hljs-number\x22\x3e 65536 \x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e 128 \x3c\/span\x3e        1.01 grub2-fstest\n[...]\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在上图输出中，我捕获到了多个延迟超过 1 毫秒 的 \x3ccode\x3ecksum(1)\x3c\/code\x3e 读取操作（字段 “T” 等于 “R”）。这是在 \x3ccode\x3exfsslower\x3c\/code\x3e 工具运行的时候，通过在 XFS 中动态地检测内核函数实现的，并当它结束的时候解除该检测。这个 bcc 工具也有其它文件系统的版本：\x3ccode\x3eext4slower\x3c\/code\x3e、\x3ccode\x3ebtrfsslower\x3c\/code\x3e、\x3ccode\x3ezfsslower\x3c\/code\x3e 和 \x3ccode\x3enfsslower\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e这是个有用的工具，也是 BPF 追踪的重要例子。对文件系统性能的传统分析主要集中在块 I\/O 统计信息 —— 通常你看到的是由 \x3ccode\x3eiostat(1)\x3c\/code\x3e 工具输出，并由许多性能监视 GUI 绘制的图表。这些统计数据显示的是磁盘如何执行，而不是真正的文件系统如何执行。通常比起磁盘来说，你更关心的是文件系统的性能，因为应用程序是在文件系统中发起请求和等待。并且，文件系统的性能可能与磁盘的性能大为不同！文件系统可以完全从内存缓存中读取数据，也可以通过预读算法和回写缓存来填充缓存。\x3ccode\x3exfsslower\x3c\/code\x3e 显示了文件系统的性能 —— 这是应用程序直接体验到的性能。通常这对于排除整个存储子系统的问题是有用的；如果确实没有文件系统延迟，那么性能问题很可能是在别处。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#4-biolatency\x22\x3e\x3c\/a\x3e4、 biolatency\x3c\/h4\x3e\n\x3cp\x3e虽然文件系统性能对于理解应用程序性能非常重要，但研究磁盘性能也是有好处的。当各种缓存技巧都无法挽救其延迟时，磁盘的低性能终会影响应用程序。 磁盘性能也是容量规划研究的目标。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eiostat(1)\x3c\/code\x3e 工具显示了平均磁盘 I\/O 延迟，但平均值可能会引起误解。 以直方图的形式研究 I\/O 延迟的分布是有用的，这可以通过使用 [biolatency] 来实现\x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/biolatency.py\x22\x3e18\x3c\/a\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs tap\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# \/usr\/share\/bcc\/tools\/biolatency\x3c\/span\x3e\nTracing block device I\/O... Hit Ctrl-C to end.\n^C\n     usecs               : count     distribution\n        \x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 1 \x3c\/span\x3e         :\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e       |                                        |\n        \x3cspan class=\x22hljs-number\x22\x3e 2 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 3 \x3c\/span\x3e         :\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e       |                                        |\n        \x3cspan class=\x22hljs-number\x22\x3e 4 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 7 \x3c\/span\x3e         :\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e       |                                        |\n        \x3cspan class=\x22hljs-number\x22\x3e 8 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 15 \x3c\/span\x3e        :\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e       |                                        |\n       \x3cspan class=\x22hljs-number\x22\x3e 16 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 31 \x3c\/span\x3e        :\x3cspan class=\x22hljs-number\x22\x3e 0 \x3c\/span\x3e       |                                        |\n       \x3cspan class=\x22hljs-number\x22\x3e 32 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 63 \x3c\/span\x3e        :\x3cspan class=\x22hljs-number\x22\x3e 1 \x3c\/span\x3e       |                                        |\n       \x3cspan class=\x22hljs-number\x22\x3e 64 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 127 \x3c\/span\x3e       :\x3cspan class=\x22hljs-number\x22\x3e 63 \x3c\/span\x3e      |****                                    |\n      \x3cspan class=\x22hljs-number\x22\x3e 128 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 255 \x3c\/span\x3e       :\x3cspan class=\x22hljs-number\x22\x3e 121 \x3c\/span\x3e     |*********                               |\n      \x3cspan class=\x22hljs-number\x22\x3e 256 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 511 \x3c\/span\x3e       :\x3cspan class=\x22hljs-number\x22\x3e 483 \x3c\/span\x3e     |************************************    |\n      \x3cspan class=\x22hljs-number\x22\x3e 512 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 1023 \x3c\/span\x3e      :\x3cspan class=\x22hljs-number\x22\x3e 532 \x3c\/span\x3e     |****************************************|\n     \x3cspan class=\x22hljs-number\x22\x3e 1024 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 2047 \x3c\/span\x3e      :\x3cspan class=\x22hljs-number\x22\x3e 117 \x3c\/span\x3e     |********                                |\n     \x3cspan class=\x22hljs-number\x22\x3e 2048 \x3c\/span\x3e-\x26gt;\x3cspan class=\x22hljs-number\x22\x3e 4095 \x3c\/span\x3e      :\x3cspan class=\x22hljs-number\x22\x3e 8 \x3c\/span\x3e       |                                        |\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这是另一个有用的工具和例子；它使用一个名为 maps 的 BPF 特性，它可以用来实现高效的内核摘要统计。从内核层到用户层的数据传输仅仅是“计数”列。 用户级程序生成其余的。\x3c\/p\x3e\n\x3cp\x3e值得注意的是，这种工具大多支持 CLI 选项和参数，如其使用信息所示：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stata\x22\x3e# \/usr\/share\/bcc\/tools\/biolatency -\x3cspan class=\x22hljs-built_in\x22\x3eh\x3c\/span\x3e\nusage: biolatency [-\x3cspan class=\x22hljs-keyword\x22\x3eh\x3c\/span\x3e] [-T] [-Q] [-\x3cspan class=\x22hljs-keyword\x22\x3em\x3c\/span\x3e] [-\x3cspan class=\x22hljs-keyword\x22\x3eD\x3c\/span\x3e] [interval] [\x3cspan class=\x22hljs-keyword\x22\x3ecount\x3c\/span\x3e]\n\n\x3cspan class=\x22hljs-keyword\x22\x3eSummarize\x3c\/span\x3e block device I\/O latency \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e a \x3cspan class=\x22hljs-keyword\x22\x3ehistogram\x3c\/span\x3e\n\npositional arguments:\n  interval            output interval, \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e seconds\n  \x3cspan class=\x22hljs-keyword\x22\x3ecount\x3c\/span\x3e               number of outputs\n\noptional arguments:\n  -\x3cspan class=\x22hljs-keyword\x22\x3eh\x3c\/span\x3e, --\x3cspan class=\x22hljs-keyword\x22\x3ehelp\x3c\/span\x3e          show this \x3cspan class=\x22hljs-keyword\x22\x3ehelp\x3c\/span\x3e message and \x3cspan class=\x22hljs-keyword\x22\x3eexit\x3c\/span\x3e\n  -T, --timestamp     \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e timestamp \x3cspan class=\x22hljs-keyword\x22\x3eon\x3c\/span\x3e output\n  -Q, --queued        \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e OS queued time \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e I\/O time\n  -\x3cspan class=\x22hljs-keyword\x22\x3em\x3c\/span\x3e, --milliseconds  millisecond \x3cspan class=\x22hljs-keyword\x22\x3ehistogram\x3c\/span\x3e\n  -\x3cspan class=\x22hljs-keyword\x22\x3eD\x3c\/span\x3e, --disks         \x3cspan class=\x22hljs-keyword\x22\x3eprint\x3c\/span\x3e a \x3cspan class=\x22hljs-keyword\x22\x3ehistogram\x3c\/span\x3e per disk device\n\nexamples:\n    .\/biolatency            # \x3cspan class=\x22hljs-keyword\x22\x3esummarize\x3c\/span\x3e block I\/O latency \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e a \x3cspan class=\x22hljs-keyword\x22\x3ehistogram\x3c\/span\x3e\n    .\/biolatency 1 10       # \x3cspan class=\x22hljs-keyword\x22\x3eprint\x3c\/span\x3e 1 second summaries, 10 times\n    .\/biolatency -mT 1      # 1s summaries, milliseconds, and timestamps\n    .\/biolatency -Q         # \x3cspan class=\x22hljs-keyword\x22\x3einclude\x3c\/span\x3e OS queued time \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e I\/O time\n    .\/biolatency -\x3cspan class=\x22hljs-keyword\x22\x3eD\x3c\/span\x3e         # show each disk device separately\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e它们的行为就像其它 Unix 工具一样，以利于采用而设计。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#5-tcplife\x22\x3e\x3c\/a\x3e5、 tcplife\x3c\/h4\x3e\n\x3cp\x3e另一个有用的工具是 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/tcplife.py\x22\x3etcplife\x3c\/a\x3e ，该例显示 TCP 会话的生命周期和吞吐量统计。\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e# \/usr\/share\/bcc\/tools\/tcplife\nPID   COMM       LADDR           LPORT RADDR           RPORT TX_KB RX_KB MS\n\x3cspan class=\x22hljs-number\x22\x3e12759\x3c\/span\x3e sshd       \x3cspan class=\x22hljs-number\x22\x3e192.168\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.56\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.101\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e22\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e192.168\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.56\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e60639\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1863.82\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12783\x3c\/span\x3e sshd       \x3cspan class=\x22hljs-number\x22\x3e192.168\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.56\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.101\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e22\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e192.168\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.56\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e60640\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e     \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e9174.53\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12844\x3c\/span\x3e wget       \x3cspan class=\x22hljs-number\x22\x3e10.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.2\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.15\x3c\/span\x3e       \x3cspan class=\x22hljs-number\x22\x3e34250\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e54.204\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.39\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.132\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e443\x3c\/span\x3e      \x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e1870\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e5712.26\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e12851\x3c\/span\x3e curl       \x3cspan class=\x22hljs-number\x22\x3e10.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.2\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.15\x3c\/span\x3e       \x3cspan class=\x22hljs-number\x22\x3e34252\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e54.204\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.39\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.132\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e443\x3c\/span\x3e       \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e    \x3cspan class=\x22hljs-number\x22\x3e74\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e505.90\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在你说 “我不是可以只通过 \x3ccode\x3etcpdump(8)\x3c\/code\x3e 就能输出这个？” 之前请注意，运行 \x3ccode\x3etcpdump(8)\x3c\/code\x3e 或任何数据包嗅探器，在高数据包速率的系统上的开销会很大，即使 \x3ccode\x3etcpdump(8)\x3c\/code\x3e 的用户层和内核层机制已经过多年优化（要不可能更差）。\x3ccode\x3etcplife\x3c\/code\x3e 不会测试每个数据包；它只会有效地监视 TCP 会话状态的变化，并由此得到该会话的持续时间。它还使用已经跟踪了吞吐量的内核计数器，以及进程和命令信息（“PID” 和 “COMM” 列），这些对于 \x3ccode\x3etcpdump(8)\x3c\/code\x3e 等线上嗅探工具是做不到的。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#6-gethostlatency\x22\x3e\x3c\/a\x3e6、 gethostlatency\x3c\/h4\x3e\n\x3cp\x3e之前的每个例子都涉及到内核跟踪，所以我至少需要一个用户级跟踪的例子。 这就是 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/gethostlatency.py\x22\x3egethostlatency\x3c\/a\x3e，它检测用于名称解析的 \x3ccode\x3egethostbyname(3)\x3c\/code\x3e 和相关的库调用：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs less\x22\x3e# \/\x3cspan class=\x22hljs-selector-tag\x22\x3eusr\x3c\/span\x3e\/\x3cspan class=\x22hljs-selector-tag\x22\x3eshare\x3c\/span\x3e\/\x3cspan class=\x22hljs-selector-tag\x22\x3ebcc\x3c\/span\x3e\/\x3cspan class=\x22hljs-selector-tag\x22\x3etools\x3c\/span\x3e\/\x3cspan class=\x22hljs-selector-tag\x22\x3egethostlatency\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3eTIME\x3c\/span\x3e      \x3cspan class=\x22hljs-selector-tag\x22\x3ePID\x3c\/span\x3e    \x3cspan class=\x22hljs-selector-tag\x22\x3eCOMM\x3c\/span\x3e                  \x3cspan class=\x22hljs-selector-tag\x22\x3eLATms\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eHOST\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:43\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:33\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12903\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                 \x3cspan class=\x22hljs-selector-tag\x22\x3e188\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.98\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.com\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:43\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:36\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12905\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                   \x3cspan class=\x22hljs-selector-tag\x22\x3e8\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.45\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.com\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:43\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:40\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12907\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                   \x3cspan class=\x22hljs-selector-tag\x22\x3e6\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.55\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.com\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:43\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:44\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12911\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                   \x3cspan class=\x22hljs-selector-tag\x22\x3e9\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.67\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.com\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:45\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:02\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12948\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                  \x3cspan class=\x22hljs-selector-tag\x22\x3e19\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.66\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cats\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:45\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:06\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12950\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                  \x3cspan class=\x22hljs-selector-tag\x22\x3e18\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.37\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cats\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:45\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:07\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e12952\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                  \x3cspan class=\x22hljs-selector-tag\x22\x3e13\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.64\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cats\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3e06\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:45\x3c\/span\x3e\x3cspan class=\x22hljs-selector-pseudo\x22\x3e:19\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3e13139\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecurl\x3c\/span\x3e                  \x3cspan class=\x22hljs-selector-tag\x22\x3e13\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.10\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eopensource\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cats\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e是的，总是有 DNS 请求，所以有一个工具来监视系统范围内的 DNS 请求会很方便（这只有在应用程序使用标准系统库时才有效）。看看我如何跟踪多个对 “opensource.com” 的查找？ 第一个是 188.98 毫秒，然后更快，不到 10 毫秒，毫无疑问，这是缓存的作用。它还追踪多个对 “opensource.cats” 的查找，一个不存在的可怜主机名，但我们仍然可以检查第一个和后续查找的延迟。（第二次查找后是否有一些否定缓存的影响？）\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22#7-trace\x22\x3e\x3c\/a\x3e7、 trace\x3c\/h4\x3e\n\x3cp\x3e好的，再举一个例子。 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/trace.py\x22\x3etrace\x3c\/a\x3e 工具由 Sasha Goldshtein 提供，并提供了一些基本的 \x3ccode\x3eprintf(1)\x3c\/code\x3e 功能和自定义探针。 例如：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs autoit\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e# \/usr\/share\/bcc\/tools\/trace \x3cspan class=\x22hljs-string\x22\x3e\x27pam:pam_start \x22%s: %s\x22, arg1, arg2\x27\x3c\/span\x3e\x3c\/span\x3e\nPID    TID    COMM         \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFUNC\x3c\/span\x3e             -\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e13266\x3c\/span\x3e  \x3cspan class=\x22hljs-number\x22\x3e13266\x3c\/span\x3e  sshd         pam_start        sshd: root\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在这里，我正在跟踪 \x3ccode\x3elibpam\x3c\/code\x3e 及其 \x3ccode\x3epam_start(3)\x3c\/code\x3e 函数，并将其两个参数都打印为字符串。 \x3ccode\x3elibpam\x3c\/code\x3e 用于插入式身份验证模块系统，该输出显示 sshd 为 “root” 用户调用了 \x3ccode\x3epam_start()\x3c\/code\x3e（我登录了）。 其使用信息中有更多的例子（\x3ccode\x3etrace -h\x3c\/code\x3e），而且所有这些工具在 bcc 版本库中都有手册页和示例文件。 例如 \x3ccode\x3etrace_example.txt\x3c\/code\x3e 和 \x3ccode\x3etrace.8\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#通过包安装-bcc\x22\x3e\x3c\/a\x3e通过包安装 bcc\x3c\/h3\x3e\n\x3cp\x3e安装 bcc 最佳的方法是从 iovisor 仓储库中安装，按照 bcc 的 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/INSTALL.md#fedora---binary\x22\x3eINSTALL.md\x3c\/a\x3e 进行即可。\x3ca href=\x22https:\/\/www.iovisor.org\/\x22\x3eIO Visor\x3c\/a\x3e 是包括了 bcc 的 Linux 基金会项目。4.x 系列 Linux 内核中增加了这些工具所使用的 BPF 增强功能，直到 4.9 添加了全部支持。这意味着拥有 4.8 内核的 Fedora 25 可以运行这些工具中的大部分。 使用 4.11 内核的 Fedora 26 可以全部运行它们（至少在目前是这样）。\x3c\/p\x3e\n\x3cp\x3e如果你使用的是 Fedora 25（或者 Fedora 26，而且这个帖子已经在很多个月前发布了 —— 你好，来自遥远的过去！），那么这个通过包安装的方式是可以工作的。 如果您使用的是 Fedora 26，那么请跳至“通过源代码安装”部分，它避免了一个\x3ca href=\x22https:\/\/reviews.llvm.org\/rL302055\x22\x3e已修复的\x3c\/a\x3e的\x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/issues\/1221\x22\x3e已知\x3c\/a\x3e错误。 这个错误修复目前还没有进入 Fedora 26 软件包的依赖关系。 我使用的系统是：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs llvm\x22\x3e# uname -a\nLinux localhost.localdomain \x3cspan class=\x22hljs-number\x22\x3e4.11\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-300\x3c\/span\x3e.fc\x3cspan class=\x22hljs-number\x22\x3e26\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e86\x3c\/span\x3e_\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e \x3cspan class=\x22hljs-symbol\x22\x3e#1\x3c\/span\x3e SMP Thu Jun \x3cspan class=\x22hljs-number\x22\x3e29\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e20\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e09\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e48\x3c\/span\x3e UTC \x3cspan class=\x22hljs-number\x22\x3e2017\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e86\x3c\/span\x3e_\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e86\x3c\/span\x3e_\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ex\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e86\x3c\/span\x3e_\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e GNU\/Linux\n# cat \/etc\/fedora-\x3cspan class=\x22hljs-keyword\x22\x3erelease\x3c\/span\x3e\nFedora \x3cspan class=\x22hljs-keyword\x22\x3erelease\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e26\x3c\/span\x3e (Twenty Six)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e以下是我所遵循的安装步骤，但请参阅 INSTALL.md 获取更新的版本：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e -e \x3cspan class=\x22hljs-string\x22\x3e\x27[iovisor]\\nbaseurl=https:\/\/repo.iovisor.org\/yum\/nightly\/f25\/$basearch\\nenabled=1\\ngpgcheck=0\x27\x3c\/span\x3e | sudo tee \/etc\/yum.repos.d\/iovisor.repo\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e dnf install bcc-tools\x3c\/span\x3e\n[...]\nTotal download size: 37 M\nInstalled size: 143 M\nIs this ok [y\/N]: y\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e安装完成后，您可以在 \x3ccode\x3e\/usr\/share\x3c\/code\x3e 中看到新的工具：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs mipsasm\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# ls \/usr\/share\/bcc\/tools\/\x3c\/span\x3e\nargdist       dcsnoop              killsnoop       softirqs    trace\n\x3cspan class=\x22hljs-keyword\x22\x3ebashreadline \x3c\/span\x3e dcstat               \x3cspan class=\x22hljs-keyword\x22\x3ellcstat \x3c\/span\x3e        solisten    ttysnoop\n[...]\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e试着运行其中一个：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs livecodeserver\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e# \/usr\/share\/bcc\/tools\/opensnoop\x3c\/span\x3e\nchdir(\/lib\/modules\/\x3cspan class=\x22hljs-number\x22\x3e4.11\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.8\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-300.\x3c\/span\x3efc26.x86_64\/build): No such \x3cspan class=\x22hljs-built_in\x22\x3efile\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eor\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edirectory\x3c\/span\x3e\nTraceback (most recent call \x3cspan class=\x22hljs-keyword\x22\x3elast\x3c\/span\x3e):\n  File \x3cspan class=\x22hljs-string\x22\x3e\x22\/usr\/share\/bcc\/tools\/opensnoop\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eline\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e126\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e \n    b = BPF(\x3cspan class=\x22hljs-keyword\x22\x3etext\x3c\/span\x3e=bpf_text)\n  File \x3cspan class=\x22hljs-string\x22\x3e\x22\/usr\/lib\/python3.6\/site-packages\/bcc\/__init__.py\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eline\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e284\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e __init__\n    raise Exception(\x3cspan class=\x22hljs-string\x22\x3e\x22Failed to compile BPF module %s\x22\x3c\/span\x3e % src_file)\nException: Failed \x3cspan class=\x22hljs-built_in\x22\x3eto\x3c\/span\x3e compile BPF module\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e运行失败，提示 \x3ccode\x3e\/lib\/modules\/4.11.8-300.fc26.x86_64\/build\x3c\/code\x3e 丢失。 如果你也遇到这个问题，那只是因为系统缺少内核头文件。 如果你看看这个文件指向什么（这是一个符号链接），然后使用 \x3ccode\x3ednf whatprovides\x3c\/code\x3e 来搜索它，它会告诉你接下来需要安装的包。 对于这个系统，它是：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs css\x22\x3e# \x3cspan class=\x22hljs-selector-tag\x22\x3ednf\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3einstall\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekernel-devel-4\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.11\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.8-300\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.fc26\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.x86_64\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-attr\x22\x3e[...]\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3eTotal\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3edownload\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3esize\x3c\/span\x3e: 20 \x3cspan class=\x22hljs-selector-tag\x22\x3eM\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3eInstalled\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3esize\x3c\/span\x3e: 63 \x3cspan class=\x22hljs-selector-tag\x22\x3eM\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3eIs\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ethis\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3eok\x3c\/span\x3e \x3cspan class=\x22hljs-selector-attr\x22\x3e[y\/N]\x3c\/span\x3e: \x3cspan class=\x22hljs-selector-tag\x22\x3ey\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-attr\x22\x3e[...]\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e# \/usr\/share\/bcc\/tools\/opensnoop\nPID    COMM               FD ERR PATH\n\x3cspan class=\x22hljs-number\x22\x3e11792\x3c\/span\x3e  ls                  \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/etc\/ld.so.cache\n\x3cspan class=\x22hljs-number\x22\x3e11792\x3c\/span\x3e  ls                  \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libselinux.so\x3cspan class=\x22hljs-number\x22\x3e.1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e11792\x3c\/span\x3e  ls                  \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libcap.so\x3cspan class=\x22hljs-number\x22\x3e.2\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e11792\x3c\/span\x3e  ls                  \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libc.so\x3cspan class=\x22hljs-number\x22\x3e.6\x3c\/span\x3e\n[...]\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e运行起来了。 这是捕获自另一个窗口中的 ls 命令活动。 请参阅前面的部分以使用其它有用的命令。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#通过源码安装\x22\x3e\x3c\/a\x3e通过源码安装\x3c\/h3\x3e\n\x3cp\x3e如果您需要从源代码安装，您还可以在 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/INSTALL.md#fedora---source\x22\x3eINSTALL.md\x3c\/a\x3e 中找到文档和更新说明。 我在 Fedora 26 上做了如下的事情：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs sql\x22\x3esudo dnf \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e -y bison cmake ethtool flex git iperf libstdc\x2b\x2b-\x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e \\\n  python-netaddr python-pip gcc gcc-c\x2b\x2b make zlib-devel \\\n  elfutils-libelf-devel\nsudo dnf \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e -y luajit luajit-devel  # \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e Lua support\nsudo dnf \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e -y \\\n  \x3cspan class=\x22hljs-keyword\x22\x3ehttp\x3c\/span\x3e:\/\/pkgs.repoforge.org\/netperf\/netperf\x3cspan class=\x22hljs-number\x22\x3e-2.6\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-1.\x3c\/span\x3eel6.rf.x86_64.rpm\nsudo pip \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e pyroute2\nsudo dnf \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e -y clang clang-devel llvm llvm-devel llvm-\x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e ncurses-devel\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e除 \x3ccode\x3enetperf\x3c\/code\x3e 外一切妥当，其中有以下错误：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs livecodeserver\x22\x3eCurl error (\x3cspan class=\x22hljs-number\x22\x3e28\x3c\/span\x3e): Timeout was reached \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ehttp\x3c\/span\x3e:\/\/pkgs.repoforge.org\/netperf\/netperf\x3cspan class=\x22hljs-number\x22\x3e-2.6\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e.0\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e-1.\x3c\/span\x3eel6.rf.x86_64.rpm [Connection timed out \x3cspan class=\x22hljs-keyword\x22\x3eafter\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e120002\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3emilliseconds\x3c\/span\x3e]\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e不必理会，\x3ccode\x3enetperf\x3c\/code\x3e 是可选的，它只是用于测试，而 bcc 没有它也会编译成功。\x3c\/p\x3e\n\x3cp\x3e以下是余下的 bcc 编译和安装步骤：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs jboss-cli\x22\x3egit clone https:\x3cspan class=\x22hljs-string\x22\x3e\/\/github.com\/iovisor\/bcc.git\x3c\/span\x3e\nmkdir bcc\/build; \x3cspan class=\x22hljs-keyword\x22\x3ecd\x3c\/span\x3e bcc\/build\ncmake \x3cspan class=\x22hljs-string\x22\x3e..\x3c\/span\x3e -DCMAKE_INSTALL_PREFIX=\x3cspan class=\x22hljs-string\x22\x3e\/usr\x3c\/span\x3e\nmake\nsudo make install\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e现在，命令应该可以工作了：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lsl\x22\x3e# \/usr\/share\/bcc\/tools\/opensnoop\nPID    COMM               FD ERR PATH\n\x3cspan class=\x22hljs-number\x22\x3e4131\x3c\/span\x3e   date                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/etc\/ld.so.cache\n\x3cspan class=\x22hljs-number\x22\x3e4131\x3c\/span\x3e   date                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/lib64\/libc.so\x3cspan class=\x22hljs-number\x22\x3e.6\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e4131\x3c\/span\x3e   date                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/usr\/lib\/locale\/locale-archive\n\x3cspan class=\x22hljs-number\x22\x3e4131\x3c\/span\x3e   date                \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e   \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e \/etc\/localtime\n[...]\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch3\x3e\x3ca href=\x22#写在最后和其他的前端\x22\x3e\x3c\/a\x3e写在最后和其他的前端\x3c\/h3\x3e\n\x3cp\x3e这是一个可以在 Fedora 和 Red Hat 系列操作系统上使用的新 BPF 性能分析强大功能的快速浏览。我演示了 BPF 的流行前端 \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\x22\x3ebcc\x3c\/a\x3e ，并包括了其在 Fedora 上的安装说明。bcc 附带了 60 多个用于性能分析的新工具，这将帮助您充分利用 Linux 系统。也许你会直接通过 SSH 使用这些工具，或者一旦 GUI 监控程序支持 BPF 的话，你也可以通过它们来使用相同的功能。\x3c\/p\x3e\n\x3cp\x3e此外，bcc 并不是正在开发的唯一前端。\x3ca href=\x22https:\/\/github.com\/iovisor\/ply\x22\x3eply\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/github.com\/ajor\/bpftrace\x22\x3ebpftrace\x3c\/a\x3e，旨在为快速编写自定义工具提供更高级的语言支持。此外，\x3ca href=\x22https:\/\/sourceware.org\/systemtap\/\x22\x3eSystemTap\x3c\/a\x3e 刚刚发布\x3ca href=\x22https:\/\/sourceware.org\/ml\/systemtap\/2017-q4\/msg00096.html\x22\x3e版本3.2\x3c\/a\x3e，包括一个早期的实验性 eBPF 后端。 如果这个继续开发，它将为运行多年来开发的许多 SystemTap 脚本和 tapset（库）提供一个安全和高效的生产级引擎。（随同 eBPF 使用 SystemTap 将是另一篇文章的主题。）\x3c\/p\x3e\n\x3cp\x3e如果您需要开发自定义工具，那么也可以使用 bcc 来实现，尽管语言比 SystemTap、ply 或 bpftrace 要冗长得多。我的 bcc 工具可以作为代码示例，另外我还贡献了用 Python 开发 bcc 工具的\x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/docs\/tutorial_bcc_python_developer.md\x22\x3e教程\x3c\/a\x3e。 我建议先学习 bcc 的 multi-tools，因为在需要编写新工具之前，你可能会从里面获得很多经验。 您可以从它们的 bcc 存储库[funccount] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/funccount_example.txt\x22\x3e34\x3c\/a\x3e，[funclatency] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/funclatency_example.txt\x22\x3e35\x3c\/a\x3e，[funcslower] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/funcslower_example.txt\x22\x3e36\x3c\/a\x3e，[stackcount] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/stackcount_example.txt\x22\x3e37\x3c\/a\x3e，[trace] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/trace_example.txt\x22\x3e38\x3c\/a\x3e ，[argdist] \x3ca href=\x22https:\/\/github.com\/iovisor\/bcc\/blob\/master\/tools\/argdist_example.txt\x22\x3e39\x3c\/a\x3e 的示例文件中研究 bcc。\x3c\/p\x3e\n\x3cp\x3e感谢[Opensource.com] \x3ca href=\x22http:\/\/opensource.com\/\x22\x3e40\x3c\/a\x3e进行编辑。\x3c\/p\x3e\n\x3ch3\x3e\x3ca href=\x22#关于作者\x22\x3e\x3c\/a\x3e关于作者\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/opensource.com\/users\/brendang\x22\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t0121386fac38ad1e63.png\x22 alt=\x22Brendan Gregg\x22\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eBrendan Gregg 是 Netflix 的一名高级性能架构师，在那里他进行大规模的计算机性能设计、分析和调优。\x3c\/p\x3e\n\x3cp\x3e（题图：opensource.com）\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3evia:\x3ca href=\x22https:\/\/opensource.com\/article\/17\/11\/bccbpf-performance\x22\x3ehttps:\/\/opensource.com\/article\/17\/11\/bccbpf-performance\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e作者：\x3ca href=\x22https:\/\/opensource.com\/users\/brendang\x22\x3eBrendan Gregg\x3c\/a\x3e 译者：\x3ca href=\x22https:\/\/github.com\/yongshouzhang\x22\x3eyongshouzhang\x3c\/a\x3e 校对：\x3ca href=\x22https:\/\/github.com\/wxy\x22\x3ewxy\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e本文由 \x3ca href=\x22https:\/\/github.com\/LCTT\/TranslateProject\x22\x3eLCTT\x3c\/a\x3e 原创编译，\x3ca href=\x22https:\/\/linux.cn\/\x22\x3eLinux中国\x3c\/a\x3e 荣誉推出\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>7 个使用 bcc/BPF 的性能分析神器</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/7-tools-for-analyzing-performance-in-linux-with-bccbpf">https://www.zcfy.cc/article/7-tools-for-analyzing-performance-in-linux-with-bccbpf</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/iksbk0p5k29/" target="_blank">https://alili.tech/archive/iksbk0p5k29/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>