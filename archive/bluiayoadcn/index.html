<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Redux异步方案选型"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Redux异步方案选型 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/bluiayoadcn/",
				"appid": "1613049289050283", 
				"title": "Redux异步方案选型 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-02T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/w8evjllqor/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/aa689xb61kr/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&text=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&text=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&title=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&is_video=false&description=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&title=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&title=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&title=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbluiayoadcn%2f&title=Redux%e5%bc%82%e6%ad%a5%e6%96%b9%e6%a1%88%e9%80%89%e5%9e%8b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Redux异步方案选型</h1><div class="meta"><div class="postdate"><time datetime="2019-02-02" itemprop="datePublished">2019-02-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e作为react社区最热门的状态管理框架，相信很多人都准备甚至正在使用Redux。\x3c\/p\x3e\n\x3cp\x3e由于Redux的理念非常精简，没有追求大而全，这份架构上的优雅却在某种程度上伤害了使用体验：不能开箱即用，甚至是异步这种最常见的场景也要借助社区方案。\x3c\/p\x3e\n\x3cp\x3e如果你已经挑花了眼，或者正在挑但不知道是否适合，或者已经挑了但不知道会不会有坑，这篇文章应该适合你。\x3c\/p\x3e\n\x3cp\x3e本文会从一些常见的Redux异步方案出发，介绍它们的优缺点，进而讨论一些与异步相伴的常见场景，帮助你在选型时更好地权衡利弊。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e简单方案\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eredux-thunk：指路先驱\x3c\/h3\x3e\n\x3cp\x3eGithub：\x3ca href=\x22https:\/\/github.com\/gaearon\/redux-thunk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/gaearon\/redux-thunk\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3eRedux作者Dan写的中间件，因官方文档出镜而广为人知。\x3c\/p\x3e\n\x3cp\x3e它向我们展示了Redux处理异步的原理，即:\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eRedux本身只能处理同步的Action，但可以通过中间件来拦截处理其它类型的action，比如函数(Thunk)，再用回调触发普通Action，从而实现异步处理，\x3cstrong\x3e在这点上所有Redux的异步方案都是类似的\x3c\/strong\x3e。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e而它使用起来最大的问题，就是重复的模板代码太多：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/action types\nconst GET_DATA = \x27GET_DATA\x27,\n    GET_DATA_SUCCESS = \x27GET_DATA_SUCCESS\x27,\n    GET_DATA_FAILED = \x27GET_DATA_FAILED\x27;\n    \n\/\/action creator\nconst getDataAction = function(id) {\n    return function(dispatch, getState) {\n        dispatch({\n            type: GET_DATA, \n            payload: id\n        })\n        api.getData(id) \/\/注：本文所有示例的api.getData都返回promise对象\n            .then(response =\x3e {\n                dispatch({\n                    type: GET_DATA_SUCCESS,\n                    payload: response\n                })\n            })\n            .catch(error =\x3e {\n                dispatch({\n                    type: GET_DATA_FAILED,\n                    payload: error\n                })\n            }) \n    }\n}\n\n\/\/reducer\nconst reducer = function(oldState, action) {\n    switch(action.type) {\n    case GET_DATA : \n        return oldState;\n    case GET_DATA_SUCCESS : \n        return successState;\n    case GET_DATA_FAILED : \n        return errorState;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/action types\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e GET_DATA = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA\x27\x3c\/span\x3e,\n    GET_DATA_SUCCESS = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA_SUCCESS\x27\x3c\/span\x3e,\n    GET_DATA_FAILED = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA_FAILED\x27\x3c\/span\x3e;\n    \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/action creator\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getDataAction = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch, getState\x3c\/span\x3e) \x3c\/span\x3e{\n        dispatch({\n            \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA, \n            \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: id\n        })\n        api.getData(id) \x3cspan class=\x22hljs-comment\x22\x3e\/\/注：本文所有示例的api.getData都返回promise对象\x3c\/span\x3e\n            .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                dispatch({\n                    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA_SUCCESS,\n                    \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: response\n                })\n            })\n            .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                dispatch({\n                    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA_FAILED,\n                    \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: error\n                })\n            }) \n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/reducer\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reducer = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA : \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e oldState;\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_SUCCESS : \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e successState;\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_FAILED : \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e errorState;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这已经是最简单的场景了，请注意：我们\x3cstrong\x3e甚至还没写一行业务逻辑\x3c\/strong\x3e，如果每个异步处理都像这样，重复且无意义的工作会变成明显的阻碍。\x3c\/p\x3e\n\x3cp\x3e另一方面，像\x3ccode\x3eGET_DATA_SUCCESS\x3c\/code\x3e、\x3ccode\x3eGET_DATA_FAILED\x3c\/code\x3e这样的字符串声明也非常无趣且易错。\x3c\/p\x3e\n\x3cp\x3e上例中，\x3ccode\x3eGET_DATA\x3c\/code\x3e这个action并不是多数场景需要的，它涉及我们将会提到的\x3ccode\x3e乐观更新\x3c\/code\x3e，保留这些代码是为了和下面的方案做对比\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eredux-promise：瘦身过头\x3c\/h3\x3e\n\x3cp\x3e由于\x3ccode\x3eredux-thunk\x3c\/code\x3e写起来实在是太麻烦了，社区当然会有其它轮子出现。\x3ca href=\x22https:\/\/github.com\/acdlite\/redux-promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise\x3c\/a\x3e则是其中比较知名的，同样也享受了官网\x3ca href=\x22http:\/\/redux.js.org\/docs\/advanced\/#connecting-to-ui\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e出镜\x3c\/a\x3e的待遇。\x3c\/p\x3e\n\x3cp\x3e它自定义了一个middleware，当检测到有action的payload属性是Promise对象时，就会：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e若resolve，触发一个此action的拷贝，但payload为promise的value，并设status属性为\x22success\x22\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e若reject，触发一个此action的拷贝，但payload为promise的reason，并设status属性为\x22error\x22\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e说起来可能有点不好理解，用代码感受下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/action types\nconst GET_DATA = \x27GET_DATA\x27;\n\n\/\/action creator\nconst getData = function(id) {\n    return {\n        type: GET_DATA,\n        payload: api.getData(id) \/\/payload为promise对象\n    }\n}\n\n\/\/reducer\nfunction reducer(oldState, action) {\n    switch(action.type) {\n    case GET_DATA: \n        if (action.status === \x27success\x27) {\n            return successState\n        } else {\n               return errorState\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/action types\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e GET_DATA = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/action creator\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getData = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: api.getData(id) \x3cspan class=\x22hljs-comment\x22\x3e\/\/payload为promise对象\x3c\/span\x3e\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/reducer\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA: \n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (action.status === \x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e) {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e successState\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n               \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e errorState\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e进步巨大! 代码量明显减少! 就用它了! ？\x3c\/p\x3e\n\x3cp\x3e请等等，\x3cstrong\x3e任何能明显减少代码量的方案，都应该小心它是否过度省略了什么东西\x3c\/strong\x3e，减肥是好事，减到骨头就残了。\x3c\/p\x3e\n\x3cp\x3eredux-promise为了精简而做出的妥协非常明显：\x3ca href=\x22https:\/\/github.com\/acdlite\/flux-standard-action\/issues\/7\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e无法处理乐观更新\x3c\/a\x3e\x3c\/p\x3e\n\x3ch4\x3e场景解析之：乐观更新\x3c\/h4\x3e\n\x3cp\x3e多数异步场景都是\x3ccode\x3e悲观更新\x3c\/code\x3e(求更好的翻译)的，即等到请求成功才渲染数据。而与之相对的\x3ccode\x3e乐观更新\x3c\/code\x3e，则是\x3cstrong\x3e不等待请求成功，在发送请求的同时立即渲染数据\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e最常见的例子就是微信等聊天工具，发送消息时消息\x3cstrong\x3e立即\x3c\/strong\x3e进入了对话窗，如果发送失败的话，在消息旁边再作补充提示即可。这种交互\x22乐观\x22地相信请求会成功，因此称作\x3ccode\x3e乐观更新\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e由于\x3ccode\x3e乐观更新\x3c\/code\x3e发生在用户操作时，要处理它，意味着\x3cstrong\x3e必须有action表示用户的初始动作\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在上面redux-thunk的例子中，我们看到了\x3ccode\x3eGET_DATA\x3c\/code\x3e, \x3ccode\x3eGET_DATA_SUCCESS\x3c\/code\x3e、\x3ccode\x3eGET_DATA_FAILED\x3c\/code\x3e三个action，分别表示\x3ccode\x3e初始动作\x3c\/code\x3e、\x3ccode\x3e异步成功\x3c\/code\x3e和\x3ccode\x3e异步失败\x3c\/code\x3e，其中第一个action使得redux-thunk具备乐观更新的能力。\x3c\/p\x3e\n\x3cp\x3e而在redux-promise中，最初触发的action被中间件拦截然后过滤掉了。原因很简单，redux认可的\x3ca href=\x22http:\/\/redux.js.org\/docs\/basics\/Actions.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eaction\x3c\/a\x3e对象是 \x3cem\x3eplain JavaScript objects\x3c\/em\x3e，即简单对象，而在redux-promise中，初始action的payload是个Promise。\x3c\/p\x3e\n\x3cp\x3e另一方面，使用\x3ccode\x3estatus\x3c\/code\x3e而不是\x3ccode\x3etype\x3c\/code\x3e来区分两个异步action也非常值得商榷，按照redux对action的定义以及社区的普遍实践，个人还是倾向于使用不同的type，用同一type下的不同status区分action额外增加了一套隐形的\x3ccode\x3e约定\x3c\/code\x3e，甚至不符合该redux-promise作者自己所提倡的\x3ccode\x3eFSA\x3c\/code\x3e，体现在代码上则是在switch-case内再增加一层判断。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eredux-promise-middleware：拔乱反正\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/pburtchaell\/redux-promise-middleware\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise-middleware\x3c\/a\x3e相比redux-promise，采取了更为温和和渐进式的思路，保留了和redux-thunk类似的三个action。\x3c\/p\x3e\n\x3cp\x3e示例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/action types\nconst GET_DATA = \x27GET_DATA\x27,\n    GET_DATA_PENDING = \x27GET_DATA_PENDING\x27,\n    GET_DATA_FULFILLED = \x27GET_DATA_FULFILLED\x27,\n    GET_DATA_REJECTED = \x27GET_DATA_REJECTED\x27;\n    \n\/\/action creator\nconst getData = function(id) {\n    return {\n        type: GET_DATA,\n        payload: {\n            promise: api.getData(id),\n            data: id\n        }\n    }\n}\n\n\/\/reducer\nconst reducer = function(oldState, action) {\n    switch(action.type) {\n    case GET_DATA_PENDING :\n        return oldState; \/\/ 可通过action.payload.data获取id\n    case GET_DATA_FULFILLED : \n        return successState;\n    case GET_DATA_REJECTED : \n        return errorState;\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/action types\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e GET_DATA = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA\x27\x3c\/span\x3e,\n    GET_DATA_PENDING = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA_PENDING\x27\x3c\/span\x3e,\n    GET_DATA_FULFILLED = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA_FULFILLED\x27\x3c\/span\x3e,\n    GET_DATA_REJECTED = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA_REJECTED\x27\x3c\/span\x3e;\n    \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/action creator\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getData = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3epromise\x3c\/span\x3e: api.getData(id),\n            \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: id\n        }\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/reducer\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reducer = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_PENDING :\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e oldState; \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 可通过action.payload.data获取id\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_FULFILLED : \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e successState;\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_REJECTED : \n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e errorState;\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果不需要乐观更新，action creator可以使用和redux-promise完全一样的，更简洁的写法，即：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const getData = function(id) {\n    return {\n        type: GET_DATA,\n        payload: api.getData(id) \/\/等价于 {promise: api.getData(id)}\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getData = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: GET_DATA,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: api.getData(id) \x3cspan class=\x22hljs-comment\x22\x3e\/\/等价于 {promise: api.getData(id)}\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时初始action\x3ccode\x3eGET_DATA_PENDING\x3c\/code\x3e仍然会触发，但是payload为空。\x3c\/p\x3e\n\x3cp\x3e相对redux-promise于粗暴地过滤掉整个初始action，redux-promise-middleware选择创建一个\x3cstrong\x3e只过滤payload中的promise属性\x3c\/strong\x3e的\x3ccode\x3eXXX_PENDING\x3c\/code\x3e作为初始action，以此保留乐观更新的能力。\x3c\/p\x3e\n\x3cp\x3e同时在action的区分上，它选择了回归\x3ccode\x3etype\x3c\/code\x3e的\x22正途\x22，\x3ccode\x3e_PENDING\x3c\/code\x3e、\x3ccode\x3e_FULFILLED \x3c\/code\x3e、\x3ccode\x3e_REJECTED\x3c\/code\x3e等后缀借用了promise规范 (当然它们是可配置的) 。\x3c\/p\x3e\n\x3cp\x3e它的遗憾则是只在action层实现了简化，对reducer层则束手无策。另外，相比redux-thunk，它还多出了一个\x3ccode\x3e_PENDING\x3c\/code\x3e的字符串模板代码(三个action却需要四个type)。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e社区有类似\x3ca href=\x22https:\/\/github.com\/tomatau\/type-to-reducer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3etype-to-reducer\x3c\/a\x3e这样试图简化reducer的库。但由于reducer和异步action通常是两套独立的方案，reducer相关的库无法去猜测异步action的后缀是什么(甚至有没有后缀)，社区也没有相关标准，也就很难对异步做出精简和抽象了。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3eredux-action-tools：软文预警\x3c\/h3\x3e\n\x3cp\x3e无论是\x3ccode\x3eredux-thunk\x3c\/code\x3e还是\x3ccode\x3eredux-promise-middleware\x3c\/code\x3e，模板代码都是显而易见的，每次写\x3ccode\x3eXXX_COMPLETED\x3c\/code\x3e这样的代码都觉得是在浪费生命——你得先在常量中声明它们，再在action中引用，然后是reducer，假设像\x3ccode\x3eredux-thunk\x3c\/code\x3e一样每个异步action有三个type，三个文件加起来你就得写九次! \x3c\/p\x3e\n\x3cp\x3e国外开发者也有相同的报怨：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVEzOz\x22 src=\x22https:\/\/static.alili.tech\/img\/bVEzOz\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e有没有办法让代码既像redux-promise一样简洁，又能保持乐观更新的能力呢？\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/kpaxqin\/redux-action-tools\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-action-tools\x3c\/a\x3e是我给出的答案：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const GET_DATA = \x27GET_DATA\x27;\n\n\/\/action creator\nconst getData = createAsyncAction(GET_DATA, function(id) {\n    return api.getData(id)\n})\n\n\/\/reducer\nconst reducer = createReducer()\n    .when(getData, (oldState, action) =\x3e oldState)\n    .done((oldState, action) =\x3e successState)\n    .failed((oldState, action) =\x3e errorState)\n    .build()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e GET_DATA = \x3cspan class=\x22hljs-string\x22\x3e\x27GET_DATA\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/action creator\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getData = createAsyncAction(GET_DATA, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e api.getData(id)\n})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/reducer\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e reducer = createReducer()\n    .when(getData, (oldState, action) =\x26gt; oldState)\n    .done(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e successState)\n    .failed(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e errorState)\n    .build()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eredux-action-tools在action层面做的事情与前面几个库大同小异：同样是派发了三个action：\x3ccode\x3eGET_DATA\x3c\/code\x3e\/\x3ccode\x3eGET_DATA_SUCCESS\x3c\/code\x3e\/\x3ccode\x3eGET_DATA_FAILED\x3c\/code\x3e。这三个action的描述见下表：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3etype\x3c\/th\x3e\n\x3cth\x3eWhen\x3c\/th\x3e\n\x3cth align=\x22center\x22\x3epayload\x3c\/th\x3e\n\x3cth align=\x22center\x22\x3emeta.asyncPhase\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e${actionName}\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e异步开始前\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e同步调用参数\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e\x27START\x27\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e${actionName}_COMPLETED\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e异步成功\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3evalue of promise\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e\x27COMPLETED\x27\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\x3ccode\x3e${actionName}_FAILED\x3c\/code\x3e\x3c\/td\x3e\n\x3ctd\x3e异步失败\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3ereason of promise\x3c\/td\x3e\n\x3ctd align=\x22center\x22\x3e\x27FAILED\x27\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e\x3ccode\x3ecreateAsyncAction\x3c\/code\x3e参考了redux-promise作者写的\x3ca href=\x22https:\/\/github.com\/acdlite\/redux-actions\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-actions\x3c\/a\x3e ，它接收三个参数，分别是：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eactionName \x3cem\x3e字符串\x3c\/em\x3e，所有派生action的名字都以它为基础，初始action则与它同名\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3epromiseCreator \x3cem\x3e函数\x3c\/em\x3e，必须返回一个promise对象\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emetaCreator \x3cem\x3e函数\x3c\/em\x3e，\x3cstrong\x3e可选\x3c\/strong\x3e，作用后面会演示到\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e目前看来，其实和redux-promise\/redux-promise-middleware大同小异。而真正不同的，是它同时简化了reducer层! 这种简化来自于对异步行为从语义角度的抽象：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e当(\x3cstrong\x3ewhen\x3c\/strong\x3e)初始action发生时处理同步更新，若异步成功(\x3cstrong\x3edone\x3c\/strong\x3e)则处理成功逻辑，若异步失败(\x3cstrong\x3efailed\x3c\/strong\x3e)则处理失败逻辑\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e抽离出\x3ccode\x3ewhen\x3c\/code\x3e\/\x3ccode\x3edone\x3c\/code\x3e\/\x3ccode\x3efailed\x3c\/code\x3e三个关键词作为api，并使用链式调用将他们串联起来：\x3ccode\x3ewhen\x3c\/code\x3e函数接收两个参数：actionName和handler，其中handler是可选的，\x3ccode\x3edone\x3c\/code\x3e和\x3ccode\x3efailed\x3c\/code\x3e则只接收一个handler参数，并且只能在\x3ccode\x3ewhen\x3c\/code\x3e之后调用——他们分别处理`${actionName}_SUCCESS` 和 `${actionName}_FAILED`.\x3c\/p\x3e\n\x3cp\x3e无论是action还是reducer层，\x3ccode\x3eXX_SUCCESS\x3c\/code\x3e\/\x3ccode\x3eXX_FAILED\x3c\/code\x3e相关的代码都被封装了起来，正如在例子中看到的——你甚至不需要声明它们! \x3cstrong\x3e创建一个异步action，然后处理它的成功和失败情况，事情本该这么简单。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e更进一步的，这三个action默认都根据当前所处的异步阶段，设置了不同的meta(见上表中的meta.asyncPhase)，它有什么用呢？用场景说话：\x3c\/p\x3e\n\x3ch4\x3e场景解析：失败处理与Loading\x3c\/h4\x3e\n\x3cp\x3e它们是异步不可回避的两个场景，几乎每个项目会遇到。\x3c\/p\x3e\n\x3cp\x3e以异步请求的失败处理为例，每个项目通常都有一套比较通用的，适合多数场景的处理逻辑，比如弹窗提示。同时在一些特定场景下，又需要绕过通用逻辑进行单独处理，比如表单的异步校验。\x3c\/p\x3e\n\x3cp\x3e而在实现通用处理逻辑时，常见的问题有以下几种：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e底层处理，扩展性不足\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function fetchWrapper(args) {\n    return fetch.apply(fetch, args)\n        .catch(commonErrorHandler)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchWrapper\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eargs\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch.apply(fetch, args)\n        .catch(commonErrorHandler)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在较底层封装ajax库可以轻松实现全局处理，但问题也非常明显：\x3c\/p\x3e\n\x3cp\x3e一是\x3cstrong\x3e扩展性不足\x3c\/strong\x3e，比如少数场景想要绕过通用处理逻辑，还有一些场景错误是前端生成而非直接来自于请求；\x3c\/p\x3e\n\x3cp\x3e二是\x3cstrong\x3e不易组合\x3c\/strong\x3e，比如有的场景一个action需要多个异步请求，但异常处理和loading是不需要重复的，因为用户不需要知道一个动作有多少个请求。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e不够内聚，侵入业务代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/action creator\nconst getData = createAsyncAction(GET_DATA, function(id) {\n    return api.getData(id)\n        .catch(commonErrorHandler) \/\/调用错误处理函数\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/action creator\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e getData = createAsyncAction(GET_DATA, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e api.getData(id)\n        .catch(commonErrorHandler) \x3cspan class=\x22hljs-comment\x22\x3e\/\/调用错误处理函数\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在有业务意义的action层调用通用处理逻辑，既能按需调用，又不妨碍异步请求的组合。但由于通用处理往往适用于\x3cstrong\x3e多数\x3c\/strong\x3e场景，这样写会导致业务代码变得冗余，因为几乎每个action都得这么写。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e高耦合，高风险\x3c\/p\x3e\n\x3cp\x3e也有人把上面的方案做个依赖反转，改为在通用逻辑里监听业务action：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function commonErrorReducer(oldState, action) {\n    switch(action.type) {\n    case GET_DATA_FAILED:\n    case PUT_DATA_FAILED:\n    \/\/... tons of action type\n        return commonErrorHandler(action)\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecommonErrorReducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eoldState, action\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e GET_DATA_FAILED:\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e PUT_DATA_FAILED:\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/... tons of action type\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e commonErrorHandler(action)\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样做的本质是把冗余从业务代码中拿出来集中管理。\x3c\/p\x3e\n\x3cp\x3e问题在于\x3cstrong\x3e每添加一个请求，都需要修改公共代码\x3c\/strong\x3e，把对应的action type加进来。且不说并行开发时merge冲突，如果加了一个异步action，但忘了往公共处理文件中添加——这是很可能会发生的——而异常是分支流程不容易被测试发现，等到发现，很可能就是事故而不是bug了。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e通过以上几种常见方案的分析，我认为比较完善的错误处理(Loading同理)需要具备如下特点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e面向异步动作(action)，而非直接面向请求\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不侵入业务代码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e默认使用通用处理逻辑，无需额外代码\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e可以绕过通用逻辑\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e而借助\x3ccode\x3eredux-action-tools\x3c\/code\x3e提供的\x3cem\x3emeta.asyncPhase\x3c\/em\x3e，可以轻易用middleware实现以上全部需求!\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import _ from \x27lodash\x27\nimport { ASYNC_PHASES } from \x27redux-action-tools\x27\n\nfunction errorMiddleWare({dispatch}) {\n  return next =\x3e action =\x3e {\n    const asyncStep = _.get(action, \x27meta.asyncStep\x27);\n\n    if (asyncStep === ASYNC_PHASES.FAILED) {\n      dispatch({\n        type: \x27COMMON_ERROR\x27,\n        payload: {\n          action\n        }\n      })\n    }\n    \n    next(action);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { ASYNC_PHASES } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-action-tools\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eerrorMiddleWare\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{dispatch}\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e =\x26gt;\x3c\/span\x3e action =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e asyncStep = _.get(action, \x3cspan class=\x22hljs-string\x22\x3e\x27meta.asyncStep\x27\x3c\/span\x3e);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (asyncStep === ASYNC_PHASES.FAILED) {\n      dispatch({\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27COMMON_ERROR\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n          action\n        }\n      })\n    }\n    \n    next(action);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上中间件一旦检测到\x3ccode\x3emeta.asyncStep\x3c\/code\x3e字段为\x3cem\x3eFAILED\x3c\/em\x3e的action便触发新的action去调用通用处理逻辑。面向action、不侵入业务、默认工作 (只要是用createAsyncAction声明的异步) ! 轻松实现了理想需求中的前三点，那如何定制呢？既然拦截是面向meta的，只要在创建action时支持对meta的自定义就行了，而\x3ccode\x3ecreateAsyncAction\x3c\/code\x3e的第三个参数就是为此准备的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import _ from \x27lodash\x27\nimport { ASYNC_PHASES } from \x27redux-action-tools\x27\n\nconst customizedAction = createAsyncAction(\n  type, \n  promiseCreator, \/\/type 和 promiseCreator此处无不同故省略\n  (payload, defaultMeta) =\x3e {\n    return { ...defaultMeta, omitError: true }; \/\/向meta中添加配置参数\n  }\n)\n\nfunction errorMiddleWare({dispatch}) {\n  return next =\x3e action =\x3e {\n    const asyncStep = _.get(action, \x27meta.asyncStep\x27);\n    const omitError = _.get(action, \x27meta.omitError\x27); \/\/获取配置参数\n\n    if (!omitError \x26amp;\x26amp; asyncStep === ASYNC_PHASES.FAILED) {\n      dispatch({\n        type: \x27COMMON_ERROR\x27,\n        payload: {\n          action\n        }\n      })\n    }\n    \n    next(action);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e _ \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27lodash\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { ASYNC_PHASES } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-action-tools\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e customizedAction = createAsyncAction(\n  type, \n  promiseCreator, \x3cspan class=\x22hljs-comment\x22\x3e\/\/type 和 promiseCreator此处无不同故省略\x3c\/span\x3e\n  (payload, defaultMeta) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { ...defaultMeta, \x3cspan class=\x22hljs-attr\x22\x3eomitError\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e }; \x3cspan class=\x22hljs-comment\x22\x3e\/\/向meta中添加配置参数\x3c\/span\x3e\n  }\n)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eerrorMiddleWare\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{dispatch}\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e =\x26gt;\x3c\/span\x3e action =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e asyncStep = _.get(action, \x3cspan class=\x22hljs-string\x22\x3e\x27meta.asyncStep\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e omitError = _.get(action, \x3cspan class=\x22hljs-string\x22\x3e\x27meta.omitError\x27\x3c\/span\x3e); \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取配置参数\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!omitError \x26amp;\x26amp; asyncStep === ASYNC_PHASES.FAILED) {\n      dispatch({\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27COMMON_ERROR\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: {\n          action\n        }\n      })\n    }\n    \n    next(action);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e类似的，你可以想想如何处理Loading，需要强调的是建议尽量用增量配置的方式进行扩展，而\x3cstrong\x3e不要轻易删除和修改meta.asyncPhase\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e比如上例可以通过删除\x3ccode\x3emeta.asyncPhase\x3c\/code\x3e实现同样功能，但如果同时还有其它地方也依赖\x3ccode\x3emeta.asyncPhase\x3c\/code\x3e(比如loadingMiddleware)，就可能导致本意是定制错误处理，却改变了Loading的行为，客观来讲\x3cstrong\x3e这层风险是基于meta拦截方案的最大缺点\x3c\/strong\x3e，然而相比多数场景的便利、健壮，个人认为特殊场景的风险是可以接受的，毕竟这些场景在整个开发测试流程容易获得更多关注。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e进阶方案\x3c\/h2\x3e\n\x3cp\x3e上面所有的方案，都把异步请求这一动作放在了action creator中，这样做的好处是简单直观，且和Flux社区一脉相承(见下图)。因此个人将它们归为相对简单的一类。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/facebook.github.io\/react\/img\/blog\/flux-diagram.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/facebook.github.io\/react\/img\/blog\/flux-diagram.png\x22 alt=\x22action_creator\x22 title=\x22action_creator\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e下面将要介绍的，是相对复杂一类，它们都采用了与上图不同的思路，去追求更优雅的架构、解决更复杂的问题\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eredux-loop：分形! 组合!\x3c\/h3\x3e\n\x3cp\x3e众所周知，Redux是借鉴自\x3ca href=\x22http:\/\/elm-lang.org\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eElm\x3c\/a\x3e的，然而在Elm中，异步的处理却并不是在action creator层，而是在reducer(Elm中称update)层：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/camo.githubusercontent.com\/655fdfe6e77bf59fde4623dc77a0e8962f6effa5\/687474703a2f2f692e696d6775722e636f6d2f4e4a574c58487a2e706e67\x22 src=\x22https:\/\/static.alili.techhttps:\/\/camo.githubusercontent.com\/655fdfe6e77bf59fde4623dc77a0e8962f6effa5\/687474703a2f2f692e696d6775722e636f6d2f4e4a574c58487a2e706e67\x22 alt=\x22elm_arch\x22 title=\x22elm_arch\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e图片来源于： \x3ca href=\x22https:\/\/github.com\/jarvisaoieong\/redux-architecture\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/jarvisaoie...\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这样做的目的是为了实现彻底的可组合性(composable)。在redux中，reducer作为函数是可组合的，action正常情况下作为纯对象也是可组合的，然而一旦涉及异步，当action嵌套组合的时候，中间件就无法正常识别，这个问题让redux作者Dan也发出感叹 \x3ca href=\x22https:\/\/productpains.com\/post\/redux\/there-is-no-easy-way-to-compose-redux-applications\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eThere is no easy way to compose Redux applications\x3c\/a\x3e并且开了一个至今仍然open的\x3ca href=\x22https:\/\/github.com\/reactjs\/redux\/issues\/1528\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eissue\x3c\/a\x3e，对组合、分形与redux的故事，有兴趣的朋友可以观摩以上链接，甚至了解一下Elm，篇幅所限，本文难以尽述。\x3c\/p\x3e\n\x3cp\x3e而redux-loop，则是在这方面的一个尝试，它更彻底的模仿了Elm的模式：引入Effects的概念并将其置入reducer，官方示例如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { Effects, loop } from \x27redux-loop\x27;\nimport { loadingStart, loadingSuccess, loadingFailure } from \x27.\/actions\x27;\n\nexport function fetchDetails(id) {\n  return fetch(`\/api\/details\/${id}`)\n    .then((r) =\x3e r.json())\n    .then(loadingSuccess)\n    .catch(loadingFailure);\n}\n\nexport default function reducer(state, action) {\n  switch (action.type) {\n    case \x27LOADING_START\x27:\n      return loop(\n        { ...state, loading: true },\n        Effects.promise(fetchDetails, action.payload.id)\n      ); \/\/ 同时返回状态与副作用\n\n    case \x27LOADING_SUCCESS\x27:\n      return {\n        ...state,\n        loading: false,\n        details: action.payload\n      };\n\n    case \x27LOADING_FAILURE\x27:\n      return {\n        ...state,\n        loading: false,\n        error: action.payload.message\n      };\n\n    default:\n      return state;\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Effects, loop } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-loop\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { loadingStart, loadingSuccess, loadingFailure } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/actions\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchDetails\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e`\/api\/details\/\x3cspan class=\x22hljs-subst\x22\x3e${id}\x3c\/span\x3e`\x3c\/span\x3e)\n    .then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3er\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e r.json())\n    .then(loadingSuccess)\n    .catch(loadingFailure);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereducer\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estate, action\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27LOADING_START\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e loop(\n        { ...state, \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e },\n        Effects.promise(fetchDetails, action.payload.id)\n      ); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 同时返回状态与副作用\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27LOADING_SUCCESS\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        ...state,\n        \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edetails\x3c\/span\x3e: action.payload\n      };\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27LOADING_FAILURE\x27\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        ...state,\n        \x3cspan class=\x22hljs-attr\x22\x3eloading\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: action.payload.message\n      };\n\n    \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state;\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意在reducer中，当处理\x3ccode\x3eLOADING_START\x3c\/code\x3e时，并没有直接返回state对象，而是用\x3ccode\x3eloop\x3c\/code\x3e函数将state和Effect\x22打包\x22返回(实际上这个返回值是数组\x3ccode\x3e[State, Effect]\x3c\/code\x3e，和Elm的方式非常接近)。\x3c\/p\x3e\n\x3cp\x3e然而修改reducer的返回类型显然是比较暴力的做法，除非Redux官方出面，否则很难获得社区的广泛认同。更复杂的返回类型会让很多已有的API，三方库面临危险，甚至\x3ccode\x3ecombineReducer\x3c\/code\x3e都需要用redux-loop提供的定制\x3ca href=\x22https:\/\/github.com\/redux-loop\/redux-loop#use-the-custom-combinereducers-if-you-need-it\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e版本\x3c\/a\x3e，这种\x22破坏性\x22也是Redux作者Dan没有采纳redux-loop进入Redux核心代码的原因：\x22If a solution doesn’t work with vanilla combineReducers(), it won’t get into Redux core\x22。\x3c\/p\x3e\n\x3cp\x3e对Elm的分形架构有了解，想在Redux上继续实践的人来说，redux-loop是很好的参考素材，但对多数人和项目而言，最好还是更谨慎地看待。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eredux-saga：难、而美\x3c\/h3\x3e\n\x3cp\x3eGithub:  \x3ca href=\x22https:\/\/github.com\/yelouafi\/redux-saga\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/yelouafi\/r...\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e另一个著名的库，它让异步行为成为架构中独立的一层(称为saga)，既不在action creator中，也不和reducer沾边。\x3c\/p\x3e\n\x3cp\x3e它的出发点是把副作用 (Side effect，异步行为就是典型的副作用) 看成\x22线程\x22，可以通过普通的action去触发它，当副作用完成时也会触发action作为输出。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { takeEvery } from \x27redux-saga\x27\nimport { call, put } from \x27redux-saga\/effects\x27\nimport Api from \x27...\x27\n\nfunction* getData(action) {\n   try {\n      const response = yield call(api.getData, action.payload.id);\n      yield put({type: \x26quot;GET_DATA_SUCCEEDED\x26quot;, payload: response});\n   } catch (e) {\n      yield put({type: \x26quot;GET_DATA_FAILED\x26quot;, payload: error});\n   }\n}\n\nfunction* mySaga() {\n  yield* takeEvery(\x26quot;GET_DATA\x26quot;, getData);\n}\n\nexport default mySaga;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { takeEvery } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { call, put } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-saga\/effects\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Api \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27...\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egetData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e response = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(api.getData, action.payload.id);\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22GET_DATA_SUCCEEDED\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: response});\n   } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22GET_DATA_FAILED\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: error});\n   }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3emySaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e* takeEvery(\x3cspan class=\x22hljs-string\x22\x3e\x22GET_DATA\x22\x3c\/span\x3e, getData);\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e mySaga;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e相比action creator的方案，它可以保证组件触发的action是纯对象，因此至少在项目范围内(middleware和saga都是项目的顶层依赖，跨项目无法保证)，action的组合性明显更加优秀。\x3c\/p\x3e\n\x3cp\x3e而它最为主打的，则是\x3cstrong\x3e可测试性\x3c\/strong\x3e和强大的异步\x3cstrong\x3e流程控制\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e由于强制所有saga都必须是generator函数，借助generator的next接口，异步行为的每个中间步骤都被暴露给了开发者，从而实现对异步逻辑\x22step by step\x22的测试。这在其它方案中是很少看到的 (当然也可以借鉴generator这一点，但缺少约束)。\x3c\/p\x3e\n\x3cp\x3e而强大得有点眼花缭乱的\x3ca href=\x22http:\/\/yelouafi.github.io\/redux-saga\/docs\/api\/index.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eAPI\x3c\/a\x3e，特别是channel的引入，则提供了武装到牙齿级的异步流程控制能力。\x3c\/p\x3e\n\x3cp\x3e然而，回顾我们在讨论简单方案时提到的各种场景与问题，redux-saga并没有去尝试回答和解决它们，这意味着你需要自行寻找解决方案。而generator、相对复杂的API和单独的一层抽象也让不少人望而却步。\x3c\/p\x3e\n\x3cp\x3e包括我在内，很多人非常欣赏redux-saga。它的架构和思路毫无疑问是优秀甚至优雅的，但使用它之前，最好想清楚它带来的优点(可测试性、流程控制、高度解耦)与付出的成本是否匹配，特别是异步方面复杂度并不高的项目，比如多数以CRUD为主的管理系统。\x3c\/p\x3e\n\x3ch4\x3e场景解析：竞态\x3c\/h4\x3e\n\x3cp\x3e说到异步流程控制很多人可能觉得太抽象，这里举个简单的例子：竞态。这个问题并不罕见，知乎也有见到\x3ca href=\x22https:\/\/www.zhihu.com\/question\/51944726\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e类似问题\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e简单描述为：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e由于异步返回时间的不确定性，后发出的请求可能先返回，如何确保异步结果的渲染是按照请求发生顺序，而不是返回顺序？\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这在redux-thunk为代表的简单方案中是要费点功夫的：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function fetchFriend(id){\n    return (dispatch, getState) =\x3e {\n        \/\/步骤1：在reducer中 set state.currentFriend = id;\n        dispatch({type: \x27FETCH_FIREND\x27, payload: id}); \n\n        return fetch(`http:\/\/localhost\/api\/firend\/${id}`)\n            .then(response =\x3e response.json())\n            .then(json =\x3e { \n                \/\/步骤2：只处理currentFriend的对应response\n                const { currentFriend } = getState();\n                (currentFriend === id) \x26amp;\x26amp; dispatch({type: \x27RECEIVE_FIRENDS\x27, playload: json})\n            });\n    }\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efetchFriend\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch, getState\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/步骤1：在reducer中 set state.currentFriend = id;\x3c\/span\x3e\n        dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27FETCH_FIREND\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: id}); \n\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(\x3cspan class=\x22hljs-string\x22\x3e`http:\/\/localhost\/api\/firend\/\x3cspan class=\x22hljs-subst\x22\x3e${id}\x3c\/span\x3e`\x3c\/span\x3e)\n            .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e =\x26gt;\x3c\/span\x3e response.json())\n            .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ejson\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/步骤2：只处理currentFriend的对应response\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { currentFriend } = getState();\n                (currentFriend === id) \x26amp;\x26amp; dispatch({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27RECEIVE_FIRENDS\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3eplayload\x3c\/span\x3e: json})\n            });\n    }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上只是示例，实际中不一定需要依赖业务id，也不一定要把id存到store里，只要为每个请求生成key，以便处理请求时能够对应起来即可。\x3c\/p\x3e\n\x3cp\x3e而在redux-saga中，一切非常地简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { takeLatest } from `redux-saga`\n\nfunction* fetchFriend(action) {\n  ...\n}\n\nfunction* watchLastFetchUser() {\n  yield takeLatest(\x27FETCH_FIREND\x27, fetchFriend)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { takeLatest } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e`redux-saga`\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3efetchFriend\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n  ...\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ewatchLastFetchUser\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeLatest(\x3cspan class=\x22hljs-string\x22\x3e\x27FETCH_FIREND\x27\x3c\/span\x3e, fetchFriend)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里的重点是\x3ca href=\x22http:\/\/yelouafi.github.io\/redux-saga\/docs\/api\/#saga-helpers\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3etakeLatest\x3c\/a\x3e，它限制了同步事件与异步返回事件的顺序关系。\x3c\/p\x3e\n\x3cp\x3e另外还有一些基于响应式编程(Reactive Programming)的异步方案(如redux-observable)也能非常好地处理竞态场景，因为\x3cstrong\x3e描述事件流之间的关系，正是整个响应式编程的抽象基石\x3c\/strong\x3e，而竞态在本质上就是如何保证同步事件与异步返回事件的关系，正是响应式编程的用武之地。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e小结\x3c\/h2\x3e\n\x3cp\x3e本文包含了一些redux社区著名、非著名 (恩，我的redux-action-tools) 的异步方案，这些其实并不重要。\x3c\/p\x3e\n\x3cp\x3e因为方案是一家之作，结论也是一家之言，不可能放之四海皆准。个人更希望文中探讨过的常见问题和场景，比如模板代码、乐观更新、错误处理、竞态等，能够成为你选型时的尺子，为你的权衡提供更好的参考，而不是等到项目热火朝天的时候，才发现当初选型的硬伤。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Redux异步方案选型</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007248878">https://segmentfault.com/a/1190000007248878</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/bluiayoadcn/" target="_blank">https://alili.tech/archive/bluiayoadcn/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>