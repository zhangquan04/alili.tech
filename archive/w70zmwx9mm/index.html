<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="基于react&#43;react-router&#43;redux&#43;socket.io&#43;koa开发一个聊天室"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>基于react&#43;react-router&#43;redux&#43;socket.io&#43;koa开发一个聊天室 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/w70zmwx9mm/",
				"appid": "1613049289050283", 
				"title": "基于react&#43;react-router&#43;redux&#43;socket.io&#43;koa开发一个聊天室 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/24ltn0rs7qv/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/r32xk5me94n/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&text=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&text=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&title=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&is_video=false&description=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&title=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&title=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&title=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw70zmwx9mm%2f&title=%e5%9f%ba%e4%ba%8ereact%2breact-router%2bredux%2bsocket.io%2bkoa%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e8%81%8a%e5%a4%a9%e5%ae%a4"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">基于react&#43;react-router&#43;redux&#43;socket.io&#43;koa开发一个聊天室</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近练手开发了一个项目，是一个聊天室应用。项目虽不大，但是使用到了react, react-router, redux, socket.io，后端开发使用了koa，算是一个比较综合性的案例，很多概念和技巧在开发的过程中都有所涉及,非常有必要再来巩固一下。\x3c\/p\x3e\n\x3cp\x3e项目目前部署在heroku平台上，在线演示地址: \x3ca href=\x22https:\/\/desolate-fortress-76848.herokuapp.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eonline demo\x3c\/a\x3e, 因为是国外的平台速度可能有点慢，点进去耐心等一会儿就能加载好了。\x3c\/p\x3e\n\x3cp\x3e加载好之后，首先出现的页面是让用户起一个昵称:\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVKab9?w=1360\x26amp;h=898\x22 src=\x22https:\/\/static.alili.tech\/img\/bVKab9?w=1360\x26amp;h=898\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e输入昵称之后，就会进入聊天页面，左边是进入聊天室的在线用户，右边则是聊天区域，下图是三个在线用户聊天的情形:\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVKaca?w=2456\x26amp;h=1300\x22 src=\x22https:\/\/static.alili.tech\/img\/bVKaca?w=2456\x26amp;h=1300\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e项目源码的github地址: \x3ca href=\x22https:\/\/github.com\/mly-zju\/chat-room\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e源码地址\x3c\/a\x3e, 有兴趣的同学欢迎关注学习~\x3c\/p\x3e\n\x3cp\x3e下面就来分析一下项目的整体架构，以及一下值得注意的技巧和知识点。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e1. 整体结构\x3c\/h3\x3e\n\x3cp\x3e项目的目录如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22├── README.md\n├── node_modules\n├── dist\n│\x26nbsp;\x26nbsp; ├── bundle.css\n│\x26nbsp;\x26nbsp; ├── bundle.js\n│\x26nbsp;\x26nbsp; └── resource\n│\x26nbsp;\x26nbsp;     ├── background.jpeg\n│\x26nbsp;\x26nbsp;     └── preview.png\n├── package.json\n├── server.js\n├── src\n│\x26nbsp;\x26nbsp; ├── action\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.js\n│\x26nbsp;\x26nbsp; ├── components\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── chatall\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.less\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── login\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.less\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── msgshow\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.less\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── namelist\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.less\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── nav\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.less\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── typein\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp;     ├── index.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp;     └── index.less\n│\x26nbsp;\x26nbsp; ├── container\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── chatAll.js\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── login.js\n│\x26nbsp;\x26nbsp; ├── index.ejs\n│\x26nbsp;\x26nbsp; ├── index.js\n│\x26nbsp;\x26nbsp; ├── index.less\n│\x26nbsp;\x26nbsp; ├── index2.js\n│\x26nbsp;\x26nbsp; ├── reducer\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.js\n│\x26nbsp;\x26nbsp; ├── redux_middleware\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── index.js\n│\x26nbsp;\x26nbsp; └── resource\n│\x26nbsp;\x26nbsp;     ├── background.jpeg\n│\x26nbsp;\x26nbsp;     └── preview.png\n└── webpack.config.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e├── \x3cspan class=\x22hljs-selector-tag\x22\x3eREADME\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.md\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-selector-tag\x22\x3enode_modules\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-selector-tag\x22\x3edist\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ebundle\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.css\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ebundle\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eresource\x3c\/span\x3e\n│\x26nbsp;\x26nbsp;     ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ebackground\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.jpeg\x3c\/span\x3e\n│\x26nbsp;\x26nbsp;     └── \x3cspan class=\x22hljs-selector-tag\x22\x3epreview\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.png\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-selector-tag\x22\x3epackage\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.json\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-selector-tag\x22\x3eserver\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n├── \x3cspan class=\x22hljs-selector-tag\x22\x3esrc\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eaction\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ecomponents\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3echatall\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3elogin\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3emsgshow\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3enamelist\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3enav\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3etypein\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp;     ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp;     └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3econtainer\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3echatAll\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3elogin\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.ejs\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.less\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex2\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ereducer\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── \x3cspan class=\x22hljs-selector-tag\x22\x3eredux_middleware\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; │\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eindex\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; └── \x3cspan class=\x22hljs-selector-tag\x22\x3eresource\x3c\/span\x3e\n│\x26nbsp;\x26nbsp;     ├── \x3cspan class=\x22hljs-selector-tag\x22\x3ebackground\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.jpeg\x3c\/span\x3e\n│\x26nbsp;\x26nbsp;     └── \x3cspan class=\x22hljs-selector-tag\x22\x3epreview\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.png\x3c\/span\x3e\n└── \x3cspan class=\x22hljs-selector-tag\x22\x3ewebpack\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.config\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中src当中是前端部分的源代码。项目使用webpack进行打包，打包后的代码在dist目录当中。由于我们的项目是一个单页面应用，因此只需要统一打包出一个bundle.js和一个bundle.css。而后端使用了koa框架，由于代码相对比较少，都集中在了server.js这一个文件当中。\x3c\/p\x3e\n\x3cp\x3e开发过程中，由于要webpack打包，一般我们会配合webpack-dev-server来使用。webpack-dev-server运行的时候自身就会开启一个server，而在我们的项目当中，后端koa也是一个server，因此为了简单起见，我们可以使用koa-webpack-dev-middleware来在koa当中开启webpack-dev-server。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var webpackDev = require(\x27koa-webpack-dev-middleware\x27);\nvar webpackConf = require(\x27.\/webpack.config.js\x27);\nvar compiler = webpack(webpackConf);\napp.use(webpackDev(compiler, {\n  contentBase: webpackConf.output.path,\n  publicPath: webpackConf.output.publicPath,\n  hot: true\n}));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e webpackDev = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-webpack-dev-middleware\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e webpackConf = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/webpack.config.js\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e compiler = webpack(webpackConf);\napp.use(webpackDev(compiler, {\n  \x3cspan class=\x22hljs-attr\x22\x3econtentBase\x3c\/span\x3e: webpackConf.output.path,\n  \x3cspan class=\x22hljs-attr\x22\x3epublicPath\x3c\/span\x3e: webpackConf.output.publicPath,\n  \x3cspan class=\x22hljs-attr\x22\x3ehot\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n}));\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e2. 项目布局: flexbox实践\x3c\/h3\x3e\n\x3cp\x3e在这个项目中我们有意识的使用了flex布局，作为面向未来的一种新的布局方式，实践一下还是很有必要的！没有学习郭flexbox的同学可以参考这篇来学一下：\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2015\/07\/flex-grammar.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/www.ruanyifeng.com\/blog\/2015\/07\/flex-grammar.html\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e以聊天界面为例进行分析，使用flex布局的话，可以非常方便，下图就是对界面的一个简单的切分：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVKacr?w=2456\x26amp;h=1300\x22 src=\x22https:\/\/static.alili.tech\/img\/bVKacr?w=2456\x26amp;h=1300\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e整个聊天框最外层红框框起来的部分display设置为flex，并且flex-direction设置为column，这样它里面的两个元素（即粉框和蓝框部分）就会竖直方向排列，同时粉框的flex设置为0 0 90px，代表该框不可伸缩，固定高度90px，而对于蓝框，则设置flex为1，代表伸展系数为1，这样，蓝框的高度就会占满除了粉框以外的全部空间。\x3c\/p\x3e\n\x3cp\x3e而于此同时，粉框和蓝框本身又分别设置display为flex。对粉框而言，内部一共有欢迎标签和退出button两个元素，分列两侧，因此只需要设置justify-content为space-between即可做到这一点。而对蓝框而言，内部有在线用户列表以及聊天区域两个元素。这里在线用户列表（即黄色框）需要设置固定宽度，因此类似于刚才粉框的设置，flex: 0 0 240px，而聊天区域（即绿色框）则设置flex为1，这样会自适应占满剩余宽度。\x3c\/p\x3e\n\x3cp\x3e最后，聊天区域内部又分为信息展示区以及打字区，因此聊天区域自身又是一个flexbox，设置方式类似，就不再具体分析了。\x3c\/p\x3e\n\x3cp\x3e可以看出，使用flexbox，相比使用float以及position等等而言，更加的规整，使用这种思路，整个页面就像庖丁解牛一般，布局格外清晰。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e3. 设计页面的数据结构\x3c\/h3\x3e\n\x3cp\x3e项目中使用了redux作为数据流管理工具，配合react，能够让页面组件同页面数据形成规律的映射。\x3c\/p\x3e\n\x3cp\x3e分析我们的聊天页面，可以看出，主要的数据就是目前在线的用户昵称列表，以及消息记录，此外我们还需要记录自己的用户昵称，方便消息发送时候取用。因此，整个应用的数据结构如下, 也就是redux中的store的数据结构如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;nickName\x26quot;: \x26quot;your nickname\x26quot;,\n  \x26quot;nameList\x26quot;: [\x26quot;user A\x26quot;,\x26quot;user B\x26quot;,\x26quot;user C\x26quot;,\x26quot;....\x26quot;],\n  \x26quot;msgList\x26quot;: [\n    {\n    \x26quot;nickName\x26quot;: \x26quot;some user\x26quot;,\n    \x26quot;msg\x26quot;: \x26quot;some string\x26quot;\n  },{\n    \x26quot;nickName\x26quot;: \x26quot;another user\x26quot;,\n    \x26quot;msg\x26quot;: \x26quot;another string\x26quot;\n  },\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22nickName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22your nickname\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22nameList\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22user A\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22user B\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22user C\x22\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x22....\x22\x3c\/span\x3e],\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22msgList\x22\x3c\/span\x3e: [\n    {\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22nickName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22some user\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22msg\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22some string\x22\x3c\/span\x3e\n  },{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22nickName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22another user\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22msg\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22another string\x22\x3c\/span\x3e\n  },\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有了这个总体的数据结构，我们就可以根据该结构设计具体的action，reducer等等部分了。这里整个程序的模块拆分遵循了redux官方实例当中的拆分方法，action文件夹当中定义action creators，reducer文件夹中定义reducer函数，component文件夹中定义一些通用的组件，container文件夹当中则是将通用组件取出，定义store中的数据同组件如何映射，以及组件中的事件如何dispatch action，从而引起store数据的改变。\x3c\/p\x3e\n\x3cp\x3e以component\/namelist中的组件为例，该组件用于显示在线用户昵称列表，因此它接受一个数组，也就是store中的nameList作为参数，因此其通用组件的写法也很简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22class NameList extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n  render() {\n    var {nameList} = this.props;\n    return (\n      \x3cul className=\x27name-list\x27\x3e\n        \x3cli className=\x27name-list-title\x27\x3e在线用户:\x3c\/li\x3e\n        {nameList.map((item, index) =\x3e (\n        \x3cli key={index}\x3e{item}\x3c\/li\x3e\n      ))}\n      \x3c\/ul\x3e\n    )\n  }\n}\n\nexport default NameList\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eNameList\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(props) {\n    \x3cspan class=\x22hljs-keyword\x22\x3esuper\x3c\/span\x3e(props);\n  }\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e {nameList} = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.props;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n      \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27name-list\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclassName\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27name-list-title\x27\x3c\/span\x3e\x26gt;\x3c\/span\x3e在线用户:\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n        {nameList.map((item, index) =\x26gt; (\n        \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{index}\x3c\/span\x3e\x26gt;\x3c\/span\x3e{item}\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eli\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      ))}\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eul\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    )\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e NameList\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而在container当中，只需要将store中的nameList赋值到该组件的props上面即可。其他组件也是类似的写法。\x3c\/p\x3e\n\x3cp\x3e可以看出，在redux的思想下，我们可以对整个应用抽象出一个总体的数据结构，数据结构的改变，会引发各个组件的改变，而组件当中的各种事件，又会反过来修改数据结构，从而再次引起页面的改变，这是一种单向的数据流，总体的数据都在store这个对象中进行维护，从而让整个应用开发变得更加有规律。redux的这种程序架构是对react提出的flux架构的一种消化和改良，下图是flux架构的示意图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVwAUY?w=2232\x26amp;h=1114\x22 src=\x22https:\/\/static.alili.tech\/img\/bVwAUY?w=2232\x26amp;h=1114\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e4.  socket.io的使用\x3c\/h3\x3e\n\x3cp\x3e由于是一个即时聊天应用，websocket协议自然是首选。而socket.io就是基于websocket实现的一套基于事件订阅与发布的js通信库。\x3c\/p\x3e\n\x3cp\x3e在socket.io中，主要有server端和client端。创建一个server和client都非常容易，对于server端，配合koa，只需要如下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var app=require(\x27koa\x27)();\nvar server = require(\x27http\x27).Server(app.callback());\nvar io = require(\x27socket.io\x27)(server);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e app=\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa\x27\x3c\/span\x3e)();\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e server = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27http\x27\x3c\/span\x3e).Server(app.callback());\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e io = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27socket.io\x27\x3c\/span\x3e)(server);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eclient端更加简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var io=require(\x27socket.io-client\x27);\nvar socket = io();\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e io=\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27socket.io-client\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e socket = io();\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一旦连接建立，client和server即可通过时间订阅与发布来彼此通信，socket.io提供的api非常类似于nodejs中的event对象的使用，对于server端：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22io.on(\x27connection\x27,function(socket){\n  socket.on(\x27some event\x27,function(data){\n    \/\/do something here....\n    socket.emit(\x27another event\x27,{some data here});\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eio.on(\x3cspan class=\x22hljs-string\x22\x3e\x27connection\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esocket\x3c\/span\x3e)\x3c\/span\x3e{\n  socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27some event\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something here....\x3c\/span\x3e\n    socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27another event\x27\x3c\/span\x3e,{some data here});\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对于client端，同样通过socket.on以及socket.emit来订阅和发布事件。比如说，某一个client端口emit了event A，而如果server端口订阅了event A，那么在server端，对应的回调函数就会被执行。通过这种方式，可以方便的编写即时通信程序。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e5. 一些值得注意的实现细节\x3c\/h3\x3e\n\x3cp\x3e下面对程序中涉及的一些我认为值得注意的细节和技巧进行一下简要分析。\x3c\/p\x3e\n\x3ch4\x3e1. socket.io同redux的结合方案：redux中间件的运用\x3c\/h4\x3e\n\x3cp\x3e在程序编写过程当中，我遇到一个难题，就是如何将socket.io的client实例结合到redux当中。\x3c\/p\x3e\n\x3cp\x3esocket.io的client类似于一个全局的对象，它不属于任何一个react组件，它订阅到的任何消息都可能更改整个应用的数据结构，而这种更改在redux当中又只能通过dispatch来实现。思考之后，我觉得编写一个redux中间件来处理socket.io相关的事件是一个很好的选择。\x3c\/p\x3e\n\x3cp\x3e关于redux中间件，简单来说，就是在redux真正出发dispatch之前，中间件可以首先捕获到react组件出发的action，并针对不同action做一些处理，然后再调用dispatch。中间件的写法，在redux的官方文档当中写的非常详细，有兴趣的可以参考一下: \x3ca href=\x22http:\/\/redux.js.org\/docs\/advanced\/Middleware.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/redux.js.org\/docs\/advanced\/Middleware.html\x3c\/a\x3e , 后续我也会出一些系列文章，深入分析redux包括react-redux的原理，其中就会提到中间件的原理，尽请期待~\x3c\/p\x3e\n\x3cp\x3e知道了redux中间件是怎么一回事之后，我们就可以发现，socket.io相关的事件非常适合通过写一个中间件来处理。我们程序当中中间件如下所示:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { message_update, guest_update } from \x27..\/action\x27\n\nfunction createSocketMiddleware(socket) {\n  var eventFlag = false;\n  return store =\x3e next =\x3e action =\x3e {\n    \/\/如果中间件第一次被调用，则首先绑定一些socket订阅事件\n    if (!eventFlag) {\n      eventFlag = true;\n      socket.on(\x27guest update\x27, function(data) {\n        next(guest_update(data));\n      });\n      socket.on(\x27msg from server\x27, function(data) {\n        next(message_update(data));\n      });\n      socket.on(\x27self logout\x27, function() {\n        window.location.reload();\n      });\n      setInterval(function() {\n        socket.emit(\x27heart beat\x27);\n      }, 10000);\n    }\n    \/\/捕获action，如果是和发送相关的事件，则调用socket对应的发布函数\n    if (action.type == \x27MSG_UPDATE\x27) {\n      socket.emit(\x27msg from client\x27, action.msg);\n    } else if (action.type == \x27NICKNAME_GET\x27) {\n      socket.emit(\x27guest come\x27, action.nickName);\n    } else if (action.type == \x27NICKNAME_FORGET\x27) {\n      socket.emit(\x27guest leave\x27, store.getState().nickName);\n    }\n    return next(action);\n  }\n}\n\nexport default createSocketMiddleware\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { message_update, guest_update } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/action\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateSocketMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esocket\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e eventFlag = \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e;\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果中间件第一次被调用，则首先绑定一些socket订阅事件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!eventFlag) {\n      eventFlag = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27guest update\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        next(guest_update(data));\n      });\n      socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27msg from server\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n        next(message_update(data));\n      });\n      socket.on(\x3cspan class=\x22hljs-string\x22\x3e\x27self logout\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.reload();\n      });\n      setInterval(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27heart beat\x27\x3c\/span\x3e);\n      }, \x3cspan class=\x22hljs-number\x22\x3e10000\x3c\/span\x3e);\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/捕获action，如果是和发送相关的事件，则调用socket对应的发布函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (action.type == \x3cspan class=\x22hljs-string\x22\x3e\x27MSG_UPDATE\x27\x3c\/span\x3e) {\n      socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27msg from client\x27\x3c\/span\x3e, action.msg);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (action.type == \x3cspan class=\x22hljs-string\x22\x3e\x27NICKNAME_GET\x27\x3c\/span\x3e) {\n      socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27guest come\x27\x3c\/span\x3e, action.nickName);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (action.type == \x3cspan class=\x22hljs-string\x22\x3e\x27NICKNAME_FORGET\x27\x3c\/span\x3e) {\n      socket.emit(\x3cspan class=\x22hljs-string\x22\x3e\x27guest leave\x27\x3c\/span\x3e, store.getState().nickName);\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action);\n  }\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e createSocketMiddleware\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码是一个socket middleware的创建函数，从中我们可以看出，这个中间件如果第一次调用的话(eventFlag),会首先绑定一些订阅主题和对应的回调函数，主要是订阅了消息到达、新用户来到、用户离开等等事件。同时，中间件会在真正dispatch函数调用之前，首先捕获action，然后分析action的type。如果是和发送事件相关的，就会调用socket.emit来发布对应的事件和数据。比如说，在我们的应用中，点击“发送”按钮会触发一个type为\x22MSG_UPDATE\x22的事件，这个事件首先被中间件捕获，那么这时候就会出发socket.emit(\x27msg from client\x27)来将消息发送给server。\x3c\/p\x3e\n\x3ch4\x3e2. 权限验证: 单页面应用中的页面跳转\x3c\/h4\x3e\n\x3cp\x3e整个应用使用react-router，做成了一个单页面应用，其中前端路由的层级非常简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22render(\n  \x3cProvider store={store}\x3e\n    \x3cRouter history={hashHistory}\x3e\n      \x3cRoute path=\x27\/\x27 component={ChatAllContainer}\/\x3e\n      \x3cRoute path=\x27\/login\x27 component={LoginContainer}\/\x3e\n    \x3c\/Router\x3e\n  \x3c\/Provider\x3e\n  ,\n  document.getElementById(\x27test\x27));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3erender(\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{store}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRouter\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehistory\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{hashHistory}\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{ChatAllContainer}\/\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n      \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eRoute\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ecomponent\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e{LoginContainer}\/\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eRouter\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eProvider\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  ,\n  document.getElementById(\x27test\x27));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以看出，主要是两条路径: \x27\/\x27和\x27\/login\x27，其中\x27\/\x27是我们的聊天界面，而\x27\/login\x27则是起昵称界面。\x3c\/p\x3e\n\x3cp\x3e由于应用的逻辑是，只有用户起了昵称才可以进入聊天界面，因此我们需要做一些权限验证，对于没有起昵称就进入\x27\/\x27路径的用户，需要跳转到\x27\/login\x27。在传统多页面web应用中，我们对于跳转非常熟悉，无非是服务器发送一个重定向请求，浏览器就会重定向到新的页面。然而在单页面中，由于始终只有一页，服务器又能够让浏览器跳转到哪里去呢？也就是说，服务器重定向的方法是行不通的。\x3c\/p\x3e\n\x3cp\x3e因此，我们换一种思路，页面跳转的逻辑需要在浏览器端执行，在react-router的框架下，执行跳转也非常简单，只需要使用其中的hashHistory对象，通过hashHistory.push(\x27path\x27)，即可让应用跳转到指定路径对应的界面。有了这个认知，那么我们下面要解决的，就是何时控制单页面的跳转？\x3c\/p\x3e\n\x3cp\x3e我的思路是，将用户的昵称通过一定的加密和编码，保存在cookie当中。当用户访问\x27\/\x27的时候，在对于界面的组件挂载之前，首先会向服务器发送一个认证请求，服务器会从请求中读取cookie，如果cookie当中没有用户名存在，那么服务器返回的参数当中有一个\x27permit\x27字段，设置为false，当应用解析到该字段后，就会调用hashHistory.push(\x27\/login\x27)来让页面跳转到起昵称界面下。这部分对应的逻辑主要在container\/chatAll.js文件当中实现。\x3c\/p\x3e\n\x3ch4\x3e3. 文本输入的细节处理: xss的预防，以及组合键的识别\x3c\/h4\x3e\n\x3cp\x3e在我们的聊天应用中，如果不对用户的输入进行一些处理，就有可能导致xss漏洞。举个例子，比如说有一个用户输入了\x27\x26lt;script\x26gt;....\x26lt;\/script\x26gt;\x27，如果不进行一些防范，输入到消息显示界面，这段文字就直接被解析成为了一段js代码。为了防范这类攻击，这里我们需要做一些简单的预防：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var regLeft = \/\x3c\/g;\nvar regRight = \/\x3e\/g;\nvalue = value.replace(regLeft, \x27\x26amp;lt;\x27);\nvalue = value.replace(regRight, \x27\x26amp;gt;\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e regLeft = \x3cspan class=\x22hljs-regexp\x22\x3e\/\x26lt;\/g\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e regRight = \x3cspan class=\x22hljs-regexp\x22\x3e\/\x26gt;\/g\x3c\/span\x3e;\nvalue = value.replace(regLeft, \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;lt;\x27\x3c\/span\x3e);\nvalue = value.replace(regRight, \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;gt;\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码在components\/typein组件当中。\x3c\/p\x3e\n\x3cp\x3e此外，为了方便用户快速发送消息，在消息输入框中，我们设置了\x27enter\x27按键为之间发送按键。那么，为了让用户能够打出换行，我们模仿微信，约定用户输入ctrl\x2benter组合键的时候是换行，这样，在消息输入框中，就需要监听组合键。在js的键盘事件中，event对象有一个ctrlKey属性，用于判断ctrl按键是否按下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22someDom.onkeydown=function(e){\n  if(e.keyCode==13\x26amp;\x26amp;e.ctrlKey){\n    \/\/组合键被按下\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3esomeDom.onkeydown=\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(e.keyCode==\x3cspan class=\x22hljs-number\x22\x3e13\x3c\/span\x3e\x26amp;\x26amp;e.ctrlKey){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/组合键被按下\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就是组合键监听的原理。\x3c\/p\x3e\n\x3cp\x3e以上就是对于这个项目的概述以及一些细节的讲解。最后安利一下我的博客 \x3ca href=\x22http:\/\/mly-zju.github.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/mly-zju.github.io\/\x3c\/a\x3e,会不定期更新我的原创技术文章和学习感悟，欢迎大家关注~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>基于react+react-router+redux+socket.io+koa开发一个聊天室</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008579965">https://segmentfault.com/a/1190000008579965</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/w70zmwx9mm/" target="_blank">https://alili.tech/archive/w70zmwx9mm/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>