<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="redux-saga 实践总结"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>redux-saga 实践总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/30tak3uso6u/",
				"appid": "1613049289050283", 
				"title": "redux-saga 实践总结 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/bs8f946sf9h/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/82uk4qpv07f/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&text=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&text=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&title=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&is_video=false&description=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&title=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&title=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&title=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f30tak3uso6u%2f&title=redux-saga%20%e5%ae%9e%e8%b7%b5%e6%80%bb%e7%bb%93"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">redux-saga 实践总结</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e有关 redux-saga 的文章，网络上早已是汗牛充栋。因此，本篇主要谈一谈自己的理解，以及实践中的经验总结。\x3c\/p\x3e\n\x3cp\x3e众所周知，redux 大部分的想法，都来自于 \x3ca href=\x22http:\/\/elm-lang.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eelm\x3c\/a\x3e。在 elm 和 redux 中，整个应用就是一个纯函数。elm 通过在 reducer 中返回一些声明副作用的 task 来处理异步问题，而 redux 借鉴 koa 的插件机制，用中间件改造 dispatch ，从而诞生了一批通过构造满足特殊 pattern 条件的 action 来解决副作用的问题。\x3c\/p\x3e\n\x3cp\x3e而 redux-saga 独辟蹊径，监听 action 来执行有副作用的 task，以保持 action 的简洁性。并且引入了 \x3ca href=\x22http:\/\/www.cs.cornell.edu\/andru\/cs711\/2002fa\/reading\/sagas.pdf\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esagas\x3c\/a\x3e 的机制和 generator 的特性，让redux-saga 非常方便地处理复杂异步问题。\x3c\/p\x3e\n\x3cp\x3e有意思的是，redux 借鉴了 elm，但在处理异步问题（副作用问题在前端一般为异步问题）上，借鉴了 koa 中间件的形式，而 redux-saga 却又去从 elm 取经，借鉴了独立 task 的形式。但是说到底，redux-saga 是一个 redux 的中间件。这个故事告诉我们，有好的设计不如有强大的扩展性。\x3c\/p\x3e\n\x3cp\x3eredux-saga 本身也有良好的扩展性。比如，易证得，但凡 redux 中间件，都可以用 redux-saga 来重写。当然了，不是说用了 redux-saga，其它异步中间件就不能用了，只是说不能保证 redux-saga 能恰好和你之前使用的中间件配合良好。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e\n\x3ccode\x3eredux-saga\x3c\/code\x3e 简介\x3c\/h2\x3e\n\x3cp\x3eredux-saga 是一个 redux 中间件，它具有如下特性：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e集中处理 redux 副作用问题。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e被实现为 generator 。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e类 redux-thunk 中间件。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ewatch\/worker（监听-\x26gt;执行） 的工作形式。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e读者也可以从这里查看\x3ca href=\x22https:\/\/github.com\/yelouafi\/redux-saga\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官方定义\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e对于刚接触 redux-saga 的同学，可以先来一段简单的代码快速了解 redux-saga 诸多特性。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 类 thunk 的 worker “进程”\nfunction* load() {\n  yield put({ type: BEGIN_LOAD_DATA });\n  \n  try {\n    const result = yield call(fetch, UrlMap.loadData);\n\n    yield put({\n      type: LOAD_DATA_SUCCESS,\n      payload: result,\n    });\n  } catch (e) {\n    yield put({\n      type: LOAD_DATA_ERROR,\n      payload: e,\n      error: true,\n    });\n  }\n}\n\nfunction* saga() {\n  \/\/ 创建一个监听“进程”\n  yield fork(watch(CLICK_LOAD_BUTTON, load))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 类 thunk 的 worker “进程”\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eload\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: BEGIN_LOAD_DATA });\n  \n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(fetch, UrlMap.loadData);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\n      \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOAD_DATA_SUCCESS,\n      \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: result,\n    });\n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\n      \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: LOAD_DATA_ERROR,\n      \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: e,\n      \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    });\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3esaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个监听“进程”\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(watch(CLICK_LOAD_BUTTON, load))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3eEffects\x3c\/h3\x3e\n\x3cp\x3eEffect 是一个 javascript 对象，里面包含描述副作用的信息，可以通过 yield 传达给 sagaMiddleware 执行\x3c\/p\x3e\n\x3cp\x3e在 redux-saga 世界里，所有的 Effect 都必须被 yield 才会执行，所以有人写了 \x3ca href=\x22https:\/\/github.com\/pke\/eslint-plugin-redux-saga\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eeslint-plugin-redux-saga\x3c\/a\x3e 来检查是否每个 Effect 都被 yield。并且原则上来说，所有的 yield 后面也只能跟Effect，以保证代码的易测性。\x3c\/p\x3e\n\x3cp\x3e例如：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22yield fetch(UrlMap.fetchData);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fetch(UrlMap.fetchData);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e应该用 call Effect ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22yield call(fetch, UrlMap.fetchData)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(fetch, UrlMap.fetchData)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从而可以使代码可测：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22assert.deepEqual(iterator.next().value, call(fetch, UrlMap.fetchData))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eassert.deepEqual(iterator.next().value, call(fetch, UrlMap.fetchData))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于各个 Effect 的具体介绍，文档已经写得很详细了，这里只做简要介绍。\x3c\/p\x3e\n\x3ch4\x3e1、put\x3c\/h4\x3e\n\x3cp\x3e作用和 redux 中的 dispatch 相同。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22yield put({ type: \x27CLICK_BTN\x27 });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({ \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27CLICK_BTN\x27\x3c\/span\x3e });\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e2、select\x3c\/h4\x3e\n\x3cp\x3e作用和 redux thunk 中的 getState 相同。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const id = yield select(state =\x3e state.id);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e id = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estate\x3c\/span\x3e =\x26gt;\x3c\/span\x3e state.id);\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e3、take\x3c\/h4\x3e\n\x3cp\x3e等待 redux dispatch 匹配某个 pattern 的 action 。\x3c\/p\x3e\n\x3cp\x3e在这个例子中，先等待一个按钮点击的 action ，然后执行按钮点击的 saga：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22while (true) {\n  yield take(\x27CLICK_BUTTON\x27);\n  yield fork(clickButtonSaga);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(\x3cspan class=\x22hljs-string\x22\x3e\x27CLICK_BUTTON\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(clickButtonSaga);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再举一个利用 take 实现 logMiddleware 的例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22while (true) {\n  const action = yield take(\x27*\x27);\n  const newState = yield select();\n  \n  console.log(\x27received action:\x27, action);\n  console.log(\x27state become:\x27, newState);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e action = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e newState = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select();\n  \n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27received action:\x27\x3c\/span\x3e, action);\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state become:\x27\x3c\/span\x3e, newState);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这种监听一个 action ，然后执行相应任务的方式，在 redux-saga 中非常常用，因此 redux-saga 提供了一个辅助 Effect —— takeEvery ，让 watch\/worker 的代码更加清晰。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22yield takeEvery(\x27*\x27, function* logger(action) {\n  const newState = yield select();\n\n  console.log(\x27received action:\x27, action);\n  console.log(\x27state become:\x27, newState);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeEvery(\x3cspan class=\x22hljs-string\x22\x3e\x27*\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3elogger\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e newState = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e select();\n\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27received action:\x27\x3c\/span\x3e, action);\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27state become:\x27\x3c\/span\x3e, newState);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e4、阻塞调用和无阻塞调用\x3c\/h4\x3e\n\x3cp\x3eredux-saga 可以用 fork 和 call 来调用子 saga ，其中 fork 是无阻塞型调用，call 是阻塞型调用。\x3c\/p\x3e\n\x3cp\x3e如果看过 saga 的论文，就知道 saga 是由许多子 saga （或者 subtransaction）组合起来的。fork Effect 和它的字面意思一样，即创建一个子 saga 。\x3c\/p\x3e\n\x3ch5\x3e4.1、fork\x3c\/h5\x3e\n\x3cp\x3e下面写一个倒数的例子，当接收到 BEGIN_COUNT 的 action，则开始倒数，而接收到 STOP_COUNT 的 action， 则停止倒数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* count(number) {\n  let currNum = number;\n\n  while (currNum \x3e= 0) {\n    console.log(currNum--);\n    yield delay(1000);\n  }\n}\n\nfunction countSaga* () {\n  while (true) {\n    const { payload: number } = yield take(BEGIN_COUNT);\n    const countTaskId = yield fork(count, number);\n\n    yield take(STOP_TASK);\n    yield cancel(countTaskId);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ecount\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enumber\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e currNum = number;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (currNum \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(currNum--);\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e delay(\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecountSaga\x3c\/span\x3e* (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: number } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(BEGIN_COUNT);\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e countTaskId = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(count, number);\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(STOP_TASK);\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e cancel(countTaskId);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e4.2、call\x3c\/h5\x3e\n\x3cp\x3e有阻塞地调用 saga 或者返回 promise 的函数。\x3c\/p\x3e\n\x3cp\x3e同样写一个例子：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const project = yield call(fetch, { url: UrlMap.fetchProject });\nconst members = yield call(fetchMembers, project.id);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e project = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(fetch, { \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: UrlMap.fetchProject });\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e members = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(fetchMembers, project.id);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/yelouafi.github.io\/redux-saga\/docs\/api\/index.html#effect-creators\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e英文文档\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/leonshi.com\/redux-saga-in-chinese\/docs\/api\/index.html#effect-\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e中文文档\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e传统异步中间件简介\x3c\/h2\x3e\n\x3cp\x3e在介绍 redux-saga 优缺点之前，这里先简要介绍传统的 redux 异步中间件，以便和 redux-saga 做比较。对传统异步中间件已经充分了解的读者，可以直接跳到 “redux-saga 优缺点分析” 进行阅读。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e1. fetch-middleware\x3c\/h3\x3e\n\x3cp\x3e使用redux的前端技术团队或个人，大多数都有一套自己 fetch-middleware，一来可以封装异步请求的业务逻辑，避免重复代码，二来可以写一些公共的异步请求逻辑，比如异常接口数据采集、接口缓存、接口处理等等。例如 \x3ca href=\x22https:\/\/github.com\/jasonslyvia\/redux-composable-fetch\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-composable-fetch\x3c\/a\x3e，\x3ca href=\x22https:\/\/github.com\/agraboso\/redux-api-middleware\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-api-middleware\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e在当前 redux 社区中，fetch-middleware 封装结果一般如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function loadData(id) {\n  return {\n    url: \x27\/api.json\x27,\n    types: [LOADING_ACTION_TYPE, SUCCESS_ACTION_TYPE, SUCCESS_ACTION_TYPE],\n    params: {\n      id,\n    },\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eloadData\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/api.json\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3etypes\x3c\/span\x3e: [LOADING_ACTION_TYPE, SUCCESS_ACTION_TYPE, SUCCESS_ACTION_TYPE],\n    \x3cspan class=\x22hljs-attr\x22\x3eparams\x3c\/span\x3e: {\n      id,\n    },\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e值得一提的是，大多数 fetch-middleware 都会用到一个小技巧 —— 把最终处理好的 promise 返回出来，以便在 thunk-middleware 中复用，并组织不同异步过程的先后逻辑。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function loadDetailThunk(id) {\n  return (dispatch) =\x3e {\n    \/\/ 先请求到 loadData 的结果，再请求 loadDetail\n    dispatch(loadData(id)).then(result =\x3e {\n      const { id: detailId } = result;\n      dispatch(loadDetail(detailId));\n    });\n  };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eloadDetailThunk\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 先请求到 loadData 的结果，再请求 loadDetail\x3c\/span\x3e\n    dispatch(loadData(id)).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: detailId } = result;\n      dispatch(loadDetail(detailId));\n    });\n  };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个技巧在 \x3ccode\x3eredux-saga\x3c\/code\x3e 中也同样有效。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* loadDetailSaga(id) {\n  const result = yield put.sync(loadData(id));\n  const { id: detailId } = result;\n\n  yield put.sync(loadDetail(detailId));\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3eloadDetailSaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put.sync(loadData(id));\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: detailId } = result;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put.sync(loadDetail(detailId));\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2. redux-thunk-middleware\x3c\/h3\x3e\n\x3cp\x3eredux 中大量应用了 thunk 的概念，例如 getState 以延迟执行的方式可以始终获得最新值，redux-thunk 以延迟执行的方式把副作用的责任推卸到用户身上。\x3c\/p\x3e\n\x3cp\x3e任何异步问题都能在 thunk 中解决。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3. \x3ca href=\x22https:\/\/github.com\/jasonslyvia\/redux-sequence-action\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esequence-middleware\x3c\/a\x3e\n\x3c\/h3\x3e\n\x3cp\x3esequence-middleware 用于保证 action 依次执行，无论是异步 action 还是普通 aciton ，和 fetch-middleware 配合使用非常方便。\x3c\/p\x3e\n\x3cp\x3e这里可以把每个 action 可以写成 thunk action，在 thunk 函数内从 store 拿到参数，避免 action 之间的依赖。这样不管业务逻辑有多复杂，都可以通过用 sequence action 轻易组织。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function loadDetailThunk() {\n  return function(dispatch, getState) {\n    const detailId = _.get(getState(), `${currPath}.detailId`);\n\n    dispatch({\n      url: UrlMap.getDetail,\n      params: { detailId },\n    });\n  };\n}\n\nfunction loadDetail() {\n  return [loadData(), loadDetailThunk()];\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eloadDetailThunk\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch, getState\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e detailId = _.get(getState(), \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${currPath}\x3c\/span\x3e.detailId`\x3c\/span\x3e);\n\n    dispatch({\n      \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: UrlMap.getDetail,\n      \x3cspan class=\x22hljs-attr\x22\x3eparams\x3c\/span\x3e: { detailId },\n    });\n  };\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eloadDetail\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e [loadData(), loadDetailThunk()];\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e\n\x3ccode\x3eredux-saga\x3c\/code\x3e 优缺点分析\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e缺点\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eredux-saga 不强迫我们捕获异常，这往往会造成异常发生时难以发现原因。因此，一个良好的习惯是，相信任何一个过程都有可能发生异常。如果出现异常但没有被捕获，redux-saga 的错误栈会给你一种一脸懵逼的感觉。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3egenerator 的调试环境比较糟糕，babel 的 source-map 经常错位，经常要手动加 debugger 来调试。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e你团队中使用的其它异步中间件，或许难以和 redux-saga 搭配良好。或许需要花费一些代价，用 redux-saga 来重构一部分中间件。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e优点\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e保持 action 的简单纯粹，aciton 不再像原来那样五花八门，让人眼花缭乱。task 的模式使代码更加清晰。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eredux-saga 提供了丰富的 Effects，以及 sagas 的机制（所有的 saga 都可以被中断），在处理复杂的异步问题上十分趁手。如果你的应用属于写操作密集型或者业务逻辑复杂，快让 redux-saga 来拯救你。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e扩展性强。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e声明式的 Effects，使代码更易测试，\x3ca href=\x22http:\/\/leonshi.com\/redux-saga-in-chinese\/docs\/basics\/DeclarativeEffects.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e查看详情\x3c\/a\x3e。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e利用 redux-saga 写 redux 中间件\x3c\/h2\x3e\n\x3cp\x3e用 redux-saga 来写中间件，可谓事半功倍。这里举一个轮询中间件的例子。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* pollingSaga(fetchAction) {\n  const { defaultInterval, mockInterval } = fetchAction;\n\n  while (true) {\n    try {\n      const result = yield put.sync(fetchAction);\n      const interval = mockInterval || result.interval;\n\n      yield delay(interval * 1000);\n    } catch (e) {\n      yield delay(defaultInterval * 1000);\n    }\n  }\n}\n\nfunction* beginPolling(pollingAction) {\n  const { pollingUrl, defaultInterval = 300, mockInterval, types,\n    params = {} } = pollingAction;\n\n  if (!types[1]) {\n    console.error(\x27pollingAction pattern error\x27, pollingAction);\n    throw Error(\x27pollingAction types[1] is null\x27);\n  }\n\n  const fetchAction = {\n    url: pollingUrl,\n    types,\n    params,\n    mockInterval,\n    defaultInterval,\n  };\n\n  const pollingTaskId = yield fork(pollingSaga, fetchAction);\n  const pattern = action =\x3e action.type === types[1] \x26amp;\x26amp; action.stopPolling;\n\n  yield take(pattern);\n  yield cancel(pollingTaskId);\n}\n\nfunction* pollingSagaMiddleware() {\n  yield takeEvery(action =\x3e {\n    const { pollingUrl, types } = action;\n\n    return pollingUrl \x26amp;\x26amp; types \x26amp;\x26amp; types.length;\n  }, beginPolling);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3epollingSaga\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efetchAction\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { defaultInterval, mockInterval } = fetchAction;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (\x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put.sync(fetchAction);\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e interval = mockInterval || result.interval;\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e delay(interval * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e delay(defaultInterval * \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n    }\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3ebeginPolling\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epollingAction\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { pollingUrl, defaultInterval = \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e, mockInterval, types,\n    params = {} } = pollingAction;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!types[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27pollingAction pattern error\x27\x3c\/span\x3e, pollingAction);\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27pollingAction types[1] is null\x27\x3c\/span\x3e);\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fetchAction = {\n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: pollingUrl,\n    types,\n    params,\n    mockInterval,\n    defaultInterval,\n  };\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pollingTaskId = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e fork(pollingSaga, fetchAction);\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e pattern = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e action.type === types[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] \x26amp;\x26amp; action.stopPolling;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e take(pattern);\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e cancel(pollingTaskId);\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3epollingSagaMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e takeEvery(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { pollingUrl, types } = action;\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e pollingUrl \x26amp;\x26amp; types \x26amp;\x26amp; types.length;\n  }, beginPolling);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后，\x3ccode\x3eredux-saga\x3c\/code\x3e 在实践的沉淀，我已经总结到 \x3ca href=\x22https:\/\/github.com\/jasonHzq\/redux-saga-sugar\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-saga-sugar\x3c\/a\x3e，欢迎点赞 ~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>redux-saga 实践总结</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007261052">https://segmentfault.com/a/1190000007261052</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/30tak3uso6u/" target="_blank">https://alili.tech/archive/30tak3uso6u/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>