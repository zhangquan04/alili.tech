<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="我对MVVM的学习笔记"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>我对MVVM的学习笔记 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/l186ld3gxoc/",
				"appid": "1613049289050283", 
				"title": "我对MVVM的学习笔记 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/48d12cl9t0n/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/b9gktimg665/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&text=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&text=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&title=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&is_video=false&description=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&title=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&title=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&title=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fl186ld3gxoc%2f&title=%e6%88%91%e5%af%b9MVVM%e7%9a%84%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">我对MVVM的学习笔记</h1><div class="meta"><div class="postdate"><time datetime="2019-01-29" itemprop="datePublished">2019-01-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e最近在学习MVVM的实现原理，刚好在sf上看到了\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006599500\x22\x3e剖析Vue原理\x26amp;实现双向绑定MVVM\x3c\/a\x3e一文，写的非常好，摘出Vue.js中的部分源码，改造后完成了一个简单的MVVM实现。实现了双向数据绑定，我自己在学习的过程中，也照着这篇文章中的源码重新实现了一遍。不同之处在于，我尽量将原来的实现写成了ES6的写法，比如使用\x3ccode\x3eclass\x3c\/code\x3e代替构造函数，将\x3ccode\x3eobserver\x3c\/code\x3e,\x3ccode\x3edep\x3c\/code\x3e,\x3ccode\x3ewatcher\x3c\/code\x3e,\x3ccode\x3ecompiler\x3c\/code\x3e分成不同的模块，然后使用\x3ccode\x3eimport\x3c\/code\x3e,\x3ccode\x3eexport\x3c\/code\x3e来互相引入，导出，最后使用\x3ca href=\x22https:\/\/github.com\/frostney\/rollup-babel-lib-bundler\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3erollup-babel-lib-bundler\x3c\/a\x3e打包了一下。所以这篇文章是对上面文章的学习总结，不会写的很细。大家也可以读一下上面的文章，简单易懂。\x3c\/p\x3e\n\x3cp\x3e我重新写过的\x3ca href=\x22https:\/\/github.com\/showonne\/toy\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e项目地址在这里\x3c\/a\x3e，有兴趣的可以看看。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e整体结构\x3c\/h2\x3e\n\x3cp\x3e这个简易的MVVM总共由\x3ccode\x3eindex.js(入口文件)\x3c\/code\x3e,\x3ccode\x3ecompiler.js\x3c\/code\x3e,\x3ccode\x3edep.js\x3c\/code\x3e,\x3ccode\x3eobserver.js\x3c\/code\x3e,\x3ccode\x3ewatcher.js\x3c\/code\x3e几部分组成。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.\n├── README.md\n├── dest\n│\x26nbsp;\x26nbsp; ├── toy.es2015.js\n│\x26nbsp;\x26nbsp; ├── toy.js\n│\x26nbsp;\x26nbsp; └── toy.umd.js\n├── examples\n│\x26nbsp;\x26nbsp; └── index.html\n├── package.json\n├── rollup.config.js\n└── src\n    ├── compiler.js\n    ├── dep.js\n    ├── index.js\n    ├── observer.js\n    └── watcher.js\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e.\n├── README\x3cspan class=\x22hljs-selector-class\x22\x3e.md\x3c\/span\x3e\n├── dest\n│\x26nbsp;\x26nbsp; ├── toy\x3cspan class=\x22hljs-selector-class\x22\x3e.es2015\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; ├── toy\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n│\x26nbsp;\x26nbsp; └── toy\x3cspan class=\x22hljs-selector-class\x22\x3e.umd\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n├── examples\n│\x26nbsp;\x26nbsp; └── index\x3cspan class=\x22hljs-selector-class\x22\x3e.html\x3c\/span\x3e\n├── package\x3cspan class=\x22hljs-selector-class\x22\x3e.json\x3c\/span\x3e\n├── rollup\x3cspan class=\x22hljs-selector-class\x22\x3e.config\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n└── src\n    ├── compiler\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n    ├── dep\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n    ├── index\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n    ├── observer\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n    └── watcher\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eindex.js\x3c\/code\x3e是整个框架的入口，比如我给这个框架起了个名字叫\x3ccode\x3eToy\x3c\/code\x3e，入口文件导出的其实就是\x3ccode\x3eToy\x3c\/code\x3e的构造函数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/引入其它模块\nimport { observe } from \x27.\/observer.js\x27\nimport { Compiler } from \x27.\/compiler.js\x27\nimport { Watcher } from \x27.\/watcher.js\x27\n\n\/\/具体实现\nclass Toy {\n    constructor(options){\n        \/\/...\n    }\n}\n\n\/\/导出模块\nexport { Toy }\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/引入其它模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { observe } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/observer.js\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Compiler } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/compiler.js\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { Watcher } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/watcher.js\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/具体实现\x3c\/span\x3e\n\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eToy\x3c\/span\x3e \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(options){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/...\x3c\/span\x3e\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/导出模块\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e { Toy }\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e初始化的过程分两步：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e劫持监听所有属性，通过\x3ccode\x3eObject.defineProperty\x3c\/code\x3e将数据变成响应式的，同时在\x3ccode\x3eget\x3c\/code\x3e和\x3ccode\x3eset\x3c\/code\x3e上做一些手脚。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e编译html模板，事实上我们在使用框架时写的html已经填充了很多框架自己的指令，语法，所以要先进行编译替换才能正确展示视图。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e实现所有属性的监听就是通过\x3ccode\x3eObject.defineProperty\x3c\/code\x3e递归地定义所以属性。每一个对象都会有一个对应的\x3ccode\x3eObserver\x3c\/code\x3e实例，其中的每一个属性都对应有一个\x3ccode\x3eDep\x3c\/code\x3e的实例\x3ccode\x3edep\x3c\/code\x3e，\x3ccode\x3edep\x3c\/code\x3e使用自增的\x3ccode\x3euid\x3c\/code\x3e标识，作用是记录这个属性被那些订阅者(\x3ccode\x3eWatcher\x3c\/code\x3e的实例)订阅了，好在属性变化时，通过遍历\x3ccode\x3edep.subs\x3c\/code\x3e去通知所有订阅了这个属性的\x3ccode\x3ewatcher\x3c\/code\x3e去做对应的更新。\x3c\/p\x3e\n\x3cp\x3e实现\x3ccode\x3eCompiler\x3c\/code\x3e就是对带有框架特殊API的模板进行编译，指令解析。同时将DOM与数据关联起来(其实是通过Watcher实现的)。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e本质上说\x3c\/h2\x3e\n\x3cp\x3e每个部分负责的事情我是这样理解的：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eindex.js\x3c\/strong\x3e 框架的入口，提供对外的构造函数。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3eobserver.js\x3c\/strong\x3e 将数据变成响应式，同时通过\x3ccode\x3edep\x3c\/code\x3e收集依赖(Watcher实例)。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3edep.js\x3c\/strong\x3e 收集依赖用的，在\x3ccode\x3eget\x3c\/code\x3e中收集依赖，在\x3ccode\x3eset\x3c\/code\x3e中通知对应依赖更新。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3ewatcher.js\x3c\/strong\x3e 数据的订阅者，一个Watcher的实例由\x3ccode\x3evm\x3c\/code\x3e,\x3ccode\x3eexp\x3c\/code\x3e,\x3ccode\x3ecb\x3c\/code\x3e,\x3ccode\x3edeps\x3c\/code\x3e等几部分组成，\x3ccode\x3evm\x3c\/code\x3e是对ViewModel的引用，触发\x3ccode\x3eget\x3c\/code\x3e方法将\x3ccode\x3ewatcher\x3c\/code\x3e自身添加至\x3ccode\x3edep\x3c\/code\x3e的\x3ccode\x3esubs\x3c\/code\x3e中时会用到，\x3ccode\x3eexp\x3c\/code\x3e则是当前Watcher实例监听的表达式，即数据的\x3ccode\x3ekey\x3c\/code\x3e，\x3ccode\x3ecb\x3c\/code\x3e则是更新数据的回调。\x3cbr\x3e当\x3ccode\x3evm\x3c\/code\x3e的数据改变后，会触发对应的\x3ccode\x3eset\x3c\/code\x3e方法，这个属性对应的\x3ccode\x3edep\x3c\/code\x3e会通知所有的\x3ccode\x3esubs\x3c\/code\x3e去执行自身的\x3ccode\x3eupdate\x3c\/code\x3e方法，而这个\x3ccode\x3eupdate\x3c\/code\x3e方法的内容其实只是\x3ccode\x3ethis.cb.call(this.vm, value, oldValue)\x3c\/code\x3e，\x3ccode\x3ecb\x3c\/code\x3e实际上是调用了\x3ccode\x3eupdateFn\x3c\/code\x3e(在\x3ccode\x3ecompiler.js\x3c\/code\x3e中绑定的)，这时才将DOM的数据真正更新。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3ecompiler.js\x3c\/strong\x3e 编辑DOM模板，并为每个\x3ccode\x3enode节点\x3c\/code\x3e通过\x3ccode\x3enew Watcher\x3c\/code\x3e的方式将属性表达式\x3ccode\x3eexp\x3c\/code\x3e，\x3ccode\x3eupdateFn(真正更新DOM的函数)\x3c\/code\x3e与\x3ccode\x3enode\x3c\/code\x3e关联，然后配合响应式数据就做到了\x3ccode\x3eview\x3c\/code\x3e与\x3ccode\x3emodel\x3c\/code\x3e的双向绑定。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e所以整个框架的运行过程是这样的：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eobserve\x3c\/code\x3e所有数据，改写了每个数据的get和set方法，并为每个数据关联了一个dep(通过闭包实现)。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3enew Compiler\x3c\/code\x3e开始编译模板，编译过程中，可以提取出指令，\x3ccode\x3ev-text\x3c\/code\x3e,\x3ccode\x3ev-html\x3c\/code\x3e等，可以分析出事件函数\x3ccode\x3ev-click\x3c\/code\x3e和绑定的表达式，这时通过\x3ccode\x3eself.compileText(node, RegExp.$1)\x3c\/code\x3e,\x3ccode\x3eself.compile(node)\x3c\/code\x3e将DOM节点和表达式建立关联。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e建立的关联，是DOM节点和数据表达式的关联，这一步是通过\x3ccode\x3enew Watcher\x3c\/code\x3e实现的\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3enew Watcher\x3c\/code\x3e的时候，Watcher实例会将Dep.target这个全局属性指向自身，然后出发一下需要监听属性的getter，这时\x3ccode\x3edep\x3c\/code\x3e会将Watcher实例添加到它的\x3ccode\x3esubs\x3c\/code\x3e中，Watcher实例也会标记一下这个dep已经添加过自己了，防止重复添加。这时\x3ccode\x3edep\x3c\/code\x3e和Watcher实例已经关联起来了，数据的变化可以通知到对应的Watcher实例，Watcher实例的update方法会正确地更新DOM。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e其实到这里，数据的双向绑定就已经实现了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e过程中学习到的一些细节\x3c\/h2\x3e\n\x3cp\x3e记录一些在学习过程中遇到的小tips，其实都是很基础的东西。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Node\/textContent\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode.textContent\x3c\/a\x3e: 表示一个节点及其内部节点的文本内容。之前一直都是用\x3ccode\x3einnerText\x3c\/code\x3e的，看了MDN才知道\x3ccode\x3einnerText\x3c\/code\x3e原来是IE私有的，\x3ccode\x3etextContent\x3c\/code\x3e才是标准属性。而且\x3ccode\x3einnerText\x3c\/code\x3e受样式影响，还会触发重排，所以还是用\x3ccode\x3etextContent\x3c\/code\x3e代替吧。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/API\/Node\/appendChild\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode.appendChild\x3c\/a\x3e: 这个API有一个很有意思的行为：\x3cstrong\x3e如果被插入的节点已经存在于当前文档的文档树中,则那个节点会首先从原先的位置移除,然后再插入到新的位置.\x3c\/strong\x3e，当时我在看\x3ccode\x3ecompiler.js\x3c\/code\x3e的\x3ccode\x3enode2Fragment\x3c\/code\x3e方法：\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22node2Fragment(el){\n    let fragment = document.createDocumentFragment()\n    let child\n    while(child = el.firstChild){\n        fragment.appendChild(child)\n    }\n    return fragment\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs vim\x22\x3e\x3ccode\x3enode2Fragment(\x3cspan class=\x22hljs-keyword\x22\x3eel\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e fragment = document.createDocumentFragment()\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e child\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(child = \x3cspan class=\x22hljs-keyword\x22\x3eel\x3c\/span\x3e.firstChild){\n        fragment.appendChild(child)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fragment\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e当时很不解为什么while循环能成按照预期执行，我在浏览器多次调用\x3ccode\x3eel.firstChild\x3c\/code\x3e拿到的也始终是第一个子节点，看了这个API的文档才发现还有这么个行为！\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTML\/Attributes\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNode.attributes\x3c\/a\x3e: 可以方便地获取DOM节点的属性，返回值是一个对象，其中\x3ccode\x3ename\x3c\/code\x3e是属性名，\x3ccode\x3evalue\x3c\/code\x3e是属性值。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e最后\x3c\/h2\x3e\n\x3cp\x3e终于明白了简易MVVM框架的运作原理，也发现了一些底层API的知识，写成一些总结，这篇文章中没有贴很多代码去说实现，因为\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006599500\x22\x3e剖析Vue原理\x26amp;实现双向绑定MVVM\x3c\/a\x3e一文已经很详细了，我也是按照这个去学习的，所以我记录的是我个人的一些思想上的总结，所以可能要先看代码才能了解。分享出来，希望能有人从中受益 :)\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>我对MVVM的学习笔记</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007915437">https://segmentfault.com/a/1190000007915437</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/l186ld3gxoc/" target="_blank">https://alili.tech/archive/l186ld3gxoc/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>