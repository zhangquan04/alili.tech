<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="移动端图片上传旋转、压缩的解决方案"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>移动端图片上传旋转、压缩的解决方案 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/qy3d0n9lih/",
				"appid": "1613049289050283", 
				"title": "移动端图片上传旋转、压缩的解决方案 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-10T02:30:08"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qug3prvbtw/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/zh5nfgazf9k/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&text=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&text=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&is_video=false&description=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fqy3d0n9lih%2f&title=%e7%a7%bb%e5%8a%a8%e7%ab%af%e5%9b%be%e7%89%87%e4%b8%8a%e4%bc%a0%e6%97%8b%e8%bd%ac%e3%80%81%e5%8e%8b%e7%bc%a9%e7%9a%84%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">移动端图片上传旋转、压缩的解决方案</h1><div class="meta"><div class="postdate"><time datetime="2019-01-10" itemprop="datePublished">2019-01-10</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e在手机上通过网页 input 标签拍照上传图片，有一些手机会出现图片旋转了90度d的问题，包括 iPhone 和个别三星手机。这些手机竖着拍的时候才会出现这种问题，横拍出来的照片就正常显示。因此，可以通过获取手机拍照角度来对照片进行旋转，从而解决这个问题。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eOrientation\x3c\/h2\x3e\n\x3cp\x3e这个参数并不是所有图片都有的，不过手机拍出来的图片是带有这个参数的。\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\x3ctr\x3e\n\x3cth\x3e旋转角度\x3c\/th\x3e\n\x3cth\x3e参数值\x3c\/th\x3e\n\x3c\/tr\x3e\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e0°\x3c\/td\x3e\n\x3ctd\x3e1\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e顺时针90°\x3c\/td\x3e\n\x3ctd\x3e6\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e逆时针90°\x3c\/td\x3e\n\x3ctd\x3e8\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e180°\x3c\/td\x3e\n\x3ctd\x3e3\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e参数为 1 的时候显示正常，那么在这些横拍显示正常，即 Orientation = 1 的手机上，竖拍的参数为 6。\x3c\/p\x3e\n\x3cp\x3e想要获取 Orientation 参数，可以通过 exif.js 库来操作。exif.js 功能很多，体积也很大，未压缩之前足足有 30k，这对手机页面加载来说是非常大影响的。而我只需要获取 Orientation 信息而已，所以我这里删减了 exif.js 库的一些代码，将代码缩小到几KB。\x3c\/p\x3e\n\x3cp\x3eexif.js 获取 Orientation ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22EXIF.getData(file, function() {  \n    var Orientation = EXIF.getTag(this, \x27Orientation\x27);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eEXIF.getData(file, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e Orientation = EXIF.getTag(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Orientation\x27\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3efile 则是 input 文件表单上传的文件。上传的文件经过 fileReader.readAsDataURL(file) 就可以实现预览图片了，这方面不清楚的可以查看：\x3ca href=\x22https:\/\/github.com\/lin-xin\/blog\/issues\/19\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHTML5 进阶系列：文件上传下载\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e旋转\x3c\/h2\x3e\n\x3cp\x3e旋转需要用到 canvas 的 rotate() 方法。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22ctx.rotate(angle);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3ectx.rotate(angle);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3erotate 方法的参数为旋转弧度。需要将角度转为弧度：degrees * Math.PI \/ 180\x3c\/p\x3e\n\x3cp\x3e旋转的中心点默认都在 canvas 的起点，即 ( 0, 0 )。旋转的原理如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009990038?w=700\x26amp;h=355\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009990038?w=700\x26amp;h=355\x22 alt=\x22旋转原理图\x22 title=\x22旋转原理图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e旋转之后，如果从 ( 0, 0 ) 点进行 drawImage()，那么画出来的位置就是在左图中的旋转 90 度后的位置，不在可视区域呢。旋转之后，坐标轴也跟着旋转了，想要显示在可视区域呢，需要将 ( 0, 0 ) 点往 y 轴的反方向移 y 个单位，此时的起始点则为 ( 0, -y )。\x3c\/p\x3e\n\x3cp\x3e同理，可以获得旋转 -90 度后的起始点为 ( -x, 0 )，旋转 180 度后的起始点为 ( -x, -y )。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e压缩\x3c\/h2\x3e\n\x3cp\x3e手机拍出来的照片太大，而且使用 base64 编码的照片会比原照片大，那么上传的时候进行压缩就非常有必要的。现在的手机像素这么高，拍出来的照片宽高都有几千像素，用 canvas 来渲染这照片的速度会相对比较慢。\x3c\/p\x3e\n\x3cp\x3e因此第一步需要先对上传照片的宽高做限制，判断宽度或高度是否超出哪个范围，则等比压缩其宽高。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var ratio = width \/ height;\nif(imgWidth \x3e imgHeight \x26amp;\x26amp; imgWidth \x3e xx){\n    imgWidth = xx;\n    imgHeight = Math.ceil(xx \/ ratio);\n}else if(imgWidth \x3c imgHeight \x26amp;\x26amp; imgHeight \x3e yy){\n    imgWidth = Math.ceil(yy * ratio);\n    imgHeight = yy;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ratio = width \/ height;\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(imgWidth \x26gt; imgHeight \x26amp;\x26amp; imgWidth \x26gt; xx){\n    imgWidth = xx;\n    imgHeight = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.ceil(xx \/ ratio);\n}\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(imgWidth \x26lt; imgHeight \x26amp;\x26amp; imgHeight \x26gt; yy){\n    imgWidth = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.ceil(yy * ratio);\n    imgHeight = yy;\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第二步就通过 canvas.toDataURL() 方法来压缩照片质量。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22canvas.toDataURL(\x26quot;image\/jpeg\x26quot;, 1);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3ecanvas.toDataURL(\x3cspan class=\x22hljs-string\x22\x3e\x22image\/jpeg\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3etoDataURL() 方法返回一个包含图片展示的 data URI 。使用两个参数，第一个参数为图片格式，默认为 image\/png。第二个参数为压缩质量，在指定图片格式为 image\/jpeg 或 image\/webp的情况下，可以从 0 到 1 的区间内选择图片的质量。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e综合以上，例子的代码包括精简的exif.js库地址：\x3ca href=\x22https:\/\/github.com\/lin-xin\/blog\/tree\/master\/file-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3efile-demo\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e主要的核心代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput type=\x26quot;file\x26quot; id=\x26quot;files\x26quot; \x3e\n\x3cimg src=\x26quot;blank.gif\x26quot; id=\x26quot;preview\x26quot;\x3e\n\x3cscript src=\x26quot;small-exif.js\x26quot;\x3e\x3c\/script\x3e\n\x3cscript\x3e\nvar ipt = document.getElementById(\x27files\x27),\n    img = document.getElementById(\x27preview\x27),\n    Orientation = null;\nipt.onchange = function () {\n    var file = ipt.files[0],\n        reader = new FileReader(),\n        image = new Image();\n        \n    if(file){\n        EXIF.getData(file, function() {  \n            Orientation = EXIF.getTag(this, \x27Orientation\x27);\n        });\n        reader.onload = function (ev) {\n            image.src = ev.target.result;\n            image.onload = function () {\n                var imgWidth = this.width,\n                    imgHeight = this.height;\n                \/\/ 控制上传图片的宽高\n                if(imgWidth \x3e imgHeight \x26amp;\x26amp; imgWidth \x3e 750){\n                    imgWidth = 750;\n                    imgHeight = Math.ceil(750 * this.height \/ this.width);\n                }else if(imgWidth \x3c imgHeight \x26amp;\x26amp; imgHeight \x3e 1334){\n                    imgWidth = Math.ceil(1334 * this.width \/ this.height);\n                    imgHeight = 1334;\n                }\n                \n                var canvas = document.createElement(\x26quot;canvas\x26quot;),\n                ctx = canvas.getContext(\x272d\x27);\n                canvas.width = imgWidth;\n                canvas.height = imgHeight;\n                if(Orientation \x26amp;\x26amp; Orientation != 1){\n                    switch(Orientation){\n                        case 6:     \/\/ 旋转90度\n                            canvas.width = imgHeight;    \n                            canvas.height = imgWidth;    \n                            ctx.rotate(Math.PI \/ 2);\n                            \/\/ (0,-imgHeight) 从旋转原理图那里获得的起始点\n                            ctx.drawImage(this, 0, -imgHeight, imgWidth, imgHeight);\n                            break;\n                        case 3:     \/\/ 旋转180度\n                            ctx.rotate(Math.PI);    \n                            ctx.drawImage(this, -imgWidth, -imgHeight, imgWidth, imgHeight);\n                            break;\n                        case 8:     \/\/ 旋转-90度\n                            canvas.width = imgHeight;    \n                            canvas.height = imgWidth;    \n                            ctx.rotate(3 * Math.PI \/ 2);    \n                            ctx.drawImage(this, -imgWidth, 0, imgWidth, imgHeight);\n                            break;\n                    }\n                }else{\n                    ctx.drawImage(this, 0, 0, imgWidth, imgHeight);\n                }\n                img.src = canvas.toDataURL(\x26quot;image\/jpeg\x26quot;, 0.8);\n            }\n        }\n        reader.readAsDataURL(file);\n    }\n}\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22xml hljs\x22\x3e\x3ccode class=\x22html\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22files\x22\x3c\/span\x3e \x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eimg\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22blank.gif\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22preview\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22small-exif.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e ipt = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27files\x27\x3c\/span\x3e),\n    img = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27preview\x27\x3c\/span\x3e),\n    Orientation = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\nipt.onchange = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e file = ipt.files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e],\n        reader = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FileReader(),\n        image = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image();\n        \n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(file){\n        EXIF.getData(file, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{  \n            Orientation = EXIF.getTag(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27Orientation\x27\x3c\/span\x3e);\n        });\n        reader.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eev\x3c\/span\x3e) \x3c\/span\x3e{\n            image.src = ev.target.result;\n            image.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e imgWidth = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width,\n                    imgHeight = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height;\n                \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 控制上传图片的宽高\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(imgWidth \x26gt; imgHeight \x26amp;\x26amp; imgWidth \x26gt; \x3cspan class=\x22hljs-number\x22\x3e750\x3c\/span\x3e){\n                    imgWidth = \x3cspan class=\x22hljs-number\x22\x3e750\x3c\/span\x3e;\n                    imgHeight = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.ceil(\x3cspan class=\x22hljs-number\x22\x3e750\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height \/ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width);\n                }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(imgWidth \x26lt; imgHeight \x26amp;\x26amp; imgHeight \x26gt; \x3cspan class=\x22hljs-number\x22\x3e1334\x3c\/span\x3e){\n                    imgWidth = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.ceil(\x3cspan class=\x22hljs-number\x22\x3e1334\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.width \/ \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.height);\n                    imgHeight = \x3cspan class=\x22hljs-number\x22\x3e1334\x3c\/span\x3e;\n                }\n                \n                \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e canvas = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x22canvas\x22\x3c\/span\x3e),\n                ctx = canvas.getContext(\x3cspan class=\x22hljs-string\x22\x3e\x272d\x27\x3c\/span\x3e);\n                canvas.width = imgWidth;\n                canvas.height = imgHeight;\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(Orientation \x26amp;\x26amp; Orientation != \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e){\n                    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e(Orientation){\n                        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e:     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 旋转90度\x3c\/span\x3e\n                            canvas.width = imgHeight;    \n                            canvas.height = imgWidth;    \n                            ctx.rotate(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n                            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ (0,-imgHeight) 从旋转原理图那里获得的起始点\x3c\/span\x3e\n                            ctx.drawImage(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, -imgHeight, imgWidth, imgHeight);\n                            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e:     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 旋转180度\x3c\/span\x3e\n                            ctx.rotate(\x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI);    \n                            ctx.drawImage(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, -imgWidth, -imgHeight, imgWidth, imgHeight);\n                            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e8\x3c\/span\x3e:     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 旋转-90度\x3c\/span\x3e\n                            canvas.width = imgHeight;    \n                            canvas.height = imgWidth;    \n                            ctx.rotate(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e * \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.PI \/ \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);    \n                            ctx.drawImage(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, -imgWidth, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, imgWidth, imgHeight);\n                            \x3cspan class=\x22hljs-keyword\x22\x3ebreak\x3c\/span\x3e;\n                    }\n                }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n                    ctx.drawImage(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, imgWidth, imgHeight);\n                }\n                img.src = canvas.toDataURL(\x3cspan class=\x22hljs-string\x22\x3e\x22image\/jpeg\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e0.8\x3c\/span\x3e);\n            }\n        }\n        reader.readAsDataURL(file);\n    }\n}\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e更多文章：\x3ca href=\x22https:\/\/github.com\/lin-xin\/blog\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3elin-xin\/blog\x3c\/a\x3e\n\x3c\/h3\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e微信赞赏\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009357413?w=236\x26amp;h=236\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009357413?w=236\x26amp;h=236\x22 alt=\x22谢谢支持\x22 title=\x22谢谢支持\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>移动端图片上传旋转、压缩的解决方案</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009990033">https://segmentfault.com/a/1190000009990033</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/qy3d0n9lih/" target="_blank">https://alili.tech/archive/qy3d0n9lih/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>