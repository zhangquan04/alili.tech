<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React 项目中Redux 中间件的理解"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React 项目中Redux 中间件的理解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/jgugdyg50l/",
				"appid": "1613049289050283", 
				"title": "React 项目中Redux 中间件的理解 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-29T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6k3of8hotzi/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/mn938vwhal/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&text=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&text=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&title=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&is_video=false&description=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&title=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&title=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&title=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fjgugdyg50l%2f&title=React%20%e9%a1%b9%e7%9b%ae%e4%b8%adRedux%20%e4%b8%ad%e9%97%b4%e4%bb%b6%e7%9a%84%e7%90%86%e8%a7%a3"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React 项目中Redux 中间件的理解</h1><div class="meta"><div class="postdate"><time datetime="2019-01-29" itemprop="datePublished">2019-01-29</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3eReact\/Redux项目结束后，当我在研究react-router源码的时候发现当中有一部分含中间件的思想，所以才想把中间件重新梳理一遍；在之前看redux了解到中间件，redux层面中间件的理解对项目前期比较有帮助，虽然项目中后期基本可以忽略这层概念；现在对这部分的笔记重新梳理，这里只针对这个中间件做一个理解。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e如果想学习项目的底层建设，建议先去学习官网\x3ca href=\x22https:\/\/github.com\/reactjs\/redux\/tree\/master\/examples\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux案例\x3c\/a\x3e，之后在学习\x3ca href=\x22https:\/\/github.com\/ReactTraining\/react-router\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ereact-router\x3c\/a\x3e的使用\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3eRedux 中间件介绍\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eRedux\x3c\/code\x3e 目的是提供第三方插件的模式，改变\x3ccode\x3eaction -\x26gt; reducer\x3c\/code\x3e 的过程。变为 \x3ccode\x3eaction -\x26gt; middlewares -\x26gt; reducer\x3c\/code\x3e 。自己在项目中使用它改变数据流，实现异步 \x3ccode\x3eaction\x3c\/code\x3e ；下面会对日志输出做一个开场。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e使用 Redux 中间件\x3c\/h2\x3e\n\x3cp\x3eRedux 中 \x3ccode\x3eapplyMiddleware\x3c\/code\x3e 的方法，可以应用多个中间件，这里先只写一个中间件，以日志输出中间件为例\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/利用中间件做打印log\nimport {createStore,applyMiddleware} from \x27redux\x27;\nimport logger from \x27..\/api\/logger\x27;\nimport rootReducer from \x27..\/reducer\/rootReducer\x27;\n\n\nlet createStoreWithMiddleware = applyMiddleware(logger)(createStore);\nlet store = createStoreWithMiddleware(rootReducer);\n\/\/ 也可以直接这样，可以参考createStore\n\/\/ createStore(\n\/\/     rootReducer,\n\/\/     applyMiddleware(logger)\n\/\/ )\nexport default store;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/利用中间件做打印log\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {createStore,applyMiddleware} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e logger \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/api\/logger\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e rootReducer \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/reducer\/rootReducer\x27\x3c\/span\x3e;\n\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e createStoreWithMiddleware = applyMiddleware(logger)(createStore);\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e store = createStoreWithMiddleware(rootReducer);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 也可以直接这样，可以参考createStore\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ createStore(\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/     rootReducer,\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/     applyMiddleware(logger)\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ )\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e store;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3elogger 中间件结构分析\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const logger = store =\x3e next =\x3e action =\x3e {\n    let result = next(action); \/\/ 返回的也是同样的action值\n    console.log(\x27dispatch\x27, action);\n    console.log(\x27nextState\x27, store.getState());\n    return result;\n};\n\nexport default logger;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e logger = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = next(action); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回的也是同样的action值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dispatch\x27\x3c\/span\x3e, action);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27nextState\x27\x3c\/span\x3e, store.getState());\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e logger;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3estore =\x26gt; next =\x26gt; action =\x26gt;{}\x3c\/code\x3e 实现了三层函数嵌套,最后返回 \x3ccode\x3enext\x3c\/code\x3e ，给下一个中间件使用,接下来把三层函数拆解；\x3c\/p\x3e\n\x3ch4\x3e从applyMiddleware源码开始分析\x3c\/h4\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/\/redux\/src\/applyMiddleware.js\nexport default function applyMiddleware(...middlewares) {\n    return (createStore) =\x3e (reducer, initialState, enhancer) =\x3e {\n        var store = createStore(reducer, initialState, enhancer)\n        var dispatch = store.dispatch\n        var chain = []\n        var middlewareAPI = {\n            getState: store.getState,\n            dispatch: (action) =\x3e dispatch(action)\n        }\n        chain = middlewares.map(middleware =\x3e middleware(middlewareAPI))\n        dispatch = compose(...chain)(store.dispatch)\n        return {\n            ...store,\n            dispatch\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/\/redux\/src\/applyMiddleware.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapplyMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...middlewares\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecreateStore\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (reducer, initialState, enhancer) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = createStore(reducer, initialState, enhancer)\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dispatch = store.dispatch\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e chain = []\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e middlewareAPI = {\n            \x3cspan class=\x22hljs-attr\x22\x3egetState\x3c\/span\x3e: store.getState,\n            \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e dispatch(action)\n        }\n        chain = middlewares.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emiddleware\x3c\/span\x3e =\x26gt;\x3c\/span\x3e middleware(middlewareAPI))\n        dispatch = compose(...chain)(store.dispatch)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n            ...store,\n            dispatch\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e最外层store\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/源码分析\nchain = middlewares.map(middleware =\x3e middleware(middlewareAPI));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/源码分析\x3c\/span\x3e\nchain = middlewares.map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3emiddleware\x3c\/span\x3e =\x26gt;\x3c\/span\x3e middleware(middlewareAPI));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们发现store是middlewareAPI,\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/store\nvar middlewareAPI = {\n    getState: store.getState,\n    dispatch: (action) =\x3e dispatch(action)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/store\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e middlewareAPI = {\n    \x3cspan class=\x22hljs-attr\x22\x3egetState\x3c\/span\x3e: store.getState,\n    \x3cspan class=\x22hljs-attr\x22\x3edispatch\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e dispatch(action)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后就剩下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22next =\x3e action =\x3e {\n    let result = next(action); \/\/ 返回的也是同样的action值\n    console.log(\x27dispatch\x27, action);\n    console.log(\x27nextState\x27, store.getState());\n    return result;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3enext =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = next(action); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回的也是同样的action值\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dispatch\x27\x3c\/span\x3e, action);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27nextState\x27\x3c\/span\x3e, store.getState());\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e中间层next\x3c\/h5\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/源码分析\ndispatch = compose(...chain)(store.dispatch)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/源码分析\x3c\/span\x3e\ndispatch = compose(...chain)(store.dispatch)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e先来分析compose(...chain)\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/compose源码\nexport default function compose(...funcs) {\n    if (funcs.length === 0) {\n        return arg =\x3e arg\n    }\n\n    if (funcs.length === 1) {\n        return funcs[0]\n    }\n\n    const last = funcs[funcs.length - 1]\n    const rest = funcs.slice(0, -1)\n    return (...args) =\x3e rest.reduceRight((composed, f) =\x3e f(composed), last(...args))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/compose源码\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecompose\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e...funcs\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (funcs.length === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3earg\x3c\/span\x3e =\x26gt;\x3c\/span\x3e arg\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (funcs.length === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e funcs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e last = funcs[funcs.length - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rest = funcs.slice(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e...args\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e rest.reduceRight(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomposed, f\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e f(composed), last(...args))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ecompose利用\x3ca href=\x22https:\/\/developer.mozilla.org\/zh-CN\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Array\/ReduceRight\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eArray.prototype.reduceRight\x3c\/a\x3e的方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/reduceRight遍历介绍\n[0, 1, 2, 3, 4].reduceRight(function(previousValue, currentValue, index, array) {\n    return previousValue \x2b currentValue;\n}, 10);\n\n\/\/结果 10\x2b4\x2b3\x2b2\x2b1\x2b0 = 20\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/reduceRight遍历介绍\x3c\/span\x3e\n[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e].reduceRight(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epreviousValue, currentValue, index, array\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e previousValue \x2b currentValue;\n}, \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/结果 10\x2b4\x2b3\x2b2\x2b1\x2b0 = 20\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因为我们这里的中间件就只有一个，所以没有使用到reduceRight直接返回，直接返回\x3ccode\x3efunc[0]\x3c\/code\x3e（本身）;再由\x3ccode\x3ecompose(...chain)(store.dispatch)\x3c\/code\x3e,我们可以知道next就是store.dispatch\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(action) =\x3e {\n    let result = store.dispatch(action); \/\/ 这里的next就是store.dispatch\n    console.log(\x27dispatch\x27, action);\n    console.log(\x27nextState\x27, store.getState());\n    return result;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(action) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = store.dispatch(action); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里的next就是store.dispatch\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27dispatch\x27\x3c\/span\x3e, action);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27nextState\x27\x3c\/span\x3e, store.getState());\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们之后调用的\x3ccode\x3edispath\x3c\/code\x3e就是触发的是上面这个函数（这里就单个中间件）；\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e多个中间件\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e通过上面的 \x3ccode\x3eapplyMiddleware\x3c\/code\x3e , \x3ccode\x3ecompose\x3c\/code\x3e 和中间件的结构，\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e假设应用了如下的中间件: [A, B, C]，这里我们使用es5的结构做分析\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e分析action触发的完整流程\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e三个中间件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/A\nfunction A(store) {\n    return function A(next) {\n        return function A(action) {\n            \/*...*\/;\n            next(action);\n            \/*...*\/;\n            return \/*...*\/;\n        }\n    }\n}\n\/\/B\nfunction B(store) {\n    return function B(next) {\n        return function B(action) {\n            \/*...*\/;\n            next(action);\n            \/*...*\/;\n            return \/*...*\/;\n        }\n    }\n}\n\/\/C\nfunction C(store) {\n    return function C(next) {\n        return function C(action) {\n            \/*...*\/;\n            next(action);\n            \/*...*\/;\n            return \/*...*\/;\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/A\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            next(action);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        }\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/B\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            next(action);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        }\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/C\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estore\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            next(action);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过\x3ccode\x3echain = middlewares.map(middleware =\x26gt; middleware(middlewareAPI))\x3c\/code\x3e，三个中间件的状态变化\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/A\nfunction A(next) {\n    return function A(action) {\n        \/*...*\/;\n        next(action);\n        \/*...*\/;\n        return \/*...*\/;\n    }\n}\n\/\/B\nfunction B(next) {\n    return function B(action) {\n        \/*...*\/;\n        next(action);\n        \/*...*\/;\n        return \/*...*\/;\n    }\n}\n\/\/C\nfunction C(next) {\n    return function C(action) {\n        \/*...*\/;\n        next(action);\n        \/*...*\/;\n        return \/*...*\/;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/A\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        next(action);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/B\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        next(action);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/C\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        next(action);\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再由\x3ccode\x3edispatch = compose(...chain)(store.dispatch)\x3c\/code\x3e，我们转化下\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const last = C;\nconst rest = [A,B]\ndispatch = rest.reduceRight(\n    (composed, f) =\x3e{\n        return f(composed)\n    }, \n    last(store.dispatch)\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e last = C;\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e rest = [A,B]\ndispatch = rest.reduceRight(\n    \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecomposed, f\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e f(composed)\n    }, \n    last(store.dispatch)\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们得到的结果\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dispatch = A(B(C(store.dispatch)));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3edispatch = A(B(C(store.dispatch)));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e进一步分析，我们得到的结果\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22dispatch = A(B(C(store.dispatch)));\n\n\/\/执行C(next)，得到结果\n\nA(B(function C(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;})); \n\/\/此时的next = store.dispatch\n\n\/\/继续执行B(next)\nA(function B(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;});    \n\/\/此时的next = function C(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;}\n\n\/\/继续执行A(next)\nfunction A(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;};\n\/\/此时的next = function B(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3edispatch = A(B(C(store.dispatch)));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/执行C(next)，得到结果\x3c\/span\x3e\n\nA(B(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eC\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;next(action);\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;})); \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/此时的next = store.dispatch\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/继续执行B(next)\x3c\/span\x3e\nA(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;next(action);\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;});    \n\x3cspan class=\x22hljs-comment\x22\x3e\/\/此时的next = function C(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;}\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/继续执行A(next)\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e) \x3c\/span\x3e{\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;next(action);\x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e;};\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/此时的next = function B(action) {\/*...*\/;next(action);\/*...*\/;return \/*...*\/;}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e一个action触发执行顺序，\x3ccode\x3eA(action) -\x26gt; B(action) -\x26gt; C(action) -\x26gt; store.dispatch(action)\x3c\/code\x3e(生产最新的 store 数据);\x3c\/p\x3e\n\x3cp\x3e如果\x3ccode\x3enext(action)\x3c\/code\x3e下面还有需要执行的代码，继续执行 \x3ccode\x3eC(next 后的代码)-\x26gt;B(next 后的代码)-\x26gt;A(next 后的代码)\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e总结：先从内到外生成新的func，然后由外向内执行。本来我们可以直接使用\x3ccode\x3estore.dispatch(action)\x3c\/code\x3e,但是我们可以通过中间件对action做一些处理或转换，比如异步操作，异步回调后再执行next；这样的设计很巧妙，只有等待next，才可以继续做操作，和平时直接异步回调又有些不一样\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e项目实践 -\x26gt;异步\x3c\/h2\x3e\n\x3cp\x3e我们知道redux中actions分为actionType，actionCreator，然后在由reducer进行修改数据；\x3c\/p\x3e\n\x3cp\x3e官方例子中async直接在actionCreator做了ajax请求；\x3c\/p\x3e\n\x3cp\x3e我们把ajax放入中间件触发下面要讲的与官方real-world类似\x3c\/p\x3e\n\x3cp\x3e我这边使用\x3ca href=\x22https:\/\/github.com\/gaearon\/redux-thunk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-thunk\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22applyMiddleware(reduxThunk, api)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3eapplyMiddleware(reduxThunk, api)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e先来看看redux-thunk的源码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function createThunkMiddleware(extraArgument) {\n    return ({ dispatch, getState }) =\x3e next =\x3e action =\x3e {\n        if (typeof action === \x27function\x27) {\/\/重新分发\n            return action(dispatch, getState, extraArgument);\n        }\n        return next(action);\/\/传递给下一个中间件\n    };\n}\n\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateThunkMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eextraArgument\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ dispatch, getState }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e action === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\x3cspan class=\x22hljs-comment\x22\x3e\/\/重新分发\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action(dispatch, getState, extraArgument);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action);\x3cspan class=\x22hljs-comment\x22\x3e\/\/传递给下一个中间件\x3c\/span\x3e\n    };\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e thunk;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样一来我们可以把异步写成一个复用的actionCreator；\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import * as types from \x27..\/..\/constants\/actions\/common\x27;\n\nexport function request(apiName, params, opts = {}) {\n    return (dispatch, getState) =\x3e {\n        let action = {\n            \x27API\x27: {\n                apiName: apiName,\n                params: params,\n                opts: opts\n            },\n            type: types.API_REQUEST\n        };\n        return dispatch(action);\n    };\n}\n\n\n\/\/其他地方调用复用的方法如下：\nexport { request } from \x27.\/request\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e types \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/..\/constants\/actions\/common\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eapiName, params, opts = {}\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3edispatch, getState\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e action = {\n            \x3cspan class=\x22hljs-string\x22\x3e\x27API\x27\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-attr\x22\x3eapiName\x3c\/span\x3e: apiName,\n                \x3cspan class=\x22hljs-attr\x22\x3eparams\x3c\/span\x3e: params,\n                \x3cspan class=\x22hljs-attr\x22\x3eopts\x3c\/span\x3e: opts\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: types.API_REQUEST\n        };\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e dispatch(action);\n    };\n}\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/其他地方调用复用的方法如下：\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e { request } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/request\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e正常的写法，不是异步的，就是之前的写法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export function cartSelect(id) {\n    return { \n        type: types.CART_MAIN_SELECT, \n        id\n    };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecartSelect\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: types.CART_MAIN_SELECT, \n        id\n    };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后就是下一个中间件的处理 api.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/自己封装的ajax，可以使用别的，比如isomorphic-fetch\nimport net from \x27net\x27;\n\/\/项目中全部的接口，相当于一个关于异步的actionType有一个对应的后端接口\nimport API_ROOT from \x27apiRoot\x27;\n\nexport default store =\x3e next =\x3e action =\x3e {\n    let API_OPT = action[\x27API\x27];\n\n    if (!API_OPT) {\n        \/\/我们约定这个没声明，就不是我们设计的异步action，执行下一个中间件\n        return next(action);\n    }\n\n    let ACTION_TYPE = action[\x27type\x27];\n    let { apiName, params = {} , opts = {} } = API_OPT;\n    \/**\n     * 如果有传递localData，就不会触发ajax了，直接触发_success\n     * 当前也可以传其他参数\n     *\/\n    let { localData } = opts;\n    let {\n        onSuccess,\n        onError,\n        onProgress,\n        ajaxType = \x27GET\x27,\n        param\n    } = params;\n    \/\/ 触发下一个action\n    let nextAction = function(type, param, opts) {\n        action[\x27type\x27] = type;\n        action[\x27opts\x27] = opts;\n        delete param[\x27onSuccess\x27];\n        delete param[\x27onError\x27];\n        const nextRequestAction = {...action,...param}\n        return nextRequestAction;\n    };\n\n    params={\n        ...params,\n        data: null\n    };\n    \/\/ 触发正在请求的action\n    let result = next(nextAction(apiName \x2b \x27_ON\x27, params, opts));\n    net.ajax({\n        url: API_ROOT[apiName],\n        type: ajaxType,\n        param,\n        localData,\n        success: data =\x3e {\n            onSuccess \x26amp;\x26amp; onSuccess(data);\n            params={\n                ...params,\n                data\n            };\n            \/\/触发请求成功的action\n            return next(nextAction(apiName \x2b \x27_SUCCESS\x27, params, opts));\n        },\n        error: data =\x3e {\n            onError \x26amp;\x26amp; onError(data);\n            \/\/触发请求失败的action\n            return next(nextAction(apiName \x2b \x27_ERROR\x27, params, opts));\n        }\n    });\n\n    return result;\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/自己封装的ajax，可以使用别的，比如isomorphic-fetch\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e net \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27net\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/项目中全部的接口，相当于一个关于异步的actionType有一个对应的后端接口\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e API_ROOT \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27apiRoot\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e store =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e =\x26gt;\x3c\/span\x3e action =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e API_OPT = action[\x3cspan class=\x22hljs-string\x22\x3e\x27API\x27\x3c\/span\x3e];\n\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!API_OPT) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/我们约定这个没声明，就不是我们设计的异步action，执行下一个中间件\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ACTION_TYPE = action[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e];\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { apiName, params = {} , opts = {} } = API_OPT;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * 如果有传递localData，就不会触发ajax了，直接触发_success\n     * 当前也可以传其他参数\n     *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e { localData } = opts;\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e {\n        onSuccess,\n        onError,\n        onProgress,\n        ajaxType = \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e,\n        param\n    } = params;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发下一个action\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e nextAction = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etype, param, opts\x3c\/span\x3e) \x3c\/span\x3e{\n        action[\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e] = type;\n        action[\x3cspan class=\x22hljs-string\x22\x3e\x27opts\x27\x3c\/span\x3e] = opts;\n        \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e param[\x3cspan class=\x22hljs-string\x22\x3e\x27onSuccess\x27\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e param[\x3cspan class=\x22hljs-string\x22\x3e\x27onError\x27\x3c\/span\x3e];\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e nextRequestAction = {...action,...param}\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e nextRequestAction;\n    };\n\n    params={\n        ...params,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    };\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 触发正在请求的action\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result = next(nextAction(apiName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_ON\x27\x3c\/span\x3e, params, opts));\n    net.ajax({\n        \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: API_ROOT[apiName],\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: ajaxType,\n        param,\n        localData,\n        \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            onSuccess \x26amp;\x26amp; onSuccess(data);\n            params={\n                ...params,\n                data\n            };\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/触发请求成功的action\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(nextAction(apiName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_SUCCESS\x27\x3c\/span\x3e, params, opts));\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            onError \x26amp;\x26amp; onError(data);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/触发请求失败的action\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(nextAction(apiName \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_ERROR\x27\x3c\/span\x3e, params, opts));\n        }\n    });\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result;\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e强调一点：项目中全部的接口，相当于一个关于异步的actionType有一个对应的后端接口，所以我们才可以通过API_ROOT[apiName]找到这个接口\x3c\/p\x3e\n\x3cp\x3e以cart为列子(下面是对应的每个文件)：\x3c\/p\x3e\n\x3cp\x3eactionType：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/异步\nexport const CART_MAIN_GET = \x27CART_MAIN_GET\x27;\n\/\/非异步\nexport const CART_MAIN_SELECT = \x27CART_MAIN_SELECT\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/异步\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e CART_MAIN_GET = \x3cspan class=\x22hljs-string\x22\x3e\x27CART_MAIN_GET\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/非异步\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e CART_MAIN_SELECT = \x3cspan class=\x22hljs-string\x22\x3e\x27CART_MAIN_SELECT\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eapi:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const api = {\n    \x27CART_MAIN_GET\x27:\x27\/shopping-cart\/show-shopping-cart\x27\n};\nexport default api;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e api = {\n    \x3cspan class=\x22hljs-string\x22\x3e\x27CART_MAIN_GET\x27\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27\/shopping-cart\/show-shopping-cart\x27\x3c\/span\x3e\n};\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e api;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eAPIROOT修改：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import cart from \x27.\/api\/cart\x27;\nconst APIROOT = {\n    ...cart\n};\nexport default API;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e cart \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/api\/cart\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e APIROOT = {\n    ...cart\n};\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e API;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eactionCreator:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/项目中使用redux的bindActionCreators做一个统一的绑定，所以在这里单独引入\nexport { request } from \x27.\/request\x27;\n\/\/下面是非异步的方法\nexport function cartSelect(id) {\n    return { \n        type: types.CART_MAIN_SELECT, \n        id\n    };\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/项目中使用redux的bindActionCreators做一个统一的绑定，所以在这里单独引入\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e { request } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/request\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/下面是非异步的方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecartSelect\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eid\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e { \n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: types.CART_MAIN_SELECT, \n        id\n    };\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e项目中发起结构是这样的:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let url = types.CART_MAIN_GET;\nlet param = {};\nlet params = {\n    param: param,\n    ajaxType: \x27GET\x27,\n    onSuccess: (res) =\x3e {\n        \/*...*\/\n    },\n    onError: (res) =\x3e {\n        \/*...*\/\n    }\n};\nrequest(url, params, {});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e url = types.CART_MAIN_GET;\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e param = {};\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e params = {\n    \x3cspan class=\x22hljs-attr\x22\x3eparam\x3c\/span\x3e: param,\n    \x3cspan class=\x22hljs-attr\x22\x3eajaxType\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eonSuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eonError\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n    }\n};\nrequest(url, params, {});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其对应的reducers就是下面\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import * as types from \x27..\/constants\/actions\/cart\x27;\nconst initialState = {\n    main:{\n        isFetching: 0,\/\/是否已经获取 \n        didInvalidate:1,\/\/是否失效\n        itemArr:[],\/\/自定义模版\n        itemObj:{},\/\/自定义模版数据\n        header:{}\/\/头部导航\n    }\n};\nexport default function(state = initialState, action) {\n    let newState;\n    switch (action.type) {\n        case types.HOME_MAIN_GET \x2b \x27_ON\x27:\/\/可以不写\n            \/*...*\/\n            return newState;\n        case types.HOME_MAIN_GET \x2b \x27_SUCCESS\x27:\n            \/*...*\/\n            return newState;\n        case types.HOME_MAIN_GET \x2b \x27_ERROR\x27:\/\/可以不写\n            \/*...*\/\n            return newState;\n        default:\n            return state;\n    }\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs haxe\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * as types from \x3cspan class=\x22hljs-string\x22\x3e\x27..\/constants\/actions\/cart\x27\x3c\/span\x3e;\nconst initialState = {\n    main:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e{\n        isFetching: \x3cspan class=\x22hljs-type\x22\x3e0\x3c\/span\x3e,\x3cspan class=\x22hljs-comment\x22\x3e\/\/是否已经获取 \x3c\/span\x3e\n        didInvalidate:\x3cspan class=\x22hljs-type\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-comment\x22\x3e\/\/是否失效\x3c\/span\x3e\n        itemArr:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e[],\x3cspan class=\x22hljs-comment\x22\x3e\/\/自定义模版\x3c\/span\x3e\n        itemObj:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e{},\x3cspan class=\x22hljs-comment\x22\x3e\/\/自定义模版数据\x3c\/span\x3e\n        header:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e{}\x3cspan class=\x22hljs-comment\x22\x3e\/\/头部导航\x3c\/span\x3e\n    }\n};\nexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e(state = initialState, action) {\n    let \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eState\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3eswitch\x3c\/span\x3e (action.type) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e types.HOME_MAIN_GET \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_ON\x27\x3c\/span\x3e:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e\/\/可以不写\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eState\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e types.HOME_MAIN_GET \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_SUCCESS\x27\x3c\/span\x3e:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eState\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3ecase\x3c\/span\x3e types.HOME_MAIN_GET \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_ERROR\x27\x3c\/span\x3e:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e\/\/可以不写\n            \x3cspan class=\x22hljs-comment\x22\x3e\/*...*\/\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e\x3cspan class=\x22hljs-type\x22\x3eState\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e:\x3cspan class=\x22hljs-type\x22\x3e\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e state;\n    }\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e异步，数据验证都可以通过中间件做处理；引用Generator，Async\/Await，Promise处理，可以参考社区中的一些其他方式，比如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/github.com\/acdlite\/redux-promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/yelouafi\/redux-saga\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-saga\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React 项目中Redux 中间件的理解</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007843340">https://segmentfault.com/a/1190000007843340</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/jgugdyg50l/" target="_blank">https://alili.tech/archive/jgugdyg50l/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>