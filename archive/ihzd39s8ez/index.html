<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Chrome扩展程序开发"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Chrome扩展程序开发 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ihzd39s8ez/",
				"appid": "1613049289050283", 
				"title": "Chrome扩展程序开发 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-02T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/aw28vi5cfx9/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/vbm4p9jyc3/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&text=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&text=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&title=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&is_video=false&description=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&title=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&title=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&title=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fihzd39s8ez%2f&title=Chrome%e6%89%a9%e5%b1%95%e7%a8%8b%e5%ba%8f%e5%bc%80%e5%8f%91"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Chrome扩展程序开发</h1><div class="meta"><div class="postdate"><time datetime="2019-02-02" itemprop="datePublished">2019-02-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\n\x3cp\x3e十一在家无聊时开发了这个项目。其出发点是想通过chrome插件，来保存网页上选中的文本。后来就顺手把前后端都做了(Koa2 \x2b React)：\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/ecmadao\/cliper-chrome\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3echrome插件源码\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/ecmadao\/cliper-backend\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e插件对应的前后端源码\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader0\x22\x3e概述\x3c\/h3\x3e\n\x3ch4\x3echrome扩展程序\x3c\/h4\x3e\n\x3cp\x3echrome扩展程序大家应该都很熟悉了，它可以通过脚本帮我们完成一些快速的操作。通过插件可以捕捉到网页内容、标签页、本地存储，或者用户的操作行为；它也可以在一定程度上改变浏览器的UI，例如页面上右键的菜单、浏览器右上角点击插件logo后的弹窗，或者浏览器新标签页\x3c\/p\x3e\n\x3ch4\x3e开发缘由\x3c\/h4\x3e\n\x3cp\x3e按照惯例，开发前多问问自己 why? how?\x3c\/p\x3e\n\x3cp\x3ewhy：\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e我在平常看博文时，对于一些段落想进行摘抄或者备注，又懒得复制粘贴\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cp\x3ehow：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e一个chrome扩展程序，可以通过鼠标右键的菜单，或者键盘快捷键快速保存当前页面上选择的文本\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果没有选择文本，则保存网页链接\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e要有对应的后台服务，保存 user、cliper、page (后话，本文不涉及)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e还要有对应的前端，以便浏览我的保存记录 (后话，本文不涉及)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e先上个成果图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVEixj?w=424\x26amp;h=664\x22 src=\x22https:\/\/static.alili.tech\/img\/bVEixj?w=424\x26amp;h=664\x22 alt=\x22chrome extension - login\x22 title=\x22chrome extension - login\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVEixj?w=424\x26amp;h=664\x22 src=\x22https:\/\/static.alili.tech\/img\/bVEixj?w=424\x26amp;h=664\x22 alt=\x22chrome extension - info\x22 title=\x22chrome extension - info\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVEixp?w=1960\x26amp;h=1420\x22 src=\x22https:\/\/static.alili.tech\/img\/bVEixp?w=1960\x26amp;h=1420\x22 alt=\x22chrome extension - frontend\x22 title=\x22chrome extension - frontend\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eclip 有剪辑之意，因此项目命名为 cliper\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这两天终于安奈不住买了服务器，终于把网址部署了，也上线了chrome插件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/cliper.com.cn\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecliper\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/chrome.google.com\/webstore\/detail\/biijehenaabpogldekblkfgooifmagbi\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecliper extension\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/manifest\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3emanifest.json\x3c\/code\x3e\x3c\/a\x3e\x3c\/h3\x3e\n\x3cp\x3e在项目根目录下创建\x3ccode\x3emanifest.json\x3c\/code\x3e文件，其中会涵盖扩展程序的基本信息，并指明需要的权限和资源文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \/\/ 以下为必写\n  \x26quot;manifest_version\x26quot;: 2, \/\/ 必须为2，1号版本已弃用\n  \x26quot;name\x26quot;: \x26quot;cliper\x26quot;, \/\/ 扩展程序名称\n  \x26quot;version\x26quot;: \x26quot;0.01\x26quot;, \/\/ 版本号\n  \n  \/\/ 以下为选填\n  \n  \/\/ 推荐\n  \x26quot;description\x26quot;: \x26quot;描述\x26quot;,\n  \x26quot;icons\x26quot;: {\n    \x26quot;16\x26quot;: \x26quot;icons\/icon_16.png\x26quot;,\n    \x26quot;48\x26quot;: \x26quot;icons\/icon_48.png\x26quot;,\n    \x26quot;64\x26quot;: \x26quot;icons\/icon_64.png\x26quot;,\n    \x26quot;128\x26quot;: \x26quot;icons\/icon_128.png\x26quot;\n  },\n  \x26quot;author\x26quot;: \x26quot;ecmadao\x26quot;,\n  \n  \/\/ 根据自己使用的权限填写\n  \x26quot;permissions\x26quot;: [\n    \/\/ 例如\n    \x26quot;tab\x26quot;,\n    \x26quot;storage\x26quot;,\n    \/\/ 如果会在js中请求外域API或者资源，则要把外域链接加入\n    \x26quot;http:\/\/localhost:5000\/*\x26quot;\n  ],\n  \n  \/\/ options_page，指右键点击右上角里的插件logo时，弹出列表中的“选项”是否可点，以及在可以点击时，左键点击后打开的页面\n  \x26quot;options_page\x26quot;: \x26quot;view\/options.html\x26quot;,\n  \n  \/\/ browser_action，左键点击右上角插件logo时，弹出的popup框。不填此项则点击logo不会有用\n  \x26quot;browser_action\x26quot;: {\n    \x26quot;default_icon\x26quot;: {\n      \x26quot;38\x26quot;: \x26quot;icons\/icon_38.png\x26quot;\n    },\n    \x26quot;default_popup\x26quot;: \x26quot;view\/popup.html\x26quot;, \/\/ popup页面，其实就是普通的html\n    \x26quot;default_title\x26quot; : \x26quot;保存到cliper\x26quot;\n  },\n  \n  \/\/ background，后台执行的文件，一般只需要指定js即可。会在浏览器打开后全局范围内后台运行\n  \x26quot;background\x26quot;: {\n    \x26quot;scripts\x26quot;: [\x26quot;js\/vendor\/jquery-3.1.1.min.js\x26quot;, \x26quot;js\/background.js\x26quot;],\n    \/\/ persistent代表“是否持久”。如果是一个单纯的全局后台js，需要一直运行，则不需配置persistent（或者为true）。当配置为false时转变为事件js，依旧存在于后台，在需要时加载，空闲时卸载\n    \x26quot;persistent\x26quot;: false\n  },\n  \n  \/\/ content_scripts，在各个浏览器页面里运行的文件，可以获取到当前页面的上下文DOM\n  \x26quot;content_scripts\x26quot;: [\n    {\n      \/\/ matches 匹配 content_scripts 可以在哪些页面运行\n      \x26quot;matches\x26quot; : [\x26quot;http:\/\/*\/*\x26quot;, \x26quot;https:\/\/*\/*\x26quot;],\n      \x26quot;js\x26quot;: [\x26quot;js\/vendor\/jquery-3.1.1.min.js\x26quot;, \x26quot;js\/vendor\/keyboard.min.js\x26quot;, \x26quot;js\/selection.js\x26quot;, \x26quot;js\/notification.js\x26quot;],\n      \x26quot;css\x26quot;: [\x26quot;css\/notification.css\x26quot;]\n    }\n  ]\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以下为必写\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22manifest_version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 必须为2，1号版本已弃用\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22name\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cliper\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 扩展程序名称\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x220.01\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 版本号\x3c\/span\x3e\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 以下为选填\x3c\/span\x3e\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 推荐\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22description\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22描述\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-string\x22\x3e\x22icons\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x2216\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22icons\/icon_16.png\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x2248\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22icons\/icon_48.png\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x2264\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22icons\/icon_64.png\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22128\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22icons\/icon_128.png\x22\x3c\/span\x3e\n  },\n  \x3cspan class=\x22hljs-string\x22\x3e\x22author\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22ecmadao\x22\x3c\/span\x3e,\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据自己使用的权限填写\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22permissions\x22\x3c\/span\x3e: [\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 例如\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22tab\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x22storage\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果会在js中请求外域API或者资源，则要把外域链接加入\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/localhost:5000\/*\x22\x3c\/span\x3e\n  ],\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ options_page，指右键点击右上角里的插件logo时，弹出列表中的“选项”是否可点，以及在可以点击时，左键点击后打开的页面\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22options_page\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22view\/options.html\x22\x3c\/span\x3e,\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ browser_action，左键点击右上角插件logo时，弹出的popup框。不填此项则点击logo不会有用\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22browser_action\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22default_icon\x22\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x2238\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22icons\/icon_38.png\x22\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-string\x22\x3e\x22default_popup\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22view\/popup.html\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ popup页面，其实就是普通的html\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22default_title\x22\x3c\/span\x3e : \x3cspan class=\x22hljs-string\x22\x3e\x22保存到cliper\x22\x3c\/span\x3e\n  },\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ background，后台执行的文件，一般只需要指定js即可。会在浏览器打开后全局范围内后台运行\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22background\x22\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22js\/vendor\/jquery-3.1.1.min.js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22js\/background.js\x22\x3c\/span\x3e],\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ persistent代表“是否持久”。如果是一个单纯的全局后台js，需要一直运行，则不需配置persistent（或者为true）。当配置为false时转变为事件js，依旧存在于后台，在需要时加载，空闲时卸载\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e\x22persistent\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  },\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ content_scripts，在各个浏览器页面里运行的文件，可以获取到当前页面的上下文DOM\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e\x22content_scripts\x22\x3c\/span\x3e: [\n    {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ matches 匹配 content_scripts 可以在哪些页面运行\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e\x22matches\x22\x3c\/span\x3e : [\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/*\/*\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/*\/*\x22\x3c\/span\x3e],\n      \x3cspan class=\x22hljs-string\x22\x3e\x22js\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22js\/vendor\/jquery-3.1.1.min.js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22js\/vendor\/keyboard.min.js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22js\/selection.js\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22js\/notification.js\x22\x3c\/span\x3e],\n      \x3cspan class=\x22hljs-string\x22\x3e\x22css\x22\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22css\/notification.css\x22\x3c\/span\x3e]\n    }\n  ]\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e综上，我们一共有三种资源文件，针对着三个运行环境：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ebrowser_action\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e控制logo点击后出现的弹窗，涵盖相关的html\/js\/css\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在弹窗中，会进行登录\/注册的操作，并将用户信息保存在本地储存中。已登录用户则展现基本信息\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3ebackground\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e在后台持续运行，或者被事件唤醒后运行\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e右键菜单的点击和异步保存事件将在这里触发\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ccode\x3econtent_scripts\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e当前浏览的页面里运行的文件，可以操作DOM\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e因此，我会在这个文件里监听用户的选择事件\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e注：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3econtent_scripts\x3c\/code\x3e中如果没有\x3ccode\x3ematches\x3c\/code\x3e，则扩展程序无法正常加载，也不能通过“加载未封装的扩展程序”来添加。如果你的\x3ccode\x3econtent_scripts\x3c\/code\x3e中有js可以针对所有页面运行，则填写\x3ccode\x3e\x22matches\x22 : [\x22http:\/\/*\/*\x22, \x22https:\/\/*\/*\x22]\x3c\/code\x3e即可\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e推荐将\x3ccode\x3ebackground\x3c\/code\x3e中的\x3ccode\x3epersistent\x3c\/code\x3e设置为\x3ccode\x3efalse\x3c\/code\x3e，根据事件来运行后台js\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e不同运行环境JS的绳命周期\x3c\/h3\x3e\n\x3cp\x3e如上所述，三种JS有着三种运行环境，它们的生命周期、可操作DOM\/接口也不同\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/content_scripts\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3econtent_scripts\x3c\/code\x3e\x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3econtent_scripts\x3c\/code\x3e会在每个标签页初始化加载的时候进行调用，关闭页面时卸载\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e内容脚本，在每个标签页下运行。虽然它可以访问到页面DOM，但无法访问到这个里面里，其他JS文件创建的全局变量或者函数。也就是说，各个\x3ccode\x3econtent_scripts\x3c\/code\x3e(以及外部JS文件)之间是相互独立的，只有：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;content_scripts\x26quot;: [\n  {\n    \x26quot;js\x26quot;: [...]\n  }\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22content_scripts\x22\x3c\/span\x3e: [\n  {\n    \x3cspan class=\x22hljs-string\x22\x3e\x22js\x22\x3c\/span\x3e: [...]\n  }\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ejs\x3c\/code\x3e所定义的一个Array里的各个JS可以相互影响。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/event_pages\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ebackground\x3c\/code\x3e\x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e官方建议将后台js配置为\x3ccode\x3e\x22persistent\x22: false\x3c\/code\x3e，以便在需要时加载，再次进入空闲状态后卸载\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e什么时候会让\x3ccode\x3ebackground\x3c\/code\x3e的资源文件加载呢？\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e应用程序第一次安装或者更新\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e监听某个事件触发(例如\x3ccode\x3echrome.runtime.onInstalled.addListener\x3c\/code\x3e)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e监听其他环境的JS文件发送消息(例如\x3ccode\x3echrome.runtime.onMessage.addListener\x3c\/code\x3e)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e扩展程序的其他资源文件调用了\x3ccode\x3eruntime.getBackgroundPage\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/browserAction\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3ebrowser_action\x3c\/code\x3e\x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3ebrowser_action\x3c\/code\x3e里的资源会在弹窗打开时初始化，关闭时卸载\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ccode\x3ebrowser_action\x3c\/code\x3e里定义的JS\/CSS运行环境仅限于popup，并且会在每次点开弹窗的时候初始化。但是它可以调用一些\x3ccode\x3echrome api\x3c\/code\x3e，以此来和其他js进行交互\x3c\/p\x3e\n\x3cp\x3e除此以外：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ebrowser_action\x3c\/code\x3e的HTML文件里使用的JS，不能直接以\x3ccode\x3e\x26lt;script\x26gt;\x26lt;\/script\x26gt;\x3c\/code\x3e的形式行内写入HTML里，需要独立成JS文件再引入\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果有其他第三方依赖，比如\x3ccode\x3ejQuery\x3c\/code\x3e等文件，也无法通过CDN引入，而需要保持资源文件到项目目录后再引入\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e不同运行环境JS之间的交互\x3c\/h3\x3e\n\x3cp\x3e虽然运行环境和绳命周期都不相同，但幸运的是，chrome为我们提供了一些三种JS都通用的API，可以起到JS之间相互通讯的效果。\x3c\/p\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/runtime\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3echrome.runtime\x3c\/a\x3e\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/apps\/messaging\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e消息传递\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch5\x3e普通的消息传递\x3c\/h5\x3e\n\x3cp\x3e通过\x3ccode\x3eruntime\x3c\/code\x3e的\x3ccode\x3eonMessage\x3c\/code\x3e、\x3ccode\x3esendMessage\x3c\/code\x3e等方法，可以在各个JS之间传递并监听消息。举个栗子：\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3epopup.js\x3c\/code\x3e中，我们让它初始化之后发送一个消息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chrome.runtime.sendMessage({\n  method: \x27showAlert\x27\n}, function(response) {});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echrome.runtime.sendMessage({\n  \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27showAlert\x27\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在\x3ccode\x3ebackground.js\x3c\/code\x3e中，监听消息的接收，并进行处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {\n  if (message.method === \x27showAlert\x27) {\n    alert(\x27showAlert\x27);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echrome.runtime.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, sender, sendResponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (message.method === \x3cspan class=\x22hljs-string\x22\x3e\x27showAlert\x27\x3c\/span\x3e) {\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x27showAlert\x27\x3c\/span\x3e);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上代码，会在每次打开插件弹窗的时候弹出一个Alert。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3echrome.runtime\x3c\/code\x3e的常用方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 获取当前扩展程序中正在运行的后台网页的 JavaScript window 对象\nchrome.runtime.getBackgroundPage(function (backgroundPage) {\n  \/\/ backgroundPage 即 window 对象\n});\n\/\/ 发送消息\nchrome.runtime.sendMessage(message, function(response) {\n  \/\/ response 代表消息回复，可以接受到通过 sendResponse 方法发送的消息回复\n});\n\/\/ 监听消息\nchrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {\n  \/\/ message 就是你发送的 message\n  \/\/ sender 代表发送者，可以通过 sender.tab 判断消息是否是从内容脚本发出\n  \/\/ sendResponse 可以直接发送回复，如：\n  sendResponse({\n    method: \x27response\x27,\n    message: \x27send a response\x27\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取当前扩展程序中正在运行的后台网页的 JavaScript window 对象\x3c\/span\x3e\nchrome.runtime.getBackgroundPage(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ebackgroundPage\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ backgroundPage 即 window 对象\x3c\/span\x3e\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送消息\x3c\/span\x3e\nchrome.runtime.sendMessage(message, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ response 代表消息回复，可以接受到通过 sendResponse 方法发送的消息回复\x3c\/span\x3e\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听消息\x3c\/span\x3e\nchrome.runtime.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, sender, sendResponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ message 就是你发送的 message\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sender 代表发送者，可以通过 sender.tab 判断消息是否是从内容脚本发出\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ sendResponse 可以直接发送回复，如：\x3c\/span\x3e\n  sendResponse({\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27response\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27send a response\x27\x3c\/span\x3e\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e需要注意的是，即便你在多个JS中注册了消息监听\x3ccode\x3eonMessage.addListener\x3c\/code\x3e，也只有一个监听者能收到通过\x3ccode\x3eruntime.sendMessage\x3c\/code\x3e发送出去的消息。如果需要不同的监听者分别监听消息，则需要使用\x3ccode\x3echrome.tab\x3c\/code\x3e API来指定消息接收对象\x3c\/p\x3e\n\x3cp\x3e举个栗子：\x3c\/p\x3e\n\x3cp\x3e上文说过，需要在\x3ccode\x3econtent_scripts\x3c\/code\x3e中监听选择事件，获取选择的文本，而对于右键菜单的点击则是在\x3ccode\x3ebackground\x3c\/code\x3e中监听的。那么需要把选择的文本作为消息，发送给\x3ccode\x3ebackground\x3c\/code\x3e，在\x3ccode\x3ebackground\x3c\/code\x3e完成异步保存。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ content_scripts 中获取选择，并发送消息\n\/\/ js\/selection.js\n\n\/\/ 获取选择的文本\nfunction getSelectedText() {\n  if (window.getSelection) {\n    return window.getSelection().toString();\n  } else if (document.getSelection) {\n    return document.getSelection();\n  } else if (document.selection) {\n    return document.selection.createRange().text;\n  }\n}\n\/\/ 组建信息\nfunction getSelectionMessage() {\n  var text = getSelectedText();\n  var title = document.title;\n  var url = window.location.href;\n  var data = {\n    text: text,\n    title: title,\n    url: url\n  };\n  var message = {\n    method: \x27get_selection\x27,\n    data: data\n  }\n  return message;\n}\n\/\/ 发送消息\nfunction sendSelectionMessage(message) {\n  chrome.runtime.sendMessage(message, function(response) {});\n}\n\/\/ 监听鼠标松开的事件，只有在右键点击时，才会去获取文本\nwindow.onmouseup = function(e) {\n  if (!e.button === 2) {\n    return;\n  }\n  var message = getSelectionMessage();\n  sendSelectionMessage(message);\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ content_scripts 中获取选择，并发送消息\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ js\/selection.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取选择的文本\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetSelectedText\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.getSelection) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.getSelection().toString();\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getSelection) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getSelection();\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.selection) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.selection.createRange().text;\n  }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 组建信息\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetSelectionMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e text = getSelectedText();\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e title = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.title;\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href;\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n    \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: text,\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: title,\n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: url\n  };\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e message = {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27get_selection\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: data\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e message;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送消息\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esendSelectionMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage\x3c\/span\x3e) \x3c\/span\x3e{\n  chrome.runtime.sendMessage(message, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{});\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听鼠标松开的事件，只有在右键点击时，才会去获取文本\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.onmouseup = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!e.button === \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e message = getSelectionMessage();\n  sendSelectionMessage(message);\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ background 中接收消息，监听右键菜单的点击，并异步保存数据\n\/\/ js\/background.js\n\n\/\/ 创建一个全局对象，来保存接收到的消息值\nvar selectionObj = null;\n\n\/\/ 首先要创建菜单\nchrome.runtime.onInstalled.addListener(function() {\n  chrome.contextMenus.create({\n    type: \x27normal\x27,\n    title: \x27save selection\x27,\n    id: \x27save_selection\x27,\n    \/\/ 有选择才会出现\n    contexts: [\x27selection\x27]\n  });\n});\n\/\/ 监听菜单的点击\nchrome.contextMenus.onClicked.addListener(function(menuItem) {\n  if (menuItem.menuItemId === \x26quot;save_selection\x26quot;) {\n    addCliper();\n  }\n});\n\n\/\/ 消息监听，接收从 content_scripts 传递来的消息，并保存在一个全局对象中\nchrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {\n  if (message.method === \x27get_selection\x27) {\n    selectionObj = message.data;\n  }\n});\n\n\/\/ 异步保存\nfunction addCliper() {\n  $.ajax({\n    \/\/ ...\n  });\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ background 中接收消息，监听右键菜单的点击，并异步保存数据\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ js\/background.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个全局对象，来保存接收到的消息值\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e selectionObj = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 首先要创建菜单\x3c\/span\x3e\nchrome.runtime.onInstalled.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  chrome.contextMenus.create({\n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27normal\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3etitle\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27save selection\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27save_selection\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 有选择才会出现\x3c\/span\x3e\n    contexts: [\x3cspan class=\x22hljs-string\x22\x3e\x27selection\x27\x3c\/span\x3e]\n  });\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 监听菜单的点击\x3c\/span\x3e\nchrome.contextMenus.onClicked.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emenuItem\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (menuItem.menuItemId === \x3cspan class=\x22hljs-string\x22\x3e\x22save_selection\x22\x3c\/span\x3e) {\n    addCliper();\n  }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 消息监听，接收从 content_scripts 传递来的消息，并保存在一个全局对象中\x3c\/span\x3e\nchrome.runtime.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, sender, sendResponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (message.method === \x3cspan class=\x22hljs-string\x22\x3e\x27get_selection\x27\x3c\/span\x3e) {\n    selectionObj = message.data;\n  }\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 异步保存\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddCliper\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  $.ajax({\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n  });\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch5\x3e长链接\x3c\/h5\x3e\n\x3cp\x3e通过\x3ccode\x3echrome.runtime.connect\x3c\/code\x3e（或者\x3ccode\x3echrome.tabs.connect\x3c\/code\x3e）可以建立起不同类型JS之间的长链接。\x3c\/p\x3e\n\x3cp\x3e信息的发送者需要制定独特的信息类型，发送并监听信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var port = chrome.runtime.connect({type: \x26quot;connection\x26quot;});\nport.postMessage({\n  method: \x26quot;add\x26quot;,\n  datas: [1, 2, 3]\n});\nport.onMessage.addListener(function(msg) {\n  if (msg.method === \x26quot;answer\x26quot;) {\n      console.log(msg.data);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e port = chrome.runtime.connect({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22connection\x22\x3c\/span\x3e});\nport.postMessage({\n  \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22add\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3edatas\x3c\/span\x3e: [\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]\n});\nport.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (msg.method === \x3cspan class=\x22hljs-string\x22\x3e\x22answer\x22\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(msg.data);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而接受者则要注册监听，并判断消息的类型：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chrome.runtime.onConnect.addListener(function(port) {\n  console.assert(port.type == \x26quot;connection\x26quot;);\n  port.onMessage.addListener(function(msg) {\n    if (msg.method == \x26quot;add\x26quot;) {\n      var result = msg.datas.reduce(function(previousValue, currentValue, index, array){\n      return previousValue \x2b currentValue;\n  });\n      port.postMessage({\n        method: \x26quot;answer\x26quot;,\n        data: result\n      });\n    }\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echrome.runtime.onConnect.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eport\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.assert(port.type == \x3cspan class=\x22hljs-string\x22\x3e\x22connection\x22\x3c\/span\x3e);\n  port.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emsg\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (msg.method == \x3cspan class=\x22hljs-string\x22\x3e\x22add\x22\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = msg.datas.reduce(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3epreviousValue, currentValue, index, array\x3c\/span\x3e)\x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e previousValue \x2b currentValue;\n  });\n      port.postMessage({\n        \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22answer\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: result\n      });\n    }\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/tabs\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3echrome.tabs\x3c\/a\x3e\x3c\/h4\x3e\n\x3cp\x3e要使用这个API则需要先在\x3ccode\x3emanifest.json\x3c\/code\x3e中注册：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;permissions\x26quot;: [\n  \x26quot;tabs\x26quot;,\n  \/\/ ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22permissions\x22\x3c\/span\x3e: [\n  \x3cspan class=\x22hljs-string\x22\x3e\x22tabs\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 获取到当前的Tab\nchrome.tabs.getCurrent(function(tab) {\n  \/\/ 通过 tab.id 可以拿到标签页的ID\n});\n\n\/\/ 通过 queryInfo，以Array的形式筛选出符合条件的tabs\nchrome.tabs.query(queryInfo, function(tabs) {})\n\n\/\/ 精准的给某个页面的`content_scripts`发送消息\nchrome.tabs.sendMessage(tabId, message, function(response) {});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取到当前的Tab\x3c\/span\x3e\nchrome.tabs.getCurrent(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etab\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 tab.id 可以拿到标签页的ID\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 queryInfo，以Array的形式筛选出符合条件的tabs\x3c\/span\x3e\nchrome.tabs.query(queryInfo, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etabs\x3c\/span\x3e) \x3c\/span\x3e{})\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 精准的给某个页面的`content_scripts`发送消息\x3c\/span\x3e\nchrome.tabs.sendMessage(tabId, message, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e举个栗子：\x3c\/p\x3e\n\x3cp\x3e在\x3ccode\x3ebackground.js\x3c\/code\x3e中，我们获取到当前Tab，并发送消息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chrome.tabs.getCurrent(function(tab) {\n  chrome.tabs.sendMessage(tab.id, {\n    method: \x27tab\x27,\n    message: \x27get active tab\x27\n  }, function(response) {});\n});\n\/\/ 或者\nchrome.tabs.query({active: true, currentWindow: true}, function(tabs) {\n  chrome.tabs.sendMessage(tabs[0].id, {\n    method: \x27tab\x27,\n    message: \x27get active tab\x27\n  }, function(response) {\n  });\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echrome.tabs.getCurrent(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etab\x3c\/span\x3e) \x3c\/span\x3e{\n  chrome.tabs.sendMessage(tab.id, {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tab\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27get active tab\x27\x3c\/span\x3e\n  }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{});\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 或者\x3c\/span\x3e\nchrome.tabs.query({\x3cspan class=\x22hljs-attr\x22\x3eactive\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecurrentWindow\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etabs\x3c\/span\x3e) \x3c\/span\x3e{\n  chrome.tabs.sendMessage(tabs[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].id, {\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27tab\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27get active tab\x27\x3c\/span\x3e\n  }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{\n  });\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在\x3ccode\x3econtent_scripts\x3c\/code\x3e中，进行消息监听：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22chrome.runtime.onMessage.addListener(function(message, sender, sendResponse) {\n  if (message.method === \x27tab\x27) {\n    console.log(message.message);\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3echrome.runtime.onMessage.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emessage, sender, sendResponse\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (message.method === \x3cspan class=\x22hljs-string\x22\x3e\x27tab\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(message.message);\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/apps\/storage\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3echrome.storage\x3c\/a\x3e\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3echrome.storage\x3c\/code\x3e是一个基于\x3ccode\x3elocalStorage\x3c\/code\x3e的本地储存，但chrome对其进行了IO的优化，可以储存对象形式的数据，也不会因为浏览器完全关闭而清空。\x3c\/p\x3e\n\x3cp\x3e同样，使用这个API需要先在\x3ccode\x3emanifest.json\x3c\/code\x3e中注册：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x26quot;permissions\x26quot;: [\n  \x26quot;storage\x26quot;,\n  \/\/ ...\n]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-string\x22\x3e\x22permissions\x22\x3c\/span\x3e: [\n  \x3cspan class=\x22hljs-string\x22\x3e\x22storage\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...\x3c\/span\x3e\n]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3echrome.storage\x3c\/code\x3e有两种形式，\x3ccode\x3echrome.storage.sync\x3c\/code\x3e和\x3ccode\x3echrome.storage.local\x3c\/code\x3e：\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3echrome.storage.local\x3c\/code\x3e是基于本地的储存，而\x3ccode\x3echrome.storage.sync\x3c\/code\x3e会先判断当前用户是否登录了google账户，如果登录，则会将储存的数据通过google服务自动同步，否则，会使用\x3ccode\x3echrome.storage.local\x3c\/code\x3e仅进行本地储存\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e注：因为储存区没有加密，所以不应该储存用户的敏感信息\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3eAPI:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 数据储存\nStorageArea.set(object items, function callback)\n\n\/\/ 数据获取\nStorageArea.get(string or array of string or object keys, function callback)\n\n\/\/ 数据移除\nStorageArea.remove(string or array of string keys, function callback)\n\n\/\/ 清空全部储存\nStorageArea.clear(function callback)\n\n\/\/ 监听储存的变化\nchrome.storage.onChanged.addListener(function(changes, namespace) {});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据储存\x3c\/span\x3e\nStorageArea.set(object items, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecallback\x3c\/span\x3e)\n\n\/\/ 数据获取\n\x3cspan class=\x22hljs-title\x22\x3eStorageArea\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eget\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estring or array of string or object keys, function callback\x3c\/span\x3e)\n\n\/\/ 数据移除\n\x3cspan class=\x22hljs-title\x22\x3eStorageArea\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eremove\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estring or array of string keys, function callback\x3c\/span\x3e)\n\n\/\/ 清空全部储存\n\x3cspan class=\x22hljs-title\x22\x3eStorageArea\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eclear\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efunction callback\x3c\/span\x3e)\n\n\/\/ 监听储存的变化\n\x3cspan class=\x22hljs-title\x22\x3echrome\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3estorage\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eonChanged\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eaddListener\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efunction(changes, namespace\x3c\/span\x3e) \x3c\/span\x3e{});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e举栗子：\x3c\/p\x3e\n\x3cp\x3e我们在\x3ccode\x3ebrowser_action\x3c\/code\x3e完成了用户的登录\/注册操作，将部分用户信息储存在\x3ccode\x3estorage\x3c\/code\x3e中。每次初始化时，都会检查是否有储存，没有的话则需要用户登录，成功后再添加：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ browser_action\n\/\/ js.popup.js\n\nchrome.storage.sync.get(\x27user\x27, function(result) {\n  \/\/ 通过 result.user 获取到储存的 user 对象\n  result \x26amp;\x26amp; setPopDOM(result.user);\n});\n\nfunction setPopDOM(user) {\n  if (user \x26amp;\x26amp; user.userId) {\n    \/\/ show user UI\n  } else {\n    \/\/ show login UI\n  }\n};\n\ndocument.getElementById(\x27login\x27).onclick = function() {\n  \/\/ login user..\n  \/\/ 通过 ajax 请求异步登录，获取到成功的回调后，将返回的 user 对象储存在 storage 中\n  chrome.storage.sync.set({user: user}, function(result) {});\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ browser_action\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ js.popup.js\x3c\/span\x3e\n\nchrome.storage.sync.get(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 result.user 获取到储存的 user 对象\x3c\/span\x3e\n  result \x26amp;\x26amp; setPopDOM(result.user);\n});\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esetPopDOM\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3euser\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user \x26amp;\x26amp; user.userId) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ show user UI\x3c\/span\x3e\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ show login UI\x3c\/span\x3e\n  }\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27login\x27\x3c\/span\x3e).onclick = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ login user..\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过 ajax 请求异步登录，获取到成功的回调后，将返回的 user 对象储存在 storage 中\x3c\/span\x3e\n  chrome.storage.sync.set({\x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: user}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresult\x3c\/span\x3e) \x3c\/span\x3e{});\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而在其他环境的JS里，我们可以监听\x3ccode\x3estorage\x3c\/code\x3e的变化：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ background\n\/\/ js\/background.js\n\n\/\/ 一个全局的 user 对象，用来保存用户信息，以便在异步时发生 userId\nvar user = null;\n\nchrome.storage.onChanged.addListener(function(changes, namespace) {\n  for (key in changes) {\n    if (key === \x27user\x27) {\n      console.log(\x27user storage changed!\x27);\n      user = changes[key];\n    }\n  }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ background\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ js\/background.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 一个全局的 user 对象，用来保存用户信息，以便在异步时发生 userId\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e user = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e;\n\nchrome.storage.onChanged.addListener(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3echanges, namespace\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (key \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e changes) {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (key === \x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27user storage changed!\x27\x3c\/span\x3e);\n      user = changes[key];\n    }\n  }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e大体上，我们目前为止理清了三种环境下JS的不同，以及他们交流和储存的方式。除此以外，还有popup弹窗、右键菜单的创建和使用。其实使用这些知识就足够做出一个简单的chrome扩展了。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e正式发布\x3c\/h3\x3e\n\x3cp\x3e其实我觉得整个过程中最蛋疼的一步就是把插件正式发布到chrome商店了。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e首先，你要在\x3ca href=\x22https:\/\/chrome.google.com\/webstore\/developer\/dashboard\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e开发者信息中心\x3c\/a\x3e进行登记，缴费5刀。这一步可以参照\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006035525\x22\x3e如何成为一名Chrome应用开发者\x3c\/a\x3e一文来通过验证和支付。但需要注意的是，我在尝试时使用的账户为中国google账户，因此完全无法支付，直到重新注册了一个香港账户才搞定\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e之后，要填写一系列的发布信息。google对icon和banner的尺寸要求的相当严格。。这一步可以参考\x3ca href=\x22http:\/\/www.cnblogs.com\/xishuai\/p\/google-chrome-webstore-developer-upload-program.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eGoogle Chrome 应用商店上传扩展程序\x3c\/a\x3e一文\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e最后终于搞定，线上可见：\x3ca href=\x22https:\/\/chrome.google.com\/webstore\/detail\/biijehenaabpogldekblkfgooifmagbi\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecliper extension\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e学习资源\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/crxdoc-zh.appspot.com\/extensions\/getstarted\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e建立 Chrome 扩展程序\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/guogangj\/p\/3235703.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eChrome插件（Extensions）开发攻略\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000006035525\x22\x3e如何成为一名Chrome应用开发者\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000005071240\x22 target=\x22_blank\x22\x3echrome扩展的开发\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e下一步？\x3c\/h3\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e插件功能丰富化\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e插件可在网页上高亮展示标记的文本\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e用\x3ccode\x3ees6\x3c\/code\x3e \x2b \x3ccode\x3ebabel\x3c\/code\x3e重构\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e需要使用框架吗？\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3chr\x3e\n\x3cp\x3e注：本文源码位于\x3ca href=\x22https:\/\/github.com\/ecmadao\/cliper-chrome\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub仓库：cliper-chrome\x3c\/a\x3e，线上产品见：\x3ca href=\x22http:\/\/cliper.com.cn\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecliper\x3c\/a\x3e 和 \x3ca href=\x22https:\/\/chrome.google.com\/webstore\/detail\/biijehenaabpogldekblkfgooifmagbi\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ecliper extension\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Chrome扩展程序开发</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007182038">https://segmentfault.com/a/1190000007182038</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ihzd39s8ez/" target="_blank">https://alili.tech/archive/ihzd39s8ez/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>