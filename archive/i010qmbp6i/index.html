<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/i010qmbp6i/",
				"appid": "1613049289050283", 
				"title": "【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-12T02:30:25"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qouq2lehwb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/givlb1h7m0m/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&text=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&text=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&title=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&is_video=false&description=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&title=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&title=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&title=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi010qmbp6i%2f&title=%e3%80%90%e5%8d%95%e9%a1%b5%e9%9d%a2%e5%8d%9a%e5%ae%a2%e4%bb%8e%e5%89%8d%e7%ab%af%e5%88%b0%e5%90%8e%e7%ab%af%e3%80%91%e5%9f%ba%e4%ba%8e%20Passport%20%e5%92%8c%20Koa%402%20%e7%9a%84%e6%9d%83%e9%99%90%e9%aa%8c%e8%af%81%e4%b8%8e%20DVA%20%e7%9a%84%20Model%20%e8%ae%be%e8%ae%a1"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计</h1><div class="meta"><div class="postdate"><time datetime="2019-01-12" itemprop="datePublished">2019-01-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e基于 JWT 的权限验证\x3c\/h3\x3e\n\x3cp\x3e这里有一篇文章描述的已经非常详尽，阐述了 \x3ccode\x3eJWT\x3c\/code\x3e 验证相比较传统的持久化 \x3ccode\x3esession\x3c\/code\x3e 验证的优势，以及基于 \x3ccode\x3eangular\x3c\/code\x3e 和 \x3ccode\x3eexpress\x3c\/code\x3e 验证的简单流程。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ca href=\x22https:\/\/auth0.com\/blog\/angularjs-authentication-with-cookies-vs-token\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e基于Json WebToken的权限验证\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3ePassport 专注于用户验证 Nodejs 库\x3c\/h3\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/jaredhanson\/passport\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ePassport\x3c\/a\x3e 提供了多种的验证策略，如：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/jaredhanson\/passport-http-bearer\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epassport-http-bearer\x3c\/a\x3e  - 使用 \x3ccode\x3eBearer tokens\x3c\/code\x3e 对 \x3ccode\x3eHTTP\x3c\/code\x3e 请求做权限验证。这个最适合我们的项目不过了。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/jaredhanson\/passport-local\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3epassport-local\x3c\/a\x3e - 本地验证，普通的登陆验证，数据库密码验证成功即可。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e此外还有 \x3ccode\x3epassport-github\x3c\/code\x3e , \x3ccode\x3epassport-weixin\x3c\/code\x3e , \x3ccode\x3epassport-qq\x3c\/code\x3e , \x3ccode\x3epassport-weibo\x3c\/code\x3e … ，这些你都可以在 \x3ca href=\x22http:\/\/passportjs.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官网\x3c\/a\x3e 上找到。 \x3c\/p\x3e\n\x3cp\x3e我们就采用这种方式来进行权限验证。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3eKoa@2 基本环境\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e首先需要注意的是使用 Koa@2，Node的版本需要 7.X的版本以上，而且启动时需要加上 \x3ccode\x3e--harmony\x3c\/code\x3e 或者 \x3ccode\x3e—harmony-async-await\x3c\/code\x3e \x3cbr\x3e最近 \x3ccode\x3eNode 8.0\x3c\/code\x3e 已经上线，我直接采用的是 \x3ccode\x3eNode v8.0.0\x3c\/code\x3e \x3cbr\x3e\x3ccode\x3envm install 8.0.0\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3envm alias default 8.0.0\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3ccode\x3eblog\/server\x3c\/code\x3e基本的目录结构\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22server\n├─ bin \/ www      # 入口文件\n├─ config         # server配置文件\n├─ controller     # 控制器文件夹\n|  └─ user.js     \n├─ lib            \n|  ├─ auth.js     # 认证逻辑\n|  └─ db.js       # 数据库 连接等\n├─ models         # Mongoose Models\n├─ routes         # Koa router\n├─ utils          # 工具方法\n├─ index.js       \n└─ package.json  \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crystal\x22\x3e\x3ccode class=\x22sh\x22\x3eserver\n├─ bin \/ www      \x3cspan class=\x22hljs-comment\x22\x3e# 入口文件\x3c\/span\x3e\n├─ config         \x3cspan class=\x22hljs-comment\x22\x3e# server配置文件\x3c\/span\x3e\n├─ controller     \x3cspan class=\x22hljs-comment\x22\x3e# 控制器文件夹\x3c\/span\x3e\n|  └─ user.js     \n├─ \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3elib\x3c\/span\x3e            \x3c\/span\x3e\n|  ├─ auth.js     \x3cspan class=\x22hljs-comment\x22\x3e# 认证逻辑\x3c\/span\x3e\n|  └─ db.js       \x3cspan class=\x22hljs-comment\x22\x3e# 数据库 连接等\x3c\/span\x3e\n├─ models         \x3cspan class=\x22hljs-comment\x22\x3e# Mongoose Models\x3c\/span\x3e\n├─ routes         \x3cspan class=\x22hljs-comment\x22\x3e# Koa router\x3c\/span\x3e\n├─ utils          \x3cspan class=\x22hljs-comment\x22\x3e# 工具方法\x3c\/span\x3e\n├─ index.js       \n└─ package.json  \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们在入口文件处 \x3ccode\x3eserver\/bin\/www\x3c\/code\x3e 来连接 \x3ccode\x3eMongoDB\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22(async () =\x3e {\n    \/\/ 测试连接 MongoDB\n    try {\n        const info = await connect(dbConfig)\n        console.log(`Success to connect to MongoDB at ${info.host}:${info.port}\/${info.name}`)\n    } catch (err) {\n        console.error(err)\n        process.exit()\n    }\n    \/\/ 开启服务进程\n    try {\n        app.listen(port)\n        console.log(`Server is running at http:\/\/localhost:${port}`)\n    } catch (err) {\n        console.error(err)\n    }\n})()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e () =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 测试连接 MongoDB\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e info = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e connect(dbConfig)\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Success to connect to MongoDB at \x3cspan class=\x22hljs-subst\x22\x3e${info.host}\x3c\/span\x3e:\x3cspan class=\x22hljs-subst\x22\x3e${info.port}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${info.name}\x3c\/span\x3e`\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err)\n        process.exit()\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 开启服务进程\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        app.listen(port)\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e`Server is running at http:\/\/localhost:\x3cspan class=\x22hljs-subst\x22\x3e${port}\x3c\/span\x3e`\x3c\/span\x3e)\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err)\n    }\n})()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eserver\/lib\/db.js\x3c\/code\x3e 下对应的 \x3ccode\x3econnect\x3c\/code\x3e 方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22exports.connect = function (config) {\n    return new Promise((resolve, reject) =\x3e {\n        mongoose.connection\n            .on(\x27error\x27, err =\x3e reject(err))\n            .on(\x27close\x27, () =\x3e console.log(\x27MongoDB connection closed! \x27))\n            .on(\x27open\x27, () =\x3e resolve(mongoose.connections[0]))\n        mongoose.connect(`mongodb:\/\/${config.host}:${config.port}\/${config.database}`, config.options)\n    })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3eexports.connect = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3econfig\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n        mongoose.connection\n            .on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, err =\x26gt; reject(err))\n            .on(\x3cspan class=\x22hljs-string\x22\x3e\x27close\x27\x3c\/span\x3e, () =\x26gt; \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27MongoDB connection closed! \x27\x3c\/span\x3e))\n            .on(\x3cspan class=\x22hljs-string\x22\x3e\x27open\x27\x3c\/span\x3e, () =\x26gt; resolve(mongoose.connections[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]))\n        mongoose.connect(\x3cspan class=\x22hljs-string\x22\x3e`mongodb:\/\/\x3cspan class=\x22hljs-subst\x22\x3e${config.host}\x3c\/span\x3e:\x3cspan class=\x22hljs-subst\x22\x3e${config.port}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${config.database}\x3c\/span\x3e`\x3c\/span\x3e, config.options)\n    })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/config\/index.js\x3c\/code\x3e 增加 \x3ccode\x3eMongoDB\x3c\/code\x3e 的配置\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const base = {\n    admin: {\n        username: \x27whistleyz\x27,\n        password: \x27admin123\x27,\n        email: \x27whistleyz@163.com\x27,\n        level: 51  \/\/ \x3e50 超管\n    }\n}\nconst dev = Object.assign(base, {\n    db: {\n        host: \x27127.0.0.1\x27,\n        port: 27017,\n        database: \x27fullblog\x27,\n        options: {\n            user: \x27\x27,\n            pass: \x27\x27\n        }\n    }\n})\nconst prod = Object.assign(base, {})\nconst env = process.env.NODE_ENV || \x27development\x27\nconst _config = {\n    development: dev,\n    production: prod\n}\n\/\/ 数据库配置\nmodule.exports = _config[env]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e base = {\n    \x3cspan class=\x22hljs-attr\x22\x3eadmin\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eusername\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27whistleyz\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27admin123\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eemail\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27whistleyz@163.com\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3elevel\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e51\x3c\/span\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ \x26gt;50 超管\x3c\/span\x3e\n    }\n}\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dev = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign(base, {\n    \x3cspan class=\x22hljs-attr\x22\x3edb\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27127.0.0.1\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eport\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e27017\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edatabase\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27fullblog\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eoptions\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3epass\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n        }\n    }\n})\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e prod = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign(base, {})\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e env = process.env.NODE_ENV || \x3cspan class=\x22hljs-string\x22\x3e\x27development\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e _config = {\n    \x3cspan class=\x22hljs-attr\x22\x3edevelopment\x3c\/span\x3e: dev,\n    \x3cspan class=\x22hljs-attr\x22\x3eproduction\x3c\/span\x3e: prod\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 数据库配置\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = _config[env]\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e由于线上和我们开发甚至是测试环境，配置都会有些许不同，我们可以用 \x3ccode\x3eprocess.env.NODE_ENV\x3c\/code\x3e 来区分这些配置\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e实现后端验证逻辑\x3c\/h3\x3e\n\x3cp\x3e新建 \x3ccode\x3eserver\/lib\/auth.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ serialize deserialize user objects into the session\npassport.serializeUser((user, done) =\x3e done(null, user.username))\npassport.deserializeUser(async (username, done) =\x3e {\n    const user = await UserModel.findOne({username})\n    done(null, user)\n})\n\/**\n * 基于 Bearer、Local 的认证方式 \n * 下面导出的路由中间件走的就是这里的逻辑 \n * passport-http-bearer 会自动解析出 headers 中的 token\n * https:\/\/github.com\/jaredhanson\/passport-http-bearer\/blob\/master\/lib\/strategy.js#L89\n *\/\npassport.use(new BearerStrategy(async (token, done) =\x3e {\n    try {\n        console.log(token)\n        const accessToken = await AccessToken.findOne({token}).populate(\x27user\x27)\n        accessToken ? done(null, accessToken.user) : done(null, false, {type: \x27error\x27, message: \x27授权失败！\x27})\n    } catch (err) {\n        done(err)\n    }\n}))\n\n\/**\n * 默认从 req.body 或者 req.query 中取出 username, password 字段\n * https:\/\/github.com\/jaredhanson\/passport-local\/blob\/master\/lib\/strategy.js#L49\n *\/\npassport.use(new LocalStrategy(async (username, password, done) =\x3e {\n    try {\n        const user = await UserModel.findOne({username})\n        if (user \x26amp;\x26amp; user.validPassword(password)) {\n            done(null, user)\n        } else {\n            done(null, false)\n        }\n    } catch (err) {\n        done(err)\n    }\n}))\n\/\/ 导出中间件 \nexports.isBearerAuthenticated = function () {\n    return passport.authenticate(\x27bearer\x27, {session: false})\n}\nexports.isLocalAuthenticated = function () {\n    return passport.authenticate(\x27local\x27, {session: false})\n}\nexports.passport = passport\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ serialize deserialize user objects into the session\x3c\/span\x3e\npassport.serializeUser(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3euser, done\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, user.username))\npassport.deserializeUser(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (username, done) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findOne({username})\n    done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, user)\n})\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 基于 Bearer、Local 的认证方式 \n * 下面导出的路由中间件走的就是这里的逻辑 \n * passport-http-bearer 会自动解析出 headers 中的 token\n * https:\/\/github.com\/jaredhanson\/passport-http-bearer\/blob\/master\/lib\/strategy.js#L89\n *\/\x3c\/span\x3e\npassport.use(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BearerStrategy(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (token, done) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(token)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e accessToken = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e AccessToken.findOne({token}).populate(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e)\n        accessToken ? done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, accessToken.user) : done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27授权失败！\x27\x3c\/span\x3e})\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        done(err)\n    }\n}))\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * 默认从 req.body 或者 req.query 中取出 username, password 字段\n * https:\/\/github.com\/jaredhanson\/passport-local\/blob\/master\/lib\/strategy.js#L49\n *\/\x3c\/span\x3e\npassport.use(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e LocalStrategy(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (username, password, done) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e user = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.findOne({username})\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (user \x26amp;\x26amp; user.validPassword(password)) {\n            done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, user)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n            done(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e)\n        }\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n        done(err)\n    }\n}))\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 导出中间件 \x3c\/span\x3e\nexports.isBearerAuthenticated = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e passport.authenticate(\x3cspan class=\x22hljs-string\x22\x3e\x27bearer\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3esession\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e})\n}\nexports.isLocalAuthenticated = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e passport.authenticate(\x3cspan class=\x22hljs-string\x22\x3e\x27local\x27\x3c\/span\x3e, {\x3cspan class=\x22hljs-attr\x22\x3esession\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e})\n}\nexports.passport = passport\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e新建 \x3ccode\x3eserver\/routes\/api.js\x3c\/code\x3e ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const Router = require(\x27koa-router\x27)\nconst User = require(\x27..\/controllers\/user\x27)\nconst { isBearerAuthenticated, isLocalAuthenticated } = require(\x27..\/lib\/auth\x27)\nconst router = new Router()\nrouter.use(async (ctx, next) =\x3e {\n    try {\n        await next()\n    } catch (error) {\n        console.error(error)\n        ctx.status = 400\n        ctx.body = {\n            code: error.code,\n            message: error.message || error.errmsg || error.msg || \x27unknown_error\x27,\n            error\n        }\n    }\n})\n\/\/ 初始化用户数据\nUser.seed()\n\/\/ Auth 认证\nrouter.post(\x27\/auth\x27, isLocalAuthenticated(), User.signToken)\nrouter.get(\x27\/auth\x27, isBearerAuthenticated(), User.getUserByToken)\nmodule.exports = router.routes()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Router = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-router\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e User = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/controllers\/user\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { isBearerAuthenticated, isLocalAuthenticated } = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/lib\/auth\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Router()\nrouter.use(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx, next) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e next()\n    } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (error) {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(error)\n        ctx.status = \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e\n        ctx.body = {\n            \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: error.code,\n            \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: error.message || error.errmsg || error.msg || \x3cspan class=\x22hljs-string\x22\x3e\x27unknown_error\x27\x3c\/span\x3e,\n            error\n        }\n    }\n})\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 初始化用户数据\x3c\/span\x3e\nUser.seed()\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Auth 认证\x3c\/span\x3e\nrouter.post(\x3cspan class=\x22hljs-string\x22\x3e\x27\/auth\x27\x3c\/span\x3e, isLocalAuthenticated(), User.signToken)\nrouter.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/auth\x27\x3c\/span\x3e, isBearerAuthenticated(), User.getUserByToken)\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = router.routes()\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么我们在 \x3ccode\x3eserver\/controller\/user.js\x3c\/code\x3e 下的处理逻辑久变得简单：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ LocalStrategy 的中间件验证通过，会把 user 储存在 req 中\nexports.signToken = async function (ctx, next) {\n    const { user } = ctx.req\n    \/\/ 重新请求 token 需要删除上一次生成的 token\n    await TokenModel.findOneAndRemove({user: user._id})\n    const result = await TokenModel.create({\n        \/\/ md5加密\n        token: genHash(user.username \x2b Date.now()),\n        user: user._id\n    })\n    ctx.status = 200\n    ctx.body = {\n        success: true,\n        data: result\n    }\n}\n\/\/ LocalStrategy 的中间件验证Token有效，会把 user 储存在 req 中\nexports.getUserByToken = async function (ctx, next) {\n    ctx.status = 200\n    ctx.body = {\n        success: true,\n        data: ctx.req.user\n    }\n}\n\/\/ 当数据库中user表示空的时候，创建超级管理员\nexports.seed = async function (ctx, next) {\n    const users = await UserModel.find({})\n    const adminInfo = config.admin\n    if (users.length === 0) {\n        const _admin = new UserModel(adminInfo)\n        const adminUser = await _admin.save()\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ LocalStrategy 的中间件验证通过，会把 user 储存在 req 中\x3c\/span\x3e\nexports.signToken = \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ectx, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { user } = ctx.req\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重新请求 token 需要删除上一次生成的 token\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TokenModel.findOneAndRemove({\x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: user._id})\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e result = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e TokenModel.create({\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ md5加密\x3c\/span\x3e\n        token: genHash(user.username \x2b \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now()),\n        \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: user._id\n    })\n    ctx.status = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\n    ctx.body = {\n        \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: result\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ LocalStrategy 的中间件验证Token有效，会把 user 储存在 req 中\x3c\/span\x3e\nexports.getUserByToken = \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ectx, next\x3c\/span\x3e) \x3c\/span\x3e{\n    ctx.status = \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e\n    ctx.body = {\n        \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: ctx.req.user\n    }\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 当数据库中user表示空的时候，创建超级管理员\x3c\/span\x3e\nexports.seed = \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ectx, next\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e users = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e UserModel.find({})\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e adminInfo = config.admin\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (users.length === \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e _admin = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e UserModel(adminInfo)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e adminUser = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e _admin.save()\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e我们可以借助 \x3ccode\x3emongoose\x3c\/code\x3e 还控制 \x3ccode\x3eToken\x3c\/code\x3e 的寿命\x3cbr\x3e比如设置 7 天后过期，\x3ccode\x3eexpires: 60 * 60 * 24 * 7\x3c\/code\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e到这里我们的后端逻辑基本实现，为了和前端 \x3ccode\x3ewebpack-dev-server\x3c\/code\x3e 本地服务器进行数据模拟，我们可以开启 \x3ccode\x3edevServer\x3c\/code\x3e 的 \x3ccode\x3eproyx\x3c\/code\x3e ，以及开启 \x3ccode\x3ekoa\x3c\/code\x3e 的跨域支持\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3etask\/config\x3c\/code\x3e ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22config.devServer = {\n    hot: true,\n    contentBase: path.resolve(__dirname, \x27..\/dist\x27),\n    publicPath: \x27\/\x27,\n    proxy: {\n        \x26quot;\/api\/v1\x26quot;: \x26quot;http:\/\/localhost:8082\x26quot;\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3econfig.devServer = {\n    \x3cspan class=\x22hljs-attr\x22\x3ehot\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3econtentBase\x3c\/span\x3e: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/dist\x27\x3c\/span\x3e),\n    \x3cspan class=\x22hljs-attr\x22\x3epublicPath\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eproxy\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-string\x22\x3e\x22\/api\/v1\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/localhost:8082\x22\x3c\/span\x3e\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样，前端的任何 \x3ccode\x3e\/api\/v1\x3c\/code\x3e 下的请求，都会被代理到 \x3ccode\x3ehttp:\/\/localhost:8082\x3c\/code\x3e 而 \x3ccode\x3e8082\x3c\/code\x3e 就是 \x3ccode\x3ekoa\x3c\/code\x3e 服务器的监听端口。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ koa 跨域\nconst logger = require(\x27koa-logger\x27)\nconst app = new koa()\napp.use(kcors())\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ koa 跨域\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e logger = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-logger\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e koa()\napp.use(kcors())\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e前端的登陆逻辑实现\x3c\/h3\x3e\n\x3ch4\x3e实现一个 dva model\x3c\/h4\x3e\n\x3cp\x3e在下一篇文章中，我们会深入 \x3ccode\x3edva\x3c\/code\x3e 的框架核心实现。我们先来看看 \x3ccode\x3edav\x3c\/code\x3e 的基本使用\x3c\/p\x3e\n\x3cp\x3e新建 \x3ccode\x3esrc\/model\/app.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { doLogin, getUserByToken } from \x27..\/service\/app\x27\nimport { LocalStorage } from \x27..\/utils\x27\nimport { message } from \x27antd\x27\nexport default {\n    namespace: \x27app\x27,\n    state: {\n        isLogin: false,\n        user: null\n    },\n    subscriptions: {},\n    effects: {\n        *checkToken({next}, {call, put}){\n            const Token = LocalStorage.getItem(\x27token\x27)\n            if (Token) {\n                yield put({type: \x27loginSuccess\x27})\n            } else {\n                message.error(\x27你还没有登陆哦！\x27)\n            }\n        },\n        *doLogin({payload}, {call, put}){\n            try {\n                const { success, data } = yield call(doLogin, payload)\n                if (success) {\n                    LocalStorage.setItem(\x27token\x27, data.token)\n                    yield put({type: \x27requireAuth\x27})\n                }\n            } catch (err) {\n                message.error(\x27授权失败！\x27)\n                yield put({type: \x27authErr\x27})\n            }\n        },\n        *getUserByToken({}, {call, put}){\n            try {\n                const { success, data } = yield call(getUserByToken)\n                if (success) {\n                    yield put({type: \x27authSuccess\x27, payload: data})\n                }\n            } catch (err) {\n                message.error(err.message)\n                yield put({type: \x27authErr\x27})\n            }\n        }\n    },\n    reducers: {\n        loginSuccess(state){\n            return {\n                ...state, isLogin: true\n            }\n        },\n        authErr(state){\n            return {\n                ...state, isLogin: false, user: null\n            }\n        },\n        authSuccess(state, {payload}){\n            return {\n                ...state, user: payload\n            }\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { doLogin, getUserByToken } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/service\/app\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { LocalStorage } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/utils\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { message } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27antd\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-attr\x22\x3enamespace\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27app\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3estate\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3eisLogin\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3esubscriptions\x3c\/span\x3e: {},\n    \x3cspan class=\x22hljs-attr\x22\x3eeffects\x3c\/span\x3e: {\n        *checkToken({next}, {call, put}){\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e Token = LocalStorage.getItem(\x3cspan class=\x22hljs-string\x22\x3e\x27token\x27\x3c\/span\x3e)\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (Token) {\n                \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27loginSuccess\x27\x3c\/span\x3e})\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                message.error(\x3cspan class=\x22hljs-string\x22\x3e\x27你还没有登陆哦！\x27\x3c\/span\x3e)\n            }\n        },\n        *doLogin({payload}, {call, put}){\n            \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { success, data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(doLogin, payload)\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (success) {\n                    LocalStorage.setItem(\x3cspan class=\x22hljs-string\x22\x3e\x27token\x27\x3c\/span\x3e, data.token)\n                    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27requireAuth\x27\x3c\/span\x3e})\n                }\n            } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n                message.error(\x3cspan class=\x22hljs-string\x22\x3e\x27授权失败！\x27\x3c\/span\x3e)\n                \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27authErr\x27\x3c\/span\x3e})\n            }\n        },\n        *getUserByToken({}, {call, put}){\n            \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n                \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { success, data } = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e call(getUserByToken)\n                \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (success) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27authSuccess\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3epayload\x3c\/span\x3e: data})\n                }\n            } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e (err) {\n                message.error(err.message)\n                \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e put({\x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27authErr\x27\x3c\/span\x3e})\n            }\n        }\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3ereducers\x3c\/span\x3e: {\n        loginSuccess(state){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                ...state, \x3cspan class=\x22hljs-attr\x22\x3eisLogin\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n            }\n        },\n        authErr(state){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                ...state, \x3cspan class=\x22hljs-attr\x22\x3eisLogin\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n            }\n        },\n        authSuccess(state, {payload}){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n                ...state, \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: payload\n            }\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e对于 \x3ccode\x3eredux-saga\x3c\/code\x3e 的 \x3ccode\x3eeffect\x3c\/code\x3e 等的用法，可以参考 \x3ca href=\x22https:\/\/redux-saga.js.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e文档\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这里我们对 \x3ccode\x3elocalStorage\x3c\/code\x3e 做了一次封装，看了源码相信你就知道目的是什么了：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n * src\/utils\/localStorage.js\n * Custom window.localStorage\n *\/\nconst STORE_PREFIX = \x27blog\x27\nexport function getItem (key) {\n    return window.localStorage.getItem(STORE_PREFIX \x2b \x27-\x27 \x2b key)\n}\nexport function setItem (key, value) {\n    window.localStorage.setItem(STORE_PREFIX \x2b \x27-\x27 \x2b key, value)\n}\nexport function removeItem (key) {\n    window.localStorage.removeItem(STORE_PREFIX \x2b \x27-\x27 \x2b key)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * src\/utils\/localStorage.js\n * Custom window.localStorage\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e STORE_PREFIX = \x3cspan class=\x22hljs-string\x22\x3e\x27blog\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetItem\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.getItem(STORE_PREFIX \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e \x2b key)\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esetItem\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey, value\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.setItem(STORE_PREFIX \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e \x2b key, value)\n}\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eremoveItem\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.localStorage.removeItem(STORE_PREFIX \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27-\x27\x3c\/span\x3e \x2b key)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e封装 \x3ccode\x3esrc\/utils\/request.js\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import fetch from \x27dva\/fetch\x27\nimport * as LocalStorage from \x27.\/localStorage\x27\nconst URL_PREFIX = \x27\/api\/v1\x27\nconst TOKEN_NAME = \x27token\x27\nfunction checkStatus(response) {\n    if (response.status \x3e= 200 \x26amp;\x26amp; response.status \x3c 300) {\n        return response;\n    }\n    const error = new Error(response.statusText);\n    error.response = response;\n    throw error;\n}\n\/**\n * Requests a URL, returning a promise.\n *\n * @param  {string} url       The URL we want to request\n * @param  {object} [options] The options we want to pass to \x26quot;fetch\x26quot;\n * @return {object}           An object containing either \x26quot;data\x26quot; or \x26quot;err\x26quot;\n *\/\nexport default function request(url, options) {\n    options = Object.assign({\n        headers: new Headers({\n            \x27Content-Type\x27: \x27application\/json\x27\n        })\n    }, options)\n    return fetch(URL_PREFIX \x2b url, options)\n        .then(checkStatus)\n        .then(res =\x3e res.json())\n        .then(data =\x3e data)\n}\n\/**\n * Request width token\n * @param  {[type]} url    \n * @param  {[type]} options\n * @return {[type]}        \n *\/\nexport function requestWidthToken (url, options) {\n        const TOKEN = LocalStorage.getItem(TOKEN_NAME)\n        options = Object.assign({\n            headers: new Headers({\n                \x27Content-Type\x27: \x27application\/json\x27,\n                \x27Authorization\x27: `Bearer ${TOKEN}`\n            })\n        }, options)\n        return request(url, options)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e fetch \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27dva\/fetch\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e * \x3cspan class=\x22hljs-keyword\x22\x3eas\x3c\/span\x3e LocalStorage \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/localStorage\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e URL_PREFIX = \x3cspan class=\x22hljs-string\x22\x3e\x27\/api\/v1\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e TOKEN_NAME = \x3cspan class=\x22hljs-string\x22\x3e\x27token\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckStatus\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (response.status \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e \x26amp;\x26amp; response.status \x26lt; \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e response;\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e error = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(response.statusText);\n    error.response = response;\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e error;\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Requests a URL, returning a promise.\n *\n * @param  {string} url       The URL we want to request\n * @param  {object} [options] The options we want to pass to \x22fetch\x22\n * @return {object}           An object containing either \x22data\x22 or \x22err\x22\n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, options\x3c\/span\x3e) \x3c\/span\x3e{\n    options = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({\n        \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Headers({\n            \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e\n        })\n    }, options)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetch(URL_PREFIX \x2b url, options)\n        .then(checkStatus)\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e res.json())\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e =\x26gt;\x3c\/span\x3e data)\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * Request width token\n * @param  {[type]} url    \n * @param  {[type]} options\n * @return {[type]}        \n *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequestWidthToken\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eurl, options\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e TOKEN = LocalStorage.getItem(TOKEN_NAME)\n        options = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.assign({\n            \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Headers({\n                \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e,\n                \x3cspan class=\x22hljs-string\x22\x3e\x27Authorization\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`Bearer \x3cspan class=\x22hljs-subst\x22\x3e${TOKEN}\x3c\/span\x3e`\x3c\/span\x3e\n            })\n        }, options)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(url, options)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3edva\/fetch\x3c\/code\x3e 直接导出了 \x3ccode\x3efetch\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3efetch\x3c\/code\x3e 的用法很简单，参考 \x3ca href=\x22https:\/\/github.com\/github\/fetch\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3egithub地址\x3c\/a\x3e\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e这里我们把 url 的 prefix、token name 提取出来用作常量保存，以便于我们修改，最好的方法是提取出来用一个文件保存\x3c\/p\x3e\n\x3ch4\x3e组件与model的通信\x3c\/h4\x3e\n\x3cp\x3e还记得我们的展示组件吗，现在我们让它 \x3ccode\x3econnect\x3c\/code\x3e 到我们的 \x3ccode\x3emodel\x3c\/code\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { connect } from \x27dva\x27\nconst { Header, Content, Footer } = Layout\nconst { HeaderRight } = HeaderComponent\nconst App = ({children, routes, app, doLogin}) =\x3e {\n    const { isLogin, user } = app\n    return (\n        \x3cLayout\x3e\n            \x3cHeader\x3e\n                \x3cHeaderComponent routes={routes}\x3e\n                    {isLogin ? \x3cHeaderRight user={user} \/\x3e : \x3cLoginComponent doLogin={doLogin} app={app} \/\x3e }\n                \x3c\/HeaderComponent\x3e\n            \x3c\/Header\x3e\n           ...\n    )\n}\nfunction mapStateToProps ({app}, ownProps) {\n    return {\n        app\n    }\n}\nfunction mapDispatchToProps (dispatch) {\n    return {\n        doLogin({username, password}){\n            dispatch({type: \x27app\/doLogin\x27, payload: {username, password\x22}}\x22)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { connect } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27dva\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { Header, Content, Footer } = Layout\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { HeaderRight } = HeaderComponent\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e App = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{children, routes, app, doLogin}\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { isLogin, user } = app\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (\n        \x26lt;Layout\x26gt;\n            \x26lt;Header\x26gt;\n                \x26lt;HeaderComponent routes={routes}\x26gt;\n                    {isLogin ? \x26lt;HeaderRight user={user} \/\x26gt; : \x26lt;LoginComponent doLogin={doLogin} app={app} \/\x26gt; }\n                \x26lt;\/HeaderComponent\x26gt;\n            \x26lt;\/Header\x26gt;\n           ...\n    )\n}\nfunction mapStateToProps ({app}, ownProps) {\n    return {\n        app\n    }\n}\nfunction mapDispatchToProps (dispatch) {\n    return {\n        doLogin({username, password}){\n            dispatch({type: \x27app\/doLogin\x27, payload: {username, password\x22}}\x22)\n        }\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e唯一需要注意的就是\x3ccode\x3eaction\x3c\/code\x3e 的 \x3ccode\x3etype\x3c\/code\x3e 属性了，如 \x3ccode\x3eapp\/doLogin\x3c\/code\x3e 前缀 \x3ccode\x3eapp\x3c\/code\x3e 就是 \x3ccode\x3edva.model\x3c\/code\x3e 的 \x3ccode\x3enamespace\x3c\/code\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e从 \x3ca href=\x22https:\/\/github.com\/dvajs\/dva\/blob\/master\/src\/createDva.js#L461\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3edva\/createDva.js at master · dvajs\/dva · GitHub\x3c\/a\x3e 中可以看到，\x3ccode\x3edva\x3c\/code\x3e 会把 \x3ccode\x3emodel.namespace\x3c\/code\x3e 最为 \x3ccode\x3ereducer\x3c\/code\x3e , \x3ccode\x3eeffects \x3c\/code\x3e 的 \x3ccode\x3eprefix\x3c\/code\x3e 拼接\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e然后我们就可以在 \x3ccode\x3eLoginComponent\x3c\/code\x3e 中，监听登陆的相应事件来调用对应的方法了。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e小结\x3c\/h3\x3e\n\x3cp\x3e在写后端的时，难免遇到很多错误，我们可以使用 \x3ccode\x3esupervisor\x3c\/code\x3e 、\x3ccode\x3epm2\x3c\/code\x3e 来监听文件变动来自动重启 \x3ccode\x3enodejs\x3c\/code\x3e 。鉴于后期我们会使用 \x3ccode\x3epm2\x3c\/code\x3e 部署项目。这里我还是使用 pm2 \x3c\/p\x3e\n\x3cp\x3e在 \x3ccode\x3eserver\/package.json\x3c\/code\x3e 中的 \x3ccode\x3escripts\x3c\/code\x3e 下新增：\x3cbr\x3e\x3ccode\x3e\x22start\x22: \x22pm2 start bin\/www --watch --name blog \x26amp;\x26amp; pm2 log blog\x22,\x3c\/code\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009676087\x22\x3e【单页面博客从前端到后端】环境搭建\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009712370\x22 target=\x22_blank\x22\x3e【单页面博客从前端到后端】基于 DVA\x2bANTD 搭建博客前后台界面\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009749208\x22\x3e【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【单页面博客从前端到后端】基于 Passport 和 Koa@2 的权限验证与 DVA 的 Model 设计</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009749208">https://segmentfault.com/a/1190000009749208</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/i010qmbp6i/" target="_blank">https://alili.tech/archive/i010qmbp6i/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>