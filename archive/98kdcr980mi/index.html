<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="va.js——Vue 表单验证插件的写作过程"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>va.js——Vue 表单验证插件的写作过程 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/98kdcr980mi/",
				"appid": "1613049289050283", 
				"title": "va.js——Vue 表单验证插件的写作过程 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-31T02:31:16"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ct6tykgs2rk/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/dw38usex45b/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&text=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&text=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&title=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&is_video=false&description=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&title=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&title=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&title=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f98kdcr980mi%2f&title=va.js%e2%80%94%e2%80%94Vue%20%e8%a1%a8%e5%8d%95%e9%aa%8c%e8%af%81%e6%8f%92%e4%bb%b6%e7%9a%84%e5%86%99%e4%bd%9c%e8%bf%87%e7%a8%8b"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">va.js——Vue 表单验证插件的写作过程</h1><div class="meta"><div class="postdate"><time datetime="2019-01-31" itemprop="datePublished">2019-01-31</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e前段时间，老大搭好了Vue的开发环境，于是我们愉快地从JQ来到了Vue。这中间做的时候，在表单验证上做的不开心，看到vue的插件章节，感觉自己也能写一个，因此就自己开始写了一个表单验证插件va.js。\x3cbr\x3e  当然为什么不找个插件呢？ vue-validator呀。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e我想了下，一个是表单验证是个高度定制化的东西，这种网上找到的插件为了兼顾各个公司的需求，所以加了很多功能，这些我们不需要。事实证明，vue-validator有50kb，而我写的va.js只有8kb。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e另一个是，vue-validator的api我真的觉得长, 动不动就v-validate:username=\x22[\x27required\x27]\x22，这么一长串，而我设计的调用大概如——v-va:Money\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e当然，本文仅是展示下，如何写个满足自己公司需求的vue表单验证插件。下面介绍下思路。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e一、表单验证模块的构成\x3c\/h2\x3e\n\x3cp\x3e任何表单验证模块都是由 配置——校验——报错——取值 这几部分构成的。\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e配置： 配置规则 和配置报错，以及优先级\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e校验： 有在 change 事件校验， 在点击提交按钮的时候校验， 当然也有在input事件取值的\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e报错： 报错方式一般要分，报错的文字有模板，也有自定义的\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e取值： 将通过验证的数据返还给开发者调用\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e下面是我老大针对公司项目给我提出的要求\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e集中式的管理 校验规则 和 报错模板。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e报错时机可选\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e校验正确后的数据，已经打包成对象，可以直接用\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e允许各个页面对规则进行覆盖，对报错信息进行自定义修改，以及允许ajax获取数据后，再对规则进行补充\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e按顺序来校验，在第一个报错的框弹出错误\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e我就很好奇地问， 为什么要这样子呢？然后老大就跟我一条一条解答：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e集中式管理规则，和报错模板的好处，就是规则可以全局通用，一改全改。老大跟我说，光是昵称的正则就改了三次。如果这些正则写在各个页面，o(￣ヘ￣o#)哼，你就要改N个页面了\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3epc和移动的流程不一样，pc很多校验都要在change事件或者input事件就校验并报错了，而移动则一般是要到提交按钮再进行校验。所以写插件的时候要做好两手准备。然后，报错用的ui要可以支持我们现在用的layer插件。当然以后这个报错的ui也可能变，所以你懂滴。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当然原来jq时代，我们的公用表单验证，就能验证完了，把数据都集合到一个对象里。这样ajax的时候，就不用再去取值了。你这个插件耶要达到这个效果\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e原来jq的那个公用脚本，正则和报错都集中到一个地方去了，在很多地方已经很方便了。但是在一些页面需要改东西的时候还不够灵活。像RealName这个规则，最早是针对某个页面配置的，用的是后端接口上的字段名。另一个支付页，后端接口上的字段名改成了PayUser了，但是正则还是RealName的，原来我们是要复写一下RealName。这个就不太方便也不好看了。另外一个，支付金额，有最大值和最小值的限制，这个需要从后端获取的。你也要考虑这个情况。要做到各个页面上也能有一些灵活的地方可以修改规则，自定义报错等等。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e为什么要按顺序校验啊？你忘了上次牛哥让我们输入框，从上到下，按顺序报错。不然用户都不知道哪个地方错了。还有规则也是要按顺序的。哦哦哦。看来这次我放东西的时候，要用下数组了。尽量保持顺序。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e我听了之后，大致懂了，原来之前自己写的jq表单验证还有这么多不舒服的点。-_-|||\x3cbr\x3e接下来，是看看vue给我的好东西。让我来写\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e二、Vue 的插件怎么写\x3c\/h2\x3e\n\x3cp\x3e我一个vue小白，怎么就开始写vue插件了呢？那是因为想解决方案的时候，翻Vue文档翻到了这里\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVFWLw?w=657\x26amp;h=885\x22 src=\x22https:\/\/static.alili.tech\/img\/bVFWLw?w=657\x26amp;h=885\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这些东东，等我写完va.js的时候，感觉尤大写的真的是很清楚了。\x3c\/p\x3e\n\x3cp\x3e其实我是想写个指令来完成表单验证的事的。结果发现可能有2-3个指令，而且要再Vue.prototype上定义些方法，好让各个子实例内部也能拓展规则。于是老大说，这就相当于插件了。这让我很是吃鲸。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eva.js主要用的是 Vue指令\x3c\/h3\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVFWNT?w=615\x26amp;h=558\x22 src=\x22https:\/\/static.alili.tech\/img\/bVFWNT?w=615\x26amp;h=558\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVFWNW?w=774\x26amp;h=930\x22 src=\x22https:\/\/static.alili.tech\/img\/bVFWNW?w=774\x26amp;h=930\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eVue 文档真的写得很用心，但是我再补充一点吧\x3cbr\x3e\x3cstrong\x3evnode.context 就是Vue的实例\x3c\/strong\x3e\x3cbr\x3e我们做项目的时候，经常一个根组件上挂着N个子组件，子组件上又可能挂着N个子组件。\x3cstrong\x3evnode.context获取的实例，是绑定该指令的组件的实例。\x3c\/strong\x3e这个就相当好用了。你可以做很多事情\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e当然还用了点Vue.prototype\x3c\/h3\x3e\n\x3cp\x3eVue.prototype.$method  就是可以在各个组件上调用的方法。可以在组件内部用 this.$method调用的\x3c\/p\x3e\n\x3cp\x3e## 三、具体实现的思路 ##\x3c\/p\x3e\n\x3cp\x3e核心思路如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVFWTq?w=805\x26amp;h=121\x22 src=\x22https:\/\/static.alili.tech\/img\/bVFWTq?w=805\x26amp;h=121\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e规则的构造函数\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/va配置的构造函数\nfunction VaConfig(type, typeVal, errMsg, name, tag){\n    this.type = type, this.typeVal = typeVal, this.errMsg = errMsg, this.name = name, this.tag = tag\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs pony\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/va配置的构造函数\x3c\/span\x3e\nfunction \x3cspan class=\x22hljs-type\x22\x3eVaConfig\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e, typeVal, errMsg, name, \x3cspan class=\x22hljs-meta\x22\x3etag\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-literal\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e = \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3ethis\x3c\/span\x3e.typeVal = typeVal, \x3cspan class=\x22hljs-literal\x22\x3ethis\x3c\/span\x3e.errMsg = errMsg, \x3cspan class=\x22hljs-literal\x22\x3ethis\x3c\/span\x3e.name = name, \x3cspan class=\x22hljs-literal\x22\x3ethis\x3c\/span\x3e.\x3cspan class=\x22hljs-meta\x22\x3etag\x3c\/span\x3e = \x3cspan class=\x22hljs-meta\x22\x3etag\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3etype: nonvoid(非空), reg(正则), limit(区间), equal(与某个input相等)，unique(不能相同)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etypeVal: 根据不同type设置不同的值\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eerrMsg: 自定义的报错信息\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3ename: 用来传ajax的字段，如Password, Username\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etag：用来报错的名字，如‘银行账号’，‘姓名’\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e设置了三种规则\x3c\/h3\x3e\n\x3cp\x3e1.默认规则： 只要绑定指令，就默认有的校验。 比如非空的校验。 可以额外加修饰符来去除\x3cbr\x3e2.选项规则： 通过Vue指令的修饰符添加的规则。\x3cbr\x3e3.自定义规则： Vue指令属性值上添加的规则。\x3cbr\x3e同一个type的规则只存在一个，也就是说，如果type为reg(正则),那么会互相覆盖。 \x3cbr\x3e覆盖的优先级： 自定义规则  \x26gt; 选项规则  \x26gt; 默认规则\x3c\/p\x3e\n\x3cp\x3e思路讲的多了。也不知道怎么讲了，下面大家直接看源码把。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e源码\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var Vue\nvar checkWhenChange = true  \/\/每个输入框需要离焦即校验\n\n\/\/ 给一个dom添加class\nfunction addClass(dom, className){\n  \/\/ if (dom.classList){\n  \/\/   dom.classList.add(className);\n  \/\/ }else{\n  \/\/   dom.className \x2b= \x27 \x27 \x2b className;\n  \/\/ }\n\n  var hasClass = !!dom.className.match(new RegExp(\x27(\\\\s|^)\x27 \x2b _class \x2b \x27(\\\\s|$)\x27))\n  if(!hasClass){\n    dom.className \x2b= \x27 \x27 \x2b _class\n  }\n}\n\n\/\/常用正则表\nvar regList = {\n  ImgCode: \/^[0-9a-zA-Z]{4}$\/,\n  SmsCode: \/^\\d{4}$\/,\n  MailCode: \/^\\d{4}$\/,\n  UserName: \/^[\\w|\\d]{4,16}$\/,\n  Password: \/^[\\w!@#$%^\x26amp;*.]{6,16}$\/,\n  Mobile: \/^1[3|4|5|7|8]\\d{9}$\/,\n  RealName: \/^[\\u4e00-\\u9fa5|·]{2,16}$|^[a-zA-Z|\\s]{2,20}$\/,\n  BankNum: \/^\\d{10,19}$\/,\n  Money: \/^([1-9]\\d*|[0-9]\\d*\\.\\d{1,2}|0)$\/,\n  Answer: \/^\\S\x2b$\/,\n  Mail: \/^([a-zA-Z0-9_\\.\\-])\x2b\\@(([a-zA-Z0-9\\-])\x2b\\.)\x2b([a-zA-Z0-9]{2,4})\x2b$\/\n}\n\n\/\/ 断言函数\nfunction assert(condition, message){\n  if(!condition){\n    console.error(\x27[va-warn]:\x27 \x2b message)\n  }\n}\n\n\/\/ Rule构造器\nfunction Rule(ruleType, ruleValue, errMsg){\n  this.ruleType = ruleType\n  this.ruleValue = ruleValue\n  this.errMsg = errMsg || \x27\x27\n}\n\n\/\/VaForm构造器\nfunction VaForm(el, finalRules, modifiers){\n  this.ruleOrder = []\n  this.rules = {}\n  this.dom = el\n  this.value = el.value   \/\/值的副本\n  this.validated = false  \/\/是否被验证过\n  this.tag = el.getAttribute(\x27tag\x27)   \/\/提示的字段名\n  \/\/ this.correctMsg = `${this.tag}输入正确！`\n  this.correctMsg = \x27\x27\n  this.modifiers = modifiers   \/\/一些特殊的配置\n  this.noCheck = false         \/\/为true则不要校验\n\n  this.ruleOrder = finalRules.map(item=\x3e{\n    this.rules[item.ruleType] = item\n    return item.ruleType\n  })\n}\n\n\/\/rules中靠前的配置优先级最高\nfunction mergeRule(...rules){\n  var mergeResult = []\n  var combineArr = Array.prototype.concat.apply([], rules)\n  var hash = {}\n  combineArr.forEach((rule)=\x3e{\n    if(hash[rule.ruleType] === undefined){\n      mergeResult.push(rule)\n      hash[rule.ruleType] = mergeResult.length - 1\n    }else{\n      var index = hash[rule.ruleType]\n      Object.assign(mergeResult[index], rule)\n    }\n  })\n  return mergeResult\n}\n\n\/\/单个规则的验证结果\nfunction VaResult(ruleType, ruleValue, isPass, errMsg){\n  this.ruleType = ruleType\n  this.ruleValue = ruleValue\n  this.isPass = isPass\n  this.errMsg = errMsg\n}\n\n\/\/ 显示结果的构造器\nfunction DisplayResult(isPass, message){\n  this.isPass = isPass\n  this.message = message\n}\n\n\/\/单个规则的校验，或者单个表单的校验\nfunction validate(field, ruleType){\n  assert(field, \x27未输入要验证的字段\x27)\n  var vaForm = this.forms[field]\n  var {ruleOrder, rules} = vaForm\n\n  if(ruleType === undefined){\n    return this.checkForm(vaForm)\n  }else{\n    var rule = rules[ruleType] \/\/规则\n    return this.checkRule(vaForm, rule)\n  }\n  \/\/ vaForm.validated = true\n}\n\n\/\/ 获得不同的报错信息\nfunction getErrMsg(vaForm, ruleType, ruleValue){\n  var tag = vaForm.tag\n  var errMsgs = {\n    NonEmpty: `${tag}不能为空`,\n    reg: `${tag}格式错误`,\n    limit: `${tag}必须在${ruleValue[0]}与${ruleValue[1]}之间`,\n    equal:`两次${tag}不相同`,\n    length: `${tag}长度必须在${ruleValue[0]}与${ruleValue[1]}之间`,\n    unique: `${tag}不能相同`\n  }\n  return errMsgs[ruleType]\n}\n\n\/\/检测非空\nfunction checkEmpty(ruleValue, vaForm, va){\n  return vaForm.value.trim() ? true : false\n}\n\/\/检测正则\nfunction checkReg(ruleValue, vaForm, va){\n  return ruleValue.test(vaForm.value) ? true : false\n}\n\/\/检测数字区间\nfunction checkLimit(ruleValue, vaForm, va){\n  var value = vaForm.value\n  return ((\x2bvalue \x3e= ruleValue[0]) \x26amp;\x26amp; (\x2bvalue \x3c= ruleValue[1])) ? true : false\n}\n\/\/检测相等\nfunction checkEqual(ruleValue, vaForm, va){\n  var target = va.forms[ruleValue]\n  return target.value === vaForm.value ? true : false\n}\n\/\/检测字符长度\nfunction checkCharLength(ruleValue, vaForm, va){\n  var length = vaForm.value.length\n  return ((\x2blength \x3e= ruleValue[0]) \x26amp;\x26amp; (\x2blength \x3c= ruleValue[1])) ? true : false\n}\n\n\/\/几个输入框要各不相同\nfunction checkUnique(ruleValue, vaForm, va){\n  var uniqueGroup = va.uniqueGroup[ruleValue]\n  var values = uniqueGroup.map(field=\x3eva.forms[field].value)\n  var uniqueValues = values.filter((item,index,arr)=\x3earr.indexOf(item) === index)\n  return values.length === uniqueValues.length ? true : false\n}\n\n\/\/ 检测单个规则\nfunction checkRule(vaForm, rule){\n  var forms = this.forms\n  var {ruleType, ruleValue, errMsg} = rule\n  \/\/如果有自定义报错就按自定义报错，没有就格式化报错\n  errMsg = errMsg || getErrMsg(vaForm, ruleType, ruleValue)\n\n  var ruleCheckers = {\n    NonEmpty: checkEmpty,\n    reg: checkReg,\n    limit: checkLimit,\n    equal: checkEqual,\n    length: checkCharLength,\n    unique: checkUnique\n  }\n\n  var ruleChecker = ruleCheckers[ruleType]\n  var isPass = ruleChecker(ruleValue, vaForm, this)\n  var vaResult = new VaResult(ruleType, ruleValue, isPass, isPass ? null : errMsg)\n  return vaResult\n}\n\n\/\/检测单个表单\nfunction checkForm(vaForm){\n  var results = vaForm.ruleOrder.map(ruleType=\x3e{\n    var rule = vaForm.rules[ruleType]\n    return this.checkRule(vaForm,rule)\n  })\n\n  var errIndex = null\n  for(var i = 0;i \x3c results.length;i\x2b\x2b){\n    var result = results[i]\n    if(result.isPass === false){\n      errIndex = i\n      break\n    }\n  }\n\n  if(errIndex === null){\n    return new DisplayResult(true,  vaForm.correctMsg)\n  }else{\n    return new DisplayResult(false, results[errIndex].errMsg)\n  }\n}\n\n\/\/刷新vaForm中的值的数据\nfunction refreshValue(field, newValue){\n  this.forms[field].value = newValue \x2b \x27\x27\n}\n\n\/\/更新所有表单的值\nfunction refreshAllValue(){\n  this.fieldOrder.forEach(field=\x3e{\n    var vaForm = this.forms[field]\n    vaForm.value = vaForm.dom.value\n  })\n}\n\n\/\/ 校验所有的表单，并弹出第一个错误。考虑可以为空的情况\nfunction checkAll(){\n  var firstErr = null\n  this.fieldOrder.forEach(field=\x3e{\n    var vaForm = this.forms[field]\n    var canNull = vaForm.ruleOrder.every(ruleType=\x3eruleType !== \x27NonEmpty\x27)  \/\/输入框可以为空\n    var noCheckEmpty = (vaForm.value === \x27\x27 \x26amp;\x26amp; canNull)   \/\/该输入框可以为空，且输入为空\n\n    if(vaForm.noCheck === false \x26amp;\x26amp; noCheckEmpty === false){\n      var result = this.setVmResult(field)\n      \/\/ var result = this.validate(field)\n      \/\/ this.vmResult[field] = result\n      \/\/ vaForm.validated = true\n\n      if(firstErr === null \x26amp;\x26amp; result.isPass === false){\n        firstErr = result.message\n      }\n    }\n\n  })\n  return firstErr\n}\n\n\/\/验证单个字段，返回值，并弹出报错\nfunction setVmResult(field){\n  var result = this.validate(field) \/\/本输入框结果\n  this.vmResult[field] = result    \/\/将报错弹出\n  this.forms[field].validated = true  \/\/校验过了\n  return result\n}\n\n\/\/ 返回各个表单的值对象\nfunction getValue(){\n  var dataSet = {}\n  for(var field in this.forms){\n    dataSet[field] = this.forms[field].value\n  }\n  return dataSet\n}\n\n\/\/添加一个规则\nfunction addRule(field, index, Rule){\n  var vaForm = this.forms[field]\n  vaForm.ruleOrder.splice(index, 0, Rule.ruleType)\n  vaForm.rules[Rule.ruleType] = Rule\n}\n\n\/\/ function resetAll(){\n\/\/   this.fieldOrder.forEach(field=\x3e{\n\/\/     this.refreshValue(field, \x27\x27)\n\/\/   })\n\/\/ }\n\n\/\/ 设置不校验的表单\nfunction setNoCheck(field, bool){\n  this.forms[field].noCheck = bool\n}\n\nfunction createVa(vm, field){\n  var va = {\n    vmResult:vm.va,\n    fieldOrder:[],\n    forms:{},\n    group:{\n      base:[],\n    },\n    equalGroup:{},                  \/\/必须相等的字段\n    uniqueGroup:{},                 \/\/必须不同的字段\n    Rule:Rule,                      \/\/Rule构造器\n    VaForm:VaForm,                  \/\/VaForm构造器\n    validate: validate,             \/\/暴露的校验函数\n    setVmResult: setVmResult,       \/\/校验并报错\n    checkRule: checkRule,           \/\/内部的校验单条规则的函数\n    checkForm: checkForm,           \/\/内部的校验单个表单的函数\n    refreshValue: refreshValue,     \/\/更新某个表单的值\n    checkAll: checkAll,             \/\/检查所有的函数\n    getValue: getValue,             \/\/获取所有表单的当前值，得到一个对象\n    setNoCheck:setNoCheck,          \/\/设置为不校验\n    addRule:addRule,                \/\/给一个表单添加一个规则\n    refreshAllValue:refreshAllValue \/\/更新所有表单的值\n    \/\/ resetAll: resetAll\n  }\n\n  if(vm.$va){\n    return vm.$va\n  }else{\n    vm.$va = va\n    return va\n  }\n}\n\n\/\/v-va:Password.canNull = \x26quot;[{reg:\/^\\d{4}$\/}]\x26quot;\n\/\/arg = Password,  modifiers.canNull = true, value为后面相关的\n\/\/arg用来存字段名， modifiers用来存特殊配置， value为规则， tag是中文提示名， group 为分组\nvar main = {}\nmain.install = function(_Vue, options){\n  Vue = _Vue\n\n    Vue.directive(\x27va\x27,{\n    bind:function(el, binding, vnode){\n      var vm = vnode.context                         \/\/当前的vue实例\n      var field = binding.arg === \x27EXTEND\x27 ? el.getAttribute(\x27name\x27) : binding.arg \/\/ 当arg为EXTEND，从name属性获得值\n      var option = binding.modifiers                    \/\/特殊配置（允许非空，编辑新增共用等）\n      var value = el.value                              \/\/输入框的初始值\n      var group = el.getAttribute(\x27group\x27) || \x27base\x27    \/\/分组，一个表单框在多个组呢？这个还没设，要兼容。 通过类似 \x27group1 group2 group3 group4\x27\n      var tag = el.getAttribute(\x27tag\x27)\n      var regMsg = el.getAttribute(\x27regMsg\x27) || \x27\x27   \/\/针对正则的自定义报错\n      var baseRule = []                              \/\/默认的校验规则             --不用写，默认存在的规则（如非空），优先级最高\n      var customRule = []                            \/\/用户自定义的规则（组件中） --bingding.value\n      var optionalRule = []                          \/\/配置项中引申出来的规则，优先级最低\n\n      assert(tag, \x27未设置输入框的tag\x27)\n      assert(vm.va, \x27实例的data选项上，未设置va对象\x27)  \/\/实例上如果没有设置结果则报错。\n      assert(field, \x27未设置输入框字段\x27)\n      var va = createVa(vm, field)  \/\/单例模式创建va，绑定在vm上\n      va.fieldOrder.push(field)     \/\/字段的检验顺序\n      va.group[group].push(field)   \/\/分组\n      var NonEmpty = new Rule(\x27NonEmpty\x27, true, \x27\x27)\n      \/\/默认非空\n      if(option.CanNull === undefined){\n        baseRule.push(NonEmpty)\n      }\n\n      \/\/如果regList里有name对应的，直接就加进optionalConfig\n      if(regList[field]){\n        optionalRule.push(new Rule(\x27reg\x27, regList[field], regMsg))\n      }\n\n      \/\/如果modefiers中的字段有在正则表里，将其加入optionalRule\n      var regOptions = Object.keys(option);\n      for(var i = 0;i \x3c regOptions.length;i\x2b\x2b){\n        var regOption = regOptions[i]\n        if(regList[regOptions[i]]){\n          optionalRule.push(new Rule(\x27reg\x27, regList[regOption], regMsg))\n        }\n      }\n\n      \/\/用户自定义的规则\n      if(binding.value !== undefined){\n        customRule = binding.value.map(item=\x3e{\n          var ruleType = Object.keys(item)[0];\n          var errMsg = ruleType === \x27reg\x27 ? regMsg : \x27\x27\n          return new Rule(ruleType, item[ruleType], errMsg)\n        })\n      }\n\n      var finalRules = mergeRule(baseRule, optionalRule, customRule)\n      var hasUniqueRule = false\n      \/\/对联合校验的进行预处理\n      finalRules.forEach(rule=\x3e{\n        var {ruleType, ruleValue} = rule\n        if(ruleType === \x27equal\x27){\n          if(va.equalGroup[ruleValue] === undefined){\n            va.equalGroup[ruleValue] = [field]\n          }else{\n            va.equalGroup[ruleValue].push(field)\n          }\n        }\n\n        if(ruleType === \x27unique\x27){\n          hasUniqueRule = ruleValue\n          if(va.uniqueGroup[ruleValue] === undefined){\n            va.uniqueGroup[ruleValue] = [field]\n          }else{\n            va.uniqueGroup[ruleValue].push(field)\n          }\n        }\n      })\n\n      var vaForm = new VaForm(el, finalRules, option)\n      va.forms[field] = vaForm\n\n      if(checkWhenChange){\n        function validateSingle(){\n          va.refreshValue(field, el.value)  \/\/更新值\n          \/\/如果允许为空的此时为空，不校验\n          if(vaForm.value === \x27\x27 \x26amp;\x26amp; option.CanNull){\n            va.vmResult[field] = {}   \/\/如果为空，把界面显示上面的提示清掉\n            return\n          }\n\n          if(vaForm.noCheck === false){\n            va.setVmResult(field)\n          }\n\n          var isEqualTarget = false\n          for(var index in va.equalGroup){\n            if(index === field){\n              isEqualTarget = true\n            }\n          }\n\n          \/\/相等框的联合校验\n          if(isEqualTarget){\n            va.equalGroup[field].forEach(item=\x3e{va.setVmResult(item)})\n          }\n\n          \/\/不同框的联合校验\n          if(hasUniqueRule){\n            va.uniqueGroup[hasUniqueRule].forEach(item=\x3e{va.setVmResult(item)})\n          }\n        }\n\n        \/\/在change和blur上都绑定了处理事件\n        el.addEventListener(\x27change\x27, validateSingle)\n        el.addEventListener(\x27blur\x27, validateSingle)\n      }\n\n    },\n  })\n}\n\nexport default main\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre\x3e\x3ccode\x3evar Vue\nvar checkWhenChange = true  \/\/每个输入框需要离焦即校验\n\n\/\/ 给一个dom添加class\nfunction addClass(dom, className){\n  \/\/ if (dom.classList){\n  \/\/   dom.classList.add(className);\n  \/\/ }else{\n  \/\/   dom.className \x2b= \x27 \x27 \x2b className;\n  \/\/ }\n\n  var hasClass = !!dom.className.match(new RegExp(\x27(\\\\s|^)\x27 \x2b _class \x2b \x27(\\\\s|$)\x27))\n  if(!hasClass){\n    dom.className \x2b= \x27 \x27 \x2b _class\n  }\n}\n\n\/\/常用正则表\nvar regList = {\n  ImgCode: \/^[0-9a-zA-Z]{4}$\/,\n  SmsCode: \/^\\d{4}$\/,\n  MailCode: \/^\\d{4}$\/,\n  UserName: \/^[\\w|\\d]{4,16}$\/,\n  Password: \/^[\\w!@#$%^\x26amp;*.]{6,16}$\/,\n  Mobile: \/^1[3|4|5|7|8]\\d{9}$\/,\n  RealName: \/^[\\u4e00-\\u9fa5|·]{2,16}$|^[a-zA-Z|\\s]{2,20}$\/,\n  BankNum: \/^\\d{10,19}$\/,\n  Money: \/^([1-9]\\d*|[0-9]\\d*\\.\\d{1,2}|0)$\/,\n  Answer: \/^\\S\x2b$\/,\n  Mail: \/^([a-zA-Z0-9_\\.\\-])\x2b\\@(([a-zA-Z0-9\\-])\x2b\\.)\x2b([a-zA-Z0-9]{2,4})\x2b$\/\n}\n\n\/\/ 断言函数\nfunction assert(condition, message){\n  if(!condition){\n    console.error(\x27[va-warn]:\x27 \x2b message)\n  }\n}\n\n\/\/ Rule构造器\nfunction Rule(ruleType, ruleValue, errMsg){\n  this.ruleType = ruleType\n  this.ruleValue = ruleValue\n  this.errMsg = errMsg || \x27\x27\n}\n\n\/\/VaForm构造器\nfunction VaForm(el, finalRules, modifiers){\n  this.ruleOrder = []\n  this.rules = {}\n  this.dom = el\n  this.value = el.value   \/\/值的副本\n  this.validated = false  \/\/是否被验证过\n  this.tag = el.getAttribute(\x27tag\x27)   \/\/提示的字段名\n  \/\/ this.correctMsg = `${this.tag}输入正确！`\n  this.correctMsg = \x27\x27\n  this.modifiers = modifiers   \/\/一些特殊的配置\n  this.noCheck = false         \/\/为true则不要校验\n\n  this.ruleOrder = finalRules.map(item=\x26gt;{\n    this.rules[item.ruleType] = item\n    return item.ruleType\n  })\n}\n\n\/\/rules中靠前的配置优先级最高\nfunction mergeRule(...rules){\n  var mergeResult = []\n  var combineArr = Array.prototype.concat.apply([], rules)\n  var hash = {}\n  combineArr.forEach((rule)=\x26gt;{\n    if(hash[rule.ruleType] === undefined){\n      mergeResult.push(rule)\n      hash[rule.ruleType] = mergeResult.length - 1\n    }else{\n      var index = hash[rule.ruleType]\n      Object.assign(mergeResult[index], rule)\n    }\n  })\n  return mergeResult\n}\n\n\/\/单个规则的验证结果\nfunction VaResult(ruleType, ruleValue, isPass, errMsg){\n  this.ruleType = ruleType\n  this.ruleValue = ruleValue\n  this.isPass = isPass\n  this.errMsg = errMsg\n}\n\n\/\/ 显示结果的构造器\nfunction DisplayResult(isPass, message){\n  this.isPass = isPass\n  this.message = message\n}\n\n\/\/单个规则的校验，或者单个表单的校验\nfunction validate(field, ruleType){\n  assert(field, \x27未输入要验证的字段\x27)\n  var vaForm = this.forms[field]\n  var {ruleOrder, rules} = vaForm\n\n  if(ruleType === undefined){\n    return this.checkForm(vaForm)\n  }else{\n    var rule = rules[ruleType] \/\/规则\n    return this.checkRule(vaForm, rule)\n  }\n  \/\/ vaForm.validated = true\n}\n\n\/\/ 获得不同的报错信息\nfunction getErrMsg(vaForm, ruleType, ruleValue){\n  var tag = vaForm.tag\n  var errMsgs = {\n    NonEmpty: `${tag}不能为空`,\n    reg: `${tag}格式错误`,\n    limit: `${tag}必须在${ruleValue[0]}与${ruleValue[1]}之间`,\n    equal:`两次${tag}不相同`,\n    length: `${tag}长度必须在${ruleValue[0]}与${ruleValue[1]}之间`,\n    unique: `${tag}不能相同`\n  }\n  return errMsgs[ruleType]\n}\n\n\/\/检测非空\nfunction checkEmpty(ruleValue, vaForm, va){\n  return vaForm.value.trim() ? true : false\n}\n\/\/检测正则\nfunction checkReg(ruleValue, vaForm, va){\n  return ruleValue.test(vaForm.value) ? true : false\n}\n\/\/检测数字区间\nfunction checkLimit(ruleValue, vaForm, va){\n  var value = vaForm.value\n  return ((\x2bvalue \x26gt;= ruleValue[0]) \x26amp;\x26amp; (\x2bvalue \x26lt;= ruleValue[1])) ? true : false\n}\n\/\/检测相等\nfunction checkEqual(ruleValue, vaForm, va){\n  var target = va.forms[ruleValue]\n  return target.value === vaForm.value ? true : false\n}\n\/\/检测字符长度\nfunction checkCharLength(ruleValue, vaForm, va){\n  var length = vaForm.value.length\n  return ((\x2blength \x26gt;= ruleValue[0]) \x26amp;\x26amp; (\x2blength \x26lt;= ruleValue[1])) ? true : false\n}\n\n\/\/几个输入框要各不相同\nfunction checkUnique(ruleValue, vaForm, va){\n  var uniqueGroup = va.uniqueGroup[ruleValue]\n  var values = uniqueGroup.map(field=\x26gt;va.forms[field].value)\n  var uniqueValues = values.filter((item,index,arr)=\x26gt;arr.indexOf(item) === index)\n  return values.length === uniqueValues.length ? true : false\n}\n\n\/\/ 检测单个规则\nfunction checkRule(vaForm, rule){\n  var forms = this.forms\n  var {ruleType, ruleValue, errMsg} = rule\n  \/\/如果有自定义报错就按自定义报错，没有就格式化报错\n  errMsg = errMsg || getErrMsg(vaForm, ruleType, ruleValue)\n\n  var ruleCheckers = {\n    NonEmpty: checkEmpty,\n    reg: checkReg,\n    limit: checkLimit,\n    equal: checkEqual,\n    length: checkCharLength,\n    unique: checkUnique\n  }\n\n  var ruleChecker = ruleCheckers[ruleType]\n  var isPass = ruleChecker(ruleValue, vaForm, this)\n  var vaResult = new VaResult(ruleType, ruleValue, isPass, isPass ? null : errMsg)\n  return vaResult\n}\n\n\/\/检测单个表单\nfunction checkForm(vaForm){\n  var results = vaForm.ruleOrder.map(ruleType=\x26gt;{\n    var rule = vaForm.rules[ruleType]\n    return this.checkRule(vaForm,rule)\n  })\n\n  var errIndex = null\n  for(var i = 0;i \x26lt; results.length;i\x2b\x2b){\n    var result = results[i]\n    if(result.isPass === false){\n      errIndex = i\n      break\n    }\n  }\n\n  if(errIndex === null){\n    return new DisplayResult(true,  vaForm.correctMsg)\n  }else{\n    return new DisplayResult(false, results[errIndex].errMsg)\n  }\n}\n\n\/\/刷新vaForm中的值的数据\nfunction refreshValue(field, newValue){\n  this.forms[field].value = newValue \x2b \x27\x27\n}\n\n\/\/更新所有表单的值\nfunction refreshAllValue(){\n  this.fieldOrder.forEach(field=\x26gt;{\n    var vaForm = this.forms[field]\n    vaForm.value = vaForm.dom.value\n  })\n}\n\n\/\/ 校验所有的表单，并弹出第一个错误。考虑可以为空的情况\nfunction checkAll(){\n  var firstErr = null\n  this.fieldOrder.forEach(field=\x26gt;{\n    var vaForm = this.forms[field]\n    var canNull = vaForm.ruleOrder.every(ruleType=\x26gt;ruleType !== \x27NonEmpty\x27)  \/\/输入框可以为空\n    var noCheckEmpty = (vaForm.value === \x27\x27 \x26amp;\x26amp; canNull)   \/\/该输入框可以为空，且输入为空\n\n    if(vaForm.noCheck === false \x26amp;\x26amp; noCheckEmpty === false){\n      var result = this.setVmResult(field)\n      \/\/ var result = this.validate(field)\n      \/\/ this.vmResult[field] = result\n      \/\/ vaForm.validated = true\n\n      if(firstErr === null \x26amp;\x26amp; result.isPass === false){\n        firstErr = result.message\n      }\n    }\n\n  })\n  return firstErr\n}\n\n\/\/验证单个字段，返回值，并弹出报错\nfunction setVmResult(field){\n  var result = this.validate(field) \/\/本输入框结果\n  this.vmResult[field] = result    \/\/将报错弹出\n  this.forms[field].validated = true  \/\/校验过了\n  return result\n}\n\n\/\/ 返回各个表单的值对象\nfunction getValue(){\n  var dataSet = {}\n  for(var field in this.forms){\n    dataSet[field] = this.forms[field].value\n  }\n  return dataSet\n}\n\n\/\/添加一个规则\nfunction addRule(field, index, Rule){\n  var vaForm = this.forms[field]\n  vaForm.ruleOrder.splice(index, 0, Rule.ruleType)\n  vaForm.rules[Rule.ruleType] = Rule\n}\n\n\/\/ function resetAll(){\n\/\/   this.fieldOrder.forEach(field=\x26gt;{\n\/\/     this.refreshValue(field, \x27\x27)\n\/\/   })\n\/\/ }\n\n\/\/ 设置不校验的表单\nfunction setNoCheck(field, bool){\n  this.forms[field].noCheck = bool\n}\n\nfunction createVa(vm, field){\n  var va = {\n    vmResult:vm.va,\n    fieldOrder:[],\n    forms:{},\n    group:{\n      base:[],\n    },\n    equalGroup:{},                  \/\/必须相等的字段\n    uniqueGroup:{},                 \/\/必须不同的字段\n    Rule:Rule,                      \/\/Rule构造器\n    VaForm:VaForm,                  \/\/VaForm构造器\n    validate: validate,             \/\/暴露的校验函数\n    setVmResult: setVmResult,       \/\/校验并报错\n    checkRule: checkRule,           \/\/内部的校验单条规则的函数\n    checkForm: checkForm,           \/\/内部的校验单个表单的函数\n    refreshValue: refreshValue,     \/\/更新某个表单的值\n    checkAll: checkAll,             \/\/检查所有的函数\n    getValue: getValue,             \/\/获取所有表单的当前值，得到一个对象\n    setNoCheck:setNoCheck,          \/\/设置为不校验\n    addRule:addRule,                \/\/给一个表单添加一个规则\n    refreshAllValue:refreshAllValue \/\/更新所有表单的值\n    \/\/ resetAll: resetAll\n  }\n\n  if(vm.$va){\n    return vm.$va\n  }else{\n    vm.$va = va\n    return va\n  }\n}\n\n\/\/v-va:Password.canNull = \x22[{reg:\/^\\d{4}$\/}]\x22\n\/\/arg = Password,  modifiers.canNull = true, value为后面相关的\n\/\/arg用来存字段名， modifiers用来存特殊配置， value为规则， tag是中文提示名， group 为分组\nvar main = {}\nmain.install = function(_Vue, options){\n  Vue = _Vue\n\n    Vue.directive(\x27va\x27,{\n    bind:function(el, binding, vnode){\n      var vm = vnode.context                         \/\/当前的vue实例\n      var field = binding.arg === \x27EXTEND\x27 ? el.getAttribute(\x27name\x27) : binding.arg \/\/ 当arg为EXTEND，从name属性获得值\n      var option = binding.modifiers                    \/\/特殊配置（允许非空，编辑新增共用等）\n      var value = el.value                              \/\/输入框的初始值\n      var group = el.getAttribute(\x27group\x27) || \x27base\x27    \/\/分组，一个表单框在多个组呢？这个还没设，要兼容。 通过类似 \x27group1 group2 group3 group4\x27\n      var tag = el.getAttribute(\x27tag\x27)\n      var regMsg = el.getAttribute(\x27regMsg\x27) || \x27\x27   \/\/针对正则的自定义报错\n      var baseRule = []                              \/\/默认的校验规则             --不用写，默认存在的规则（如非空），优先级最高\n      var customRule = []                            \/\/用户自定义的规则（组件中） --bingding.value\n      var optionalRule = []                          \/\/配置项中引申出来的规则，优先级最低\n\n      assert(tag, \x27未设置输入框的tag\x27)\n      assert(vm.va, \x27实例的data选项上，未设置va对象\x27)  \/\/实例上如果没有设置结果则报错。\n      assert(field, \x27未设置输入框字段\x27)\n      var va = createVa(vm, field)  \/\/单例模式创建va，绑定在vm上\n      va.fieldOrder.push(field)     \/\/字段的检验顺序\n      va.group[group].push(field)   \/\/分组\n      var NonEmpty = new Rule(\x27NonEmpty\x27, true, \x27\x27)\n      \/\/默认非空\n      if(option.CanNull === undefined){\n        baseRule.push(NonEmpty)\n      }\n\n      \/\/如果regList里有name对应的，直接就加进optionalConfig\n      if(regList[field]){\n        optionalRule.push(new Rule(\x27reg\x27, regList[field], regMsg))\n      }\n\n      \/\/如果modefiers中的字段有在正则表里，将其加入optionalRule\n      var regOptions = Object.keys(option);\n      for(var i = 0;i \x26lt; regOptions.length;i\x2b\x2b){\n        var regOption = regOptions[i]\n        if(regList[regOptions[i]]){\n          optionalRule.push(new Rule(\x27reg\x27, regList[regOption], regMsg))\n        }\n      }\n\n      \/\/用户自定义的规则\n      if(binding.value !== undefined){\n        customRule = binding.value.map(item=\x26gt;{\n          var ruleType = Object.keys(item)[0];\n          var errMsg = ruleType === \x27reg\x27 ? regMsg : \x27\x27\n          return new Rule(ruleType, item[ruleType], errMsg)\n        })\n      }\n\n      var finalRules = mergeRule(baseRule, optionalRule, customRule)\n      var hasUniqueRule = false\n      \/\/对联合校验的进行预处理\n      finalRules.forEach(rule=\x26gt;{\n        var {ruleType, ruleValue} = rule\n        if(ruleType === \x27equal\x27){\n          if(va.equalGroup[ruleValue] === undefined){\n            va.equalGroup[ruleValue] = [field]\n          }else{\n            va.equalGroup[ruleValue].push(field)\n          }\n        }\n\n        if(ruleType === \x27unique\x27){\n          hasUniqueRule = ruleValue\n          if(va.uniqueGroup[ruleValue] === undefined){\n            va.uniqueGroup[ruleValue] = [field]\n          }else{\n            va.uniqueGroup[ruleValue].push(field)\n          }\n        }\n      })\n\n      var vaForm = new VaForm(el, finalRules, option)\n      va.forms[field] = vaForm\n\n      if(checkWhenChange){\n        function validateSingle(){\n          va.refreshValue(field, el.value)  \/\/更新值\n          \/\/如果允许为空的此时为空，不校验\n          if(vaForm.value === \x27\x27 \x26amp;\x26amp; option.CanNull){\n            va.vmResult[field] = {}   \/\/如果为空，把界面显示上面的提示清掉\n            return\n          }\n\n          if(vaForm.noCheck === false){\n            va.setVmResult(field)\n          }\n\n          var isEqualTarget = false\n          for(var index in va.equalGroup){\n            if(index === field){\n              isEqualTarget = true\n            }\n          }\n\n          \/\/相等框的联合校验\n          if(isEqualTarget){\n            va.equalGroup[field].forEach(item=\x26gt;{va.setVmResult(item)})\n          }\n\n          \/\/不同框的联合校验\n          if(hasUniqueRule){\n            va.uniqueGroup[hasUniqueRule].forEach(item=\x26gt;{va.setVmResult(item)})\n          }\n        }\n\n        \/\/在change和blur上都绑定了处理事件\n        el.addEventListener(\x27change\x27, validateSingle)\n        el.addEventListener(\x27blur\x27, validateSingle)\n      }\n\n    },\n  })\n}\n\nexport default main\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在项目已经用起来了。当然表单验证这种是高度定制化的。纯粹分享个过程和思路。也算我这个vue新手的一次阶段性成果吧。哈哈~\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e使用实例\x3c\/h2\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVG8UP?w=810\x26amp;h=682\x22 src=\x22https:\/\/static.alili.tech\/img\/bVG8UP?w=810\x26amp;h=682\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e第一个框，加了两条指令\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3ev-va:Password   这个代表使用配置表中password对应的配置（包括非空和正则，默认规则），同时应用Password作为校验成功获取的 数据对象的key\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etag为报错显示中此输入框的名字\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e第二个框，为确认框，也加了两个指令\x3cbr\x3e1.v-va:checkPassword.Password =  \x22[{\x27equal\x27:\x27Password\x27}]\x22\x3cbr\x3e一般v-va后面的第一个字段为数据对象的key，他和正则对应的名字有可能不同。\x3cbr\x3e这个字段如果和配置表中的配置匹配，那么自然应用配置。\x3cbr\x3e如果不匹配，就要自己在后面用.的方式加配置（选项规则）。像这里的Password。\x3c\/p\x3e\n\x3cp\x3e最后面还有一个 属性值 \x22[{\x27equal\x27:\x27Password\x27}]\x22（自定义规则）。\x3cbr\x3e这个地方用了数组，即会按这个数组的配置来进行校验。\x3cbr\x3e同时这个数组有顺序，顺序代表规则的优先级。 \x3cbr\x3e这个配置代表，这个框必须和上面那个Password的框值相等，否则报错。\x3cbr\x3e另外确认框不加入最后的结果数据对象。\x3c\/p\x3e\n\x3cp\x3e2.tag 用来作为报错信息的名字\x3c\/p\x3e\n\x3cp\x3e校验触发按钮 上面有一个指令 v-va-check\x3cbr\x3e1.用来触发校验\x3cbr\x3e2.校验成功后，将数据对象存在实例的vaVal属性下\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e根据上面的实例\x3c\/h3\x3e\n\x3cp\x3e规则的优先级：\x3cbr\x3e1.自定义规则  \x26gt; 选项规则  \x26gt; 默认规则 \x3cbr\x3e2.规则中的优先级依照数组顺序\x3c\/p\x3e\n\x3cp\x3e另外，可以看到为了使用者方便，我在我们团队中事先做了一些约定，并可能会用到 v-va、v-va-check、tag等指令，占用了实例的两个属性名vaConfig、vaVal。这些约定和设置可以使使用者使用方便（通过配置控制校验时机， 校验成功后自然生成通过的数据对象，自定义报错信息等等）。但是也减少了这个插件的普适性。\x3c\/p\x3e\n\x3cp\x3e此方案仅提供各位做思路参考。个人认为，表单验证是高度定制化的需求，尽量根据各个业务情况进行取舍。在我的方案中，并不像vue-validator一样做了脏校验。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>va.js——Vue 表单验证插件的写作过程</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007575302">https://segmentfault.com/a/1190000007575302</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/98kdcr980mi/" target="_blank">https://alili.tech/archive/98kdcr980mi/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>