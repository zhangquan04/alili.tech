<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="ES6 Generator与异步的同步书写"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>ES6 Generator与异步的同步书写 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/ib3snep59h/",
				"appid": "1613049289050283", 
				"title": "ES6 Generator与异步的同步书写 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-09T02:30:12"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/qg7uum1dfzp/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/a1h31fwkh2m/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&text=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&text=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&title=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&is_video=false&description=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&title=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&title=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&title=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fib3snep59h%2f&title=ES6%20Generator%e4%b8%8e%e5%bc%82%e6%ad%a5%e7%9a%84%e5%90%8c%e6%ad%a5%e4%b9%a6%e5%86%99"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">ES6 Generator与异步的同步书写</h1><div class="meta"><div class="postdate"><time datetime="2019-01-09" itemprop="datePublished">2019-01-09</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e开始前\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e我们从来没有停止过对\x3ccode\x3ejavascript\x3c\/code\x3e语言异步调用方式的改造，我们一直都想用像\x3ccode\x3ejava\x3c\/code\x3e那样同步的方式去写异步，尽管\x3ccode\x3ePromise\x3c\/code\x3e可以让我们将异步回调添加到\x3ccode\x3ethen\x3c\/code\x3e方法中，但是这种调用方式仍然不那么优雅，\x3ccode\x3ees6\x3c\/code\x3e 中新增加了\x3ccode\x3egenerator\x3c\/code\x3e，我们可以通过他的特性来实现异步任务更加优雅的书写方式。\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e协程介绍\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e协程其实和线程，进程是没有关系的，它不是操作系统为我们提供的\x3ccode\x3eapi\x3c\/code\x3e接口，而是通过编程语言或者汇编语言对程序上下文、程序栈来操作实现的。一个线程里面可以包含多个协程，线程的调度是由操作体统来决定的，协程的调度是由用户来决定的。操作系统对其一无所知，因为可以由用户来调度，所以用来执行协作式的任务特别方便。（注意这里是方便，因为能通过协程解决的问题，通过线程和进程也可以解决，但是复杂）\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e\n\x3ccode\x3eGenerator\x3c\/code\x3e介绍\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e\x3ccode\x3eGenerator\x3c\/code\x3e 是协程在\x3ccode\x3ees6\x3c\/code\x3e中的实现。它在\x3ccode\x3ees6\x3c\/code\x3e中是一个函数，这个函数可以分阶段执行，也就是说我们可以在这个函数中的某个位置选择交出当前线程的执行权限，也可以在当前函数外面的某个位置选择将权限再交回这个函数，让它继续执行，这种调度完全由用户决定。在\x3ccode\x3ees6\x3c\/code\x3e中协程函数是这样的\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* gen(p) {\n    var a = yield p \x2b 1;  \/\/1\n    var b = yield p \x2b 2;  \/\/2\n    return b;  \/\/3\n}\n\nvar g = gen(1);\ng.next();  \/\/{value: 2, done: false}\ng.next();  \/\/{value: 3, done: false}\ng.next();  \/\/{value: undefined, done: true}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ruby\x22\x3e\x3ccode\x3efunction* gen(p) {\n    var a = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e p \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    var b = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e p \x2b \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e b;  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\n}\n\nvar g = gen(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e}\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e}\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e undefined, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过 \x3ccode\x3evar g = gen(1);\x3c\/code\x3e 仅仅是创建了一个迭代器，函数 \x3ccode\x3egen\x3c\/code\x3e 里面的内容并没有执行函数体的执行时由第一个 \x3ccode\x3eg.next();\x3c\/code\x3e 开始的 并且将 \x3ccode\x3eyield\x3c\/code\x3e 所在那那条语句执行完后就会返回结果。而后面的语句并没有执行。返回值是一个对象，它的第一个属性是 yield 后面表达式的值 (\x3ccode\x3ep\x2b1\x3c\/code\x3e或者\x3ccode\x3ep\x2b2\x3c\/code\x3e的值);第二个属性表示Generator函数是否执行完成。这里我们通过 \x3ccode\x3eyield\x3c\/code\x3e 执行权限交出去，通过 \x3ccode\x3enext\x3c\/code\x3e 将权限返回。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* gen(p) {\n    var a = yield p \x2b 1;  \/\/1\n    var b = yield a \x2b 1;  \/\/2 注意这里是用到了 a\n    return b;\n}\nvar g = gen(1);\ng.next();  \/\/{value: 2, done: false}\ng.next();  \/\/{value: NaN, done: false} 这里的值是 NaN\ng.next();  \/\/{value: undefined, done: true}\n\ng.next();  \/\/{value: 2, done: false}\ng.next(2);  \/\/{value: 3, done: false}\ng.next(6);  \/\/{value: 6, done: true}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ruby\x22\x3e\x3ccode\x3efunction* gen(p) {\n    var a = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e p \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n    var b = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e a \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e 注意这里是用到了 a\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e b;\n}\nvar g = gen(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e}\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e NaN, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e} 这里的值是 NaN\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e undefined, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}\n\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e}\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e}\ng.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e);  \x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3e{\x3cspan class=\x22hljs-symbol\x22\x3evalue:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e6\x3c\/span\x3e, \x3cspan class=\x22hljs-symbol\x22\x3edone:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意这里 \/\/1 处 \/\/2 处  \x3ccode\x3evar a = yield p \x2b 1;\x3c\/code\x3e这条赋值语句中 \x3ccode\x3ea\x3c\/code\x3e 的值并不是 \x3ccode\x3ep \x2b 1\x3c\/code\x3e的值。这条语句只是一种写法，这里 \x3ccode\x3ea\x3c\/code\x3e 的值是我们在第二个 \x3ccode\x3enext\x3c\/code\x3e 中传入的 \x3ccode\x3e2\x3c\/code\x3e 这个很重要 \x3ccode\x3eb\x3c\/code\x3e 的值也是我们在第三个 \x3ccode\x3enext\x3c\/code\x3e 中传入的 \x3ccode\x3e6\x3c\/code\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e\n\x3ccode\x3eGenerator\x3c\/code\x3e 的重要特性\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e由上面的内容我们总结 3 个关于 Generator 的重要特性\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e1 通过 \x3ccode\x3eyield\x3c\/code\x3e 交出执行权限，通过 \x3ccode\x3enext\x3c\/code\x3e 返回执行权限\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e2 调用 \x3ccode\x3enext\x3c\/code\x3e 会得到一个返回值，这个值里面包含了 \x3ccode\x3eyield\x3c\/code\x3e 后面的表达式的执行结果\x3c\/strong\x3e\x3cbr\x3e\x3cstrong\x3e3 我们可以通过给 \x3ccode\x3enext\x3c\/code\x3e 传递参数，并且可以在 Generator 函数中通过上面所写的特殊方式来引用\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e利用 \x3ccode\x3eGenerator\x3c\/code\x3e 的特性来实现异步代码的同步书写\x3c\/h2\x3e\n\x3cp\x3e\x3cstrong\x3e我们来模拟一个异步函数\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function post(url, callback) {\n    setTimeout(function() {\n        var data = { \/\/模拟异步处理结果\n            url:url,\n            value:10\n        };\n        callback(data);\n    }, 1000);\n}\n\npost(\x27http:\/\/_ivenj\x27,function(data){\n    console.log(data.url);  \/\/ http:\/\/_ivenj\n    console.log(data.value);  \/\/10\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fortran\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3c\/span\x3e post(url, callback) {\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n        var \x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e = { \/\/模拟异步处理结果\n            url:url,\n            \x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n        };\n        callback(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n}\n\npost(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/_ivenj\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(data)\x3c\/span\x3e\x3c\/span\x3e{\n    console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.url);  \/\/ http:\/\/_ivenj\n    console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3edata\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3evalue\x3c\/span\x3e);  \/\/\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e对应上面的这个异步函数我想通过 Generator 来这样用\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* gen(url) {\n    var data = yield post(url);  \/\/1\n    console.log(data.url);\n    console.log(data.value);\n}\nvar g = gen(\x27http:\/\/_ivenj\x27);\nvar resultG = g.next();\ng.next(resultG.value);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e post(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.value);\n}\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e g = gen(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/_ivenj\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e resultG = g.next();\ng.next(resultG.value);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是的，这样写漂亮多了，很像 \x3ccode\x3ejava\x3c\/code\x3e 的同步写法。不同之处就是多了个 \x3ccode\x3eyield\x3c\/code\x3e 和 \x3ccode\x3e*\x3c\/code\x3e ，这个无伤大雅。当然以上这样用肯定是不行的。因为 \x3ccode\x3epost\x3c\/code\x3e 毕竟是个异步方法。没有返回值.如果不能实现这样的写法我这半天就是在扯淡，所以通过包装是可以实现的。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e通过以下两点可以实现以上的书写方式\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e(1)我有一篇文章 \x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000008754562\x22\x3ereact 实践之 redux applyMiddleware方法详解\x3c\/a\x3e 中介绍了柯里化（Currying）这篇文章虽然是写react的但是柯里化是独立的，这里就要利用柯里化的思想\x3c\/p\x3e\n\x3cp\x3e(2)我们要在回调中调用 \x3ccode\x3enext\x3c\/code\x3e 来继续执行，(这里有人会想不是不用回调了么，怎么还用，请继续看。。。)\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e我们要对 \x3ccode\x3epost\x3c\/code\x3e 的调用形式进行包装\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function kPost(url) {\n    return function(callback) {\n        post(url, callback);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ekPost\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n        post(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e, callback);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e通过这个包装，我们就能保证调用 \x3ccode\x3ekPost\x3c\/code\x3e 就会同步的得到一个返回值\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function* gen(url) {\n    var data = yield kPost(url);  \/\/1\n    console.log(data.url);\n    console.log(data.value);\n}\n\/\/这里执行方式会不同\nvar g = gen(\x27http:\/\/_ivenj\x27);\n\/\/启动任务\nvar resultG1 = g.next();\nvar value_resultG1 = resultG1.value; \/\/resultG1.value 一定是一个函数，因为我们包装了\nvalue_resultG1(function(data){\n    g.next(data);  \/\/通过在异步的回调中调用 next 并传递值来确保依赖异步结果的代码能正确执行\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e kPost(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.value);\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/这里执行方式会不同\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e g = gen(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/_ivenj\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/启动任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e resultG1 = g.next();\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e value_resultG1 = resultG1.value; \x3cspan class=\x22hljs-comment\x22\x3e\/\/resultG1.value 一定是一个函数，因为我们包装了\x3c\/span\x3e\nvalue_resultG1(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    g.next(data);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/通过在异步的回调中调用 next 并传递值来确保依赖异步结果的代码能正确执行\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e下面就是整体代码，是上面的片段组合，请你粘贴到浏览器控制台，或者用node运行，就会看到想要的结果\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function post(url, callback) {\n    setTimeout(function() {\n        var data = { \/\/模拟异步处理结果\n            url:url,\n            value:10\n        };\n        callback(data);\n    }, 1000);\n}\nfunction kPost(url) {\n    return function(callback) {\n        post(url, callback);\n    }\n}\nfunction* gen(url) {\n    var data = yield kPost(url);  \/\/1\n    console.log(data.url);\n    console.log(data.value);\n}\n\/\/这里执行方式会不同\nvar g = gen(\x27http:\/\/_ivenj\x27);\n\/\/启动任务\nvar resultG1 = g.next();\nvar value_resultG1 = resultG1.value; \/\/resultG1.value 一定是一个函数，因为我们包装了\nvalue_resultG1(function(data){\n    g.next(data);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epost\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, callback\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟异步处理结果\x3c\/span\x3e\n            \x3cspan class=\x22hljs-attribute\x22\x3eurl\x3c\/span\x3e:\x3cspan class=\x22hljs-attribute\x22\x3eurl,\n            value\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n        };\n        callback(data);\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ekPost\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n        post(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e, callback);\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e kPost(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/1\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.url);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.value);\n}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/这里执行方式会不同\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e g = gen(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/_ivenj\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/启动任务\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e resultG1 = g.next();\n\x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e value_resultG1 = resultG1.value; \x3cspan class=\x22hljs-comment\x22\x3e\/\/resultG1.value 一定是一个函数，因为我们包装了\x3c\/span\x3e\nvalue_resultG1(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e)\x3c\/span\x3e{\n    g.next(data);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e有人会说，怎么不就是将异步回调转移出来了么，还要写回调。这说明你还没有真正体会个中之奥妙。我们会发现 我们写的异步\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22value_resultG1(function(data){\n    g.next(data);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3evalue_resultG1(\x3cspan class=\x22hljs-name\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-name\x22\x3edata\x3c\/span\x3e){\n    g.next(\x3cspan class=\x22hljs-name\x22\x3edata\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n})\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e仅仅是调用了 \x3ccode\x3enext\x3c\/code\x3e 进行了结果的传递，这里面有共同之处，不管是哪一种异步，我们都只传递值。大家的处理都是一样的。真正的业务逻辑确实是用同步的方式写的。那么，我们可以将共同的地方提取出来，写一个通用的函数去执行这个传值操作，这样，我们完全就告别了异步，再也看不到了，好开心。\x3ccode\x3eco.js\x3c\/code\x3e就是一个这种\x3ccode\x3egenerator\x3c\/code\x3e的执行库。使用它是我们只需要将我们的 gen 传递给它像这样 \x3ccode\x3eco(gen)\x3c\/code\x3e 是的就这样。下面我们自己写一个 \x3ccode\x3eco\x3c\/code\x3e\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eGenerator执行器\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function co(taskDef) {\n    \/\/获取迭代器  类似 java 中的外柄迭代子\n    var task = taskDef();\n    \/\/开始任务\n    var result = task.next();\n    \/\/调用next的递归函数\n    function step() {\n        if (!result.done) {  \/\/如果generator没有执行完\n            if (typeof result.value === \x26quot;function\x26quot;) {\n                result.value(function(err, data) {\n                    if (err) {\n                        result = task.throw(err);\n                        return;\n                    }\n                    result = task.next(data);  \/\/向后传递当前异步处理结果\n                    step();  \/\/递归执行\n                });\n            } else {\n                result = task.next(result.value);  \/\/如果执行完了就传递值\n                step();  \/\/递归执行\n            }\n\n        }\n    }\n    \/\/ 启动递归函数\n    step();\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gradle\x22\x3e\x3ccode\x3efunction co(taskDef) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/获取迭代器  类似 java 中的外柄迭代子\x3c\/span\x3e\n    var \x3cspan class=\x22hljs-keyword\x22\x3etask\x3c\/span\x3e = taskDef();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/开始任务\x3c\/span\x3e\n    var result = \x3cspan class=\x22hljs-keyword\x22\x3etask\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/调用next的递归函数\x3c\/span\x3e\n    function \x3cspan class=\x22hljs-keyword\x22\x3estep\x3c\/span\x3e() {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!result.done) {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果generator没有执行完\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (typeof result.value === \x3cspan class=\x22hljs-string\x22\x3e\x22function\x22\x3c\/span\x3e) {\n                result.value(function(err, data) {\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                        result = \x3cspan class=\x22hljs-keyword\x22\x3etask\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e(err);\n                        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                    }\n                    result = \x3cspan class=\x22hljs-keyword\x22\x3etask\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e(data);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/向后传递当前异步处理结果\x3c\/span\x3e\n                    \x3cspan class=\x22hljs-keyword\x22\x3estep\x3c\/span\x3e();  \x3cspan class=\x22hljs-comment\x22\x3e\/\/递归执行\x3c\/span\x3e\n                });\n            } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n                result = \x3cspan class=\x22hljs-keyword\x22\x3etask\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3enext\x3c\/span\x3e(result.value);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果执行完了就传递值\x3c\/span\x3e\n                \x3cspan class=\x22hljs-keyword\x22\x3estep\x3c\/span\x3e();  \x3cspan class=\x22hljs-comment\x22\x3e\/\/递归执行\x3c\/span\x3e\n            }\n\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 启动递归函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3estep\x3c\/span\x3e();\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e通过 co 执行的完整代码\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function post(url, callback) {\n    setTimeout(function() {\n        var data = { \/\/模拟异步处理结果\n            url:url,\n            value:10\n        };\n        callback(data);\n    }, 1000);\n}\nfunction kPost(url) {\n    return function(callback) {\n        post(url, callback);\n    }\n}\nfunction gen(url) {\n    return function* () {\n        var data = yield kPost(url);  \/\/1\n        console.log(data.url);\n        console.log(data.value);\n    }\n}\nfunction co(taskDef) {\n    var task = taskDef();\n    \/\/开始任务\n    var result = task.next();\n    \/\/ 调用next的递归函数\n    function step() {\n        if (!result.done) {  \/\/如果generator没有执行完\n            if (typeof result.value === \x26quot;function\x26quot;) {\n                result.value(function(err, data) {\n                    if (err) {\n                        result = task.throw(err);\n                        return;\n                    }\n                    result = task.next(data);  \/\/向后传递当前异步处理结果\n                    step();  \/\/递归执行\n                });\n            } else {\n                result = task.next(result.value);  \/\/如果执行完了就传递值\n                step();  \/\/递归执行\n            }\n\n        }\n    }\n    \/\/ 启动递归函数\n    step();\n}\n    \nco(gen(\x27http:\/\/_ivenj\x27)); \/\/调用方式就是这么简单\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs qml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epost\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, callback\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = { \x3cspan class=\x22hljs-comment\x22\x3e\/\/模拟异步处理结果\x3c\/span\x3e\n            \x3cspan class=\x22hljs-attribute\x22\x3eurl\x3c\/span\x3e:\x3cspan class=\x22hljs-attribute\x22\x3eurl,\n            value\x3c\/span\x3e:\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\n        };\n        callback(data);\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ekPost\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n        post(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e, callback);\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e* (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e data = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e kPost(\x3cspan class=\x22hljs-built_in\x22\x3eurl\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/1\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.url);\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data.value);\n    }\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eco\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etaskDef\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e task = taskDef();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/开始任务\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3evar\x3c\/span\x3e result = task.next();\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用next的递归函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3estep\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!result.done) {  \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果generator没有执行完\x3c\/span\x3e\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e result.value === \x3cspan class=\x22hljs-string\x22\x3e\x22function\x22\x3c\/span\x3e) {\n                result.value(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, data\x3c\/span\x3e) \x3c\/span\x3e{\n                    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n                        result = task.throw(err);\n                        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e;\n                    }\n                    result = task.next(data);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/向后传递当前异步处理结果\x3c\/span\x3e\n                    step();  \x3cspan class=\x22hljs-comment\x22\x3e\/\/递归执行\x3c\/span\x3e\n                });\n            } \x3cspan class=\x22hljs-title\x22\x3eelse\x3c\/span\x3e {\n                result = task.next(result.value);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/如果执行完了就传递值\x3c\/span\x3e\n                step();  \x3cspan class=\x22hljs-comment\x22\x3e\/\/递归执行\x3c\/span\x3e\n            }\n\n        }\n    }\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 启动递归函数\x3c\/span\x3e\n    step();\n}\n    \nco(gen(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/_ivenj\x27\x3c\/span\x3e)); \x3cspan class=\x22hljs-comment\x22\x3e\/\/调用方式就是这么简单\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e以上代码执行 1s 后会抛出一个异常，并且正确打印{url: \x22http:\/\/_ivenj\x22, value: 10}，聪明的你一定知道为什么会抛出异常!!!\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e到这里已经说明白了，并且也说完了，你会想是不是把异步包装成\x3ccode\x3ePromise\x3c\/code\x3e也可以呢，答案是肯定的，柯里化的思想只是一种实现方式，\x3ccode\x3ePromise\x3c\/code\x3e 也是一种，你可以自己去琢磨，\x3ccode\x3eco.js\x3c\/code\x3e 就是将两种方式都实现了的一个执行器。\x3ccode\x3ees7\x3c\/code\x3e 中从语言层面对 \x3ccode\x3eGenerator\x3c\/code\x3e 进行了包装，在\x3ccode\x3ees7\x3c\/code\x3e 中我们可以使用 \x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3eawait\x3c\/code\x3e更优雅的实现类似java的顺序书写方式，\x3ccode\x3easync\x3c\/code\x3e和\x3ccode\x3eawait\x3c\/code\x3e 是\x3ccode\x3eGenerator\x3c\/code\x3e的语法糖，在\x3ccode\x3ees7\x3c\/code\x3e中内置了执行器。别人都说是终极方案。\x3c\/strong\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>ES6 Generator与异步的同步书写</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010106930">https://segmentfault.com/a/1190000010106930</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/ib3snep59h/" target="_blank">https://alili.tech/archive/ib3snep59h/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>