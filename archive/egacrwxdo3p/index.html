<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="文件上传进度提示"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>文件上传进度提示 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/egacrwxdo3p/",
				"appid": "1613049289050283", 
				"title": "文件上传进度提示 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-18T02:30:34"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/8ovkt6e7ybf/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/pxnyrmaug3t/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&text=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&text=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&title=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&is_video=false&description=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&title=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&title=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&title=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fegacrwxdo3p%2f&title=%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e8%bf%9b%e5%ba%a6%e6%8f%90%e7%a4%ba"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">文件上传进度提示</h1><div class="meta"><div class="postdate"><time datetime="2019-01-18" itemprop="datePublished">2019-01-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e需求\x3c\/h2\x3e\n\x3cp\x3e当上传的文件相对较大时，用户可能需要等待较长的时间，这个时候前端如果没有任何提示的话，体验不是很好，如果有上传进度提示，就会好很多。而要在上传过程实时显示上传进度，则需要已上传的大小和文件总大小。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e前提\x3c\/h2\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e请求是异步的。因为要实时获取到上传的进度，则请求需是异步的，如果是同步的话，会直到请求完成才能获取到响应。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e实现\x3c\/h2\x3e\n\x3cp\x3e这里总结的主要是js方面，至于进度条的显示，有的UI框架，比如\x3ccode\x3esemantic\x3c\/code\x3e就自带了进度条的实现，直接使用即可，没有的话也可以自己用改变div宽度等方式实现，这里不赘述。\x3c\/p\x3e\n\x3cp\x3e如何获取到文件的上传进度？\x3cbr\x3eJavascript的\x3ccode\x3eXMLHttpRequest\x3c\/code\x3e提供了一个\x3ccode\x3eprogress\x3c\/code\x3e事件，这个事件会返回文件已上传的大小和总大小，根据这两个值，就可以计算上传进度了，关于这个方法，在《Javascript高级程序设计(第3版)》21章第3节中有叙述，有这本书在手的可以看一下。下面贴一下代码。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3eXMLHttpRequest:progress事件\x3c\/h3\x3e\n\x3cp\x3e使用Javascript的XMLHttpRequest的progress事件，实现示例代码为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var formData = new FormData(); \nformData.append(\x26quot;file\x26quot;, document.getElementById(\x27file\x27).files[0]); \nformData.append(\x26quot;token\x26quot;, token_value); \/\/ 其他参数按这样子加入\n\nvar xhr = new XMLHttpRequest();\nxhr.open(\x27POST\x27, \x27\/uploadurl\x27);\n\/\/ 上传完成后的回调函数\nxhr.onload = function () {\n  if (xhr.status === 200) {\n　　console.log(\x27上传成功\x27);\n  } else {\n  　console.log(\x27上传出错\x27);\n  }\n};\n\/\/ 获取上传进度\nxhr.upload.onprogress = function (event) {\n  if (event.lengthComputable) {\n    var percent = Math.floor(event.loaded \/ event.total * 100) ;\n    \/\/ 设置进度显示\n    $(\x26quot;#J_upload_progress\x26quot;).progress(\x27set progress\x27, percent);\n  }\n};\nxhr.send(formData);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData(); \nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e).files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]); \nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x22token\x22\x3c\/span\x3e, token_value); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 其他参数按这样子加入\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e xhr = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e XMLHttpRequest();\nxhr.open(\x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\/uploadurl\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 上传完成后的回调函数\x3c\/span\x3e\nxhr.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (xhr.status === \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) {\n　　\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27上传成功\x27\x3c\/span\x3e);\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n  　\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27上传出错\x27\x3c\/span\x3e);\n  }\n};\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取上传进度\x3c\/span\x3e\nxhr.upload.onprogress = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (event.lengthComputable) {\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e percent = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(event.loaded \/ event.total * \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) ;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置进度显示\x3c\/span\x3e\n    $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_upload_progress\x22\x3c\/span\x3e).progress(\x3cspan class=\x22hljs-string\x22\x3e\x27set progress\x27\x3c\/span\x3e, percent);\n  }\n};\nxhr.send(formData);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于\x3ccode\x3eFormData和XMLHttpRequest\x3c\/code\x3e, 可以搜下W3C了解详情。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3ejQuery封装的xhr\x3c\/h3\x3e\n\x3cp\x3e\x3ccode\x3ejQuery\x3c\/code\x3e封装了\x3ccode\x3exhr\x3c\/code\x3e的实现, 也可以使用\x3ccode\x3ejQuery\x3c\/code\x3e的\x3ccode\x3eajax\x3c\/code\x3e获得上传进度，示例代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var formData = new FormData(); \nformData.append(\x26quot;file\x26quot;, document.getElementById(\x27file\x27).files[0]); \nformData.append(\x26quot;token\x26quot;, token_value); \n\n$.ajax({ \n    url: \x26quot;\/uploadurl\x26quot;, \n    type: \x26quot;POST\x26quot;, \n    data: formData, \n    processData: false, \/\/ 不要对data参数进行序列化处理，默认为true\n    contentType: false, \/\/ 不要设置Content-Type请求头，因为文件数据是以 multipart\/form-data 来编码\n    xhr: function(){\n        myXhr = $.ajaxSettings.xhr();\n        if(myXhr.upload){\n          myXhr.upload.addEventListener(\x27progress\x27,function(e) {\n            if (e.lengthComputable) {\n              var percent = Math.floor(e.loaded\/e.total*100);\n              if(percent \x3c= 100) {\n                $(\x26quot;#J_progress_bar\x26quot;).progress(\x27set progress\x27, percent);\n                $(\x26quot;#J_progress_label\x26quot;).html(\x27已上传：\x27\x2bpercent\x2b\x27%\x27);\n              }\n              if(percent \x3e= 100) {\n                $(\x26quot;#J_progress_label\x26quot;).html(\x27文件上传完毕，请等待...\x27);\n                $(\x26quot;#J_progress_label\x26quot;).addClass(\x27success\x27);\n              }\n            }\n          }, false);\n        }\n        return myXhr;\n    },\n    success: function(res){ \n        \/\/ 请求成功\n    },\n    error: function(res) {\n        \/\/ 请求失败\n        console.log(res);\n    }\n}); \n \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData(); \nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x22file\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e).files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]); \nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x22token\x22\x3c\/span\x3e, token_value); \n\n$.ajax({ \n    \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22\/uploadurl\x22\x3c\/span\x3e, \n    \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e, \n    \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: formData, \n    \x3cspan class=\x22hljs-attr\x22\x3eprocessData\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不要对data参数进行序列化处理，默认为true\x3c\/span\x3e\n    contentType: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不要设置Content-Type请求头，因为文件数据是以 multipart\/form-data 来编码\x3c\/span\x3e\n    xhr: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        myXhr = $.ajaxSettings.xhr();\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(myXhr.upload){\n          myXhr.upload.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27progress\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.lengthComputable) {\n              \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e percent = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(e.loaded\/e.total*\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n              \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(percent \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) {\n                $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_bar\x22\x3c\/span\x3e).progress(\x3cspan class=\x22hljs-string\x22\x3e\x27set progress\x27\x3c\/span\x3e, percent);\n                $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27已上传：\x27\x3c\/span\x3e\x2bpercent\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27%\x27\x3c\/span\x3e);\n              }\n              \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(percent \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) {\n                $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27文件上传完毕，请等待...\x27\x3c\/span\x3e);\n                $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e);\n              }\n            }\n          }, \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e);\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e myXhr;\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3esuccess\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e)\x3c\/span\x3e{ \n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 请求成功\x3c\/span\x3e\n    },\n    \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 请求失败\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res);\n    }\n}); \n \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e关于jQuery ajax的xhr, 具体可查看W3C。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3evue-resource\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var formData = new FormData();\nformData.append(\x27token\x27, token_value);  \/\/ csrf token\nformData.append(\x26quot;works\x26quot;, document.getElementById(\x27file\x27).files[0]); \/\/ file\nvar url = $(\x26quot;#R_batch_upload_url\x26quot;).val();\n\nvm.$http.post(url, formData, {\n  progress: (e) =\x3e {\n    if (e.lengthComputable) {\n      var percent = Math.floor(e.loaded\/e.total*100);\n      if(percent \x3c= 100) {\n        $(\x26quot;#J_progress_bar\x26quot;).progress(\x27set progress\x27, percent);\n        $(\x26quot;#J_progress_label\x26quot;).html(\x27已上传：\x27\x2bpercent\x2b\x27%\x27);\n      }\n      if(percent \x3e= 100) {\n        $(\x26quot;#J_progress_label\x26quot;).html(\x27文件上传完毕，提交表单中，请等待...\x27);\n        $(\x26quot;#J_progress_label\x26quot;).addClass(\x27success\x27);\n      }\n    }\n  }\n})\n.then((res) =\x3e {\n  if(res.ok \x26amp;\x26amp; res.status === 200) {\n    window.location.href = window.location.href;\n  }\n}, (res) =\x3e {\n  if(res.status === 400) {\n      $(\x26quot;#J_progress_label\x26quot;).html(\x27文件格式错误，请修改后重试\x27);\n      $(\x26quot;#J_progress_label\x26quot;).addClass(\x27warning\x27);\n      console.log(res);\n      vm.errMsg.show = true;\n      vm.errMsg.msg = res.body.msg;\n      vm.canSend = true;\n      \/\/ TODO hide the loader dimmer\n      $(\x26quot;#J_upload_batch\x26quot;).dimmer(\x26quot;hide\x26quot;);\n    } else {\n      $(\x26quot;#J_progress_label\x26quot;).html(res.statusText);\n      $(\x26quot;#J_progress_label\x26quot;).addClass(\x27warning\x27);\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formData = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e FormData();\nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x27token\x27\x3c\/span\x3e, token_value);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ csrf token\x3c\/span\x3e\nformData.append(\x3cspan class=\x22hljs-string\x22\x3e\x22works\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElementById(\x3cspan class=\x22hljs-string\x22\x3e\x27file\x27\x3c\/span\x3e).files[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]); \x3cspan class=\x22hljs-comment\x22\x3e\/\/ file\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e url = $(\x3cspan class=\x22hljs-string\x22\x3e\x22#R_batch_upload_url\x22\x3c\/span\x3e).val();\n\nvm.$http.post(url, formData, {\n  progress: \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (e.lengthComputable) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e percent = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.floor(e.loaded\/e.total*\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(percent \x26lt;= \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) {\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_bar\x22\x3c\/span\x3e).progress(\x3cspan class=\x22hljs-string\x22\x3e\x27set progress\x27\x3c\/span\x3e, percent);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27已上传：\x27\x3c\/span\x3e\x2bpercent\x2b\x3cspan class=\x22hljs-string\x22\x3e\x27%\x27\x3c\/span\x3e);\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(percent \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e) {\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27文件上传完毕，提交表单中，请等待...\x27\x3c\/span\x3e);\n        $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e);\n      }\n    }\n  }\n})\n.then(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(res.ok \x26amp;\x26amp; res.status === \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href;\n  }\n}, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(res.status === \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e) {\n      $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(\x3cspan class=\x22hljs-string\x22\x3e\x27文件格式错误，请修改后重试\x27\x3c\/span\x3e);\n      $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27warning\x27\x3c\/span\x3e);\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res);\n      vm.errMsg.show = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      vm.errMsg.msg = res.body.msg;\n      vm.canSend = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ TODO hide the loader dimmer\x3c\/span\x3e\n      $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_upload_batch\x22\x3c\/span\x3e).dimmer(\x3cspan class=\x22hljs-string\x22\x3e\x22hide\x22\x3c\/span\x3e);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).html(res.statusText);\n      $(\x3cspan class=\x22hljs-string\x22\x3e\x22#J_progress_label\x22\x3c\/span\x3e).addClass(\x3cspan class=\x22hljs-string\x22\x3e\x27warning\x27\x3c\/span\x3e);\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e七牛云储存\x3c\/h3\x3e\n\x3cp\x3e有些文件过大，后台会采取上传到七牛，再获取其地址保存到数据库的方式，这种方式的话，前端可以使用上面两种方式\x3ccode\x3eXMLHttpRequest或jQuery封装的xhr\x3c\/code\x3e实现发送请求及获取上传进度，如果需要更复杂的上传数据处理，也可以考虑使用七牛提供的配套\x3ccode\x3eJavascript SDK\x3c\/code\x3e实现，若是只需要进度提示的话，并不需要引入七牛JS SDK。\x3c\/p\x3e\n\x3cp\x3e另外一点，上传成功后设置重定向到网站某页面的话，可能会报错跨域重定向。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e相关链接\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2012\/08\/file_upload.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e阮一峰：文件上传的渐进式增强\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/sodawy\/archive\/2013\/05\/27\/3101642.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ejquery xhr upload属性包装\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.helloweba.com\/view-blog-376.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e关于文件上传的那些事\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/imys.net\/20150902\/h5-upload-progress.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehtml5上传进度实现\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/developer.qiniu.com\/kodo\/manual\/redirect\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e七牛文件上传303重定向\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/harttle.com\/2016\/12\/30\/cors-redirect.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e重定向 CORS 跨域请求\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/jssdk.demo.qiniu.io\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e七牛云存储-Javascript SDK\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>文件上传进度提示</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008791342">https://segmentfault.com/a/1190000008791342</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/egacrwxdo3p/" target="_blank">https://alili.tech/archive/egacrwxdo3p/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>