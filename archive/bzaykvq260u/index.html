<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="第三方登入例子-GitHub授权登入（node-koa）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>第三方登入例子-GitHub授权登入（node-koa） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/bzaykvq260u/",
				"appid": "1613049289050283", 
				"title": "第三方登入例子-GitHub授权登入（node-koa） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-12T02:30:25"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/i5bik3mp29m/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/87ng69qd3fc/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&text=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&text=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&title=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&is_video=false&description=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&title=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&title=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&title=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fbzaykvq260u%2f&title=%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5%e4%be%8b%e5%ad%90-GitHub%e6%8e%88%e6%9d%83%e7%99%bb%e5%85%a5%ef%bc%88node-koa%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">第三方登入例子-GitHub授权登入（node-koa）</h1><div class="meta"><div class="postdate"><time datetime="2019-01-12" itemprop="datePublished">2019-01-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e前言\x3c\/h2\x3e\n\x3cp\x3e第三方登入太常见了，微信，微博，QQ...总有一个你用过。当然看这篇文章的你，应该还用过github登入。这篇分享是在上一篇\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000009470011\x22\x3e基于node的登入例子（node-koa-mongoose）\x3c\/a\x3e的基础增加了github账号第三方授权登入功能，如果有些代码，这篇中美介绍，你可以先去看下上一篇的分享。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e本项目源码地址\x3c\/strong\x3e：\x3ca href=\x22https:\/\/github.com\/linwalker\/node-login\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/linwalker\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e第三方登入\x3c\/h2\x3e\n\x3cp\x3e第三方登入主要基于OAuth 2.0。OAuth协议为用户资源的授权提供了一个安全的、开放而又简易的标准。与以往的授权方式不同之处是OAUTH的授权不会使第三方触及到用户的帐号信息（如用户名与密码），即第三方无需使用用户的用户名与密码就可以申请获得该用户资源的授权，因此OAUTH是安全的 ---- 百度百科\x3c\/p\x3e\n\x3cp\x3e更详细的介绍可以看这篇文章\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2014\/05\/oauth_2_0.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e理解OAuth 2.0\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3egithub 授权登入\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e原理过程\x3c\/h3\x3e\n\x3cp\x3e先来大致了解下第三方通过GitHub账号授权登入的过程，具体实现结合后面代码讲解\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e1.获取code\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22第三方客户端向`https:\/\/github.com\/login\/oauth\/authorize`发送get请求，带上`?client_id=XXXXXX`参数，这时会跳转到GitHub登入页面，授权后GitHub会向客户端返回`https:\/\/redirect_url?code=XXXXXX`。其中`client_id`和`redirect_url`是第三方事先在GitHub平台上配置好的。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coffeescript\x22\x3e\x3ccode\x3e第三方客户端向`\x3cspan class=\x22javascript\x22\x3ehttps:\x3cspan class=\x22hljs-comment\x22\x3e\/\/github.com\/login\/oauth\/authorize\x3c\/span\x3e\x3c\/span\x3e`发送get请求，带上`\x3cspan class=\x22javascript\x22\x3e?client_id=XXXXXX\x3c\/span\x3e`参数，这时会跳转到GitHub登入页面，授权后GitHub会向客户端返回`\x3cspan class=\x22javascript\x22\x3ehttps:\x3cspan class=\x22hljs-comment\x22\x3e\/\/redirect_url?code=XXXXXX\x3c\/span\x3e\x3c\/span\x3e`。其中`\x3cspan class=\x22javascript\x22\x3eclient_id\x3c\/span\x3e`和`\x3cspan class=\x22javascript\x22\x3eredirect_url\x3c\/span\x3e`是第三方事先在GitHub平台上配置好的。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e2.通过code获取access_token\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22客户端处理`https:\/\/redirect_url?code=XXXXXX`请求，获取code值，向`https:\/\/github.com\/login\/oauth\/access_token`发起post请求，请求参数为`client_di`,`client_secret`和`code`。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autohotkey\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-symbol\x22\x3e客户端处理`https:\/\/redirect_url?code=XXXXXX`请求，获取code值，向`https:\x3c\/span\x3e\/\/github.com\/login\/oauth\/access_token`发起post请求，请求参数为`client_di`,`client_secret`和`code`。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e3.通过access_token获取用户GitHub账号信息\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e第二步的请求会返回这样\x3ccode\x3eaccess_token=d0686dc49a22d64e77402db072b719f510f22421\x26amp;scope=user\x26amp;token_type=bearer\x3c\/code\x3e的内容，拿到access_token只需要向\x3ccode\x3ehttps:\/\/api.github.com\/user?access_token=xxx\x3c\/code\x3e发送GET请求，即可获取到登录用户的基本信息，\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e具体实现\x3c\/h3\x3e\n\x3ch4\x3eGitHub注册应用\x3c\/h4\x3e\n\x3cp\x3e首先你要有一个GitHub账号，然后进入settings -\x26gt; OAuth application -\x26gt; Register a new application。进来后你会看到下面这个页面：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722477\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722477\x22 alt=\x22应用注册(github-login).png\x22 title=\x22应用注册(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e依次填好应用名称，应用地址和授权回掉地址后点击\x3ccode\x3eRegister application\x3c\/code\x3e按钮，会生成一个\x3ccode\x3eclient Id\x3c\/code\x3e和\x3ccode\x3eclient Secret\x3c\/code\x3e，用于后面向GitHub发送请求传参。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722478?w=763\x26amp;h=423\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722478?w=763\x26amp;h=423\x22 alt=\x22生成ID和Secret(github-login).png\x22 title=\x22生成ID和Secret(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3eGithub授权请求（获取code）\x3c\/h4\x3e\n\x3cp\x3e在页面中添加GitHub登入跳转按钮，并在路由中对跳转请求进行转发处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/在node-login\/components\/LoginTab.js\n\n\x3ca href=\x26quot;\/github\/login\x26quot;\x3e\n     \x3cIcon type=\x26quot;github\x26quot; style=\x22{{\x22fontSize: 20, color: \x27#000\x27\x22}}\x22\/\x3e\n\x3c\/a\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/在node-login\/components\/LoginTab.js\x3c\/span\x3e\n\n\x26lt;a href=\x3cspan class=\x22hljs-string\x22\x3e\x22\/github\/login\x22\x3c\/span\x3e\x26gt;\n     \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eIcon\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22github\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3estyle\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22{{\x22fontSize:\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3e20\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecolor:\x3c\/span\x3e \x27#\x3cspan class=\x22hljs-attr\x22\x3e000\x3c\/span\x3e\x27\x22}}\x22\/\x26gt;\x3c\/span\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722479?w=349\x26amp;h=361\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722479?w=349\x26amp;h=361\x22 alt=\x22点击登入(github-login).png\x22 title=\x22点击登入(github-login).png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e添加跳转按钮后，增加相应路由处理,路由入口中添加／github路径处理\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/在node-login\/routes\/index.js\n\nconst github = require(\x27.\/github\x27);\nrouter.use(\x27\/github\x27, github.routes(), github.allowedMethods());\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/在node-login\/routes\/index.js\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e github = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/github\x27\x3c\/span\x3e);\nrouter.use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/github\x27\x3c\/span\x3e, github.routes(), github.allowedMethods());\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e最后是具体的路由处理\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/在node-login\/routes\/github.js\nconst config = require(\x27..\/config\x27);\nconst router = require(\x27koa-router\x27)();\nconst fetch = require(\x27node-fetch\x27);\nconst routers = router\n    .get(\x27\/login\x27, async (ctx) =\x3e {\n        var dataStr = (new Date()).valueOf();\n        \/\/重定向到认证接口,并配置参数\n        var path = \x26quot;https:\/\/github.com\/login\/oauth\/authorize\x26quot;;\n        path \x2b= \x27?client_id=\x27 \x2b config.client_id;\n        path \x2b= \x27\x26amp;scope=\x27 \x2b config.scope;\n        path \x2b= \x27\x26amp;state=\x27 \x2b dataStr;\n        \/\/转发到授权服务器\n        ctx.redirect(path);\n    })\nmodule.exports = routers;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/在node-login\/routes\/github.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-router\x27\x3c\/span\x3e)();\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routers = router\n    .get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dataStr = (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e()).valueOf();\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/重定向到认证接口,并配置参数\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e path = \x3cspan class=\x22hljs-string\x22\x3e\x22https:\/\/github.com\/login\/oauth\/authorize\x22\x3c\/span\x3e;\n        path \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27?client_id=\x27\x3c\/span\x3e \x2b config.client_id;\n        path \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;scope=\x27\x3c\/span\x3e \x2b config.scope;\n        path \x2b= \x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;state=\x27\x3c\/span\x3e \x2b dataStr;\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/转发到授权服务器\x3c\/span\x3e\n        ctx.redirect(path);\n    })\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = routers;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在config中事先添加配置请求所需参数\x3ccode\x3eclient_id\x3c\/code\x3e，\x3ccode\x3eclient_secret\x3c\/code\x3e和\x3ccode\x3escope\x3c\/code\x3e。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = {\n    \x27database\x27: \x27mongodb:\/\/localhost:27017\/node-login\x27,\n    \x27client_id\x27: \x2783b21756e93d6ce27075\x27,\n    \x27client_secret\x27: \x27d87c4163ece5695a9ded1e8bf2701c5ee2651f28\x27,\n    \x27scope\x27: [\x27user\x27],\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = {\n    \x3cspan class=\x22hljs-string\x22\x3e\x27database\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb:\/\/localhost:27017\/node-login\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27client_id\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2783b21756e93d6ce27075\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27client_secret\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27d87c4163ece5695a9ded1e8bf2701c5ee2651f28\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-string\x22\x3e\x27scope\x27\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e],\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中scope参数可选。就是你期待你的应用需要调用Github哪些信息，可以填写多个，以逗号分割，比如：scope=user,public_repo。state参数非必需，用于防治跨域伪造请求攻击。\x3c\/p\x3e\n\x3cp\x3e现在可以运行一下项目，点击小黑猫，跳转到授权登入页面（没登入过，要输入账号密码），授权成功返回回掉地址。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722480?w=563\x26amp;h=571\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722480?w=563\x26amp;h=571\x22 alt=\x22授权(github-login).png\x22 title=\x22授权(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e回掉地址中\x3ccode\x3ecode\x3c\/code\x3e就是返回的授权码，通过授权码再去获取令牌\x3ccode\x3eaccess_token\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722481?w=861\x26amp;h=93\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722481?w=861\x26amp;h=93\x22 alt=\x22授权回掉(github-login).png\x22 title=\x22授权回掉(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e授权回掉处理（获取access_token）\x3c\/h4\x3e\n\x3cp\x3e在第一步授权请求\x3ccode\x3ehttps:\/\/github.com\/login\/oauth\/authorize\x3c\/code\x3e成功后GitHub会给应用返回一个回掉\x3ccode\x3ehttp:\/\/localhost:3003\/github\/oauth\/callback?code=14de2c737aa02037132d\x26amp;state=1496989988474\x3c\/code\x3e。这个回掉地址就是之前在GitHub注册应用时填入的回掉地址，另外还带了需要的code参数，state就是上一步请求中带的state参数，原样返回。\x3c\/p\x3e\n\x3cp\x3e现在我们要对这个回掉请求进行处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/node-login\/routes\/github.js\nconst config = require(\x27..\/config\x27);\nconst router = require(\x27koa-router\x27)();\nconst fetch = require(\x27node-fetch\x27);\nconst routers = router\n    .get(\x27\/login\x27, async (ctx) =\x3e {\n        ...\n    })\n    .get(\x27\/oauth\/callback\x27, async (ctx) =\x3e {\n        const code = ctx.query.code;\n        let path = \x27https:\/\/github.com\/login\/oauth\/access_token\x27;\n        const params = {\n            client_id: config.client_id,\n            client_secret: config.client_secret,\n            code: code\n        }\n        console.log(code);\n        await fetch(path, {\n            method: \x27POST\x27,\n            headers: {\n                \x27Content-Type\x27: \x27application\/json\x27\n            },\n            body: JSON.stringify(params)\n        })\n        .then(res =\x3e {\n            return res.text();\n        })\n        .then(body =\x3e {\n            ctx.body = body;\n        })\n       .catch(e =\x3e {\n            console.log(e);\n        })\n    })\nmodule.exports = routers;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/node-login\/routes\/github.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e config = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27..\/config\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e router = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27koa-router\x27\x3c\/span\x3e)();\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fetch = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27node-fetch\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e routers = router\n    .get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/login\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx) =\x26gt; {\n        ...\n    })\n    .get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/oauth\/callback\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e code = ctx.query.code;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e path = \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/github.com\/login\/oauth\/access_token\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e params = {\n            \x3cspan class=\x22hljs-attr\x22\x3eclient_id\x3c\/span\x3e: config.client_id,\n            \x3cspan class=\x22hljs-attr\x22\x3eclient_secret\x3c\/span\x3e: config.client_secret,\n            \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: code\n        }\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(code);\n        \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fetch(path, {\n            \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(params)\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.text();\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ebody\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            ctx.body = body;\n        })\n       .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e);\n        })\n    })\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = routers;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eGitHub返回回掉地址时，先拿到请求中的code参数，然后向\x3ccode\x3ehttps:\/\/github.com\/login\/oauth\/access_token\x3c\/code\x3e发送post请求并带上\x3ccode\x3eclient_id,client_secret,code\x3c\/code\x3e参数，请求成功后会返回带有access_token的信息。\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722482?w=796\x26amp;h=89\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722482?w=796\x26amp;h=89\x22 alt=\x22access_token(github-login).png\x22 title=\x22access_token(github-login).png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3e获取GitHub账号信息\x3c\/h4\x3e\n\x3cp\x3e最后带上获取的\x3ccode\x3eaccess_token\x3c\/code\x3e请求\x3ccode\x3ehttps:\/\/api.github.com\/user?access_token=xxx\x3c\/code\x3e,返回的就是之前scope中对应的账号信息。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22.get(\x27\/oauth\/callback\x27, async (ctx) =\x3e {\n        const code = ctx.query.code;\n        let path = \x27https:\/\/github.com\/login\/oauth\/access_token\x27;\n        const params = {\n            client_id: config.client_id,\n            client_secret: config.client_secret,\n            code: code\n        }\n        console.log(code);\n        await fetch(path, {\n            method: \x27POST\x27,\n            headers: {\n                \x27Content-Type\x27: \x27application\/json\x27\n            },\n            body: JSON.stringify(params)\n        })\n        .then(res =\x3e {\n            return res.text();\n        })\n        .then(body =\x3e {\n            const args = body.split(\x27\x26amp;\x27);\n            let arg = args[0].split(\x27=\x27);\n            const access_token = arg[1];\n            console.log(body);\n            console.log(access_token);\n            return access_token;\n        })\n        .then(async(token) =\x3e {\n            const url = \x27 https:\/\/api.github.com\/user?access_token=\x27 \x2b token;\n            console.log(url);\n            await fetch(url)\n                .then(res =\x3e {\n                    return res.json();\n                })\n                .then(res =\x3e {\n                    console.log(res);\n                    ctx.body = res;\n                })\n        })\n        .catch(e =\x3e {\n            console.log(e);\n        })\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22js\x22\x3e.get(\x3cspan class=\x22hljs-string\x22\x3e\x27\/oauth\/callback\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (ctx) =\x26gt; {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e code = ctx.query.code;\n        \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e path = \x3cspan class=\x22hljs-string\x22\x3e\x27https:\/\/github.com\/login\/oauth\/access_token\x27\x3c\/span\x3e;\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e params = {\n            \x3cspan class=\x22hljs-attr\x22\x3eclient_id\x3c\/span\x3e: config.client_id,\n            \x3cspan class=\x22hljs-attr\x22\x3eclient_secret\x3c\/span\x3e: config.client_secret,\n            \x3cspan class=\x22hljs-attr\x22\x3ecode\x3c\/span\x3e: code\n        }\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(code);\n        \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fetch(path, {\n            \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27POST\x27\x3c\/span\x3e,\n            \x3cspan class=\x22hljs-attr\x22\x3eheaders\x3c\/span\x3e: {\n                \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e\n            },\n            \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(params)\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.text();\n        })\n        .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ebody\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e args = body.split(\x3cspan class=\x22hljs-string\x22\x3e\x27\x26amp;\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e arg = args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].split(\x3cspan class=\x22hljs-string\x22\x3e\x27=\x27\x3c\/span\x3e);\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e access_token = arg[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e];\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(body);\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(access_token);\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e access_token;\n        })\n        .then(\x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e(token) =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e url = \x3cspan class=\x22hljs-string\x22\x3e\x27 https:\/\/api.github.com\/user?access_token=\x27\x3c\/span\x3e \x2b token;\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(url);\n            \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e fetch(url)\n                .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.json();\n                })\n                .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eres\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n                    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(res);\n                    ctx.body = res;\n                })\n        })\n        .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e);\n        })\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e返回的用户信息如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722483?w=863\x26amp;h=399\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722483?w=863\x26amp;h=399\x22 alt=\x22user_info(github-login).png\x22 title=\x22user_info(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e总结\x3c\/h3\x3e\n\x3cp\x3e用一张图来总结\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000009722484?w=847\x26amp;h=555\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000009722484?w=847\x26amp;h=555\x22 alt=\x22原理过程(github-login).png\x22 title=\x22原理过程(github-login).png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>第三方登入例子-GitHub授权登入（node-koa）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009722474">https://segmentfault.com/a/1190000009722474</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/bzaykvq260u/" target="_blank">https://alili.tech/archive/bzaykvq260u/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>