<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="任务、微任务、队列和时间表"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>任务、微任务、队列和时间表 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/tjqwawuesy/",
				"appid": "1613049289050283", 
				"title": "任务、微任务、队列和时间表 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/xyxahwqu05s/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/72gnr895qsj/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&text=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&text=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&title=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&is_video=false&description=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&title=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&title=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&title=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftjqwawuesy%2f&title=%e4%bb%bb%e5%8a%a1%e3%80%81%e5%be%ae%e4%bb%bb%e5%8a%a1%e3%80%81%e9%98%9f%e5%88%97%e5%92%8c%e6%97%b6%e9%97%b4%e8%a1%a8"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">任务、微任务、队列和时间表</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e当我告诉我的同事 Matt Gaunt 我想写一篇关于mircrotask、queueing和浏览器的Event Loop的文章。他说：“我实话跟你说吧，我是不会看的。” 好吧，无论如何我已经写完了，那么我们坐下来一起看看，好吧？\x3c\/p\x3e\n\x3cp\x3e如果你更喜欢视频，Philip Roberts 在 JSConf 上就事件循环有一个很棒的演讲——没有讲 microtasks，不过很好的介绍了其它概念。好，继续！\x3c\/p\x3e\n\x3cp\x3e思考下面 JavaScript 代码：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lua\x22\x3econsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27script start\x27\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout\x27\x3c\/span\x3e);\n}, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\nPromise.resolve().\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27promise1\x27\x3c\/span\x3e);\n}).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27promise2\x27\x3c\/span\x3e);\n});\n\nconsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27script end\x27\x3c\/span\x3e);\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e控制台上的输出顺序是怎样的呢？\x3c\/p\x3e\n\x3ch2\x3e试一下\x3c\/h2\x3e\n\x3cp\x3e正确的答案是：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3escript start\n\x3cspan class=\x22hljs-built_in\x22\x3e\nscript \x3c\/span\x3eend\n\npromise1\n\npromise2\n\nsetTimeout\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e但是由于浏览器实现支持不同导致结果也不一致。\x3c\/p\x3e\n\x3cp\x3eMicrosoft Edge, Firefox 40, iOS Safari 及桌面 Safari 8.0.8 在 promise1 和 promise2 之前打印 setTimeout -- 这似乎是浏览器厂商相互竞争导致的实现不同。但是很奇怪的是，Firefox 39 和 Safari 8.0.7 竟然结果都是对的（一致的）。\x3c\/p\x3e\n\x3ch2\x3e为什么会这样？\x3c\/h2\x3e\n\x3cp\x3e要想弄明白这些，你需要知道Event Loop是如何处理 tasks 和 microtasks的。如果你是第一次接触它，需要花些功夫才能弄明白。深呼吸。。。\x3c\/p\x3e\n\x3cp\x3e每个线程都有自己的事件循环，所以每个 web worker 都有自己的事件循环，因此web worker才可以独立执行。而来自同域的所有窗口共享一个事件循环，所以它们可以同步地通信。事件循环持续运行，直到清空 tasks 列队的任务。事件循环包括多种任务源，事件循环执行时会访问这些任务源，这样就确定了各个任务源的执行顺序（IndexedDB 等规范定义了自己的任务源和执行顺序），但浏览器可以在每次循环中选择从哪个任务源去执行一个任务。这允许浏览器优先考虑性能敏感的任务，例如用户输入。Ok ok, 留下来陪我坐会儿……\x3c\/p\x3e\n\x3cp\x3eTasks 被放到任务源中，浏览器内部执行转移到JavaScript\/DOM领域，并且确保这些 tasks按序执行。在tasks执行期间，浏览器可能更新渲染。来自鼠标点击的事件回调需要安排一个task，解析HTML和setTimeout同样需要。\x3c\/p\x3e\n\x3cp\x3esetTimeout延迟给定的时间，然后为它的回调安排一个新的task。这就是为什么 setTimeout在 script end 之后打印：script end 在第一个task 内，setTimeout 在另一个 task 内。好了，我们快讲完了，剩下一点我需要你们坚持下……\x3c\/p\x3e\n\x3cp\x3eMircotasks队列通常用于存放一些任务，这些任务应该在正在执行的脚本之后立即执行，比如对一批动作作出反应，或者操作异步执行避免创建整个新任务造成的性能浪费。 只要没有其他JavaScript代码在执行中，并且在每个task队列的任务结束时，microtask队列就会被处理。在处理 microtasks 队列期间，新添加到 microtasks 队列的任务也会被执行。 microtasks 包括 MutationObserver callbacks。例如上面的例子中的 promise的callback。\x3c\/p\x3e\n\x3cp\x3e一个settled状态的promise（直接调用resolve或者reject）或者已经变成settled状态(异步请求被settled)的promise，会立刻将它的callback（then）放到microtask队列里面。这就能保证promise的回调是异步的，即便promise已经变为settled状态。因此一个已settled的promise调用.then(yey,nay)时将立即把一个microtask任务加入microtasks任务队列。这就是为什么 promise1 和 promise2 在 script end 之后打印，因为正在运行的代码必须在处理 microtasks 之前完成。promise1 和 promise2 在 setTimeout 之前打印，因为 microtasks 总是在下一个 task 之前执行。\x3c\/p\x3e\n\x3cp\x3e好，一步一步的运行：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs lua\x22\x3econsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27script start\x27\x3c\/span\x3e);\n\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27setTimeout\x27\x3c\/span\x3e);\n}, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\nPromise.resolve().\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27promise1\x27\x3c\/span\x3e);\n}).\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e {\n  console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27promise2\x27\x3c\/span\x3e);\n});\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWs?w=695\x26amp;h=465http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWu?w=682\x26amp;h=445http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWB?w=674\x26amp;h=442http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajXz?w=673\x26amp;h=441http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWP?w=673\x26amp;h=440http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWU?w=667\x26amp;h=434http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbajWW?w=676\x26amp;h=443http:\/\/\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e没错，就是上面这个，我做了一个 step-by-step 动画图解。你周六是怎么过的？和朋友们一起出去玩？我没有出去。嗯，如果搞不明白我的令人惊叹的UI设计界面，点击上面的箭头试试。\x3c\/p\x3e\n\x3ch3\x3e浏览器之间会有什么不同？\x3c\/h3\x3e\n\x3cp\x3e一些浏览器的打印结果：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3e\nscript \x3c\/span\x3estart\x3cspan class=\x22hljs-built_in\x22\x3e\nscript \x3c\/span\x3eend\nsetTimeout\npromise1\npromise2\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在 setTimeout 之后运行 promise 的回调，就好像将 promise 的回调当作一个新的 task 而不是 microtask。\x3c\/p\x3e\n\x3cp\x3e这多少情有可原，因为 promise 来自 ECMAScript 规范而不是 HTML 规范。ECAMScript 有一个概念 job，和 microtask 相似，但是两者的关系在邮件列表讨论中没有明确。不过，一般共识是 promise 应该是 microtask 队列的一部分，并且有充足的理由。\x3c\/p\x3e\n\x3cp\x3e将 promise当作task（macrotask）会带来一些性能问题，因为回调没有必要因为task相关的事（比如渲染）而延迟执行。与其它 task 来源交互时它也产生不确定性，也会打断与其它 API 的交互，不过后面再细说。\x3c\/p\x3e\n\x3cp\x3e我提交了一条 Edge 反馈，它错误地将 promises 当作 task。WebKit nightly 做对了，所以我认为 Safari 最终会修复，而 Firefox 43 似乎已经修复。\x3c\/p\x3e\n\x3cp\x3e有趣的是 Safari 和 Firefox 发生了退化，而之前的版本是对的。我在想这是否只是巧合。\x3c\/p\x3e\n\x3ch2\x3e怎样区分用 tasks 还是用 microtasks\x3c\/h2\x3e\n\x3cp\x3e动手试一试是一种办法，查看相对于promise和setTimeout如何打印，尽管这取决于实现是否正确。\x3c\/p\x3e\n\x3cp\x3e一种方法是查看规范：\n将一个 task 加入队列： \x3ca href=\x22\/\/https:\/\/link.juejin.im\/?target=https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#timer-initialisation-steps\x22\x3estep 14 of setTimeout \x3c\/a\x3e \x3c\/p\x3e\n\x3cp\x3e将 microtask 加入队列：\x3ca href=\x22\/\/https:\/\/dom.spec.whatwg.org\/#queue-a-mutation-record\x22\x3estep 5 of queuing a mutation record\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e如上所述，ECMAScript 将 microtask 称为 job：\n调用 EnqueueJob 将一个 microtask 加入队列：\x3ca href=\x22\/\/http:\/\/www.ecma-international.org\/ecma-262\/6.0\/#sec-performpromisethen\x22\x3estep 8.a of PerformPromiseThen\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e现在，让我们看一个更复杂的例子。一个有心的学徒 ：“但是他们还没有准备好”。别管他，你已经准备好了，让我们开始……\x3c\/p\x3e\n\x3ch2\x3e等级一 boss打怪\x3c\/h2\x3e\n\x3cp\x3e在发出这篇文章之前，我犯过一个错误。下面是一段html代码：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs clean\x22\x3e`\x26lt;div\x26gt;`\n  `\x26lt;div\x26gt;``\x26lt;\/div\x26gt;`\n`\x26lt;\/div\x26gt;`\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e给出下面的JS代码，如果click div.inner将会打印出什么呢？\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Let\x27s get hold of those elements\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e outer = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.outer\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e inner = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.inner\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Let\x27s listen for attribute changes on the\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ outer element\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MutationObserver(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27mutate\x27\x3c\/span\x3e);\n}).observe(outer, {\n  \x3cspan class=\x22hljs-attr\x22\x3eattributes\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Here\x27s a click listener…\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonClick\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e);\n\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27timeout\x27\x3c\/span\x3e);\n  }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\n  \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27promise\x27\x3c\/span\x3e);\n  });\n\n  outer.setAttribute(\x3cspan class=\x22hljs-string\x22\x3e\x27data-random\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.random());\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ …which we\x27ll attach to both elements\x3c\/span\x3e\ninner.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, onClick);\nouter.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, onClick);\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e继续，在查看答案之前先试一试。 线索：logs可能会发生多次。\x3c\/p\x3e\n\x3ch2\x3e试一试\x3c\/h2\x3e\n\x3cp\x3e点击inner区域触发click事件：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbapyY\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e和你猜想的有不同吗？如果是，你得到的结果可能也是正确的。不幸的是，浏览器实现并不统一，下面是各个浏览器下测试结果：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t010c23469a40cf805e.png\x22 alt=\x22Chrome\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01ef787d69e72a9366.png\x22 alt=\x22Firefox\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01d213e3e523c4a8c1.png\x22 alt=\x22Safari\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t013f494d26284ac266.png\x22 alt=\x22Edge\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2\x3e谁是正确的?\x3c\/h2\x3e\n\x3cp\x3e触发 click 事件是一个 task，Mutation observer 和 promise 的回调 加入microtask列队，setTimeout 回调加入task列队。因此运行过程如下：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbakQT\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbakQO\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbakQ8\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbakRb\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e所以 Chrome 是对的。对我来说新发现是，microtasks 在回调之后运行（只要没有其它的 Javascript 在运行），我原以为它只能在一个task 的末尾执行。这个规则来自 HTML 规范，调用一个回调：\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3eIf the \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#stack-of-script-settings-objects\x22\x3estack of script settings objects\x3c\/a\x3e is now empty, \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#perform-a-microtask-checkpoint\x22\x3eperform a microtask checkpoint\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e— \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#clean-up-after-running-a-callback\x22\x3eHTML: Cleaning up after a callback\x3c\/a\x3e step 3\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e一个 microtask checkpoint 逐个检查 microtask队列，除非我们已经在处理一个 microtask 队列。类似地，ECMAScript 规范这么说 jobs：\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3eExecution of a Job can be initiated only when there is no running execution context and the execution context stack is empty…\x3c\/p\x3e\n\x3cp\x3e— \x3ca href=\x22http:\/\/www.ecma-international.org\/ecma-262\/6.0\/#sec-jobs-and-job-queues\x22\x3eECMAScript: Jobs and Job Queues\x3c\/a\x3e\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e尽管在 HTML 中\x22can be\x22变成了\x22must be\x22。\x3c\/p\x3e\n\x3ch2\x3e浏览器会出什么错?\x3c\/h2\x3e\n\x3cp\x3e对于 mutation callbacks，Firefox 和 Safari 都正确地在内部区域和外部区域单击事件之间执行完毕，清空了microtask 队列，但是 promises 列队的处理看起来和chrome不一样。这多少情有可原，因为 jobs 和 microtasks 的关系不清楚，但是我仍然期望在事件回调之间处理 \x3ca href=\x22https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1193394\x22\x3eFirefox ticket\x3c\/a\x3e. \x3ca href=\x22https:\/\/bugs.webkit.org\/show_bug.cgi?id=147933\x22\x3eSafari ticket\x3c\/a\x3e.\x3c\/p\x3e\n\x3cp\x3e对于 Edge，我们已经看到它错误的将 promises 当作 task，它也没有在单击回调之间清空 microtask 队列，而是在所有单击回调执行完之后清空，于是总共只有一个 mutate 在两个 click 之后打印。 \x3ca href=\x22https:\/\/connect.microsoft.com\/IE\/feedbackdetail\/view\/1658386\/microtasks-queues-should-be-processed-following-event-listeners\x22\x3eBug ticket\x3c\/a\x3e.\x3c\/p\x3e\n\x3ch2\x3e等级一 boss打怪升级\x3c\/h2\x3e\n\x3cp\x3e仍然使用上面的例子，假如我们运行下面代码会怎么样：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs abnf\x22\x3einner.click()\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e跟之前一样，它会触发 click 事件，不过是通过代码而不是实际的交互动作。\x3c\/p\x3e\n\x3ch2\x3e试一试\x3c\/h2\x3e\n\x3cp\x3e下面是各个浏览器的运行情况：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t010c23469a40cf805e.png\x22 alt=\x22Chrome\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01ef787d69e72a9366.png\x22 alt=\x22Firefox\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01d213e3e523c4a8c1.png\x22 alt=\x22Safari\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t013f494d26284ac266.png\x22 alt=\x22Edge\x22\x3e\x3cul\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3eclick\x3c\/li\x3e\n\x3cli\x3emutate\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3cli\x3etimeout\x3c\/li\x3e\n\x3cli\x3epromise\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e我发誓我一直在Chrome 中得到不同的结果，我已经更新了这个表许许多次了。我觉得我是错误地测试了Canary。假如你在 Chrome 中得到了不同的结果，请在评论中告诉我是哪个版本。\x3c\/p\x3e\n\x3ch2\x3e为什么会有不同?\x3c\/h2\x3e\n\x3cp\x3e这里介绍了它是怎样发生的：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCt\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCw\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCz\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCA\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCE\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCF\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/segmentfault.com\/img\/bVbaoCG\x22 alt=\x22\x22\x3e\x3c\/p\x3e\n\x3cp\x3e所以正确的顺序是：click, click, promise, mutate, promise, timeout, timeout，似乎 Chrome 是对的。\x3c\/p\x3e\n\x3cp\x3e在每个listerner callback被调用之后：\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3eIf the \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#stack-of-script-settings-objects\x22\x3estack of script settings objects\x3c\/a\x3e is now empty, \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#perform-a-microtask-checkpoint\x22\x3eperform a microtask checkpoint\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e— \x3ca href=\x22https:\/\/html.spec.whatwg.org\/multipage\/webappapis.html#clean-up-after-running-a-callback\x22\x3eHTML: Cleaning up after a callback\x3c\/a\x3e step 3\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3ePreviously, this meant that microtasks ran between listener callbacks, but \x3ccode\x3e.click()\x3c\/code\x3e causes the event to dispatch synchronously, so the script that calls \x3ccode\x3e.click()\x3c\/code\x3e is still in the stack between callbacks. The above rule ensures microtasks don\x27t interrupt JavaScript that\x27s mid-execution. This means we don\x27t process the microtask queue between listener callbacks, they\x27re processed after both listeners.\x3c\/p\x3e\n\x3ch2\x3e这个会有什么问题吗?\x3c\/h2\x3e\n\x3cp\x3e重要，它会在偏角处咬你（疼）。我就遇到了这个问题，我在尝试\x3ca href=\x22https:\/\/github.com\/jakearchibald\/indexeddb-promised\/blob\/master\/lib\/idb.js\x22\x3e为IndexedDB创建一个使用promises\x3c\/a\x3e而不是奇怪的IDBRequest对象的简单包装库时遇到了此问题。\x3ca href=\x22https:\/\/github.com\/jakearchibald\/indexeddb-promised\/blob\/master\/test\/idb.js#L36\x22\x3e它让 IDB 用起来很有趣\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e当 IDB 触发成功事件时，相关的 \x3ca href=\x22http:\/\/w3c.github.io\/IndexedDB\/#fire-a-success-event\x22\x3etransaction 对象在事件之后转为非激活状态\x3c\/a\x3e（第四步）。如果我创建的 promise 在这个事件发生时被resolved，回调应当在第四步之前执行，这时这个对象仍然是激活状态。但是在 Chrome 之外的浏览器中不是这样，导致这个库有些无用。\x3c\/p\x3e\n\x3cp\x3e实际上你可以在 Firefox 中解决这个问题，因为 promise polyfills 如 \x3ca href=\x22https:\/\/github.com\/jakearchibald\/es6-promise\x22\x3ees6-promise\x3c\/a\x3e使用 mutation observers 执行回调，它正确地使用了 microtasks。而它在 Safari 下似乎存在竞态条件，不过这可能是因为他们\x3ca href=\x22http:\/\/www.raymondcamden.com\/2014\/09\/25\/IndexedDB-on-iOS-8-Broken-Bad\x22\x3e糟糕的 IDB 实现\x3c\/a\x3e。不幸的是 IE\/Edge 不一致，因为 mutation 事件不在回调之后处理。\x3c\/p\x3e\n\x3cp\x3e希望不久我们能看到一些互通性。\x3c\/p\x3e\n\x3ch2\x3e你做到了!\x3c\/h2\x3e\n\x3cp\x3e总结：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eTasks 按序执行，浏览器会在 tasks 之间执行渲染。\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eMicrotasks 按序执行，在下面情况时执行：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e在每个回调之后，只要没有其它代码正在运行。\x3c\/li\x3e\n\x3cli\x3e在每个 task 的末尾。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e希望你现在明白了事件循环，或者至少得到一个借口出去走一走，躺一躺。\x3c\/p\x3e\n\x3cp\x3e呃，还有人在吗？Hello？Hello？\x3c\/p\x3e\n\x3cp\x3e感谢 Anne van Kesteren, Domenic Denicola, Brian Kardell 和 Matt Gaunt 校对和修正。是的，Matt 最后还是看了此文，我不必把他整成发条橙了。\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>任务、微任务、队列和时间表</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/tasks-microtasks-queues-and-schedules">https://www.zcfy.cc/article/tasks-microtasks-queues-and-schedules</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/tjqwawuesy/" target="_blank">https://alili.tech/archive/tjqwawuesy/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>