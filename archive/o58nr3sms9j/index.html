<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="20170616-跨域"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>20170616-跨域 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/o58nr3sms9j/",
				"appid": "1613049289050283", 
				"title": "20170616-跨域 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-12T02:30:24"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ssznrn5dc/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/frphvyavaa/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&text=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&text=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&title=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&is_video=false&description=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=20170616-%e8%b7%a8%e5%9f%9f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&title=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&title=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&title=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo58nr3sms9j%2f&title=20170616-%e8%b7%a8%e5%9f%9f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">20170616-跨域</h1><div class="meta"><div class="postdate"><time datetime="2019-01-12" itemprop="datePublished">2019-01-12</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e同源策略\x3c\/h2\x3e\n\x3cp\x3e浏览器出于安全方面的考虑，不同源的客户端脚本在没有明确授权的情况下，不能读写对方的资源。\x3c\/p\x3e\n\x3cp\x3e同源指的是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e同协议\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e同域名\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e同端口\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e作用：保证用户信息的安全，防止恶意的网站窃取数据\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e例1：A网站是一家银行，用户登录以后，又去浏览其他网站。如果其他网站可以读取A网站的 Cookie，会发生什么？很显然，如果 Cookie 包含隐私（比如存款总额），这些信息就会泄漏。除此之外，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。（因为浏览器同时还规定，提交表单不受同源政策的限制）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e例2：恶意网站的页面通过iframe嵌入了银行的登录页面（二者不同源），如果没有同源限制，恶意网页上的javascript脚本就可以在用户登录银行的时候获取用户名和密码，从而造成相关的风险。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e对于当前页面来说页面中 JS 文件的域不重要，重要的是当前页面所在的域与 脚本中涉及到的域(例如xht的open方法的url)是否同源\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e跨域\x3c\/h2\x3e\n\x3cp\x3e跨域：浏览器出于安全方面的考虑设置了同源策略来限制不同域之间的交互，但是也阻碍了不域之间的协助。为了实现不同域之间的交互、协作，因此需要“跨域”。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e跨域窗口通信\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e降域\x3c\/h3\x3e\n\x3cp\x3e降域获取同一 Cookie：Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置document.domain 共享 Cookie。\x3c\/p\x3e\n\x3cp\x3eexample：A 网页是 \x3ccode\x3ehttp:\/\/w1.example.com\/a.html\x3c\/code\x3e，B 网页是\x3ccode\x3ehttp:\/\/w2.example.com\/b.html\x3c\/code\x3e，那么只要设置相同的 \x3ccode\x3edocument.domain\x3c\/code\x3e，两个网页就可以共享 \x3ccode\x3eCookie\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3eJavaScript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ A网页和B网页设置相同的 document.domain\ndocument.domain = \x27example.com\x27\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs stylus\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ A网页和B网页设置相同的 document.domain\x3c\/span\x3e\ndocument\x3cspan class=\x22hljs-selector-class\x22\x3e.domain\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27example.com\x27\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ A网页通过脚本设置 Cookie\ndocument.cookie = \x26quot;test1 = hello\x26quot;;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ A网页通过脚本设置 Cookie\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie = \x3cspan class=\x22hljs-string\x22\x3e\x22test1 = hello\x22\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ B网页可以获取到该 Cookie\nvar otherCookie = document.cookie;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dart\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ B网页可以获取到该 Cookie\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e otherCookie = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.cookie;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e降域使不同源的iframe窗口和父窗口相互通信：如果两个网页不同源，就无法拿到对方的\x3cbr\x3e DOM。典型的例子是 iframe 窗口和与父窗口无法通信。如果两个窗口一级域名相同，只是二级域名不同，那么设置 document.domain 属性，就可以规避同源政策，拿到\x3cbr\x3e DOM。\x3c\/p\x3e\n\x3cp\x3eA 网页：\x3ccode\x3eURL: http:\/\/a.yanxin.com:8080\/a.html\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3eHTML\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cdiv class=\x26quot;ct\x26quot;\x3e\n  \x3ch1\x3e使用降域实现跨域\x3c\/h1\x3e\n  \x3cdiv class=\x26quot;main\x26quot;\x3e\n    \x3cinput type=\x26quot;text\x26quot; placeholder=\x26quot;http:\/\/a.yanxin.cn:8080\/a.html\x26quot;\x3e\n  \x3c\/div\x3e\n  \x3ciframe src=\x26quot;http:\/\/b.yanxin.com:8080\/b.html\x26quot; frameborder=\x26quot;0\x26quot; \x3e\x3c\/iframe\x3e\n\x3c\/div\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x26lt;div \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22ct\x22\x3c\/span\x3e\x26gt;\n  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e使用降域实现跨域\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eh1\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  \x26lt;div \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22main\x22\x3c\/span\x3e\x26gt;\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3einput\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eplaceholder\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/a.yanxin.cn:8080\/a.html\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n  \x26lt;iframe src=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/b.yanxin.com:8080\/b.html\x22\x3c\/span\x3e frameborder=\x3cspan class=\x22hljs-string\x22\x3e\x220\x22\x3c\/span\x3e \x26gt;\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3eiframe\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n\x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/div\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3escript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3e\ndocument.querySelector(\x27.main input\x27).addEventListener(\x27input\x27, function(){\n  console.log(this.value);\n  \/* window.frames 是窗口中所有命名的框架组成的数组。\n  这个数组的每个元素都是一个Window对象，对应于窗口中的一个框架。\n  window.frames[0]得到的就是html中的框架\n  window.frames[0].document.querySelector(\x27input\x27) 得到框架中的input元素\n  *\/\n  window.frames[0].document.querySelector(\x27input\x27).value = this.value;\n})\n\ndocument.domain = \x26quot;yanxin.com\x26quot;\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.main input\x27\x3c\/span\x3e).addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value);\n  \x3cspan class=\x22hljs-comment\x22\x3e\/* window.frames 是窗口中所有命名的框架组成的数组。\n  这个数组的每个元素都是一个Window对象，对应于窗口中的一个框架。\n  window.frames[0]得到的就是html中的框架\n  window.frames[0].document.querySelector(\x27input\x27) 得到框架中的input元素\n  *\/\x3c\/span\x3e\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.frames[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e].document.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value;\n})\n\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.domain = \x3cspan class=\x22hljs-string\x22\x3e\x22yanxin.com\x22\x3c\/span\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3eiframe 中的 B 网页：\x3ccode\x3eURL: http:\/\/b.yanxin.com:8080\/b.html\x3c\/code\x3e\x3cbr\x3eHTML\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cinput id=\x26quot;input\x26quot; type=\x26quot;text\x26quot;  placeholder=\x26quot;http:\/\/b.yanxin.com:8080\/b.html\x26quot;\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fsharp\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x26lt;input id=\x3cspan class=\x22hljs-string\x22\x3e\x22input\x22\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22text\x22\x3c\/span\x3e  placeholder=\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/b.yanxin.com:8080\/b.html\x22\x3c\/span\x3e\x26gt;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3escript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3e\ndocument.querySelector(\x27#input\x27).addEventListener(\x27input\x27, function(){\n    \/\/ 得到父窗口中的input元素\n    window.parent.document.querySelector(\x27input\x27).value = this.value;\n})\ndocument.domain = \x27yanxin.com\x27;\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27#input\x27\x3c\/span\x3e).addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 得到父窗口中的input元素\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.parent.document.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.value;\n})\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.domain = \x3cspan class=\x22hljs-string\x22\x3e\x27yanxin.com\x27\x3c\/span\x3e;\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3epostMessage\x3c\/h3\x3e\n\x3cp\x3eHTML5为了解决跨域问题，引入了一个全新的API：跨文档通信 API（Cross-document messaging）。\x3cbr\x3e这个API为window对象新增了一个window.postMessage方法，允许跨窗口通信，不论这两个窗口是否同源。\x3c\/p\x3e\n\x3cp\x3e目的：向另一个地方传递数据，另一个地方指的是：\x3cstrong\x3e包含在当前页面的\x26lt;iframe\x26gt;元素，或者由当前页面弹出的窗口\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3ewindow.postMessage() 方法被调用时，会在所有页面脚本执行完毕之后向目标窗口派发一个 MessageEvent 消息。 * otherWindow.postMessage(message, targetOrigin, [transfer]);\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eotherWindow：其他窗口的一个引用(\x3cstrong\x3e相对于当前的窗口的其他窗口\x3c\/strong\x3e)，比如iframe的contentWindow属性、执行window.open返回的窗口对象、或者是命名过或数值索引的window.frames。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3emessage将要发送到其他 window的数据\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3etargetOrigin：指定哪些窗口能接收到消息事件，其值可以是字符串\x22*\x22（表示无限制）或者一个URI。在发送消息的时候，如果目标窗口的协议、主机地址或端口这三者的任意一项不匹配targetOrigin提供的值，那么消息就不会被发送；只有三者完全匹配，消息才会被发送。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e注意:如果你明确的知道消息应该发送到哪个窗口，那么请始终提供一个有确切值的targetOrigin，而不是*。不提供确切的目标将导致数据泄露到任何对数据感兴趣的恶意站点。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e示例\x3c\/p\x3e\n\x3cp\x3e页面 A:  \x3ccode\x3ehttp:\/\/a.yanxin.cn:8080\/a.html\x3c\/code\x3e。\x3cbr\x3e在页面 A 中 打开页面 B: \x3ccode\x3ehttp:\/\/b.yanxin.cn:8080\/b.html\x3c\/code\x3e\x3cbr\x3e当点击页面 A 上的 button 时,向页面B传输消息 \x22hello world\x22\x3c\/p\x3e\n\x3cp\x3eHTML\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x3cbutton id=\x26quot;sendmessage\x26quot;\x3esend message\x3c\/button\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eid\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22sendmessage\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3esend message\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ebutton\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3escript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x3cscript\x3e\n   var button = document.querySelector(\x26quot;#sendmessage\x26quot;);\n  \/\/ 打开页面b，并且取得对它的引用\n   var targetWindow = window.open(\x26quot;http:\/\/b.yanxin.cn:8080\/b.html\x26quot;);\n   button.addEventListener(\x27click\x27,function(){\n   \/\/ 注意: 这里是向targetWindow即新打开的窗口(通过上面的window.open打开的窗口)发送消息\n  \/\/ 直接打开页面b(手动打开的)是无法收到消息的\n  \/\/ 如果直接调用postMessage则相当于当前窗口向自己发送消息\n      targetWindow.postMessage(\x26quot;hello world!!\x26quot;, \x26quot;http:\/\/b.yanxin.cn:8080\/b.html\x26quot;);\n   });\n  \x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e button = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x22#sendmessage\x22\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打开页面b，并且取得对它的引用\x3c\/span\x3e\n   \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e targetWindow = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.open(\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/b.yanxin.cn:8080\/b.html\x22\x3c\/span\x3e);\n   button.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注意: 这里是向targetWindow即新打开的窗口(通过上面的window.open打开的窗口)发送消息\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 直接打开页面b(手动打开的)是无法收到消息的\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果直接调用postMessage则相当于当前窗口向自己发送消息\x3c\/span\x3e\n      targetWindow.postMessage(\x3cspan class=\x22hljs-string\x22\x3e\x22hello world!!\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/b.yanxin.cn:8080\/b.html\x22\x3c\/span\x3e);\n   });\n  \x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为页面 B 的 window 添加监听器\x3cbr\x3e当页面 B 收到 Message 时,在控制台中输出收到的消息,并提示 \x22hello\x22\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3cscript\x3e\n    window.addEventListener(\x26quot;message\x26quot;, receiveMessage);\n    function receiveMessage(event){\n        console.log(event.data);\n        alert(\x26quot;hello\x26quot;);\n    }\n\x3c\/script\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22javascript\x22\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x22message\x22\x3c\/span\x3e, receiveMessage);\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ereceiveMessage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eevent\x3c\/span\x3e)\x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(event.data);\n        alert(\x3cspan class=\x22hljs-string\x22\x3e\x22hello\x22\x3c\/span\x3e);\n    }\n\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e服务器与客户端跨域通信\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eCORS\x3c\/h3\x3e\n\x3cp\x3eCORS: Cross-Origin Resource Sharing, 跨源资源共享，是W3C的一个工作草案，定义了在必须访问跨源资源时，浏览器与服务器应该如何沟通，它是一种 ajax跨域请求资源的方式，支持现代浏览器，IE支持10以上。\x3c\/p\x3e\n\x3cp\x3e实现过程：当使用 XMLHttpRequest发送请求时，浏览器发现该请求不符合同源策略，会\x3cstrong\x3e自动\x3c\/strong\x3e给该请求加一个请求头：Origin，并将请求发送。服务器端收到请求后，如果确定接受请求则在返回结果中加入一个响应头：Access-Control-Allow-Origin; 浏览器收到响应后判断该相应头中是否包含 Origin 的值，如果有则浏览器会处理响应，我们就可以拿到响应数据，如果不包含浏览器直接驳回，这时我们无法拿到响应数据。整个CORS通信过程，都是浏览器自动完成，不需要用户参与\x3c\/p\x3e\n\x3cp\x3e实现CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。\x3c\/p\x3e\n\x3cp\x3e详细流程：\x3c\/p\x3e\n\x3cp\x3e1.浏览器发现这次请求不符合同源策略，就自动在头信息之中，添加一个Origin字段。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22GET \/cors HTTP\/1.1\nOrigin: http:\/\/api.bob.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla\/5.0...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs http\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eGET\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/cors\x3c\/span\x3e HTTP\/1.1\n\x3cspan class=\x22hljs-attribute\x22\x3eOrigin\x3c\/span\x3e: http:\/\/api.bob.com\n\x3cspan class=\x22hljs-attribute\x22\x3eHost\x3c\/span\x3e: api.alice.com\n\x3cspan class=\x22hljs-attribute\x22\x3eAccept-Language\x3c\/span\x3e: en-US\n\x3cspan class=\x22hljs-attribute\x22\x3eConnection\x3c\/span\x3e: keep-alive\n\x3cspan class=\x22hljs-attribute\x22\x3eUser-Agent\x3c\/span\x3e: Mozilla\/5.0...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在上面的头信息中，Origin字段表明了本次请求来自哪个源：协议、域名、端口。\x3c\/p\x3e\n\x3cp\x3e2.该请求到达服务器后，服务器会根据这个值来判断是否接受请求。如果Origin指定的域名在许可范围内，服务器返回的响应，会多出几个头信息字段(如下所示)。如果Origin指定的源，不在许可范围内，服务器会返回一个正常的HTTP回应。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Access-Control-Allow-Origin: http:\/\/api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text\/html; charset=utf-8\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3eAccess-Control-Allow-\x3cspan class=\x22hljs-string\x22\x3eOrigin:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ehttp:\x3c\/span\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/api.bob.com\x3c\/span\x3e\nAccess-Control-Allow-\x3cspan class=\x22hljs-string\x22\x3eCredentials:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\nAccess-Control-Expose-\x3cspan class=\x22hljs-string\x22\x3eHeaders:\x3c\/span\x3e FooBar\nContent-\x3cspan class=\x22hljs-string\x22\x3eType:\x3c\/span\x3e text\/html; charset=utf\x3cspan class=\x22hljs-number\x22\x3e-8\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e3.浏览器收到响应后判断该相应头中是否包含Origin的值，如果响应的头信息没有包含Access-Control-Allow-Origin字段，就知道出错了，从而抛出一个错误，被XMLHttpRequest的onerror回调函数捕获，这时我们无法拿到响应数据。如果有则浏览器会处理响应，我们就可以拿到响应数据。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3eJSONP\x3c\/h3\x3e\n\x3cp\x3e基本思想是，网页通过添加一个\x26lt;script\x26gt;元素，向服务器请求JSON数据，这种做法不受同源政策限制；服务器收到请求后，将数据放在一个指定名字的回调函数里传回来。传回后回调函数立即执行(参数是后端产生的数据),从而实现相应的功能。\x3c\/p\x3e\n\x3cp\x3e具体流程：\x3c\/p\x3e\n\x3cp\x3e1.网页动态地插入 \x26lt;script\x26gt; 元素，由它向跨域网址发出请求\x3c\/p\x3e\n\x3cp\x3eJavaScript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function addScriptTag(src){\n    var script = document.createElement(\x27script\x27);\n    script.src = src; \/\/跨域网址\n    document.body.appendChild(script);  \n    \/\/ 往页面插入元素后，会向跨域网址发出请求(src指定了跨域网址，得到响应后立即执行\n}\nwindow.onload = function(){\n    addScriptTag(\x26quot;http:\/\/example.com\/ip?callback = foo\x27);  \/\/当页面加载完毕，即往页面中插入script元素\n}\nfunction foo(data){\n    console.log(\x27your public ip address is: \x27\x2b data.ip)\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs scilab\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eaddScriptTag\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(src)\x3c\/span\x3e{\x3c\/span\x3e\n    var script = document.createElement(\x3cspan class=\x22hljs-string\x22\x3e\x27script\x27\x3c\/span\x3e);\n    script.src = src; \x3cspan class=\x22hljs-comment\x22\x3e\/\/跨域网址\x3c\/span\x3e\n    document.body.appendChild(script);  \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 往页面插入元素后，会向跨域网址发出请求(src指定了跨域网址，得到响应后立即执行\x3c\/span\x3e\n}\nwindow.onload = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e{\x3c\/span\x3e\n    addScriptTag(\x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com\/ip?callback = foo\x27\x3c\/span\x3e);  \x3cspan class=\x22hljs-comment\x22\x3e\/\/当页面加载完毕，即往页面中插入script元素\x3c\/span\x3e\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efoo\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(data)\x3c\/span\x3e{\x3c\/span\x3e\n    console.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27your public ip address is: \x27\x3c\/span\x3e\x2b data.ip)\x3cspan class=\x22hljs-string\x22\x3e\x27\n}\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e2.上面代码通过动态添加\x26lt;script\x26gt;元素，向服务器example.com发出请求。注意，该请求的查询字符串有一个callback参数，用来\x3cstrong\x3e指定回调函数的名字\x3c\/strong\x3e，这对于JSONP是必需的。\x3cbr\x3e3.服务器收到该请求后，会将数据放在回到函数的参数位置返回\x3cbr\x3eJavaScript\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22foo({\n  \x26quot;ip\x26quot;: \x26quot;8.8.8.8\x26quot;\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3efoo({\n  \x3cspan class=\x22hljs-string\x22\x3e\x22ip\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x228.8.8.8\x22\x3c\/span\x3e\n})\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e4.由于\x26lt;script\x26gt;元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了foo函数，该函数就会立即调用。作为参数的JSON数据被视为JavaScript对象，而不是字符串，因此避免了使用JSON.parse的步骤。\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e注意：JSONP只能发 \x3cstrong\x3eGET\x3c\/strong\x3e 请求(因为请求是放在\x26lt;script\x26gt;的scr中的)。\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e图像 Ping\x3c\/h3\x3e\n\x3cp\x3e我们知道，一个网页可以从任何网页中加载图像，不用担心跨域问题。这也是在线广告跟踪浏览量的主要方式。我们可以动态地创建图像，使用它们的onload和onerror事件处理程序来确定是否接受到了响应。\x3c\/p\x3e\n\x3cp\x3e动态创建图像经常用于图像Ping，图像Ping是与服务器进行简单、单向的跨域通信的一种方式。请求的数据是通过查询字符串形式发送的，而响应可以是任意内容，但通常是像素图或者204响应。通过图像Ping，浏览器得不到任何具体的数据，但通过侦听load和error事件，它能知道响应是什么时候接受到的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var img = new Image()\nimg.onload = img.onerror = function(){\n    alert(\x26quot;Done\x26quot;)\n};\nimg.src = \x26quot;http:\/\/www.example.com\/test?name=Nicholas\x26quot;;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e img = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Image()\nimg.onload = img.onerror = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e\x3c\/span\x3e{\n    alert(\x3cspan class=\x22hljs-string\x22\x3e\x22Done\x22\x3c\/span\x3e)\n};\nimg.src = \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/www.example.com\/test?name=Nicholas\x22\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里创建了一个 Image 的实例，然后将 onload 和 onerror 事件处理程序指定为同一个函数。这样无论是什么响应，只要请求完成，就能得到通知。请求从设置 src 属性那一刻开始，而这个例子在请求中发送了一个 name 参数。\x3c\/p\x3e\n\x3cp\x3e图像 Ping 最常用于跟踪用户点击页面或动态广告曝光次数。\x3c\/p\x3e\n\x3cp\x3e缺点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e只能发送GET请求\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e无法访问服务器的响应文本\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e结论：图像Ping只能用于浏览器与服务器间的单向通信。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>20170616-跨域</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009803675">https://segmentfault.com/a/1190000009803675</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/o58nr3sms9j/" target="_blank">https://alili.tech/archive/o58nr3sms9j/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>