<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="VUE开发SPA之较舒服的微信授权登录"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>VUE开发SPA之较舒服的微信授权登录 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/0wafkrmsso9e/",
				"appid": "1613049289050283", 
				"title": "VUE开发SPA之较舒服的微信授权登录 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-14T02:30:07"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6kvsv74kk06/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/0jk9hs0lj6da/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&text=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&text=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&title=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&is_video=false&description=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&title=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&title=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&title=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f0wafkrmsso9e%2f&title=VUE%e5%bc%80%e5%8f%91SPA%e4%b9%8b%e8%be%83%e8%88%92%e6%9c%8d%e7%9a%84%e5%be%ae%e4%bf%a1%e6%8e%88%e6%9d%83%e7%99%bb%e5%bd%95"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">VUE开发SPA之较舒服的微信授权登录</h1><div class="meta"><div class="postdate"><time datetime="2019-01-14" itemprop="datePublished">2019-01-14</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3eSPA单页应用中微信授权登录的一点思路\x3c\/h3\x3e\n\x3cp\x3e单页应用应该如何解决微信授权登录的尴尬跳转？后退无法返回？\x3cbr\x3e主要遇到的问题就是  \x3cbr\x3e先进入单页应用，一边渲染页面一边判断用户有没有登录，当判断到没有登录时异步数据请求已经发送出去了，然后要跳转到微信授权页面，这样就浪费了一次网络请求且用户可能要去点击这个数据了结果...跳走了！在授权成功后用户点击后退再次进行授权有没有？？？\x3cbr\x3e本文主要讲述\x3c\/p\x3e\n\x3cblockquote\x3e对于单页应用应该在哪个阶段获取微信授权？  \x3cbr\x3e 只考虑网站完全依赖微信授权登录，一进入就要以授权的身份进入\x3c\/blockquote\x3e\n\x3ch4\x3e基本思路\x3c\/h4\x3e\n\x3cp\x3e核心是需要有个author.vue  叫它授权中间页好了\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVNZQC?w=558\x26amp;h=814\x22 src=\x22https:\/\/static.alili.tech\/img\/bVNZQC?w=558\x26amp;h=814\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch4\x3evue开发过程中的一些点子\x3c\/h4\x3e\n\x3cp\x3e由于我的业务是完全依赖微信授权登录的，也就是用户一进来就应该是已经完成授权的  \x3cbr\x3e为了避免让用户明显感觉到先进入网站然后又跳转到微信授权页面  \x3cbr\x3e我们从\x3cstrong\x3evue-router\x3c\/strong\x3e下手  \x3cbr\x3e基本实现思路是：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e无论使用哪个url进入网站都会先触发router.beforeEach钩子\x3c\/li\x3e\n\x3cli\x3e在router.beforeEach钩子中判断用户当前登录状态\x3c\/li\x3e\n\x3cli\x3e若没有登录则保存用户进入的url并跳转到author授权页面\x3c\/li\x3e\n\x3cli\x3eauthor授权页面完成微信授权以及token的写入实现用户登录\x3c\/li\x3e\n\x3cli\x3e获取前面保存的用户进入url并跳转\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e经过这样一个流程，用户感觉到的就是，无论从哪个url进入SPA，都会先显示author页面，然后再进入自己想要进入的页面，而不是先进入自己想要进入的页面再\x3cstrong\x3e闪\x3c\/strong\x3e到author页面，这样不仅节省了资源也提升了用户体验，更重要的一点是！我们的项目多了一个广告页面(无语...)！！！  \x3c\/p\x3e\n\x3cp\x3e先贴上我的实现代码  \x3cbr\x3e用户信息保存在Vuex中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ holdno是我自己定义的一个工具集 里面有各种操作方法\nrouter.beforeEach((to, from, next) =\x3e {\n  if(!store.state.user.id \x26amp;\x26amp; to.path != \x27\/author\x27){\n    \/\/ 第一次进入项目\n    holdno.cookie.set(\x27beforeLoginUrl\x27, to.fullPath) \/\/ 保存用户进入的url\n    next(\x27\/author\x27)\n    return false\n  }\n  next()\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ holdno是我自己定义的一个工具集 里面有各种操作方法\x3c\/span\x3e\nrouter.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!store.state.user.id \x26amp;\x26amp; to.path != \x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第一次进入项目\x3c\/span\x3e\n    holdno.cookie.set(\x3cspan class=\x22hljs-string\x22\x3e\x27beforeLoginUrl\x27\x3c\/span\x3e, to.fullPath) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户进入的url\x3c\/span\x3e\n    next(\x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n  next()\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e下面来看一下author页面的处理逻辑\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22created () {\n    \/\/ 检测会员有没有登录\n    if(!holdno.cookie.get(\x27user\x27)){\n      let ua = window.navigator.userAgent.toLowerCase()\n      if(ua.match(\/MicroMessenger\/i) == \x27micromessenger\x27){\n        \/\/ 跳转到微信授权页面\n        window.location.href = this.webUrl \x2b \x27\/Wap\/User\/getOpenid\x27\n      }\n    }else{\n      \/\/ 如果有token 但是vuex中没有用户登录信息则做登录操作\n      this.login()\n    }\n},\nmethods: {\n    login () {\n      let url = this.webUrl \x2b \x27\/Wap\/User\/info\x27\n      \/\/ 通过cookie中保存的token 获取用户信息\n      this.$http.get(url).then(response =\x3e {\n        response = response.body\n        if(response){\n          \/\/ 保存用户登录状态(Vuex)\n          this.$store.commit(\x27user\x27, response)\n          setTimeout(() =\x3e {\n            this.goBeforeLoginUrl() \/\/ 页面恢复(进入用户一开始请求的页面)\n          }, 2000)\n        }else{\n          this.$alert(\x27服务器撸猫去惹 :(\x27, \x27wrong\x27)\n          if(holdno.cookie.get(\x27user\x27)){\n            \/\/ 跳转到微信授权页面\n            window.location.href = this.webUrl \x2b \x27\/Wap\/User\/getOpenid\x27\n          }\n        }\n      })\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3ecreated () {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检测会员有没有登录\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!holdno.cookie.get(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e)){\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e ua = \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.navigator.userAgent.toLowerCase()\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(ua.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/MicroMessenger\/i\x3c\/span\x3e) == \x3cspan class=\x22hljs-string\x22\x3e\x27micromessenger\x27\x3c\/span\x3e){\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跳转到微信授权页面\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.webUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/Wap\/User\/getOpenid\x27\x3c\/span\x3e\n      }\n    }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果有token 但是vuex中没有用户登录信息则做登录操作\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.login()\n    }\n},\n\x3cspan class=\x22hljs-attr\x22\x3emethods\x3c\/span\x3e: {\n    login () {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e url = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.webUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/Wap\/User\/info\x27\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过cookie中保存的token 获取用户信息\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$http.get(url).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresponse\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        response = response.body\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(response){\n          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 保存用户登录状态(Vuex)\x3c\/span\x3e\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$store.commit(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e, response)\n          setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.goBeforeLoginUrl() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 页面恢复(进入用户一开始请求的页面)\x3c\/span\x3e\n          }, \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e)\n        }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$alert(\x3cspan class=\x22hljs-string\x22\x3e\x27服务器撸猫去惹 :(\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27wrong\x27\x3c\/span\x3e)\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(holdno.cookie.get(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e)){\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 跳转到微信授权页面\x3c\/span\x3e\n            \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.href = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.webUrl \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/Wap\/User\/getOpenid\x27\x3c\/span\x3e\n          }\n        }\n      })\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上述代码中 \x3cstrong\x3ewindow.location.href = this.webUrl \x2b \x27\/Wap\/User\/getOpenid\x27\x3c\/strong\x3e  \x3cbr\x3e这一段是后端请求微信授权登录接口的地址，在后端获取到用户信息及openid后再次跳转到author页面而不是直接定向到用户想要请求的位置，这样做的原因很简单。\x3c\/p\x3e\n\x3cp\x3e如果用户跳转到授权页面，由后端获取用户信息并保存好登录状态，重定向到用户请求的页面，这时只要用户点击一下后退，所有的逻辑重新再来一遍有没有？作为一个不懂技术的用户，应该也是很郁闷，为什么后退还是跳回来了呢？？？  \x3c\/p\x3e\n\x3cp\x3e所以获取用户信息后再次重定向到author页面，由author做一个中间页检测到获取到用户信息后在前端做一个跳转，也就是代码中的\x3cstrong\x3ethis.goBeforeLoginUrl()\x3c\/strong\x3e(跳转到登录前的url ...哈哈哈)，这时候用户再点击后退就会退回到author页面而不是后端获取用户openid的url，但真的会再次显示author页面给用户吗？并不会，回看我们路由钩子的定义：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22router.beforeEach((to, from, next) =\x3e {\n  if(to.path == \x27\/author\x27 \x26amp;\x26amp; store.state.user.id){\n    \/\/ 用户使用后退返回到授权页，则默认回到首页\n    next(\x27\/index\x27)\n    return false\n  }\n  ...\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3erouter.beforeEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eto, \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e, next\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(to.path == \x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e \x26amp;\x26amp; store.state.user.id){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用户使用后退返回到授权页，则默认回到首页\x3c\/span\x3e\n    next(\x3cspan class=\x22hljs-string\x22\x3e\x27\/index\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n  }\n  ...\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e后面部分这里不重要，展示出来的则是关键部分，在再次跳转至author前，路由钩子被触发，检测到即将进入的页面to.path == \x27\/author\x27成立同时刚才在this.login()中做了\x3cstrong\x3ethis.$store.commit(\x27user\x27, response)\x3c\/strong\x3e操作，所以if条件成立页面被直接跳转至\x3cstrong\x3e\x27\/index\x27\x3c\/strong\x3e首页，所以在这一个流程中，用户并没有再次看到授权页面，而是直接返回到了首页，是不是很完美！  \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3ethis.goBeforeLoginUrl()\x3c\/strong\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 登录后跳转方法\nVue.prototype.goBeforeLoginUrl = () =\x3e {\n  let url = holdno.cookie.get(\x27beforeLoginUrl\x27)\n  if(!url || url.indexOf(\x27\/author\x27) != -1){\n    router.push(\x27\/index\x27)\n  }else{\n    if(url == \x27\/\x27){\n      url = \x27\/index\x27\n    }\n    router.push(url)\n    holdno.cookie.set(\x27beforeLoginUrl\x27, \x27\x27)\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 登录后跳转方法\x3c\/span\x3e\nVue.prototype.goBeforeLoginUrl = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e url = holdno.cookie.get(\x3cspan class=\x22hljs-string\x22\x3e\x27beforeLoginUrl\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(!url || url.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27\/author\x27\x3c\/span\x3e) != \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e){\n    router.push(\x3cspan class=\x22hljs-string\x22\x3e\x27\/index\x27\x3c\/span\x3e)\n  }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(url == \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e){\n      url = \x3cspan class=\x22hljs-string\x22\x3e\x27\/index\x27\x3c\/span\x3e\n    }\n    router.push(url)\n    holdno.cookie.set(\x3cspan class=\x22hljs-string\x22\x3e\x27beforeLoginUrl\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看完整个流程，author只讲到逻辑处理，但它毕竟是一个页面，也是要展示给用户看的，只处理逻辑的话难道白花花的一片show给用户吗？当然不是！想必大家都了解app在初次启动时都有一个广告页吧，我们完全可以把author授权中间页包装成一个广告页，在用户浏览花哨的图片(广告)时默默完成授权登录的处理 :)\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVUkMd?w=719\x26amp;h=1280\x22 src=\x22https:\/\/static.alili.tech\/img\/bVUkMd?w=719\x26amp;h=1280\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e大概就是这么个意思 :P\x3c\/p\x3e\n\x3ch4\x3e扫码体验\x3c\/h4\x3e\n\x3cblockquote\x3eemmmm... 现在已经是小程序的时代了，所以我把微信web站点给关掉了，没办法体验了 不好意思。\x3c\/blockquote\x3e\n\x3cp\x3e希望能有大神交流更优解决方案。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>VUE开发SPA之较舒服的微信授权登录</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009493199">https://segmentfault.com/a/1190000009493199</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/0wafkrmsso9e/" target="_blank">https://alili.tech/archive/0wafkrmsso9e/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>