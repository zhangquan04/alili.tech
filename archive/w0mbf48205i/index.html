<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="初探Promise"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>初探Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/w0mbf48205i/",
				"appid": "1613049289050283", 
				"title": "初探Promise | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-02T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/6lm2sm6wm06/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/yofndlbrn6r/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&text=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&text=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&title=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&is_video=false&description=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%88%9d%e6%8e%a2Promise&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&title=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&title=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&title=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fw0mbf48205i%2f&title=%e5%88%9d%e6%8e%a2Promise"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">初探Promise</h1><div class="meta"><div class="postdate"><time datetime="2019-02-02" itemprop="datePublished">2019-02-02</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e一 前言\x3c\/h1\x3e\n\x3cp\x3e本文主要对ES6的\x3ccode\x3ePromise\x3c\/code\x3e进行一些入门级的介绍。要想学习一个知识点，肯定是从三个方面出发，what、why、how。下面就跟着我一步步学习吧~\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader1\x22\x3e二 什么是Promise\x3c\/h1\x3e\n\x3cp\x3e首先是what。那么什么是\x3ccode\x3ePromise\x3c\/code\x3e呢？  \x3cbr\x3e以下是MDN对\x3ccode\x3ePromise\x3c\/code\x3e的定义\x3c\/p\x3e\n\x3cblockquote\x3eThe Promise object is used for asynchronous computations. A Promise represents a single asynchronous operation that hasn\x27t completed yet, but is expected in the future.\x3cp\x3e译文：Promise对象用于异步操作，它表示一个尚未完成且预计在未来完成的异步操作。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e那么什么是异步操作？在学习promise之前需要把这个概念搞明白，下面将抽离一章专门介绍。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e2.1 同步与异步\x3c\/h2\x3e\n\x3cp\x3e我们知道，JavaScript的执行环境是「单线程」。  \x3cbr\x3e所谓单线程，是指JS引擎中负责解释和执行JavaScript代码的线程只有一个，也就是一次只能完成一项任务，这个任务执行完后才能执行下一个，它会「阻塞」其他任务。这个任务可称为主线程。  \x3cbr\x3e但实际上还有其他线程，如事件触发线程、ajax请求线程等。 \x3c\/p\x3e\n\x3cp\x3e这也就引发了同步和异步的问题。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e2.1.1 同步\x3c\/h3\x3e\n\x3cp\x3e同步模式，即上述所说的单线程模式，\x3cstrong\x3e一次\x3c\/strong\x3e只能执行\x3cstrong\x3e一个\x3c\/strong\x3e任务，函数调用后需等到函数执行结束，返回执行的结果，才能进行下一个任务。如果这个任务执行的时间较长，就会导致「\x3cstrong\x3e线程阻塞\x3c\/strong\x3e」。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.1 *\/\nvar x = true;\nwhile(x);\nconsole.log(\x26quot;don\x27t carry out\x26quot;);    \/\/不会执行\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.1 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e x = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e(x);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22don\x27t carry out\x22\x3c\/span\x3e);    \x3cspan class=\x22hljs-comment\x22\x3e\/\/不会执行\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上面的例子即同步模式，其中的while是一个死循环，它会阻塞进程，因此第三句console不会执行。  \x3cbr\x3e同步模式比较简单，也较容易编写。但问题也显而易见，如果请求的时间较长，而阻塞了后面代码的执行，体验是很不好的。因此对于一些耗时的操作，异步模式则是更好的选择。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2.1.2 异步\x3c\/h3\x3e\n\x3cp\x3e下面就来看看异步模式。  \x3cbr\x3e异步模式，即与同步模式相反，可以一起执行\x3cstrong\x3e多个任务\x3c\/strong\x3e，函数调用后不会立即返回执行的结果，如果任务A需要等待，可先执行任务B，等到任务A结果返回后再继续回调。  \x3cbr\x3e最常见的异步模式就数定时器了，我们来看看以下的例子。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.2 *\/\nsetTimeout(function() {\n    console.log(\x27taskA, asynchronous\x27);\n}, 0);\nconsole.log(\x27taskB, synchronize\x27);\n\/\/while(true);\n\n-------ouput-------\ntaskB, synchronize\ntaskA, asynchronous\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.2 *\/\x3c\/span\x3e\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27taskA, asynchronous\x27\x3c\/span\x3e);\n}, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27taskB, synchronize\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/while(true);\x3c\/span\x3e\n\n-------ouput-------\ntaskB, synchronize\ntaskA, asynchronous\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们可以看到，定时器延时的时间明明为0，但taskA还是晚于taskB执行。这是为什么呢？由于定时器是异步的，\x3cstrong\x3e异步任务会在当前脚本的所有同步任务执行完才会执行\x3c\/strong\x3e。如果同步代码中含有死循环，即将上例的注释去掉，那么这个异步任务就不会执行，因为同步任务阻塞了进程。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e2.1.3 回调函数\x3c\/h3\x3e\n\x3cp\x3e提起异步，就不得不谈谈回调函数了。上例中，\x3ccode\x3esetTimeout\x3c\/code\x3e里的\x3ccode\x3efunction\x3c\/code\x3e便是回调函数。可以简单理解为：（执行完）回（来）调（用）的函数。\x3cbr\x3e以下是WikiPedia对于\x3ccode\x3ecallback\x3c\/code\x3e的定义。\x3c\/p\x3e\n\x3cblockquote\x3eIn computer programming, a callback is a piece of executable code that is passed as an argument to other code, which is expected to call back (execute) the argument at some convenient time.\x3c\/blockquote\x3e\n\x3cp\x3e可以看出，回调函数是一段可执行的代码段，它以「参数」的形式传递给其他代码，在其合适的时间执行这段（回调函数）的代码。\x3c\/p\x3e\n\x3cp\x3eWikiPedia同时提到\x3c\/p\x3e\n\x3cblockquote\x3eThe invocation may be immediate as in a synchronous callback, or it might happen at a later time as in an asynchronous callback.\x3c\/blockquote\x3e\n\x3cp\x3e也就是说，回调函数不仅可以用于异步调用，一般同步的场景也可以用回调。在同步调用下，回调函数一般是最后执行的。而异步调用下，可能一段时间后执行或不执行（未达到执行的条件）。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.3 *\/\n\/******************同步回调******************\/\nvar fun1 = function(callback) {\n    \/\/do something\n    console.log(\x26quot;before callback\x26quot;);\n    (callback \x26amp;\x26amp; typeof(callback) === \x27function\x27) \x26amp;\x26amp; callback();\n    console.log(\x26quot;after callback\x26quot;);\n}\nvar fun2 = function(param) {\n    \/\/do something\n    var start = new Date();\n    while((new Date() - start) \x3c 3000) { \/\/delay 3s\n    }\n    console.log(\x26quot;I\x27m callback\x26quot;);\n}\nfun1(fun2);\n\n-------output--------\nbefore callback\n\/\/after 3s\nI’m callback\nafter callback\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.3 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/******************同步回调******************\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fun1 = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecallback\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22before callback\x22\x3c\/span\x3e);\n    (callback \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e(callback) === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) \x26amp;\x26amp; callback();\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22after callback\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fun2 = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eparam\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e start = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e();\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e((\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e() - start) \x26lt; \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e) { \x3cspan class=\x22hljs-comment\x22\x3e\/\/delay 3s\x3c\/span\x3e\n    }\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22I\x27m callback\x22\x3c\/span\x3e);\n}\nfun1(fun2);\n\n-------output--------\nbefore callback\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/after 3s\x3c\/span\x3e\nI’m callback\nafter callback\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于是同步回调，会阻塞后面的代码，如果fun2是个死循环，后面的代码就不执行了。\x3c\/p\x3e\n\x3cp\x3e上一小节中\x3ccode\x3esetTimeout\x3c\/code\x3e就是常见的异步回调，另外常见的异步回调即ajax请求。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.4 *\/\n\/******************异步回调******************\/\nfunction request(url, param, successFun, errorFun) {\n    $.ajax({\n        type: \x27GET\x27,\n        url: url,\n        param: param,\n        async: true,    \/\/默认为true,即异步请求；false为同步请求\n        success: successFun,\n        error: errorFun\n    });\n}\nrequest(\x27test.html\x27, \x27\x27, function(data) {\n    \/\/请求成功后的回调函数，通常是对请求回来的数据进行处理\n    console.log(\x27请求成功啦, 这是返回的数据:\x27, data);\n},function(error) {\n    console.log(\x27sorry, 请求失败了, 这是失败信息:\x27, error);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.4 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/******************异步回调******************\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, param, successFun, errorFun\x3c\/span\x3e) \x3c\/span\x3e{\n    $.ajax({\n        \x3cspan class=\x22hljs-attr\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eurl\x3c\/span\x3e: url,\n        \x3cspan class=\x22hljs-attr\x22\x3eparam\x3c\/span\x3e: param,\n        \x3cspan class=\x22hljs-attr\x22\x3easync\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/默认为true,即异步请求；false为同步请求\x3c\/span\x3e\n        success: successFun,\n        \x3cspan class=\x22hljs-attr\x22\x3eerror\x3c\/span\x3e: errorFun\n    });\n}\nrequest(\x3cspan class=\x22hljs-string\x22\x3e\x27test.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/请求成功后的回调函数，通常是对请求回来的数据进行处理\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27请求成功啦, 这是返回的数据:\x27\x3c\/span\x3e, data);\n},\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27sorry, 请求失败了, 这是失败信息:\x27\x3c\/span\x3e, error);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader6\x22\x3e2.2 为什么使用Promise\x3c\/h2\x3e\n\x3cp\x3e说完了以上基本概念，我们就可以继续学习\x3ccode\x3ePromise\x3c\/code\x3e了。\x3cbr\x3e上面提到，\x3ccode\x3ePromise\x3c\/code\x3e对象是用于异步操作的。既然我们可以使用异步回调来进行异步操作，为什么还要引入一个\x3ccode\x3ePromise\x3c\/code\x3e新概念，还要花时间学习它呢？不要着急，下面就来谈谈\x3ccode\x3ePromise\x3c\/code\x3e的过人之处。\x3cbr\x3e我们先看看下面的demo，利用\x3ccode\x3ePromise\x3c\/code\x3e改写例2.4的异步回调。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.5 *\/\nfunction sendRequest(url, param) {\n    return new Promise(function (resolve, reject) {\n        request(url, param, resolve, reject);\n    });\n}\n\nsendRequest(\x27test.html\x27, \x27\x27).then(function(data) {\n    \/\/异步操作成功后的回调\n    console.log(\x27请求成功啦, 这是返回的数据:\x27, data);\n}, function(error) {\n    \/\/异步操作失败后的回调\n    console.log(\x27sorry, 请求失败了, 这是失败信息:\x27, error);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.5 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esendRequest\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eurl, param\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n        request(url, param, resolve, reject);\n    });\n}\n\nsendRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27test.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/异步操作成功后的回调\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27请求成功啦, 这是返回的数据:\x27\x3c\/span\x3e, data);\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/异步操作失败后的回调\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27sorry, 请求失败了, 这是失败信息:\x27\x3c\/span\x3e, error);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这么一看，并没有什么区别，还比上面的异步回调复杂，得先新建Promise再定义其回调。其实，\x3ccode\x3ePromise\x3c\/code\x3e的真正强大之处在于它的多重链式调用，可以避免层层嵌套回调。如果我们在第一次ajax请求后，还要用它返回的结果再次请求呢？\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.6 *\/\nrequest(\x27test1.html\x27, \x27\x27, function(data1) {\n    console.log(\x27第一次请求成功, 这是返回的数据:\x27, data1);\n    request(\x27test2.html\x27, data1, function (data2) {\n        console.log(\x27第二次请求成功, 这是返回的数据:\x27, data2);\n        request(\x27test3.html\x27, data2, function (data3) {\n            console.log(\x27第三次请求成功, 这是返回的数据:\x27, data3);\n            \/\/request... 继续请求\n        }, function(error3) {\n            console.log(\x27第三次请求失败, 这是失败信息:\x27, error3);\n        });\n    }, function(error2) {\n        console.log(\x27第二次请求失败, 这是失败信息:\x27, error2);\n    });\n}, function(error1) {\n    console.log(\x27第一次请求失败, 这是失败信息:\x27, error1);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.6 *\/\x3c\/span\x3e\nrequest(\x3cspan class=\x22hljs-string\x22\x3e\x27test1.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata1\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第一次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data1);\n    request(\x3cspan class=\x22hljs-string\x22\x3e\x27test2.html\x27\x3c\/span\x3e, data1, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata2\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第二次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data2);\n        request(\x3cspan class=\x22hljs-string\x22\x3e\x27test3.html\x27\x3c\/span\x3e, data2, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata3\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第三次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data3);\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/request... 继续请求\x3c\/span\x3e\n        }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror3\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第三次请求失败, 这是失败信息:\x27\x3c\/span\x3e, error3);\n        });\n    }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror2\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第二次请求失败, 这是失败信息:\x27\x3c\/span\x3e, error2);\n    });\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror1\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第一次请求失败, 这是失败信息:\x27\x3c\/span\x3e, error1);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e以上出现了多层回调嵌套，有种晕头转向的感觉。这也就是我们常说的厄运回调金字塔（Pyramid of Doom），编程体验十分不好。而使用\x3ccode\x3ePromise\x3c\/code\x3e，我们就可以利用\x3ccode\x3ethen\x3c\/code\x3e进行「链式回调」，将异步操作以同步操作的流程表示出来。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例2.7 *\/\nsendRequest(\x27test1.html\x27, \x27\x27).then(function(data1) {\n    console.log(\x27第一次请求成功, 这是返回的数据:\x27, data1);\n}).then(function(data2) {\n    console.log(\x27第二次请求成功, 这是返回的数据:\x27, data2);\n}).then(function(data3) {\n    console.log(\x27第三次请求成功, 这是返回的数据:\x27, data3);\n}).catch(function(error) {\n    \/\/用catch捕捉前面的错误\n    console.log(\x27sorry, 请求失败了, 这是失败信息:\x27, error);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例2.7 *\/\x3c\/span\x3e\nsendRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27test1.html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata1\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第一次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data1);\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata2\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第二次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data2);\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata3\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27第三次请求成功, 这是返回的数据:\x27\x3c\/span\x3e, data3);\n}).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/用catch捕捉前面的错误\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27sorry, 请求失败了, 这是失败信息:\x27\x3c\/span\x3e, error);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e是不是明显清晰很多？孰优孰略也无需多说了吧~下面就让我们真正进入\x3ccode\x3ePromise\x3c\/code\x3e的学习。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader7\x22\x3e三 Promise的基本用法\x3c\/h1\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e3.1 基本用法\x3c\/h2\x3e\n\x3cp\x3e上一小节我们认识了\x3ccode\x3epromise\x3c\/code\x3e长什么样，但对它用到的\x3ccode\x3eresolve\x3c\/code\x3e、\x3ccode\x3ereject\x3c\/code\x3e、\x3ccode\x3ethen\x3c\/code\x3e、\x3ccode\x3ecatch\x3c\/code\x3e想必还不理解。下面我们一步步学习。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3ePromise\x3c\/code\x3e对象代表一个未完成、但预计将来会完成的操作。\x3cbr\x3e它有以下三种状态：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3ccode\x3epending\x3c\/code\x3e：初始值，不是fulfilled，也不是rejected\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3efulfilled\x3c\/code\x3e：代表操作成功\x3c\/li\x3e\n\x3cli\x3e\n\x3ccode\x3erejected\x3c\/code\x3e：代表操作失败\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3ePromise\x3c\/code\x3e有两种状态改变的方式，既可以从\x3ccode\x3epending\x3c\/code\x3e转变为\x3ccode\x3efulfilled\x3c\/code\x3e，也可以从\x3ccode\x3epending\x3c\/code\x3e转变为\x3ccode\x3erejected\x3c\/code\x3e。一旦状态改变，就「凝固」了，会一直保持这个状态，不会再发生变化。当状态发生变化，\x3ccode\x3epromise.then\x3c\/code\x3e绑定的函数就会被调用。\x3cbr\x3e注意：\x3ccode\x3ePromise\x3c\/code\x3e一旦新建就会「立即执行」，无法取消。这也是它的缺点之一。\x3cbr\x3e下面就通过例子进一步讲解。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.1 *\/\n\/\/构建Promise\nvar promise = new Promise(function (resolve, reject) {\n    if (\/* 异步操作成功 *\/) {\n        resolve(data);\n    } else {\n        \/* 异步操作失败 *\/\n        reject(error);\n    }\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.1 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/构建Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-comment\x22\x3e\/* 异步操作成功 *\/\x3c\/span\x3e) {\n        resolve(data);\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/* 异步操作失败 *\/\x3c\/span\x3e\n        reject(error);\n    }\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e类似构建对象，我们使用\x3ccode\x3enew\x3c\/code\x3e来构建一个\x3ccode\x3ePromise\x3c\/code\x3e。\x3ccode\x3ePromise\x3c\/code\x3e接受一个「函数」作为参数，该函数的两个参数分别是\x3ccode\x3eresolve\x3c\/code\x3e和\x3ccode\x3ereject\x3c\/code\x3e。这两个函数就是就是「回调函数」，由JavaScript引擎提供。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3eresolve\x3c\/code\x3e函数的作用：在异步操作成功时调用，并将异步操作的结果，作为参数传递出去； \x3cbr\x3e\x3ccode\x3ereject\x3c\/code\x3e函数的作用：在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去。\x3c\/p\x3e\n\x3cp\x3ePromise实例生成以后，可以用\x3ccode\x3ethen\x3c\/code\x3e方法指定\x3ccode\x3eresolved\x3c\/code\x3e状态和\x3ccode\x3ereject\x3c\/code\x3e状态的回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 接例3.1 *\/\npromise.then(onFulfilled, onRejected);\n\npromise.then(function(data) {\n  \/\/ do something when success\n}, function(error) {\n  \/\/ do something when failure\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 接例3.1 *\/\x3c\/span\x3e\npromise.then(onFulfilled, onRejected);\n\npromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something when success\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ do something when failure\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ethen\x3c\/code\x3e方法会返回一个Promise。它有两个参数，分别为Promise从\x3ccode\x3epending\x3c\/code\x3e变为\x3ccode\x3efulfilled\x3c\/code\x3e和\x3ccode\x3erejected\x3c\/code\x3e时的回调函数（第二个参数非必选）。这两个函数都\x3cstrong\x3e接受Promise对象传出的值作为参数\x3c\/strong\x3e。\x3cbr\x3e简单来说，\x3ccode\x3ethen\x3c\/code\x3e就是定义\x3ccode\x3eresolve\x3c\/code\x3e和\x3ccode\x3ereject\x3c\/code\x3e函数的，其\x3ccode\x3eresolve\x3c\/code\x3e参数相当于：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function resolveFun(data) {\n    \/\/data为promise传出的值\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eresolveFun\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/data为promise传出的值\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而新建Promise中的\x27resolve(data)\x27，则相当于执行resolveFun函数。\x3cbr\x3ePromise新建后就会立即执行。而\x3ccode\x3ethen\x3c\/code\x3e方法中指定的回调函数，将\x3cstrong\x3e在当前脚本所有同步任务执行完才会执行\x3c\/strong\x3e。如下例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.2 *\/\nvar promise = new Promise(function(resolve, reject) {\n  console.log(\x27before resolved\x27);\n  resolve();\n  console.log(\x27after resolved\x27);\n});\n\npromise.then(function() {\n  console.log(\x27resolved\x27);\n});\n\nconsole.log(\x27outer\x27);\n\n-------output-------\nbefore resolved\nafter resolved\nouter\nresolved\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.2 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27before resolved\x27\x3c\/span\x3e);\n  resolve();\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27after resolved\x27\x3c\/span\x3e);\n});\n\npromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27resolved\x27\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27outer\x27\x3c\/span\x3e);\n\n-------output-------\nbefore resolved\nafter resolved\nouter\nresolved\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于\x3ccode\x3eresolve\x3c\/code\x3e指定的是异步操作成功后的回调函数，它需要等所有同步代码执行后才会执行，因此最后打印\x27resolved\x27，这个和例2.2是一样的道理。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e3.2 基本API\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e.then()\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22语法：Promise.prototype.then(onFulfilled, onRejected)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elm\x22\x3e\x3ccode\x3e语法：\x3cspan class=\x22hljs-type\x22\x3ePromise\x3c\/span\x3e.proto\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e.then(onFulfilled, onRejected)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对promise添加\x3ccode\x3eonFulfilled\x3c\/code\x3e和\x3ccode\x3eonRejected\x3c\/code\x3e回调，并返回的是一个新的Promise实例（不是原来那个Promise实例），且返回值将作为参数传入这个新Promise的\x3ccode\x3eresolve\x3c\/code\x3e函数。\x3c\/p\x3e\n\x3cp\x3e因此，我们可以使用链式写法，如上文的例2.7。由于前一个回调函数，返回的还是一个Promise对象（即有异步操作），这时后一个回调函数，就会等待该Promise对象的\x3cstrong\x3e状态发生变化\x3c\/strong\x3e，才会被调用。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e.catch()\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22语法：Promise.prototype.catch(onRejected)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs elm\x22\x3e\x3ccode\x3e语法：\x3cspan class=\x22hljs-type\x22\x3ePromise\x3c\/span\x3e.proto\x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e.catch(onRejected)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法是\x3ccode\x3e.then(undefined, onRejected)\x3c\/code\x3e的别名，用于指定发生错误时的回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.3 *\/\npromise.then(function(data) {\n    console.log(\x27success\x27);\n}).catch(function(error) {\n    console.log(\x27error\x27, error);\n});\n\n\/*******等同于*******\/\npromise.then(function(data) {\n    console.log(\x27success\x27);\n}).then(undefined, function(error) {\n    console.log(\x27error\x27, error);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.3 *\/\x3c\/span\x3e\npromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e);\n}).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, error);\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*******等同于*******\/\x3c\/span\x3e\npromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e);\n}).then(\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, error);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.4 *\/\nvar promise = new Promise(function (resolve, reject) {\n    throw new Error(\x27test\x27);\n});\n\/*******等同于*******\/\nvar promise = new Promise(function (resolve, reject) {\n    reject(new Error(\x27test\x27));\n});\n\n\/\/用catch捕获\npromise.catch(function (error) {\n    console.log(error);\n});\n-------output-------\nError: test\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.4 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27test\x27\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/*******等同于*******\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    reject(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27test\x27\x3c\/span\x3e));\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/用catch捕获\x3c\/span\x3e\npromise.catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(error);\n});\n-------output-------\n\x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e: test\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从上例可以看出，\x3ccode\x3ereject\x3c\/code\x3e方法的作用，等同于抛错。\x3c\/p\x3e\n\x3cp\x3epromise对象的错误，会一直向后传递，直到被捕获。即错误总会被下一个\x3ccode\x3ecatch\x3c\/code\x3e所捕获。\x3ccode\x3ethen\x3c\/code\x3e方法指定的回调函数，若抛出错误，也会被下一个\x3ccode\x3ecatch\x3c\/code\x3e捕获。\x3ccode\x3ecatch\x3c\/code\x3e中也能抛错，则需要后面的\x3ccode\x3ecatch\x3c\/code\x3e来捕获。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.5 *\/\nsendRequest(\x27test.html\x27).then(function(data1) {\n    \/\/do something\n}).then(function (data2) {\n    \/\/do something\n}).catch(function (error) {\n    \/\/处理前面三个Promise产生的错误\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.5 *\/\x3c\/span\x3e\nsendRequest(\x3cspan class=\x22hljs-string\x22\x3e\x27test.html\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata1\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata2\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n}).catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/处理前面三个Promise产生的错误\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e上文提到过，promise状态一旦改变就会凝固，不会再改变。因此promise一旦\x3ccode\x3efulfilled\x3c\/code\x3e了，再抛错，也不会变为\x3ccode\x3erejected\x3c\/code\x3e，就不会被\x3ccode\x3ecatch\x3c\/code\x3e了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.6 *\/\nvar promise = new Promise(function(resolve, reject) {\n  resolve();\n  throw \x27error\x27;\n});\n\npromise.catch(function(e) {\n   console.log(e);      \/\/This is never called\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.6 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n  resolve();\n  \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e;\n});\n\npromise.catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e);      \x3cspan class=\x22hljs-comment\x22\x3e\/\/This is never called\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果没有使用\x3ccode\x3ecatch\x3c\/code\x3e方法指定处理错误的回调函数，Promise对象抛出的错误不会传递到外层代码，即不会有任何反应（Chrome会抛错），这是Promise的另一个缺点。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.7 *\/\nvar promise = new Promise(function (resolve, reject) {\n    resolve(x);\n});\npromise.then(function (data) {\n    console.log(data);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.7 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    resolve(x);\n});\npromise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(data);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDEBJ?w=1466\x26amp;h=286\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDEBJ?w=1466\x26amp;h=286\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDEZp?w=530\x26amp;h=151\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDEZp?w=530\x26amp;h=151\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDE0o?w=388\x26amp;h=145\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDE0o?w=388\x26amp;h=145\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如图所示，只有Chrome会抛错，且promise状态变为\x3ccode\x3erejected\x3c\/code\x3e，Firefox和Safari中错误不会被捕获，也不会传递到外层代码，最后没有任何输出，promise状态也变为\x3ccode\x3erejected\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e.all()\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22语法：Promise.all(iterable)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ada\x22\x3e\x3ccode\x3e语法：Promise.\x3cspan class=\x22hljs-keyword\x22\x3eall\x3c\/span\x3e(iterable)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法用于将多个Promise实例，包装成一个新的Promise实例。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var p = Promise.all([p1, p2, p3]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([p1, p2, p3]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePromise.all\x3c\/code\x3e方法接受一个数组（或具有Iterator接口）作参数，数组中的对象（p1、p2、p3）均为promise实例（如果不是一个promise，该项会被用\x3ccode\x3ePromise.resolve\x3c\/code\x3e转换为一个promise)。它的状态由这三个promise实例决定。\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e当p1, p2, p3状态都变为\x3ccode\x3efulfilled\x3c\/code\x3e，p的状态才会变为\x3ccode\x3efulfilled\x3c\/code\x3e，并将三个promise返回的结果，按参数的顺序（而不是 \x3ccode\x3eresolved\x3c\/code\x3e的顺序）存入数组，传给p的回调函数，如例3.8。\x3c\/li\x3e\n\x3cli\x3e当p1, p2, p3其中之一状态变为\x3ccode\x3erejected\x3c\/code\x3e，p的状态也会变为\x3ccode\x3erejected\x3c\/code\x3e，并把第一个被\x3ccode\x3ereject\x3c\/code\x3e的promise的返回值，传给p的回调函数，如例3.9。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.8 *\/\nvar p1 = new Promise(function (resolve, reject) {\n    setTimeout(resolve, 3000, \x26quot;first\x26quot;);\n});\nvar p2 = new Promise(function (resolve, reject) {\n    resolve(\x27second\x27);\n});\nvar p3 = new Promise((resolve, reject) =\x3e {\n  setTimeout(resolve, 1000, \x26quot;third\x26quot;);\n}); \n\nPromise.all([p1, p2, p3]).then(function(values) { \n  console.log(values); \n});\n\n-------output-------\n\/\/约 3s 后\n[\x26quot;first\x26quot;, \x26quot;second\x26quot;, \x26quot;third\x26quot;] \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.8 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22first\x22\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27second\x27\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p3 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22third\x22\x3c\/span\x3e);\n}); \n\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([p1, p2, p3]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalues\x3c\/span\x3e) \x3c\/span\x3e{ \n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(values); \n});\n\n-------output-------\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/约 3s 后\x3c\/span\x3e\n[\x3cspan class=\x22hljs-string\x22\x3e\x22first\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22second\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22third\x22\x3c\/span\x3e] \x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.9 *\/\nvar p1 = new Promise((resolve, reject) =\x3e { \n  setTimeout(resolve, 1000, \x26quot;one\x26quot;); \n}); \nvar p2 = new Promise((resolve, reject) =\x3e { \n  setTimeout(reject, 2000, \x26quot;two\x26quot;); \n});\nvar p3 = new Promise((resolve, reject) =\x3e {\n  reject(\x26quot;three\x26quot;);\n});\n\nPromise.all([p1, p2, p3]).then(function (value) {\n    console.log(\x27resolve\x27, value);\n}, function (error) {\n    console.log(\x27reject\x27, error);    \/\/ =\x3e reject three\n});\n\n-------output-------\nreject three\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.9 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e { \n  setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22one\x22\x3c\/span\x3e); \n}); \n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e { \n  setTimeout(reject, \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22two\x22\x3c\/span\x3e); \n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p3 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  reject(\x3cspan class=\x22hljs-string\x22\x3e\x22three\x22\x3c\/span\x3e);\n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([p1, p2, p3]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27resolve\x27\x3c\/span\x3e, value);\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27reject\x27\x3c\/span\x3e, error);    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; reject three\x3c\/span\x3e\n});\n\n-------output-------\nreject three\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这多个 promise 是同时开始、并行执行的，而不是顺序执行。从下面例子可以看出。如果一个个执行，那至少需要 1\x2b32\x2b64\x2b128\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.10 *\/\nfunction timerPromisefy(delay) {\n    return new Promise(function (resolve) {\n        setTimeout(function () {\n            resolve(delay);\n        }, delay);\n    });\n}\nvar startDate = Date.now();\n\nPromise.all([\n    timerPromisefy(1),\n    timerPromisefy(32),\n    timerPromisefy(64),\n    timerPromisefy(128)\n]).then(function (values) {\n    console.log(Date.now() - startDate \x2b \x27ms\x27);\n    console.log(values);\n});\n-------output-------\n133ms       \/\/不一定，但大于128ms\n[1,32,64,128]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.10 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etimerPromisefy\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edelay\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n        setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            resolve(delay);\n        }, delay);\n    });\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e startDate = \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now();\n\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.all([\n    timerPromisefy(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e),\n    timerPromisefy(\x3cspan class=\x22hljs-number\x22\x3e32\x3c\/span\x3e),\n    timerPromisefy(\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e),\n    timerPromisefy(\x3cspan class=\x22hljs-number\x22\x3e128\x3c\/span\x3e)\n]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalues\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e.now() - startDate \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27ms\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(values);\n});\n-------output-------\n\x3cspan class=\x22hljs-number\x22\x3e133\x3c\/span\x3ems       \x3cspan class=\x22hljs-comment\x22\x3e\/\/不一定，但大于128ms\x3c\/span\x3e\n[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e32\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e64\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e128\x3c\/span\x3e]\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader13\x22\x3e.race()\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22语法：Promise.race(iterable)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs armasm\x22\x3e\x3ccode\x3e语法：Promise.race(\x3cspan class=\x22hljs-keyword\x22\x3eiterable)\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e该方法同样是将多个Promise实例，包装成一个新的Promise实例。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var p = Promise.race([p1, p2, p3]);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.race([p1, p2, p3]);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePromise.race\x3c\/code\x3e方法同样接受一个数组（或具有Iterator接口）作参数。当p1, p2, p3中有一个实例的状态发生改变（变为\x3ccode\x3efulfilled\x3c\/code\x3e或\x3ccode\x3erejected\x3c\/code\x3e），p的状态就跟着改变。并把第一个改变状态的promise的返回值，传给p的回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.11 *\/\nvar p1 = new Promise(function(resolve, reject) { \n    setTimeout(reject, 500, \x26quot;one\x26quot;); \n});\nvar p2 = new Promise(function(resolve, reject) { \n    setTimeout(resolve, 100, \x26quot;two\x26quot;); \n});\n\nPromise.race([p1, p2]).then(function(value) {\n    console.log(\x27resolve\x27, value); \n}, function(error) {\n    \/\/not called\n    console.log(\x27reject\x27, error); \n});\n-------output-------\nresolve two\n\nvar p3 = new Promise(function(resolve, reject) { \n    setTimeout(resolve, 500, \x26quot;three\x26quot;);\n});\nvar p4 = new Promise(function(resolve, reject) { \n    setTimeout(reject, 100, \x26quot;four\x26quot;); \n});\n\nPromise.race([p3, p4]).then(function(value) {\n    \/\/not called\n    console.log(\x27resolve\x27, value);              \n}, function(error) {\n    console.log(\x27reject\x27, error); \n});\n-------output-------\nreject four\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.11 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{ \n    setTimeout(reject, \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22one\x22\x3c\/span\x3e); \n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{ \n    setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22two\x22\x3c\/span\x3e); \n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.race([p1, p2]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27resolve\x27\x3c\/span\x3e, value); \n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27reject\x27\x3c\/span\x3e, error); \n});\n-------output-------\nresolve two\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p3 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{ \n    setTimeout(resolve, \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22three\x22\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p4 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{ \n    setTimeout(reject, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22four\x22\x3c\/span\x3e); \n});\n\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.race([p3, p4]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27resolve\x27\x3c\/span\x3e, value);              \n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27reject\x27\x3c\/span\x3e, error); \n});\n-------output-------\nreject four\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在第一个promise对象变为resolve后，并不会取消其他promise对象的执行，如下例\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.12 *\/\nvar fastPromise = new Promise(function (resolve) {\n    setTimeout(function () {\n        console.log(\x27fastPromise\x27);\n        resolve(\x27resolve fastPromise\x27);\n    }, 100);\n});\nvar slowPromise = new Promise(function (resolve) {\n    setTimeout(function () {\n        console.log(\x27slowPromise\x27);\n        resolve(\x27resolve slowPromise\x27);\n    }, 1000);\n});\n\/\/ 第一个promise变为resolve后程序停止\nPromise.race([fastPromise, slowPromise]).then(function (value) {\n    console.log(value);    \/\/ =\x3e resolve fastPromise\n});\n-------output-------\nfastPromise\nresolve fastPromise\nslowPromise     \/\/仍会执行\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.12 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fastPromise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27fastPromise\x27\x3c\/span\x3e);\n        resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27resolve fastPromise\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e slowPromise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27slowPromise\x27\x3c\/span\x3e);\n        resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27resolve slowPromise\x27\x3c\/span\x3e);\n    }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 第一个promise变为resolve后程序停止\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.race([fastPromise, slowPromise]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; resolve fastPromise\x3c\/span\x3e\n});\n-------output-------\nfastPromise\nresolve fastPromise\nslowPromise     \x3cspan class=\x22hljs-comment\x22\x3e\/\/仍会执行\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader14\x22\x3e.resolve()\x3c\/h3\x3e\n\x3cp\x3e语法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Promise.resolve(value);\nPromise.resolve(promise);\nPromise.resolve(thenable);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(value);\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(promise);\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(thenable);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e它可以看做\x3ccode\x3enew Promise()\x3c\/code\x3e的快捷方式。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Promise.resolve(\x27Success\x27);\n\n\/*******等同于*******\/\nnew Promise(function (resolve) {\n    resolve(\x27Success\x27);\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27Success\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*******等同于*******\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n    resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27Success\x27\x3c\/span\x3e);\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码会让这个Promise对象立即进入\x3ccode\x3eresolved\x3c\/code\x3e状态，并将结果\x3ccode\x3esuccess\x3c\/code\x3e传递给\x3ccode\x3ethen\x3c\/code\x3e指定的\x3ccode\x3eonFulfilled\x3c\/code\x3e回调函数。由于\x3ccode\x3ePromise.resolve()\x3c\/code\x3e也是返回Promise对象，因此可以用\x3ccode\x3e.then()\x3c\/code\x3e处理其返回值。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.13 *\/\nPromise.resolve(\x27success\x27).then(function (value) {\n    console.log(value);\n});\n-------output-------\nSuccess\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.13 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27success\x27\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);\n});\n-------output-------\nSuccess\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.14 *\/\n\/\/Resolving an array\nPromise.resolve([1,2,3]).then(function(value) {\n  console.log(value[0]);    \/\/ =\x3e 1\n});\n\n\/\/Resolving a Promise\nvar p1 = Promise.resolve(\x27this is p1\x27);\nvar p2 = Promise.resolve(p1);\np2.then(function (value) {\n    console.log(value);     \/\/ =\x3e this is p1\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.14 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/Resolving an array\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve([\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e]).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]);    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; 1\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/Resolving a Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(\x3cspan class=\x22hljs-string\x22\x3e\x27this is p1\x27\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(p1);\np2.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; this is p1\x3c\/span\x3e\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ePromise.resolve()\x3c\/code\x3e的另一个作用就是将\x3ccode\x3ethenable\x3c\/code\x3e对象（即带有\x3ccode\x3ethen\x3c\/code\x3e方法的对象）转换为promise对象。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.15 *\/\nvar p1 = Promise.resolve({ \n    then: function (resolve, reject) { \n        resolve(\x26quot;this is an thenable object!\x26quot;);\n    }\n});\nconsole.log(p1 instanceof Promise);     \/\/ =\x3e true\n\np1.then(function(value) {\n    console.log(value);     \/\/ =\x3e this is an thenable object!\n  }, function(e) {\n    \/\/not called\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.15 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve({ \n    \x3cspan class=\x22hljs-attr\x22\x3ethen\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{ \n        resolve(\x3cspan class=\x22hljs-string\x22\x3e\x22this is an thenable object!\x22\x3c\/span\x3e);\n    }\n});\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(p1 \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e);     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; true\x3c\/span\x3e\n\np1.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; this is an thenable object!\x3c\/span\x3e\n  }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再看下面两个例子，无论是在什么时候抛异常，只要promise状态变成\x3ccode\x3eresolved\x3c\/code\x3e或\x3ccode\x3erejected\x3c\/code\x3e，状态不会再改变，这和新建promise是一样的。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例3.16 *\/\n\/\/在回调函数前抛异常\nvar p1 = { \n    then: function(resolve) {\n      throw new Error(\x26quot;error\x26quot;);\n      resolve(\x26quot;Resolved\x26quot;);\n    }\n};\n\nvar p2 = Promise.resolve(p1);\np2.then(function(value) {\n    \/\/not called\n}, function(error) {\n    console.log(error);       \/\/ =\x3e Error: error\n});\n\n\/\/在回调函数后抛异常\nvar p3 = { \n    then: function(resolve) {\n        resolve(\x26quot;Resolved\x26quot;);\n        throw new Error(\x26quot;error\x26quot;);\n    }\n};\n\nvar p4 = Promise.resolve(p3);\np4.then(function(value) {\n    console.log(value);     \/\/ =\x3e Resolved\n}, function(error) {\n    \/\/not called\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例3.16 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/在回调函数前抛异常\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = { \n    \x3cspan class=\x22hljs-attr\x22\x3ethen\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22error\x22\x3c\/span\x3e);\n      resolve(\x3cspan class=\x22hljs-string\x22\x3e\x22Resolved\x22\x3c\/span\x3e);\n    }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(p1);\np2.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(error);       \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; Error: error\x3c\/span\x3e\n});\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/在回调函数后抛异常\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p3 = { \n    \x3cspan class=\x22hljs-attr\x22\x3ethen\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n        resolve(\x3cspan class=\x22hljs-string\x22\x3e\x22Resolved\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x22error\x22\x3c\/span\x3e);\n    }\n};\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p4 = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(p3);\np4.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ =\x26gt; Resolved\x3c\/span\x3e\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader15\x22\x3e.reject()\x3c\/h3\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22语法：Promise.reject(reason)\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e语法：\x3cspan class=\x22hljs-selector-tag\x22\x3ePromise\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.reject\x3c\/span\x3e(\x3cspan class=\x22hljs-selector-tag\x22\x3ereason\x3c\/span\x3e)\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个方法和上述的\x3ccode\x3ePromise.resolve()\x3c\/code\x3e类似，它也是\x3ccode\x3enew Promise()\x3c\/code\x3e的快捷方式。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22Promise.reject(new Error(\x27error\x27));\n\n\/*******等同于*******\/\nnew Promise(function (resolve, reject) {\n    reject(new Error(\x27error\x27));\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.reject(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e));\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/*******等同于*******\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    reject(\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e));\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码会让这个Promise对象立即进入\x3ccode\x3erejected\x3c\/code\x3e状态，并将错误对象传递给\x3ccode\x3ethen\x3c\/code\x3e指定的\x3ccode\x3eonRejected\x3c\/code\x3e回调函数。\x3c\/p\x3e\n\x3ch1 id=\x22articleHeader16\x22\x3e四 Promise常见问题\x3c\/h1\x3e\n\x3cp\x3e经过上一章的学习，相信大家已经学会使用\x3ccode\x3ePromise\x3c\/code\x3e。\x3cbr\x3e总结一下创建promise的流程：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e使用\x3ccode\x3enew Promise(fn)\x3c\/code\x3e或者它的快捷方式\x3ccode\x3ePromise.resolve()\x3c\/code\x3e、\x3ccode\x3ePromise.reject()\x3c\/code\x3e，返回一个promise对象\x3c\/li\x3e\n\x3cli\x3e在\x3ccode\x3efn\x3c\/code\x3e中指定异步的处理\x3cbr\x3e   处理结果正常，调用\x3ccode\x3eresolve\x3c\/code\x3e\x3cbr\x3e   处理结果错误，调用\x3ccode\x3ereject\x3c\/code\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e如果使用ES6的箭头函数，将会使写法更加简单清晰。\x3c\/p\x3e\n\x3cp\x3e这一章节，将会用例子的形式，以说明promise使用过程中的注意点及容易犯的错误。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e情景1：\x3c\/strong\x3ereject 和 catch 的区别\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3epromise.then(onFulfilled, onRejected)\x3cbr\x3e   在\x3ccode\x3eonFulfilled\x3c\/code\x3e中发生异常的话，在\x3ccode\x3eonRejected\x3c\/code\x3e中是捕获不到这个异常的。\x3c\/li\x3e\n\x3cli\x3epromise.then(onFulfilled).catch(onRejected)\x3cbr\x3e\x3ccode\x3e.then\x3c\/code\x3e中产生的异常能在\x3ccode\x3e.catch\x3c\/code\x3e中捕获\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e一般情况，还是建议使用第二种，因为能捕获之前的所有异常。当然了，第二种的\x3ccode\x3e.catch()\x3c\/code\x3e也可以使用\x3ccode\x3e.then()\x3c\/code\x3e表示，它们本质上是没有区别的，\x3ccode\x3e.catch === .then(null, onRejected)\x3c\/code\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e情景2：\x3c\/strong\x3e如果在then中抛错，而没有对错误进行处理（即catch），那么会一直保持reject状态，直到catch了错误\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例4.1 *\/\nfunction taskA() {\n    console.log(x);\n    console.log(\x26quot;Task A\x26quot;);\n}\nfunction taskB() {\n    console.log(\x26quot;Task B\x26quot;);\n}\nfunction onRejected(error) {\n    console.log(\x26quot;Catch Error: A or B\x26quot;, error);\n}\nfunction finalTask() {\n    console.log(\x26quot;Final Task\x26quot;);\n}\nvar promise = Promise.resolve();\npromise\n    .then(taskA)\n    .then(taskB)\n    .catch(onRejected)\n    .then(finalTask);\n    \n-------output-------\nCatch Error: A or B,ReferenceError: x is not defined\nFinal Task\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例4.1 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etaskA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(x);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Task A\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etaskB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Task B\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonRejected\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Catch Error: A or B\x22\x3c\/span\x3e, error);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efinalTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Final Task\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve();\npromise\n    .then(taskA)\n    .then(taskB)\n    .catch(onRejected)\n    .then(finalTask);\n    \n-------output-------\nCatch \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e: A or B,\x3cspan class=\x22hljs-attr\x22\x3eReferenceError\x3c\/span\x3e: x is not defined\nFinal Task\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVDE12?w=720\x26amp;h=460\x22 src=\x22https:\/\/static.alili.tech\/img\/bVDE12?w=720\x26amp;h=460\x22 alt=\x22clipboard.png\x22 title=\x22clipboard.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e根据例4.1的输出结果及流程图，可以看出，A抛错时，会按照 taskA → onRejected → finalTask这个流程来处理。A抛错后，若没有对它进行处理，如例3.7，状态就会维持\x3ccode\x3erejected\x3c\/code\x3e，taskB不会执行，直到\x3ccode\x3ecatch\x3c\/code\x3e了错误。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例4.2 *\/\nfunction taskA() {\n    console.log(x);\n    console.log(\x26quot;Task A\x26quot;);\n}\nfunction taskB() {\n    console.log(\x26quot;Task B\x26quot;);\n}\nfunction onRejectedA(error) {\n    console.log(\x26quot;Catch Error: A\x26quot;, error);\n}\nfunction onRejectedB(error) {\n    console.log(\x26quot;Catch Error: B\x26quot;, error);\n}\nfunction finalTask() {\n    console.log(\x26quot;Final Task\x26quot;);\n}\nvar promise = Promise.resolve();\npromise\n    .then(taskA)\n    .catch(onRejectedA)\n    .then(taskB)\n    .catch(onRejectedB)\n    .then(finalTask);\n    \n-------output-------\nCatch Error: A ReferenceError: x is not defined\nTask B\nFinal Task\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例4.2 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etaskA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(x);\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Task A\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etaskB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Task B\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonRejectedA\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Catch Error: A\x22\x3c\/span\x3e, error);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eonRejectedB\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerror\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Catch Error: B\x22\x3c\/span\x3e, error);\n}\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efinalTask\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Final Task\x22\x3c\/span\x3e);\n}\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve();\npromise\n    .then(taskA)\n    .catch(onRejectedA)\n    .then(taskB)\n    .catch(onRejectedB)\n    .then(finalTask);\n    \n-------output-------\nCatch \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e: A \x3cspan class=\x22hljs-built_in\x22\x3eReferenceError\x3c\/span\x3e: x is not defined\nTask B\nFinal Task\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e将例4.2与4.1对比，在taskA后多了对A的处理，因此，A抛错时，会按照A会按照 taskA → onRejectedA → taskB → finalTask这个流程来处理，此时taskB是正常执行的。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e情景3：\x3c\/strong\x3e每次调用\x3ccode\x3ethen\x3c\/code\x3e都会返回一个新创建的promise对象，而\x3ccode\x3ethen\x3c\/code\x3e内部只是返回的数据\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例4.3 *\/\n\/\/方法1：对同一个promise对象同时调用 then 方法\nvar p1 = new Promise(function (resolve) {\n    resolve(100);\n});\np1.then(function (value) {\n    return value * 2;\n});\np1.then(function (value) {\n    return value * 2;\n});\np1.then(function (value) {\n    console.log(\x26quot;finally: \x26quot; \x2b value);\n});\n-------output-------\nfinally: 100\n\n\/\/方法2：对 then 进行 promise chain 方式进行调用\nvar p2 = new Promise(function (resolve) {\n    resolve(100);\n});\np2.then(function (value) {\n    return value * 2;\n}).then(function (value) {\n    return value * 2;\n}).then(function (value) {\n    console.log(\x26quot;finally: \x26quot; \x2b value);\n});\n-------output-------\nfinally: 400\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例4.3 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/方法1：对同一个promise对象同时调用 then 方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p1 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n    resolve(\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n});\np1.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n});\np1.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n});\np1.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22finally: \x22\x3c\/span\x3e \x2b value);\n});\n-------output-------\n\x3cspan class=\x22hljs-keyword\x22\x3efinally\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/方法2：对 then 进行 promise chain 方式进行调用\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e p2 = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve\x3c\/span\x3e) \x3c\/span\x3e{\n    resolve(\x3cspan class=\x22hljs-number\x22\x3e100\x3c\/span\x3e);\n});\np2.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value * \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e;\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22finally: \x22\x3c\/span\x3e \x2b value);\n});\n-------output-------\n\x3cspan class=\x22hljs-keyword\x22\x3efinally\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一种方法中，\x3ccode\x3ethen\x3c\/code\x3e的调用几乎是同时开始执行的，且传给每个then的value都是100，这种方法应当避免。方法二才是正确的链式调用。\x3cbr\x3e因此容易出现下面的错误写法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 例4.4 *\/\nfunction badAsyncCall(data) {\n    var promise = Promise.resolve(data);\n    promise.then(function(value) {\n        \/\/do something\n        return value \x2b 1;\n    });\n    return promise;\n}\nbadAsyncCall(10).then(function(value) {\n   console.log(value);          \/\/想要得到11，实际输出10\n});\n-------output-------\n10\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 例4.4 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebadAsyncCall\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(data);\n    promise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n    });\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e promise;\n}\nbadAsyncCall(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);          \x3cspan class=\x22hljs-comment\x22\x3e\/\/想要得到11，实际输出10\x3c\/span\x3e\n});\n-------output-------\n\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e正确的写法应该是：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* 改写例4.4 *\/\nfunction goodAsyncCall(data) {\n    var promise = Promise.resolve(data);\n    return promise.then(function(value) {\n        \/\/do something\n        return value \x2b 1;\n    });\n}\ngoodAsyncCall(10).then(function(value) {\n   console.log(value);\n});\n-------output-------\n11\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* 改写例4.4 *\/\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egoodAsyncCall\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(data);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e promise.then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/do something\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e value \x2b \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e;\n    });\n}\ngoodAsyncCall(\x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(value);\n});\n-------output-------\n\x3cspan class=\x22hljs-number\x22\x3e11\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e情景4：\x3c\/strong\x3e在异步回调中抛错，不会被\x3ccode\x3ecatch\x3c\/code\x3e到\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ Errors thrown inside asynchronous functions will act like uncaught errors\nvar promise = new Promise(function(resolve, reject) {\n  setTimeout(function() {\n    throw \x27Uncaught Exception!\x27;\n  }, 1000);\n});\n\npromise.catch(function(e) {\n  console.log(e);       \/\/This is never called\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ Errors thrown inside asynchronous functions will act like uncaught errors\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e promise = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27Uncaught Exception!\x27\x3c\/span\x3e;\n  }, \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e);\n});\n\npromise.catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(e);       \x3cspan class=\x22hljs-comment\x22\x3e\/\/This is never called\x3c\/span\x3e\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e情景5：\x3c\/strong\x3e promise状态变为\x3ccode\x3eresove\x3c\/code\x3e或\x3ccode\x3ereject\x3c\/code\x3e，就凝固了，不会再改变\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(1);\nnew Promise(function (resolve, reject){\n    reject();\n    setTimeout(function (){\n        resolve();            \/\/not called\n    }, 0);\n}).then(function(){\n    console.log(2);\n}, function(){\n    console.log(3);\n});\nconsole.log(4);\n\n-------output-------\n1\n4\n3\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e)\x3c\/span\x3e{\n    reject();\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n        resolve();            \x3cspan class=\x22hljs-comment\x22\x3e\/\/not called\x3c\/span\x3e\n    }, \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e);\n}, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e);\n});\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e);\n\n-------output-------\n\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\n\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch1 id=\x22articleHeader17\x22\x3e五 结语\x3c\/h1\x3e\n\x3cp\x3e关于\x3ccode\x3epromise\x3c\/code\x3e就先介绍到这边了，比较基础，有不足的地方欢迎指出，有更好的也欢迎补充~\x3c\/p\x3e\n\x3cp\x3e参考资料：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ca href=\x22https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/JavaScript\/Reference\/Global_Objects\/Promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/developer.mozilla.org...\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/liubin.org\/promises-book\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/liubin.org\/promises-book\/\x3c\/a\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ca href=\x22http:\/\/es6.ruanyifeng.com\/#docs\/promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/es6.ruanyifeng.com\/#do...\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>初探Promise</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007032448">https://segmentfault.com/a/1190000007032448</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/w0mbf48205i/" target="_blank">https://alili.tech/archive/w0mbf48205i/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>