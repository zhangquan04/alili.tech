<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="多页架构的前后端分离方案（webpack&#43;express）"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>多页架构的前后端分离方案（webpack&#43;express） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/kv3wg5qmxv/",
				"appid": "1613049289050283", 
				"title": "多页架构的前后端分离方案（webpack&#43;express） | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:09"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/uaqhtbr39kp/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/125vtbcpp02p/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&text=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&text=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&title=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&is_video=false&description=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&title=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&title=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&title=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fkv3wg5qmxv%2f&title=%e5%a4%9a%e9%a1%b5%e6%9e%b6%e6%9e%84%e7%9a%84%e5%89%8d%e5%90%8e%e7%ab%af%e5%88%86%e7%a6%bb%e6%96%b9%e6%a1%88%ef%bc%88webpack%2bexpress%ef%bc%89"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">多页架构的前后端分离方案（webpack&#43;express）</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cblockquote\x3e\x3cp\x3eSPA（单页架构）方案当下虽然很时髦，不过大多数的网站依旧选择多页或者单页\x2b多页的混合架构。使用 \x3ccode\x3eexpress\x3c\/code\x3e, \x3ccode\x3ewebpack\x3c\/code\x3e 本文低成本的实现了包含\x3ccode\x3e多页架构\x3c\/code\x3e，\x3ccode\x3e自动刷新\x3c\/code\x3e，\x3ccode\x3e前后端分离\x3c\/code\x3e 等概念\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e先上项目\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3egit repo\x3cbr\x3e\x3ca href=\x22https:\/\/github.com\/chaogao\/node-pages-webpack-hot\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enode-pages-webpack-hot\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e开发\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 npm install\n npm install supervisor -g\n npm run start # 开发环境，配置 hot reload\n npm run prod # 生产环境\n npm run build # 编译前端生产环境\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dockerfile\x22\x3e\x3ccode\x3e npm install\n npm install supervisor -g\n npm \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e start \x3cspan class=\x22hljs-comment\x22\x3e# 开发环境，配置 hot reload\x3c\/span\x3e\n\x3c\/span\x3e npm \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e prod \x3cspan class=\x22hljs-comment\x22\x3e# 生产环境\x3c\/span\x3e\n\x3c\/span\x3e npm \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e build \x3cspan class=\x22hljs-comment\x22\x3e# 编译前端生产环境\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eDEMO\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/upload-images.jianshu.io\/upload_images\/4780891-05b942ea9dec8ae4.gif?imageMogr2\/auto-orient\/strip\x22 src=\x22https:\/\/static.alili.techhttp:\/\/upload-images.jianshu.io\/upload_images\/4780891-05b942ea9dec8ae4.gif?imageMogr2\/auto-orient\/strip\x22 alt=\x22ezgif-2-dec6b379f7.gif\x22 title=\x22ezgif-2-dec6b379f7.gif\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eFE目录：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/upload-images.jianshu.io\/upload_images\/4780891-433b80a187d254e1.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 src=\x22https:\/\/static.alili.techhttp:\/\/upload-images.jianshu.io\/upload_images\/4780891-433b80a187d254e1.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 alt=\x22Paste_Image.png\x22 title=\x22Paste_Image.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eSERVER目录：\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/upload-images.jianshu.io\/upload_images\/4780891-abad5282dd1765e9.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 src=\x22https:\/\/static.alili.techhttp:\/\/upload-images.jianshu.io\/upload_images\/4780891-abad5282dd1765e9.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 alt=\x22Paste_Image.png\x22 title=\x22Paste_Image.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\x3cp\x3e为了不浪费你的时间，在阅读以下内容时需要有：\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.expressjs.com.cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eexpress\x3c\/a\x3e 基础知识，以及对 node 简单了解\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/webpack.js.org\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\x3c\/a\x3e 中级了解，本文采用 \x3ccode\x3ewebpack2\x3c\/code\x3e 实现\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e1. FE 端配置\x3c\/h2\x3e\n\x3cp\x3e前端配置需要实现的功能点：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e多页架构自动生成 \x3ccode\x3eentry\x3c\/code\x3e，并通过 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 生成每个页面的模板，且选择任意模板引擎需要实现 \x3ccode\x3elayout\x3c\/code\x3e 模板功能（本文使用\x3ccode\x3eswig\x3c\/code\x3e作为模板引擎）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e配置各种文件后缀的 loader\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用 \x3ccode\x3eHotModuleReplacementPlugin\x3c\/code\x3e 实现修改自刷新\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e1.1 自动分析entry\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cp\x3e规定每个页面必须有一个同名的 js 文件作为此页面的 entry ，目录深度可变，如下图，分解为两个 entry：\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22http:\/\/upload-images.jianshu.io\/upload_images\/4780891-2e1098fdf453b221.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 src=\x22https:\/\/static.alili.techhttp:\/\/upload-images.jianshu.io\/upload_images\/4780891-2e1098fdf453b221.png?imageMogr2\/auto-orient\/strip%7CimageView2\/2\/w\/1240\x22 alt=\x22Paste_Image.png\x22 title=\x22Paste_Image.png\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e为实现自动化获取，使用了 \x3ca href=\x22https:\/\/github.com\/isaacs\/node-glob\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eglob\x3c\/a\x3e 获取所有 \x3ccode\x3e.js\x3c\/code\x3e 文件，并判断是否有同名的 \x3ccode\x3e.html\x3c\/code\x3e ，如果有则生成一个 entry，如果是 dev 环境则多增加 \x3ccode\x3ehotMiddlewareScript \x3c\/code\x3e 模块\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ get all js files\n  let files = glob.sync(config.src \x2b \x27\/**\/*.js\x27);\n  let srcLength = config.src.length;\n\n  let entrys = {};\n\n  files.forEach(function (_file) {\n    let file = path.parse(_file);\n    let htmlFile = path.resolve(file.dir, file.name \x2b \x27.\x27 \x2b config.ext);\n\n    \/\/ if has same name template file, it is a entry\n    if (fs.existsSync(htmlFile)) {\n      let pathIndex = file.dir.indexOf(config.src);\n\n      if (config.dev == \x27dev\x27) {\n        entrys[config.staticRoot \x2b file.dir.slice(srcLength) \x2b \x27\/\x27 \x2b file.name] = [path.resolve(_file), hotMiddlewareScript];\n      } else {\n        entrys[config.staticRoot \x2b file.dir.slice(srcLength) \x2b \x27\/\x27 \x2b file.name] = path.resolve(_file);\n      }\n    }\n  });\n\n  return entrys;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get all js files\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e files = glob.sync(config.src \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/**\/*.js\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e srcLength = config.src.length;\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e entrys = {};\n\n  files.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e_file\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e file = path.parse(_file);\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e htmlFile = path.resolve(file.dir, file.name \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e \x2b config.ext);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ if has same name template file, it is a entry\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fs.existsSync(htmlFile)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e pathIndex = file.dir.indexOf(config.src);\n\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (config.dev == \x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e) {\n        entrys[config.staticRoot \x2b file.dir.slice(srcLength) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b file.name] = [path.resolve(_file), hotMiddlewareScript];\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        entrys[config.staticRoot \x2b file.dir.slice(srcLength) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b file.name] = path.resolve(_file);\n      }\n    }\n  });\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e entrys;\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e1.2 自动生成 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 模板\x3c\/h3\x3e\n\x3cp\x3e生成一系列 \x3ccode\x3eHtmlWebpackPlugin\x3c\/code\x3e 的要点如下：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e获取到所有的 \x3ccode\x3e.html\x3c\/code\x3e 后，判断是否有对应的 \x3ccode\x3eentry\x3c\/code\x3e 文件，若有则创建 \x3ccode\x3eHtmlWebpackPlugin\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果页面为 \x3ccode\x3elayout 模板\x3c\/code\x3e，则需要多注入由 \x3ccode\x3eCommonsChunkPlugin\x3c\/code\x3e 生成的 \x3ccode\x3ecommon\x3c\/code\x3e 模块\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e自动生成 \x3ccode\x3eHtmlWebpackPlugin\x3c\/code\x3e 代码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  let htmls = [];\n\n  \/\/ get all templates\n  let files = glob.sync(config.src \x2b \x27\/**\/*.\x27 \x2b config.ext);\n  let srcLength = config.src.length;\n\n  files.forEach(function (_file) {\n    let file = path.parse(_file);\n\n    let chunks = [];\n    let chunkName = config.staticRoot \x2b file.dir.slice(srcLength) \x2b \x27\/\x27 \x2b file.name;\n\n    \/\/ if has same name entry, create a html plugin\n    let c = entrys[chunkName];\n    c \x26amp;\x26amp; chunks.push(chunkName);\n\n    \/\/ layout will contains common chunk\n    if (file.name == config.serverLayoutName) {\n      chunks.push(config.staticRoot \x2b \x27\/common\x27);\n    }\n\n    let plugin = new HtmlWebpackPlugin({\n      filename: config.templateRoot \x2b file.dir.slice(srcLength) \x2b \x27\/\x27 \x2b file.base,\n      template: path.resolve(file.dir, file.base),\n      chunks: chunks,\n      inject: false\n    });\n\n    htmls.push(plugin);\n  });\n\n  return htmls;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs gradle\x22\x3e\x3ccode\x3e  let htmls = [];\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get all templates\x3c\/span\x3e\n  let files = glob.sync(config.src \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/**\/*.\x27\x3c\/span\x3e \x2b config.ext);\n  let srcLength = config.src.length;\n\n  files.forEach(function (_file) {\n    let \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e = path.parse(_file);\n\n    let chunks = [];\n    let chunkName = config.staticRoot \x2b \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.dir.slice(srcLength) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.name;\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ if has same name entry, create a html plugin\x3c\/span\x3e\n    let c = entrys[chunkName];\n    c \x26amp;\x26amp; chunks.\x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e(chunkName);\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ layout will contains common chunk\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.name == config.serverLayoutName) {\n      chunks.\x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e(config.staticRoot \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/common\x27\x3c\/span\x3e);\n    }\n\n    let plugin = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e HtmlWebpackPlugin({\n      filename: config.templateRoot \x2b \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.dir.slice(srcLength) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e \x2b \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.base,\n      template: path.resolve(\x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.dir, \x3cspan class=\x22hljs-keyword\x22\x3efile\x3c\/span\x3e.base),\n      chunks: chunks,\n      \x3cspan class=\x22hljs-keyword\x22\x3einject\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3efalse\x3c\/span\x3e\n    });\n\n    htmls.\x3cspan class=\x22hljs-keyword\x22\x3epush\x3c\/span\x3e(plugin);\n  });\n\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e htmls;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于引入了模板 \x3ccode\x3eextends\x3c\/code\x3e 支持，需设置 \x3ccode\x3einject=false\x3c\/code\x3e 便不会自动注入 \x3ccode\x3eassets 文件\x3c\/code\x3e\x3c\/p\x3e\n\x3cp\x3e编写 webpack 插件，将页面的 \x3ccode\x3ejs assets\x3c\/code\x3e, \x3ccode\x3ecss assets\x3c\/code\x3e 分别注入到：\x3cbr\x3e\x3ccode\x3e\x26lt;!--webpack_style_placeholder--\x26gt;\x3c\/code\x3e\x3cbr\x3e\x3ccode\x3e\x26lt;!--webpack_script_placeholder--\x26gt;\x3c\/code\x3e  \x3cbr\x3e两个替换文案处，例如页面模板：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{% extends \x27..\/base\/base.html\x27 %}\n\n{% block title %}My Page{% endblock %}\n\n{% block style %}\x3c!--webpack_style_placeholder--\x3e{%endblock%}\n\n{% block head %}\n  {% parent %}\n{% endblock %}\n\n{% block content %}\n\x3cp\x3eThis is just an home page！！！\x3c\/p\x3e\n\n\x3cdiv class=\x26quot;color-area\x26quot;\x3e\n  clouds\n\x3c\/div\x3e\n\n\x3ca href=\x26quot;\/users\/list\x26quot;\x3elink page2\x3c\/a\x3e\n{% endblock %}\n\n{% block script %}\x3c!--webpack_script_placeholder--\x3e{%endblock%}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs django\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eextends\x3c\/span\x3e\x3c\/span\x3e \x27..\/base\/base.html\x27 %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e title %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3eMy Page\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e style %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--webpack_style_placeholder--\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{%\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e%}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e head %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n  \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3eparent\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e content %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3eThis is just an home page！！！\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22color-area\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  clouds\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/users\/list\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3elink page2\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e script %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\x26lt;!--webpack_script_placeholder--\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{%\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e%}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e编译后替换后为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{% extends \x27..\/base\/base.html\x27 %}\n\n{% block title %}My Page{% endblock %}\n\n{% block style %}\x3clink rel=\x26quot;stylesheet\x26quot; href=\x26quot;\/static\/page\/home\/home.css\x26quot;\/\x3e{%endblock%}\n\n{% block head %}\n  {% parent %}\n{% endblock %}\n\n{% block content %}\n\x3cp\x3eThis is just an home page！！！\x3c\/p\x3e\n\n\x3cdiv class=\x26quot;color-area\x26quot;\x3e\n  clouds\n\x3c\/div\x3e\n\n\x3ca href=\x26quot;\/users\/list\x26quot;\x3elink page2\x3c\/a\x3e\n{% endblock %}\n\n{% block script %}\x3cscript src=\x26quot;\/static\/page\/home\/home.js\x26quot;\x3e\x3c\/script\x3e{%endblock%}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs django\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eextends\x3c\/span\x3e\x3c\/span\x3e \x27..\/base\/base.html\x27 %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e title %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3eMy Page\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e style %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3elink\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3erel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22stylesheet\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/static\/page\/home\/home.css\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{%\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e%}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e head %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n  \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3eparent\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e content %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3eThis is just an home page！！！\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ep\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3eclass\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22color-area\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  clouds\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ediv\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3ehref\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/users\/list\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3elink page2\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3ea\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\n\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eblock\x3c\/span\x3e\x3c\/span\x3e script %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/static\/page\/home\/home.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{%\x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendblock\x3c\/span\x3e\x3c\/span\x3e%}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e1.3 各种 loader 配置，提取页面 css\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e在 \x3ccode\x3edev\x3c\/code\x3e 环境下由于配置了 \x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e 所以不能对 css 进行提取，否则无法热更新\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e样式相关的 loader 配置如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var extractInstance = new ExtractTextPlugin(\x27[name].css\x27);\n\nif (config.env == \x27dev\x27) {\n    var stylusLoader = [\n      {\n        loader: \x27style-loader\x27\n      },\n      {\n        loader: \x27css-loader\x27\n      },\n      {\n        loader: \x27stylus-loader\x27\n      }\n    ];\n\n    var cssLoader = [\n      {\n        loader: \x27style-loader\x27\n      },\n      {\n        loader: \x27css-loader\x27\n      }\n    ];\n  } else {\n    var stylusLoader = extractInstance.extract([\x27css-loader\x27, \x27stylus-loader\x27]);\n    var cssLoader = extractInstance.extract([\x27css-loader\x27]);\n  }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sml\x22\x3e\x3ccode\x3evar extractInstance = new \x3cspan class=\x22hljs-type\x22\x3eExtractTextPlugin\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27[name].css\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (config.env == \x3cspan class=\x22hljs-symbol\x22\x3e\x27dev\x27\x3c\/span\x3e) {\n    var stylusLoader = [\n      {\n        loader: \x3cspan class=\x22hljs-symbol\x22\x3e\x27style\x3c\/span\x3e-loader\x27\n      },\n      {\n        loader: \x3cspan class=\x22hljs-symbol\x22\x3e\x27css\x3c\/span\x3e-loader\x27\n      },\n      {\n        loader: \x3cspan class=\x22hljs-symbol\x22\x3e\x27stylus\x3c\/span\x3e-loader\x27\n      }\n    ];\n\n    var cssLoader = [\n      {\n        loader: \x3cspan class=\x22hljs-symbol\x22\x3e\x27style\x3c\/span\x3e-loader\x27\n      },\n      {\n        loader: \x3cspan class=\x22hljs-symbol\x22\x3e\x27css\x3c\/span\x3e-loader\x27\n      }\n    ];\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    var stylusLoader = extractInstance.extract([\x3cspan class=\x22hljs-symbol\x22\x3e\x27css\x3c\/span\x3e-loader\x27, \x3cspan class=\x22hljs-symbol\x22\x3e\x27stylus\x3c\/span\x3e-loader\x27]);\n    var cssLoader = extractInstance.extract([\x3cspan class=\x22hljs-symbol\x22\x3e\x27css\x3c\/span\x3e-loader\x27]);\n  }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e并将所有的 \x3ccode\x3eloader\x3c\/code\x3e 放到同一个文件进行维护：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  var rules = [\n    {\n      test: \/\\.styl$\/,\n      exclude: \/node_modules\/,\n      use: stylusLoader\n    },\n    {\n      test: \/\\.css$\/,\n      exclude: \/node_modules\/,\n      use: cssLoader\n    },\n    {\n      test: \/\\.html$\/,\n      use: {\n        loader: \x27html-loader\x27,\n        options: {\n          minimize: false\n        }\n      }\n    },\n    ......\n    ......\n  ]\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs yaml\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-string\x22\x3evar\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3erules\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e=\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e[\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      test:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/\\.styl$\/,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exclude:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/node_modules\/,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      use:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3estylusLoader\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      test:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/\\.css$\/,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      exclude:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/node_modules\/,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      use:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3ecssLoader\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      test:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\/\\.html$\/,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e      use:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e        loader:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27html-loader\x27\x3c\/span\x3e\x3cspan class=\x22hljs-string\x22\x3e,\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e        options:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e{\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3e          minimize:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n        \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n      \x3cspan class=\x22hljs-string\x22\x3e}\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e},\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e......\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e......\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e]\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e1.4 路径配置\x3c\/h3\x3e\n\x3cp\x3e对生成模板，静态文件输出目录进行统一控制，便于结合各种后端架构\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const port = process.env.PORT || 8080;\nconst env = process.env.NODE_ENV || \x27dev\x27;\n\nconst CONFIG_BUILD = {\n  env: env,\n  ext: \x27html\x27, \/\/ tempate ext\n  src: path.resolve(__dirname, \x27..\/src\x27), \/\/ source code path\n  path: env == \x27dev\x27 ? \x27\/\x27 : path.resolve(__dirname, \x27..\/dist\x27), \/\/ base output path\n  templateRoot: \x27templates\x27, \/\/ tempate output path\n  staticRoot: \x27static\x27, \/\/ static output path\n  serverLayoutName: \x27base\x27, \/\/ swig layout name , only one file\n  publicPath: env == \x27dev\x27 ? (\x27http:\/\/localhost:\x27 \x2b port \x2b \x27\/\x27) : \x27\/\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mel\x22\x3e\x3ccode\x3econst port = process.\x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e.PORT || \x3cspan class=\x22hljs-number\x22\x3e8080\x3c\/span\x3e;\nconst \x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e = process.\x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e.NODE_ENV || \x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e;\n\nconst CONFIG_BUILD = {\n  \x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e,\n  ext: \x3cspan class=\x22hljs-string\x22\x3e\x27html\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ tempate ext\x3c\/span\x3e\n  src: path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/src\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/ source code path\x3c\/span\x3e\n  path: \x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e == \x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e : path.resolve(__dirname, \x3cspan class=\x22hljs-string\x22\x3e\x27..\/dist\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-comment\x22\x3e\/\/ base output path\x3c\/span\x3e\n  templateRoot: \x3cspan class=\x22hljs-string\x22\x3e\x27templates\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ tempate output path\x3c\/span\x3e\n  staticRoot: \x3cspan class=\x22hljs-string\x22\x3e\x27static\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ static output path\x3c\/span\x3e\n  serverLayoutName: \x3cspan class=\x22hljs-string\x22\x3e\x27base\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ swig layout name , only one file\x3c\/span\x3e\n  publicPath: \x3cspan class=\x22hljs-keyword\x22\x3eenv\x3c\/span\x3e == \x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e ? (\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:\x27\x3c\/span\x3e \x2b port \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e) : \x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3chr\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e2. SERVER 端配置\x3c\/h2\x3e\n\x3cp\x3e\x3ccode\x3eserver\x3c\/code\x3e 端搭建了 express 服务，实现的功能点如下：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e使用 \x3ccode\x3ewebpack-dev-middleware\x3c\/code\x3e 进行 \x3ccode\x3ewebpack\x3c\/code\x3e 编译\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用 \x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e 实现 \x3ccode\x3ehot reload\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用 \x3ccode\x3esupervisor\x3c\/code\x3e 服务监听 \x3ccode\x3enode\x3c\/code\x3e 文件改动并自动重启\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3erender\x3c\/code\x3e 模板时将内存中的文件写入硬盘，以进行渲染\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e2.1 webpack 接入 express\x3c\/h3\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e生成 \x3ccode\x3ewebpack\x3c\/code\x3e 的 \x3ccode\x3ecompiler\x3c\/code\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  var webpack = require(\x27webpack\x27),\n    webpackDevConfig = require(path.resolve(config.root, \x27.\/fe\/webpack.config.js\x27));\n\n  var compiler = webpack(webpackDevConfig);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ebnf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attribute\x22\x3e  var webpack\x3c\/span\x3e = require(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack\x27\x3c\/span\x3e),\n    webpackDevConfig = require(path.resolve(config.root, \x3cspan class=\x22hljs-string\x22\x3e\x27.\/fe\/webpack.config.js\x27\x3c\/span\x3e));\n\n\x3cspan class=\x22hljs-attribute\x22\x3e  var compiler\x3c\/span\x3e = webpack(webpackDevConfig);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e将 \x3ccode\x3ecompiler\x3c\/code\x3e 作为 \x3ccode\x3eexpress\x3c\/code\x3e 的中间件\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ attach to the compiler \x26amp; the server\n  app.use(webpackDevMiddleware(compiler, {\n    \/\/ public path should be the same with webpack config\n    publicPath: webpackDevConfig.output.publicPath,\n    noInfo: false,\n    stats: {\n      colors: true\n    }\n  }));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ attach to the compiler \x26amp; the server\x3c\/span\x3e\n  \x3cspan class=\x22hljs-selector-tag\x22\x3eapp\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.use\x3c\/span\x3e(webpackDevMiddleware(compiler, {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ public path should be the same with webpack config\x3c\/span\x3e\n    \x3cspan class=\x22hljs-attribute\x22\x3epublicPath\x3c\/span\x3e: webpackDevConfig.output.publicPath,\n    \x3cspan class=\x22hljs-attribute\x22\x3enoInfo\x3c\/span\x3e: false,\n    \x3cspan class=\x22hljs-attribute\x22\x3estats\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attribute\x22\x3ecolors\x3c\/span\x3e: true\n    }\n  }));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其中 \x3ccode\x3epublicPath\x3c\/code\x3e 指明了 \x3ccode\x3eassets \x3c\/code\x3e 请求的根路径，这里配置的是：\x3ccode\x3ehttp:\/\/localhost:8080\/\x3c\/code\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e2.2 \x3ccode\x3ehot reload\x3c\/code\x3e 方案\x3c\/h3\x3e\n\x3ch4\x3e2.2.1 \x3ccode\x3ejs，css\x3c\/code\x3e 修改自刷新\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3ejs\x3c\/code\x3e、\x3ccode\x3ecss\x3c\/code\x3e 的自刷新通过配置 \x3ccode\x3ewebpack-hot-middleware\x3c\/code\x3e 实现（fe 也需进行相应的配置）\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ server\n  const webpackHotMiddleware = require(\x27webpack-hot-middleware\x27);\n  app.use(webpackHotMiddleware(compiler));\n  \/\/ fe\n  webpackPlugins.push(\n    new webpack.HotModuleReplacementPlugin()\n  );\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ server\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e webpackHotMiddleware = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27webpack-hot-middleware\x27\x3c\/span\x3e);\n  app.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(webpackHotMiddleware(compiler));\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ fe\x3c\/span\x3e\n  webpackPlugins.push(\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.HotModuleReplacementPlugin()\n  );\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3e2.2.2 \x3ccode\x3enode\x3c\/code\x3e 修改自刷新\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3enode\x3c\/code\x3e 文件修改通过配置 \x3ccode\x3esupervisor\x3c\/code\x3e 服务实现自动刷新\x3c\/p\x3e\n\x3cp\x3e安装服务：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22npm install supervisor -g\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs cmake\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3enpm \x3cspan class=\x22hljs-keyword\x22\x3einstall\x3c\/span\x3e supervisor -g\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e配置启动参数：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ package.json\n\x26quot;scripts\x26quot;: {\n  \x26quot;start\x26quot;: \x26quot;cross-env NODE_ENV=dev supervisor -w server -e fe server\/server.js\x26quot;\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs 1c\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ package.json\x3c\/span\x3e\n\x3cspan class=\x22hljs-string\x22\x3e\x22scripts\x22\x3c\/span\x3e: {\n  \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22cross-env NODE_ENV=dev supervisor -w server -e fe server\/server.js\x22\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3esupervisor\x3c\/code\x3e 监听了 server 文件夹下所有的改动，改动后重启  \x3ccode\x3eexpress服务\x3c\/code\x3e。\x3cbr\x3e想要实现浏览器自动刷新，需要在 \x3ccode\x3elayout\x3c\/code\x3e 模板加入如下代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  {% if env == \x27dev\x27 %}\n    \x3cscript src=\x26quot;\/reload\/reload.js\x26quot;\x3e\x3c\/script\x3e\n  {% endif %}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs django\x22\x3e\x3ccode\x3e\x3cspan class=\x22xml\x22\x3e  \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eif\x3c\/span\x3e\x3c\/span\x3e env == \x27dev\x27 %}\x3c\/span\x3e\x3cspan class=\x22xml\x22\x3e\n    \x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3esrc\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22\/reload\/reload.js\x22\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3cspan class=\x22undefined\x22\x3e\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3escript\x3c\/span\x3e\x26gt;\x3c\/span\x3e\n  \x3c\/span\x3e\x3cspan class=\x22hljs-template-tag\x22\x3e{% \x3cspan class=\x22hljs-name\x22\x3e\x3cspan class=\x22hljs-name\x22\x3eendif\x3c\/span\x3e\x3c\/span\x3e %}\x3c\/span\x3e\x3c\/code\x3e\x3cspan class=\x22xml\x22\x3e\x3c\/span\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e2.3 对 template 进行 render\x3c\/h3\x3e\n\x3cp\x3e当 \x3ccode\x3ewebpack\x3c\/code\x3e 作为 \x3ccode\x3eexpress\x3c\/code\x3e 中间件时，生成的所有文件都存在内存中，当然也包括由 \x3ccode\x3ehtml-webpack-plugin\x3c\/code\x3e 生成的模板文件。\x3cbr\x3e然而 \x3ccode\x3eexpress\x3c\/code\x3e 的 \x3ccode\x3erender\x3c\/code\x3e 函数只能指定一个存在于文件系统中的模板， 即\x3ccode\x3edev\x3c\/code\x3e 环境下 \x3ccode\x3erender\x3c\/code\x3e 模板前需要将其从内存中取得并存放到文件系统中。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports = (res, template) =\x3e {\n  if (config.env == \x27dev\x27) {\n    let filename = compiler.outputPath \x2b template;\n    \/\/ load template from \n    compiler.outputFileSystem.readFile(filename, function(err, result) {\n      let fileInfo = path.parse(path.join(config.templateRoot, filename));\n\n\n      mkdirp(fileInfo.dir, () =\x3e {\n        fs.writeFileSync(path.join(config.templateRoot, filename), result);\n\n        res.render(template);\n      });\n    });\n  } else {\n    res.render(template);\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eres, template\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (config.env == \x3cspan class=\x22hljs-string\x22\x3e\x27dev\x27\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e filename = compiler.outputPath \x2b template;\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ load template from \x3c\/span\x3e\n    compiler.outputFileSystem.readFile(filename, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, result\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e fileInfo = path.parse(path.join(config.templateRoot, filename));\n\n\n      mkdirp(fileInfo.dir, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        fs.writeFileSync(path.join(config.templateRoot, filename), result);\n\n        res.render(template);\n      });\n    });\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    res.render(template);\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3elayout\x3c\/code\x3e 模板的存储需要一个中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  app.use((req, res, next) =\x3e {\n    let layoutPath = path.join(config.templateRoot, config.layoutTemplate);\n    let filename = compiler.outputPath \x2b config.layoutTemplate;\n\n    compiler.outputFileSystem.readFile(filename, function(err, result) {\n      let fileInfoLayout = path.parse(layoutPath);\n\n      mkdirp(fileInfoLayout.dir, () =\x3e {\n        fs.writeFileSync(layoutPath, result);\n        next();\n      });\n    });\n  });\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs mipsasm\x22\x3e\x3ccode\x3e  app.use((req, res, next) =\x26gt; {\n    let layoutPath = path.\x3cspan class=\x22hljs-keyword\x22\x3ejoin(config.templateRoot, \x3c\/span\x3e\x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e.layoutTemplate)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n    let filename = compiler.outputPath \x2b \x3cspan class=\x22hljs-built_in\x22\x3econfig\x3c\/span\x3e.layoutTemplate\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\n    compiler.outputFileSystem.readFile(filename, function(err, result) {\n      let fileInfoLayout = path.parse(layoutPath)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n\n      mkdirp(fileInfoLayout.\x3cspan class=\x22hljs-keyword\x22\x3edir, \x3c\/span\x3e() =\x26gt; {\n        fs.writeFileSync(layoutPath, result)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n        next()\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n      })\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n    })\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n  })\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e其余的均为 \x3ca href=\x22http:\/\/www.expressjs.com.cn\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eexpress\x3c\/a\x3e 基础使用，参阅文档即可\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e2.4 代理后端接口\x3c\/h3\x3e\n\x3cp\x3e在\x3ccode\x3edev\x3c\/code\x3e环境时使用 \x3ccode\x3ehttp-proxy-middleware\x3c\/code\x3e 对后端接口进行代理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \/\/ set proxy\n  app.use(\x27\/api\x27, proxy({target: config.proxy, changeOrigin: true}));\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ set proxy\x3c\/span\x3e\n  app.use(\x3cspan class=\x22hljs-string\x22\x3e\x27\/api\x27\x3c\/span\x3e, proxy({\x3cspan class=\x22hljs-string\x22\x3etarget:\x3c\/span\x3e config.proxy, \x3cspan class=\x22hljs-string\x22\x3echangeOrigin:\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e}));\x3c\/code\x3e\x3c\/pre\x3e\n\x3cblockquote\x3e\x3cp\x3e所有 \x3ccode\x3e\/api\x3c\/code\x3e 的请求都会代理到 \x3ccode\x3econfig.proxy\x3c\/code\x3e 配置的 ip 端口。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e在正式环境中直接配置 \x3ccode\x3enginx\x3c\/code\x3e 进行转发\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e补充\x3c\/h2\x3e\n\x3cp\x3e本文抛砖引玉简单搭建了一个前后端分离框架，但还有很多不完善的地方。真实的线上应用还需要考虑 \x3ccode\x3enodejs\x3c\/code\x3e 运维成本，日志，监控等等。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>多页架构的前后端分离方案（webpack+express）</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008644787">https://segmentfault.com/a/1190000008644787</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/kv3wg5qmxv/" target="_blank">https://alili.tech/archive/kv3wg5qmxv/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>