<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="vue2.0源码分析之理解响应式架构"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>vue2.0源码分析之理解响应式架构 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/o0md76h6d5b/",
				"appid": "1613049289050283", 
				"title": "vue2.0源码分析之理解响应式架构 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/gv6jxtrb8oh/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bs8f946sf9h/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&text=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&text=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&title=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&is_video=false&description=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&title=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&title=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&title=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fo0md76h6d5b%2f&title=vue2.0%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90%e4%b9%8b%e7%90%86%e8%a7%a3%e5%93%8d%e5%ba%94%e5%bc%8f%e6%9e%b6%e6%9e%84"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">vue2.0源码分析之理解响应式架构</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e分享前啰嗦\x3c\/h2\x3e\n\x3cp\x3e我之前介绍过vue1.0如何实现\x3ccode\x3eobserver\x3c\/code\x3e和\x3ccode\x3ewatcher\x3c\/code\x3e。本想继续写下去，可是vue2.0横空出世..所以\x3cbr\x3e  直接看vue2.0吧。这篇文章在公司分享过，终于写出来了。我们采用用最精简的代码，还原vue2.0响应式架构实现\x3cbr\x3e  以前写的那篇 \x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004384515\x22\x3evue 源码分析之如何实现 observer 和 watcher\x3c\/a\x3e可以作为本次分享的参考。\x3cbr\x3e  不过不看也没关系，但是最好了解下\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004346467\x22 target=\x22_blank\x22\x3eObject.defineProperty\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e本文分享什么\x3c\/h2\x3e\n\x3cp\x3e理解vue2.0的响应式架构，就是下面这张图\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/odqs6mk2t.qnssl.com\/vuedeptrace.jpg\x22 src=\x22https:\/\/static.alili.techhttps:\/\/odqs6mk2t.qnssl.com\/vuedeptrace.jpg\x22 alt=\x22vuedeptrace.jpg\x22 title=\x22vuedeptrace.jpg\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e顺带介绍他比react快的其中一个原因\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e本分实现什么\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const demo = new Vue({\n  data: {\n    text: \x26quot;before\x26quot;,\n  },\n  \/\/对应的template 为 \x3cdiv\x3e\x3cspan\x3e\x22{{\x22text\x22}}\x22\x3c\/span\x3e\x3c\/div\x3e\n  render(h){\n    return h(\x27div\x27, {}, [\n      h(\x27span\x27, {}, [this.__toString__(this.text)])\n    ])\n  }\n})\n setTimeout(function(){\n   demo.text = \x26quot;after\x26quot;\n }, 3000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n  \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22before\x22\x3c\/span\x3e,\n  },\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/对应的template 为 \x26lt;div\x26gt;\x26lt;span\x26gt;\x22{{\x22text\x22}}\x22\x26lt;\/span\x26gt;\x26lt;\/div\x26gt;\x3c\/span\x3e\n  render(h){\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e h(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e, {}, [\n      h(\x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e, {}, [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__toString__(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text)])\n    ])\n  }\n})\n setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n   demo.text = \x3cspan class=\x22hljs-string\x22\x3e\x22after\x22\x3c\/span\x3e\n }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e对应的虚拟dom会从\x3cbr\x3e\x3ccode\x3e\x26lt;div\x26gt;\x26lt;span\x26gt;before\x26lt;\/span\x26gt;\x26lt;\/div\x26gt;\x3c\/code\x3e 变为 \x3ccode\x3e\x26lt;div\x26gt;\x26lt;span\x26gt;after\x26lt;\/span\x26gt;\x26lt;\/div\x26gt;\x3c\/code\x3e\x3cbr\x3e好，开始吧！！！\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e第一步， 讲data 下面所有属性变为observable\x3c\/h2\x3e\n\x3cp\x3e来来来先看代码吧\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    class Vue {\n      constructor(options) {\n        this.$options = options\n        this._data = options.data\n        observer(options.data, this._update)\n        this._update()\n      }\n      _update(){\n        this.$options.render()\n      }\n    }\n\n\n    function observer(value, cb){\n      Object.keys(value).forEach((key) =\x3e defineReactive(value, key, value[key] , cb))\n    }\n\n    function defineReactive(obj, key, val, cb) {\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: ()=\x3e{},\n        set:newVal=\x3e {\n          cb()\n        }\n      })\n    }\n\n    var demo = new Vue({\n      el: \x27#demo\x27,\n      data: {\n        text: 123,\n      },\n      render(){\n        console.log(\x26quot;我要render了\x26quot;)\n      }\n    })\n\n     setTimeout(function(){\n       demo._data.text = 444\n     }, 3000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVue\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(options) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options = options\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._data = options.data\n        observer(options.data, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._update)\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._update()\n      }\n      _update(){\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options.render()\n      }\n    }\n\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eobserver\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue, cb\x3c\/span\x3e)\x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(value).forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e defineReactive(value, key, value[key] , cb))\n    }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edefineReactive\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, key, val, cb\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n        \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{},\n        \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e:\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enewVal\x3c\/span\x3e=\x26gt;\x3c\/span\x3e {\n          cb()\n        }\n      })\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#demo\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e,\n      },\n      render(){\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22我要render了\x22\x3c\/span\x3e)\n      }\n    })\n\n     setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n       demo._data.text = \x3cspan class=\x22hljs-number\x22\x3e444\x3c\/span\x3e\n     }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e为了好演示我们只考虑最简单的情况，如果看了\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004384515\x22\x3evue 源码分析之如何实现 observer 和 watcher\x3c\/a\x3e可能就会很好理解，不过没关系，我们三言两语再说说，这段代码要实现的功能就是将\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var demo = new Vue({\n      el: \x27#demo\x27,\n      data: {\n        text: 123,\n      },\n      render(){\n        console.log(\x26quot;我要render了\x26quot;)\n      }\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#demo\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e123\x3c\/span\x3e,\n      },\n      render(){\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22我要render了\x22\x3c\/span\x3e)\n      }\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e中\x3ccode\x3edata\x3c\/code\x3e 里面所有的属性置于 observer，然后\x3ccode\x3edata\x3c\/code\x3e里面的属性，比如 \x3ccode\x3etext\x3c\/code\x3e 以改变，就引起\x3ccode\x3e_update()\x3c\/code\x3e函数调用进而重新渲染，是怎样做到的呢，我们知道其实就是赋值的时候就要改变对吧，当我给\x3ccode\x3edata\x3c\/code\x3e下面的\x3ccode\x3etext\x3c\/code\x3e 赋值的时候 \x3ccode\x3eset\x3c\/code\x3e 函数就会触发，这个时候 调用 \x3ccode\x3e_update\x3c\/code\x3e 就ok了，但是\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22     setTimeout(function(){\n       demo._data.text = 444\n     }, 3000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e     setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n       demo._data.text = \x3cspan class=\x22hljs-number\x22\x3e444\x3c\/span\x3e\n     }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3edemo._data.text\x3c\/code\x3e没有\x3ccode\x3edemo.text\x3c\/code\x3e用着爽，没关系，我们加一个代理\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22      _proxy(key) {\n        const self = this\n        Object.defineProperty(self, key, {\n          configurable: true,\n          enumerable: true,\n          get: function proxyGetter () {\n            return self._data[key]\n          },\n          set: function proxySetter (val) {\n            self._data[key] = val\n          }\n        })\n      }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e      _proxy(key) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(self, key, {\n          \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproxyGetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e self._data[key]\n          },\n          \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproxySetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) \x3c\/span\x3e{\n            self._data[key] = val\n          }\n        })\n      }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在\x3ccode\x3eVue\x3c\/code\x3e的\x3ccode\x3econstructor\x3c\/code\x3e加上下面这句\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    Object.keys(options.data).forEach(key =\x3e this._proxy(key))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22 style=\x22word-break: break-word; white-space: initial;\x22\x3e    \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(options.data).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._proxy(key))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一步先说到这里，我们会发现一个问题，\x3ccode\x3edata\x3c\/code\x3e中任何一个属性的值改变，都会引起\x3cbr\x3e\x3ccode\x3e_update\x3c\/code\x3e的触发进而重新渲染，属性这显然不够精准啊\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e第二步，详细阐述第一步为什么不够精准\x3c\/h2\x3e\n\x3cp\x3e比如考虑下面代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    new Vue({\n      template: `\n        \x3cdiv\x3e\n          \x3csection\x3e\n            \x3cspan\x3ename:\x3c\/span\x3e \x22{{\x22name\x22}}\x22\n          \x3c\/section\x3e\n          \x3csection\x3e\n            \x3cspan\x3eage:\x3c\/span\x3e \x22{{\x22age\x22}}\x22\n          \x3c\/section\x3e\n        \x3cdiv\x3e`,\n      data: {\n        name: \x27js\x27,\n        age: 24,\n        height: 180\n      }\n    })\n\n    setTimeout(function(){\n      demo.height = 181\n    }, 3000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3etemplate\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e`\n        \x26lt;div\x26gt;\n          \x26lt;section\x26gt;\n            \x26lt;span\x26gt;name:\x26lt;\/span\x26gt; \x22{{\x22name\x22}}\x22\n          \x26lt;\/section\x26gt;\n          \x26lt;section\x26gt;\n            \x26lt;span\x26gt;age:\x26lt;\/span\x26gt; \x22{{\x22age\x22}}\x22\n          \x26lt;\/section\x26gt;\n        \x26lt;div\x26gt;`\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27js\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eheight\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e180\x3c\/span\x3e\n      }\n    })\n\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n      demo.height = \x3cspan class=\x22hljs-number\x22\x3e181\x3c\/span\x3e\n    }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etemplate\x3c\/code\x3e里面只用到了\x3ccode\x3edata\x3c\/code\x3e上的两个属性\x3ccode\x3ename\x3c\/code\x3e和\x3ccode\x3eage\x3c\/code\x3e，但是当我改变\x3ccode\x3eheight\x3c\/code\x3e的时候，用第一步的代码，会不会触发重新渲染？会！，但其实不需要触发重新渲染，这就是问题所在！！\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e第三步，上述问题怎么解决\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e简单说说虚拟 DOM\x3c\/h3\x3e\n\x3cp\x3e首先，template最后都是编译成render函数的(具体怎么做，就不展开说了，以后我会说的)，然后render 函数执行完就会得到一个虚拟DOM，为了好理解我们写写最简单的虚拟DOM\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function VNode(tag, data, children, text) {\n      return {\n        tag: tag,\n        data: data,\n        children: children,\n        text: text\n      }\n    }\n\n    class Vue {\n      constructor(options) {\n        this.$options = options\n        const vdom = this._update()\n        console.log(vdom)\n      }\n      _update() {\n        return this._render.call(this)\n      }\n      _render() {\n        const vnode = this.$options.render.call(this)\n        return vnode\n      }\n      __h__(tag, attr, children) {\n        return VNode(tag, attr, children.map((child)=\x3e{\n          if(typeof child === \x27string\x27){\n            return VNode(undefined, undefined, undefined, child)\n          }else{\n            return child\n          }\n        }))\n      }\n      __toString__(val) {\n        return val == null ? \x27\x27 : typeof val === \x27object\x27 ? JSON.stringify(val, null, 2) : String(val);\n      }\n    }\n\n\n    var demo = new Vue({\n      el: \x27#demo\x27,\n      data: {\n        text: \x26quot;before\x26quot;,\n      },\n      render(){\n        return this.__h__(\x27div\x27, {}, [\n          this.__h__(\x27span\x27, {}, [this.__toString__(this.text)])\n        ])\n      }\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVNode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etag, data, children, text\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etag\x3c\/span\x3e: tag,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: data,\n        \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: children,\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: text\n      }\n    }\n\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVue\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(options) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options = options\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vdom = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._update()\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(vdom)\n      }\n      _update() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._render.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n      }\n      _render() {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vnode = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options.render.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e vnode\n      }\n      __h__(tag, attr, children) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e VNode(tag, attr, children.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3echild\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e child === \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e VNode(\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, child)\n          }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e child\n          }\n        }))\n      }\n      __toString__(val) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val == \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val === \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(val, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) : \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e(val);\n      }\n    }\n\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#demo\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22before\x22\x3c\/span\x3e,\n      },\n      render(){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e, {}, [\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e, {}, [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__toString__(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text)])\n        ])\n      }\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们运行一下，他会输出\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22     {\n       tag: \x27div\x27,\n       data: {},\n       children:[\n         {\n           tag: \x27span\x27,\n           data: {},\n           children: [\n             {\n               children: undefined,\n               data: undefined,\n               tag: undefined,\n               text: \x27\x27 \/\/ 正常情况为 字符串 before，因为我们为了演示就不写代理的代码，所以这里为空\n             }\n           ]\n         }\n       ]\n     }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e     {\n       \x3cspan class=\x22hljs-attr\x22\x3etag\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e,\n       \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {},\n       \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e:[\n         {\n           \x3cspan class=\x22hljs-attr\x22\x3etag\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e,\n           \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {},\n           \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: [\n             {\n               \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n               \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n               \x3cspan class=\x22hljs-attr\x22\x3etag\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e,\n               \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 正常情况为 字符串 before，因为我们为了演示就不写代理的代码，所以这里为空\x3c\/span\x3e\n             }\n           ]\n         }\n       ]\n     }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这就是 虚拟最简单虚拟\x3ccode\x3eDOM\x3c\/code\x3e,\x3ccode\x3etag\x3c\/code\x3e是\x3ccode\x3ehtml\x3c\/code\x3e 标签名，\x3ccode\x3edata\x3c\/code\x3e 是包含诸如 \x3ccode\x3eclass\x3c\/code\x3e 和 \x3ccode\x3estyle\x3c\/code\x3e 这些标签上的属性，\x3ccode\x3echilden\x3c\/code\x3e就是子节点，关于虚拟DOM就不展开说了。\x3cbr\x3e回到开始的问题，也就是说，我得知道，\x3ccode\x3erender\x3c\/code\x3e 函数里面依赖了vue实例里面哪些变量（只考虑render 就可以，因为template 也会是帮你编译成render）。叙述有点拗口，还是看代码吧\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    var demo = new Vue({\n      el: \x27#demo\x27,\n      data: {\n        text: \x26quot;before\x26quot;,\n        name: \x26quot;123\x26quot;,\n        age: 23\n      },\n      render(){\n        return this.__h__(\x27div\x27, {}, [\n          this.__h__(\x27span\x27, {}, [this.__toString__(this.text)])\n        ])\n      }\n    })\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#demo\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22before\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22123\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eage\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e23\x3c\/span\x3e\n      },\n      render(){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e, {}, [\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e, {}, [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__toString__(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text)])\n        ])\n      }\n    })\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e就像这段代码，\x3ccode\x3erender\x3c\/code\x3e 函数里其实只依赖\x3ccode\x3etext\x3c\/code\x3e，并没有依赖 \x3ccode\x3ename\x3c\/code\x3e和 \x3ccode\x3eage\x3c\/code\x3e,所以，我们只要\x3ccode\x3etext\x3c\/code\x3e改变的时候\x3cbr\x3e我们自动触发 \x3ccode\x3erender\x3c\/code\x3e 函数 让它生成一个虚拟\x3ccode\x3eDOM\x3c\/code\x3e就ok了（剩下的就是这个虚拟DOM和上个虚拟\x3ccode\x3eDOM\x3c\/code\x3e做比对，然后操作真实\x3ccode\x3eDOM\x3c\/code\x3e，只能以后再说了），那么我们正式考虑一下怎么做\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e第三步，\x27touch\x27 拿到依赖\x3c\/h2\x3e\n\x3cp\x3e回到最上面那张图，我们知道\x3ccode\x3edata\x3c\/code\x3e上的属性设置\x3ccode\x3edefineReactive\x3c\/code\x3e后，修改data 上的值会触发 \x3ccode\x3eset\x3c\/code\x3e。\x3cbr\x3e那么我们取\x3ccode\x3edata\x3c\/code\x3e上值是会触发 \x3ccode\x3eget\x3c\/code\x3e了。\x3cbr\x3e对，我们可以在上面做做手脚，我们先执行一下\x3ccode\x3erender\x3c\/code\x3e，我们看看\x3ccode\x3edata\x3c\/code\x3e上哪些属性触发了\x3ccode\x3eget\x3c\/code\x3e，我们岂不是就可以知道 \x3ccode\x3erender\x3c\/code\x3e 会依赖\x3ccode\x3edata\x3c\/code\x3e 上哪些变量了。\x3cbr\x3e然后我么把这些变量做些手脚，每次这些变量变的时候，我们就触发\x3ccode\x3erender\x3c\/code\x3e。\x3cbr\x3e上面这些步骤简单用四个子概括就是 计算依赖。\x3cbr\x3e（其实不仅是\x3ccode\x3erender\x3c\/code\x3e，任何一个变量的改别，是因为别的变量改变引起，都可以用上述方法，也就是\x3ccode\x3ecomputed\x3c\/code\x3e 和 \x3ccode\x3ewatch\x3c\/code\x3e 的原理，也是mobx的核心）\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e第一步，\x3c\/h3\x3e\n\x3cp\x3e我们写一个依赖收集的类，每一个\x3ccode\x3edata\x3c\/code\x3e 上的对象都有可能被\x3ccode\x3erender\x3c\/code\x3e函数依赖，所以每个属性在\x3ccode\x3edefineReactive\x3c\/code\x3e\x3cbr\x3e时候就初始化它，简单来说就是这个样子的\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    class Dep {\n      constructor() {\n        this.subs = []\n      }\n      add(cb) {\n        this.subs.push(cb)\n      }\n      notify() {\n        console.log(this.subs);\n        this.subs.forEach((cb) =\x3e cb())\n      }\n    }\n    function defineReactive(obj, key, val, cb) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        \/\/ 省略\n      })\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs = []\n      }\n      add(cb) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.push(cb)\n      }\n      notify() {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs);\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e cb())\n      }\n    }\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edefineReactive\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, key, val, cb\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dep = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Dep()\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 省略\x3c\/span\x3e\n      })\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后，当执行\x3ccode\x3erender\x3c\/code\x3e 函数去\x27touch\x27依赖的时候，依赖到的变量get就会被执行，然后我们就可以把这个 \x3ccode\x3erender\x3c\/code\x3e 函数加到 \x3ccode\x3esubs\x3c\/code\x3e 里面去了。\x3cbr\x3e当我们，\x3ccode\x3eset\x3c\/code\x3e 的时候 我们就执行 \x3ccode\x3enotify\x3c\/code\x3e 将所有的subs数组里的函数执行，其中就包含\x3ccode\x3erender\x3c\/code\x3e 的执行。\x3cbr\x3e至此就完成了整个图，好我们将所有的代码展示出来\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function VNode(tag, data, children, text) {\n      return {\n        tag: tag,\n        data: data,\n        children: children,\n        text: text\n      }\n    }\n\n    class Vue {\n      constructor(options) {\n        this.$options = options\n        this._data = options.data\n        Object.keys(options.data).forEach(key =\x3e this._proxy(key))\n        observer(options.data)\n        const vdom = watch(this, this._render.bind(this), this._update.bind(this))\n        console.log(vdom)\n      }\n      _proxy(key) {\n        const self = this\n        Object.defineProperty(self, key, {\n          configurable: true,\n          enumerable: true,\n          get: function proxyGetter () {\n            return self._data[key]\n          },\n          set: function proxySetter (val) {\n            self._data.text = val\n          }\n        })\n      }\n      _update() {\n        console.log(\x26quot;我需要更新\x26quot;);\n        const vdom = this._render.call(this)\n        console.log(vdom);\n      }\n      _render() {\n        return this.$options.render.call(this)\n      }\n      __h__(tag, attr, children) {\n        return VNode(tag, attr, children.map((child)=\x3e{\n          if(typeof child === \x27string\x27){\n            return VNode(undefined, undefined, undefined, child)\n          }else{\n            return child\n          }\n        }))\n      }\n      __toString__(val) {\n        return val == null ? \x27\x27 : typeof val === \x27object\x27 ? JSON.stringify(val, null, 2) : String(val);\n      }\n    }\n\n    function observer(value, cb){\n      Object.keys(value).forEach((key) =\x3e defineReactive(value, key, value[key] , cb))\n    }\n\n    function defineReactive(obj, key, val, cb) {\n      const dep = new Dep()\n      Object.defineProperty(obj, key, {\n        enumerable: true,\n        configurable: true,\n        get: ()=\x3e{\n          if(Dep.target){\n            dep.add(Dep.target)\n          }\n          return val\n        },\n        set: newVal =\x3e {\n          if(newVal === val)\n            return\n          val = newVal\n          dep.notify()\n        }\n      })\n    }\n    function watch(vm, exp, cb){\n      Dep.target = cb\n      return exp()\n    }\n\n    class Dep {\n      constructor() {\n        this.subs = []\n      }\n      add(cb) {\n        this.subs.push(cb)\n      }\n      notify() {\n        this.subs.forEach((cb) =\x3e cb())\n      }\n    }\n    Dep.target = null\n\n\n    var demo = new Vue({\n      el: \x27#demo\x27,\n      data: {\n        text: \x26quot;before\x26quot;,\n      },\n      render(){\n        return this.__h__(\x27div\x27, {}, [\n          this.__h__(\x27span\x27, {}, [this.__toString__(this.text)])\n        ])\n      }\n    })\n\n\n     setTimeout(function(){\n       demo.text = \x26quot;after\x26quot;\n     }, 3000)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVNode\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3etag, data, children, text\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-attr\x22\x3etag\x3c\/span\x3e: tag,\n        \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: data,\n        \x3cspan class=\x22hljs-attr\x22\x3echildren\x3c\/span\x3e: children,\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: text\n      }\n    }\n\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVue\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e(options) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options = options\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._data = options.data\n        \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(options.data).forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._proxy(key))\n        observer(options.data)\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vdom = watch(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._render.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e), \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._update.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e))\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(vdom)\n      }\n      _proxy(key) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e self = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e\n        \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(self, key, {\n          \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n          \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproxyGetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e self._data[key]\n          },\n          \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eproxySetter\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) \x3c\/span\x3e{\n            self._data.text = val\n          }\n        })\n      }\n      _update() {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22我需要更新\x22\x3c\/span\x3e);\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e vdom = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._render.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(vdom);\n      }\n      _render() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options.render.call(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e)\n      }\n      __h__(tag, attr, children) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e VNode(tag, attr, children.map(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3echild\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e child === \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e){\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e VNode(\x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e, child)\n          }\x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e child\n          }\n        }))\n      }\n      __toString__(val) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val == \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e ? \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e : \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val === \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e ? \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(val, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) : \x3cspan class=\x22hljs-built_in\x22\x3eString\x3c\/span\x3e(val);\n      }\n    }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eobserver\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evalue, cb\x3c\/span\x3e)\x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(value).forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ekey\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e defineReactive(value, key, value[key] , cb))\n    }\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3edefineReactive\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eobj, key, val, cb\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e dep = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Dep()\n      \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.defineProperty(obj, key, {\n        \x3cspan class=\x22hljs-attr\x22\x3eenumerable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3econfigurable\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eget\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e=\x26gt;\x3c\/span\x3e{\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(Dep.target){\n            dep.add(Dep.target)\n          }\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val\n        },\n        \x3cspan class=\x22hljs-attr\x22\x3eset\x3c\/span\x3e: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3enewVal\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(newVal === val)\n            \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n          val = newVal\n          dep.notify()\n        }\n      })\n    }\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evm, exp, cb\x3c\/span\x3e)\x3c\/span\x3e{\n      Dep.target = cb\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e exp()\n    }\n\n    \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eDep\x3c\/span\x3e \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs = []\n      }\n      add(cb) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.push(cb)\n      }\n      notify() {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.subs.forEach(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3ecb\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e cb())\n      }\n    }\n    Dep.target = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\n\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e demo = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n      \x3cspan class=\x22hljs-attr\x22\x3eel\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27#demo\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3edata\x3c\/span\x3e: {\n        \x3cspan class=\x22hljs-attr\x22\x3etext\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22before\x22\x3c\/span\x3e,\n      },\n      render(){\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27div\x27\x3c\/span\x3e, {}, [\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__h__(\x3cspan class=\x22hljs-string\x22\x3e\x27span\x27\x3c\/span\x3e, {}, [\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.__toString__(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.text)])\n        ])\n      }\n    })\n\n\n     setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e)\x3c\/span\x3e{\n       demo.text = \x3cspan class=\x22hljs-string\x22\x3e\x22after\x22\x3c\/span\x3e\n     }, \x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们看一下运行结果\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/odqs6mk2t.qnssl.com\/D4A9A9B8-03CA-4A73-A12F-30409E08D99D.png\x22 src=\x22https:\/\/static.alili.techhttps:\/\/odqs6mk2t.qnssl.com\/D4A9A9B8-03CA-4A73-A12F-30409E08D99D.png\x22 alt=\x22D4A9A9B8-03CA-4A73-A12F-30409E08D99D.png\x22 title=\x22D4A9A9B8-03CA-4A73-A12F-30409E08D99D.png\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e好我们解释一下 \x3ccode\x3eDep.target\x3c\/code\x3e 因为我们得区分是，普通的\x3ccode\x3eget\x3c\/code\x3e，还是在查找依赖的时候的\x3ccode\x3eget\x3c\/code\x3e，\x3cbr\x3e所有我们在查找依赖时候，我们将\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    function watch(vm, exp, cb){\n      Dep.target = cb\n      return exp()\n    }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ewatch\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3evm, exp, cb\x3c\/span\x3e)\x3c\/span\x3e{\n      Dep.target = cb\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e exp()\n    }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eDep.target\x3c\/code\x3e 赋值，相当于 flag 一下，然后  \x3ccode\x3eget\x3c\/code\x3e 的时候\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22       get: () =\x3e {\n          if (Dep.target) {\n            dep.add(Dep.target)\n          }\n          return val\n        },\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e       get: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (Dep.target) {\n            dep.add(Dep.target)\n          }\n          \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val\n        },\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e判断一下，就好了。\x3cbr\x3e到现在为止，我们再看那张图是不是就清楚很多了？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e我非常喜欢，vue2.0 以上代码为了好展示，都采用最简单的方式呈现。\x3cbr\x3e  不过整个代码执行过程，甚至是命名方式都和vue2.0一样\x3cbr\x3e  对比react，vue2.0 自动帮你监测依赖，自动帮你重新渲染，而\x3cbr\x3e  react 要实现性能最大化，要做大量工作，比如我以前分享的\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004290333\x22 target=\x22_blank\x22\x3ereact如何性能达到最大化(前传)，暨react为啥非得使用immutable.js\x3c\/a\x3e\x3cbr\x3e\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000004295639\x22\x3ereact 实现pure render的时候，bind(this)隐患\x3c\/a\x3e。\x3cbr\x3e  而 vue2.0 天然帮你做到了最优,而且对于像万年不变的 如标签上静态的\x3ccode\x3eclass\x3c\/code\x3e属性，\x3cbr\x3e  vue2.0 在重新渲染后做diff 的时候是不比较的，vue2.0比 达到性能最大化的react 还要快的一个原因\x3cbr\x3e  然后源码\x3ca href=\x22https:\/\/github.com\/georgebbbb\/fakeVue\/blob\/master\/vue2.0\/index.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e在此\x3c\/a\x3e，喜欢的记得给个 star 哦?\x3cbr\x3e  后续，我会简单聊聊，vue2.0的diff。\x3cbr\x3e  如果有疑问，可以在评论区留言哈\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>vue2.0源码分析之理解响应式架构</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007334535">https://segmentfault.com/a/1190000007334535</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/o0md76h6d5b/" target="_blank">https://alili.tech/archive/o0md76h6d5b/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>