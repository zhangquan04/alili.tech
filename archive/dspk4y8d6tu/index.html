<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="前端国际化之Vue-i18n源码分析"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>前端国际化之Vue-i18n源码分析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/dspk4y8d6tu/",
				"appid": "1613049289050283", 
				"title": "前端国际化之Vue-i18n源码分析 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-18T02:30:34"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/nu65auie3yp/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/r6vmztglv6t/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&text=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&text=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&title=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&is_video=false&description=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&title=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&title=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&title=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fdspk4y8d6tu%2f&title=%e5%89%8d%e7%ab%af%e5%9b%bd%e9%99%85%e5%8c%96%e4%b9%8bVue-i18n%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">前端国际化之Vue-i18n源码分析</h1><div class="meta"><div class="postdate"><time datetime="2019-01-18" itemprop="datePublished">2019-01-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e最近的工作当中有个任务是做国际化。这篇文章也是做个简单的总结。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e部分网站的当前解决的方案\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e不同语言对应不同的页面。在本地开发的时候就分别打包输出了不同语言版本的静态及模板文件，通过页面及资源的\x3ccode\x3eurl\x3c\/code\x3e进行区分,需要维护多份代码。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在线翻译\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e统一模板文件，前端根据相应的语言映射表去做文案的替换。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e面对的问题\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\n\x3cp\x3e语言标识谁来做？\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e页面完全由服务端直出(所有的数据均由服务端来处理)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e服务端根据\x3ccode\x3eIP\x3c\/code\x3e去下发语言标识字段(前端根据下发的表示字段切换语言环境)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e前端去根据\x3ccode\x3euseragent.lang\x3c\/code\x3e浏览器环境语言进行设定\x3cbr\x3e   当前项目中入口页面由服务端来渲染,其他的页面由前端来接管路由。在入口页面由服务器下发\x3ccode\x3elang\x3c\/code\x3e字段去做语言标识，在页面渲染出来前，前端来决定使用的语言包。语言包是在本地编译的过程中就将语言包编译进了代码当中，没有采用异步加载的方式。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e前端静态资源翻译\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e单\/复数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e中文转英文\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e语言展示的方向\x3cbr\x3e前端静态资源文案的翻译使用\x3ccode\x3evue-i18n\x3c\/code\x3e这个插件来进行。插件提供了单复数，中文转英文的方法。a下文有对\x3ccode\x3evue-i18n\x3c\/code\x3e的源码进行分析。因为英文的阅读方向也是从左到右，因此语言展示的方向不予考虑。但是在一些阿拉伯地区国家的语言是从右到左进行阅读的。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e服务端数据翻译\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e前端样式的调整\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e中文转英文后部分文案过长\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e图片\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e第三方插件(\x3ccode\x3e地图\x3c\/code\x3e,\x3ccode\x3eSDK\x3c\/code\x3e等)\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3ea.中文转英文后肯定会遇到文案过长的情况。那么可能需要精简翻译，使文案保持在一定的可接受的长度范围内。但是大部分的情况都是文案在保持原意的情况下无法再进行精简。这时必须要前端来进行样式上的调整，那么可能还需要设计的同学参与进来，对一些文案过多出现折行的情况再单独做样式的定义。在细调样式这块，主要还是通过不同的语言标识去控制不同标签的\x3ccode\x3eclass\x3c\/code\x3e，来单独定义样式。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVKS5D?w=682\x26amp;h=1166\x22 src=\x22https:\/\/static.alili.tech\/img\/bVKS5D?w=682\x26amp;h=1166\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e此外，还有部分图片也是需要做调整，在C端中，大部分由产品方去输出内容，那么图片这块的话，还需要设计同学单独出图。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在第三方插件中这个环节当中，因为使用了\x3ccode\x3e腾讯地图\x3c\/code\x3e插件，由于腾讯地图并未推出国内地图的英文版，所以整个页面的地图部分暂时无法做到国际化。由此联想到，在你的应用当中使用的其他一些\x3ccode\x3e第三方插件\x3c\/code\x3e或者\x3ccode\x3eSDK\x3c\/code\x3e，在国际化的过程中需要去解决哪些问题。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVKS5I?w=686\x26amp;h=1172\x22 src=\x22https:\/\/static.alili.tech\/img\/bVKS5I?w=686\x26amp;h=1172\x22 alt=\x22图片描述\x22 title=\x22图片描述\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e跨地区xxxx\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e货币及支付方式\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e时间的格式\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e在一些\x3ccode\x3e支付场景\x3c\/code\x3e下，\x3ccode\x3e货币符号\x3c\/code\x3e，\x3ccode\x3e单位\x3c\/code\x3e及\x3ccode\x3e价格\x3c\/code\x3e的转化等。不同国家地区在时间的格式显示上有差异。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e项目的长期维护\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e翻译工作\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emap\x3c\/code\x3e表的维护\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e当前翻译的工作流程是拆页面，每拆一个页面，FE同学整理好可能会出现的中文文案，再交由翻译的同学去完成翻译的工作。负责不同页面的同学维护着不同的\x3ccode\x3emap\x3c\/code\x3e表，在当前的整体页面架构中，不同功能模块和页面被拆分出去交由不同的同学去做，那么通过跳页面的方式去暂时缓解\x3ccode\x3emap\x3c\/code\x3e表的维护问题。如果哪一天页面需要收敛，这也是一个需要去考虑的问题。如果从整个项目的一开始就考虑到国际化的问题并采取相关的措施都能减轻后期的工作量及维护成本。同时以后一旦\x3ccode\x3emap\x3c\/code\x3e表内容过多，是否需要考虑需要将\x3ccode\x3emap\x3c\/code\x3e表进行异步加载。\x3c\/p\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3eVue-i18n的基本使用\x3c\/h2\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ 入口main.js文件\n    import VueI18n from \x27vue-i18n\x27\n    \n    Vue.use(VueI18n)            \/\/ 通过插件的形式挂载\n    \n    const i18n = new VueI18n({\n        locale: CONFIG.lang,    \/\/ 语言标识\n        messages: {\n            \x27zh-CN\x27: require(\x27.\/common\/lang\/zh\x27),   \/\/ 中文语言包\n            \x27en-US\x27: require(\x27.\/common\/lang\/en\x27)    \/\/ 英文语言包\n        }\n    })\n    \n    const app = new Vue({\n        i18n,\n        ...App\n    }).$mout(\x27#root\x27)\n    \n    \/\/ 单vue文件\n    \x3ctemplate\x3e\n        \x3cspan\x3e\x22{{\x22$t(\x27你好\x27)\x22}}\x22\x3c\/span\x3e\n    \x3c\/template\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 入口main.js文件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e VueI18n \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27vue-i18n\x27\x3c\/span\x3e\n    \n    Vue.use(VueI18n)            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过插件的形式挂载\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e i18n = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e VueI18n({\n        \x3cspan class=\x22hljs-attr\x22\x3elocale\x3c\/span\x3e: CONFIG.lang,    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 语言标识\x3c\/span\x3e\n        messages: {\n            \x3cspan class=\x22hljs-string\x22\x3e\x27zh-CN\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/common\/lang\/zh\x27\x3c\/span\x3e),   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 中文语言包\x3c\/span\x3e\n            \x3cspan class=\x22hljs-string\x22\x3e\x27en-US\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/common\/lang\/en\x27\x3c\/span\x3e)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 英文语言包\x3c\/span\x3e\n        }\n    })\n    \n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e app = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({\n        i18n,\n        ...App\n    }).$mout(\x3cspan class=\x22hljs-string\x22\x3e\x27#root\x27\x3c\/span\x3e)\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 单vue文件\x3c\/span\x3e\n    \x26lt;template\x26gt;\n        \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x22{{\x22$t(\x27你好\x27)\x22}}\x22\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\n    \x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/template\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3eVue-i18n\x3c\/code\x3e是以插件的形式配合\x3ccode\x3eVue\x3c\/code\x3e进行工作的。通过全局的\x3ccode\x3emixin\x3c\/code\x3e的方式将插件提供的方法挂载到\x3ccode\x3eVue\x3c\/code\x3e的实例上。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e具体的源码分析\x3c\/h2\x3e\n\x3cp\x3e其中\x3ccode\x3einstall.js\x3c\/code\x3eVue的挂载函数,主要是为了将\x3ccode\x3emixin.js\x3c\/code\x3e里面的提供的方法挂载到\x3ccode\x3eVue\x3c\/code\x3e实例当中:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { warn } from \x27.\/util\x27\nimport mixin from \x27.\/mixin\x27\nimport Asset from \x27.\/asset\x27\n\nexport let Vue\n\n\/\/ 注入root Vue\nexport function install (_Vue) { \n  Vue = _Vue\n\n  const version = (Vue.version \x26amp;\x26amp; Number(Vue.version.split(\x27.\x27)[0])) || -1\n  if (process.env.NODE_ENV !== \x27production\x27 \x26amp;\x26amp; install.installed) {\n    warn(\x27already installed.\x27)\n    return\n  }\n  install.installed = true\n\n  if (process.env.NODE_ENV !== \x27production\x27 \x26amp;\x26amp; version \x3c 2) {\n    warn(`vue-i18n (${install.version}) need to use Vue 2.0 or later (Vue: ${Vue.version}).`)\n    return\n  }\n\n  \/\/ 通过mixin的方式，将插件提供的methods，钩子函数等注入到全局，之后每次创建的vue实例都用拥有这些methods或者钩子函数\n  Vue.mixin(mixin)\n\n  Asset(Vue)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { warn } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e mixin \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/mixin\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e Asset \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/asset\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e Vue\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 注入root Vue\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3einstall\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e_Vue\x3c\/span\x3e) \x3c\/span\x3e{ \n  Vue = _Vue\n\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e version = (Vue.version \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3eNumber\x3c\/span\x3e(Vue.version.split(\x3cspan class=\x22hljs-string\x22\x3e\x27.\x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e])) || \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e \x26amp;\x26amp; install.installed) {\n    warn(\x3cspan class=\x22hljs-string\x22\x3e\x27already installed.\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n  install.installed = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e \x26amp;\x26amp; version \x26lt; \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) {\n    warn(\x3cspan class=\x22hljs-string\x22\x3e`vue-i18n (\x3cspan class=\x22hljs-subst\x22\x3e${install.version}\x3c\/span\x3e) need to use Vue 2.0 or later (Vue: \x3cspan class=\x22hljs-subst\x22\x3e${Vue.version}\x3c\/span\x3e).`\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 通过mixin的方式，将插件提供的methods，钩子函数等注入到全局，之后每次创建的vue实例都用拥有这些methods或者钩子函数\x3c\/span\x3e\n  Vue.mixin(mixin)\n\n  Asset(Vue)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e接下来就看下在\x3ccode\x3eVue\x3c\/code\x3e上混合了哪些\x3ccode\x3emethods\x3c\/code\x3e或者\x3ccode\x3e钩子函数\x3c\/code\x3e. 在\x3ccode\x3emixin.js\x3c\/code\x3e文件中:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* @flow *\/\n\n\/\/ VueI18n构造函数\nimport VueI18n from \x27.\/index\x27\nimport { isPlainObject, warn } from \x27.\/util\x27\n\n\n\/\/ $i18n 是每创建一个Vue实例都会产生的实例对象\n\/\/ 调用以下方法前都会判断实例上是否挂载了$i18n这个属性\n\/\/ 最后实际调用的方法是插件内部定义的方法\nexport default {\n  \/\/ 这里混合了computed计算属性, 注意这里计算属性返回的都是函数,这样就可以在vue模板里面使用\x22{{\x22 $t(\x27hello\x27) \x22}}\x22, 或者其他方法当中使用 this.$t(\x27hello\x27)。这种函数接收参数的方式\n  computed: {\n    \/\/ 翻译函数, 调用的是VueI18n实例上提供的方法\n    $t () {\n      if (!this.$i18n) {\n        throw Error(`Failed in $t due to not find VueI18n instance`)\n      }\n      \/\/ add dependency tracking !!\n      const locale: string = this.$i18n.locale          \/\/ 语言配置\n      const messages: Messages = this.$i18n.messages    \/\/ 语言包\n      \/\/ 返回一个函数. 接受一个key值. 即在map文件中定义的key值, 在模板中进行使用 \x22{{\x22 $t(\x27你好\x27) \x22}}\x22\n      \/\/ ...args是传入的参数, 例如在模板中定义的一些替换符, 具体的支持的形式可翻阅文档https:\/\/kazupon.github.io\/vue-i18n\/formatting.html\n      return (key: string, ...args: any): string =\x3e {\n        return this.$i18n._t(key, locale, messages, this, ...args)\n      }\n    },\n\n    \/\/ tc方法可以单独定义组件内部语言设置选项, 如果没有定义组件内部语言，则还是使用global的配置\n    $tc () {\n      if (!this.$i18n) {\n        throw Error(`Failed in $tc due to not find VueI18n instance`)\n      }\n      \/\/ add dependency tracking !!\n      const locale: string = this.$i18n.locale\n      const messages: Messages = this.$i18n.messages\n      return (key: string, choice?: number, ...args: any): string =\x3e {\n        return this.$i18n._tc(key, locale, messages, this, choice, ...args)\n      }\n    },\n\n    \/\/ te方法\n    $te () {\n      if (!this.$i18n) {\n        throw Error(`Failed in $te due to not find VueI18n instance`)\n      }\n      \/\/ add dependency tracking !!\n      const locale: string = this.$i18n.locale\n      const messages: Messages = this.$i18n.messages\n      return (key: string, ...args: any): boolean =\x3e {\n        return this.$i18n._te(key, locale, messages, ...args)\n      }\n    }\n  },\n\n  \/\/ 钩子函数\n  \/\/ 被渲染前，在vue实例上添加$i18n属性\n  \/\/ 在根组件初始化的过程中:\n  \/**\n   * new Vue({\n   *   i18n   \/\/ 这里是提供了自定义的属性 那么实例当中可以通过this.$option.i18n去访问这个属性\n   *   \/\/ xxxx\n   * })\n   *\/\n  beforeCreate () {\n    const options: any = this.$options\n    \/\/ 如果有i18n这个属性. 根实例化的时候传入了这个参数\n    if (options.i18n) {\n      if (options.i18n instanceof VueI18n) {\n        \/\/ 如果是VueI18n的实例，那么挂载在Vue实例的$i18n属性上\n        this.$i18n = options.i18n\n        \/\/ 如果是个object\n      } else if (isPlainObject(options.i18n)) {     \/\/ 如果是一个pobj\n        \/\/ component local i18n\n        \/\/ 访问root vue实例。\n        if (this.$root \x26amp;\x26amp; this.$root.$i18n \x26amp;\x26amp; this.$root.$i18n instanceof VueI18n) {\n          options.i18n.root = this.$root.$i18n\n        }\n        this.$i18n = new VueI18n(options.i18n)  \/\/ 创建属于component的local i18n\n        if (options.i18n.sync) {\n          this._localeWatcher = this.$i18n.watchLocale()\n        }\n      } else {\n        if (process.env.NODE_ENV !== \x27production\x27) {\n          warn(`Cannot be interpreted \x27i18n\x27 option.`)\n        }\n      }\n    } else if (this.$root \x26amp;\x26amp; this.$root.$i18n \x26amp;\x26amp; this.$root.$i18n instanceof VueI18n) {\n      \/\/ root i18n\n      \/\/ 如果子Vue实例没有传入$i18n方法,且root挂载了$i18n,那么子实例也会使用root i18n\n      this.$i18n = this.$root.$i18n\n    }\n  },\n\n  \/\/ 实例被销毁的回调函数\n  destroyed () {\n    if (this._localeWatcher) {\n      this.$i18n.unwatchLocale()\n      delete this._localeWatcher\n    }\n\n    \/\/ 组件销毁后，同时也销毁实例上的$i18n方法\n    this.$i18n = null\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* @flow *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ VueI18n构造函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e VueI18n \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/index\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { isPlainObject, warn } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e\n\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ $i18n 是每创建一个Vue实例都会产生的实例对象\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用以下方法前都会判断实例上是否挂载了$i18n这个属性\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 最后实际调用的方法是插件内部定义的方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里混合了computed计算属性, 注意这里计算属性返回的都是函数,这样就可以在vue模板里面使用\x22{{\x22 $t(\x27hello\x27) \x22}}\x22, 或者其他方法当中使用 this.$t(\x27hello\x27)。这种函数接收参数的方式\x3c\/span\x3e\n  computed: {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 翻译函数, 调用的是VueI18n实例上提供的方法\x3c\/span\x3e\n    $t () {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Failed in $t due to not find VueI18n instance`\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ add dependency tracking !!\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale: string = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.locale          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 语言配置\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e messages: Messages = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.messages    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 语言包\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回一个函数. 接受一个key值. 即在map文件中定义的key值, 在模板中进行使用 \x22{{\x22 $t(\x27你好\x27) \x22}}\x22\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ...args是传入的参数, 例如在模板中定义的一些替换符, 具体的支持的形式可翻阅文档https:\/\/kazupon.github.io\/vue-i18n\/formatting.html\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (key: string, ...args: any): \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n._t(key, locale, messages, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, ...args)\n      }\n    },\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ tc方法可以单独定义组件内部语言设置选项, 如果没有定义组件内部语言，则还是使用global的配置\x3c\/span\x3e\n    $tc () {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Failed in $tc due to not find VueI18n instance`\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ add dependency tracking !!\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale: string = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.locale\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e messages: Messages = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.messages\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (key: string, choice?: number, ...args: any): \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3estring\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n._tc(key, locale, messages, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e, choice, ...args)\n      }\n    },\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ te方法\x3c\/span\x3e\n    $te () {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e`Failed in $te due to not find VueI18n instance`\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ add dependency tracking !!\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale: string = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.locale\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e messages: Messages = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.messages\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (key: string, ...args: any): \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eboolean\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n._te(key, locale, messages, ...args)\n      }\n    }\n  },\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 钩子函数\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 被渲染前，在vue实例上添加$i18n属性\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 在根组件初始化的过程中:\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * new Vue({\n   *   i18n   \/\/ 这里是提供了自定义的属性 那么实例当中可以通过this.$option.i18n去访问这个属性\n   *   \/\/ xxxx\n   * })\n   *\/\x3c\/span\x3e\n  beforeCreate () {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options: any = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$options\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果有i18n这个属性. 根实例化的时候传入了这个参数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.i18n) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.i18n \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e VueI18n) {\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是VueI18n的实例，那么挂载在Vue实例的$i18n属性上\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n = options.i18n\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是个object\x3c\/span\x3e\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPlainObject(options.i18n)) {     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是一个pobj\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ component local i18n\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 访问root vue实例。\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e VueI18n) {\n          options.i18n.root = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n\n        }\n        \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e VueI18n(options.i18n)  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建属于component的local i18n\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (options.i18n.sync) {\n          \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._localeWatcher = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.watchLocale()\n        }\n      } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n          warn(\x3cspan class=\x22hljs-string\x22\x3e`Cannot be interpreted \x27i18n\x27 option.`\x3c\/span\x3e)\n        }\n      }\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n \x3cspan class=\x22hljs-keyword\x22\x3einstanceof\x3c\/span\x3e VueI18n) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ root i18n\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果子Vue实例没有传入$i18n方法,且root挂载了$i18n,那么子实例也会使用root i18n\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$root.$i18n\n    }\n  },\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实例被销毁的回调函数\x3c\/span\x3e\n  destroyed () {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._localeWatcher) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n.unwatchLocale()\n      \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._localeWatcher\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 组件销毁后，同时也销毁实例上的$i18n方法\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.$i18n = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这里注意下这几个方法的区别:\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e$tc\x3c\/code\x3e这个方法可以用以返回翻译的复数字符串, 及一个\x3ccode\x3ekey\x3c\/code\x3e可以对应的翻译文本，通过\x3ccode\x3e|\x3c\/code\x3e进行连接:\x3c\/p\x3e\n\x3cp\x3e例如:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    \/\/ main.js\n    new VueI18n({\n        messages: {\n            car: \x27car | cars\x27\n        }\n    })\n    \n    \/\/ template\n    \x3cspan\x3e\x22{{\x22$tc(\x27car\x27, 1)\x22}}\x22\x3c\/span\x3e   ===\x3e\x3e\x3e  \x3cspan\x3ecar\x3c\/span\x3e\n    \x3cspan\x3e\x22{{\x22$tc(\x27car\x27, 2)\x22}}\x22\x3c\/span\x3e   ===\x3e\x3e\x3e  \x3cspan\x3ecars\x3c\/span\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ main.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e VueI18n({\n        \x3cspan class=\x22hljs-attr\x22\x3emessages\x3c\/span\x3e: {\n            \x3cspan class=\x22hljs-attr\x22\x3ecar\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27car | cars\x27\x3c\/span\x3e\n        }\n    })\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ template\x3c\/span\x3e\n    \x26lt;span\x26gt;\x22{{\x22$tc(\x3cspan class=\x22hljs-string\x22\x3e\x27car\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e)\x22}}\x22\x26lt;\x3cspan class=\x22hljs-regexp\x22\x3e\/span\x26gt;   ===\x26gt;\x26gt;\x26gt;  \x26lt;span\x26gt;car\x26lt;\/\x3c\/span\x3espan\x26gt;\n    \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x22{{\x22$tc(\x27car\x27, 2)\x22}}\x22\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e   ===\x26gt;\x26gt;\x26gt;  \x3cspan class=\x22xml\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3ecars\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3espan\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3e$te\x3c\/code\x3e这个方法用以判断需要翻译的\x3ccode\x3ekey\x3c\/code\x3e在你提供的\x3ccode\x3e语言包(messages)\x3c\/code\x3e中是否存在.\x3c\/p\x3e\n\x3cp\x3e接下来就看看\x3ccode\x3eVueI18n\x3c\/code\x3e构造函数及原型上提供了哪些可以被实例继承的属性或者方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/* @flow *\/\n\nimport { install, Vue } from \x27.\/install\x27\nimport { warn, isNull, parseArgs, fetchChoice } from \x27.\/util\x27\nimport BaseFormatter from \x27.\/format\x27    \/\/ 转化函数 封装了format, 里面包含了template模板替换的方法\nimport getPathValue from \x27.\/path\x27\n\nimport type { PathValue } from \x27.\/path\x27\n\n\/\/ VueI18n构造函数\nexport default class VueI18n {\n  static install: () =\x3e void\n  static version: string\n\n  _vm: any\n  _formatter: Formatter\n  _root: ?I18n\n  _sync: ?boolean\n  _fallbackRoot: boolean\n  _fallbackLocale: string\n  _missing: ?MissingHandler\n  _exist: Function\n  _watcher: any\n\n  \/\/ 实例化参数配置\n  constructor (options: I18nOptions = {}) {\n    const locale: string = options.locale || \x27en-US\x27    \/\/ vue-i18n初始化的时候语言参数配置\n    const messages: Messages = options.messages || {}   \/\/ 本地配置的所有语言环境都是挂载到了messages这个属性上\n    this._vm = null                 \/\/ ViewModel\n    this._fallbackLocale = options.fallbackLocale || \x27en-US\x27  \/\/ 缺省语言配置\n    this._formatter = options.formatter || new BaseFormatter()  \/\/ 翻译函数\n    this._missing = options.missing\n    this._root = options.root || null\n    this._sync = options.sync || false   \n    this._fallbackRoot = options.fallbackRoot || false\n\n    this._exist = (message: Object, key: string): boolean =\x3e {\n      if (!message || !key) { return false }\n      return !isNull(getPathValue(message, key))\n    }\n\n    this._resetVM({ locale, messages })\n  }\n\n  \/\/ VM \n  \/\/ 重置viewModel\n  _resetVM (data: { locale: string, messages: Messages }): void {\n    const silent = Vue.config.silent\n    Vue.config.silent = true\n    this._vm = new Vue({ data })\n    Vue.config.silent = silent\n  }\n\n  \/\/ 根实例的vm监听locale这个属性\n  watchLocale (): any {\n    if (!this._sync || !this._root) { return null }\n    const target: any = this._vm\n    \/\/ vm.$watch返回的是一个取消观察的函数，用来停止触发回调\n    this._watcher = this._root.vm.$watch(\x27locale\x27, (val) =\x3e {\n      target.$set(target, \x27locale\x27, val)\n    }, { immediate: true })\n    return this._watcher\n  }\n\n  \/\/ 停止触发vm.$watch观察函数\n  unwatchLocale (): boolean {\n    if (!this._sync || !this._watcher) { return false }\n    if (this._watcher) {\n      this._watcher()\n      delete this._watcher\n    }\n    return true\n  }\n\n  get vm (): any { return this._vm }\n\n  get messages (): Messages { return this._vm.$data.messages }                  \/\/ get 获取messages参数\n  set messages (messages: Messages): void { this._vm.$set(this._vm, \x27messages\x27, messages) }  \/\/ set 设置messages参数\n\n  get locale (): string { return this._vm.$data.locale }                        \/\/ get 获取语言配置参数\n  set locale (locale: string): void { this._vm.$set(this._vm, \x27locale\x27, locale) }     \/\/ set 重置语言配置参数\n\n  get fallbackLocale (): string { return this._fallbackLocale }                 \/\/  fallbackLocale 是什么?\n  set fallbackLocale (locale: string): void { this._fallbackLocale = locale }\n\n  get missing (): ?MissingHandler { return this._missing }\n  set missing (handler: MissingHandler): void { this._missing = handler }\n\n  get formatter (): Formatter { return this._formatter }                          \/\/ get 转换函数\n  set formatter (formatter: Formatter): void { this._formatter = formatter }      \/\/ set 转换函数\n\n  _warnDefault (locale: string, key: string, result: ?any, vm: ?any): ?string {\n    if (!isNull(result)) { return result }\n    if (this.missing) {\n      this.missing.apply(null, [locale, key, vm])\n    } else {\n      if (process.env.NODE_ENV !== \x27production\x27) {\n        warn(\n          `Cannot translate the value of keypath \x27${key}\x27. ` \x2b\n          \x27Use the value of keypath as default.\x27\n        )\n      }\n    }\n    return key\n  }\n\n  _isFallbackRoot (val: any): boolean {\n    return !val \x26amp;\x26amp; !isNull(this._root) \x26amp;\x26amp; this._fallbackRoot\n  }\n\n  \/\/ 插入函数\n  _interpolate (message: Messages, key: string, args: any): any {\n    if (!message) { return null }\n\n    \/\/ 获取key对应的字符串\n    let val: PathValue = getPathValue(message, key)\n    if (Array.isArray(val)) { return val }\n    if (isNull(val)) { val = message[key] }\n    if (isNull(val)) { return null }\n    if (typeof val !== \x27string\x27) {\n      warn(`Value of key \x27${key}\x27 is not a string!`)\n      return null\n    }\n\n\n    \/\/ TODO ?? 这里的links是干什么的？\n    \/\/ Check for the existance of links within the translated string\n    if (val.indexOf(\x27@:\x27) \x3e= 0) {\n      \/\/ Match all the links within the local\n      \/\/ We are going to replace each of\n      \/\/ them with its translation\n      const matches: any = val.match(\/(@:[\\w|.]\x2b)\/g)\n      for (const idx in matches) {\n        const link = matches[idx]\n        \/\/ Remove the leading @:\n        const linkPlaceholder = link.substr(2)\n        \/\/ Translate the link\n        const translatedstring = this._interpolate(message, linkPlaceholder, args)\n        \/\/ Replace the link with the translated string\n        val = val.replace(link, translatedstring)\n      }\n    }\n\n    \/\/ 如果没有传入需要替换的obj, 那么直接返回字符串, 否则调用this._format进行变量等的替换\n    return !args ? val : this._format(val, args)    \/\/ 获取替换后的字符\n  }\n\n  _format (val: any, ...args: any): any {\n    return this._formatter.format(val, ...args)\n  }\n\n  \/\/ 翻译函数\n  _translate (messages: Messages, locale: string, fallback: string, key: string, args: any): any {\n    let res: any = null\n    \/**\n     * messages[locale] 使用哪个语言包\n     * key 语言映射表的key\n     * args 映射替换关系\n     *\/\n    res = this._interpolate(messages[locale], key, args)\n    if (!isNull(res)) { return res }\n\n    res = this._interpolate(messages[fallback], key, args)\n    if (!isNull(res)) {\n      if (process.env.NODE_ENV !== \x27production\x27) {\n        warn(`Fall back to translate the keypath \x27${key}\x27 with \x27${fallback}\x27 locale.`)\n      }\n      return res\n    } else {\n      return null\n    }\n  }\n\n  \/\/ 翻译的核心函数\n  \/**\n   * 这里的方法传入的参数参照mixin.js里面的定义的方法\n   * key map的key值 (为接受的外部参数)\n   * _locale 语言配置选项: \x27zh-CN\x27 | \x27en-US\x27 (内部变量)\n   * messages 映射表 (内部变量)\n   * host为这个i18n的实例 (内部变量)\n   *\n   *\/\n  _t (key: string, _locale: string, messages: Messages, host: any, ...args: any): any {\n    if (!key) { return \x27\x27 }\n    \n    \/\/ parseArgs函数用以返回传入的局部语言配置, 及映射表\n    const parsedArgs = parseArgs(...args)   \/\/ 接收的参数{ locale, params(映射表) }\n    const locale = parsedArgs.locale || _locale   \/\/ 语言配置\n    \n    \/\/ 字符串替换\n    \/**\n     * @params messages  语言包\n     * @params locale  语言配置\n     * @params fallbackLocale 缺省语言配置\n     * @params key 替换的key值\n     * @params parsedArgs.params 需要被替换的参数map表\n     *\/\n    const ret: any = this._translate(messages, locale, this.fallbackLocale, key, parsedArgs.params)\n    if (this._isFallbackRoot(ret)) {\n      if (process.env.NODE_ENV !== \x27production\x27) {\n        warn(`Fall back to translate the keypath \x27${key}\x27 with root locale.`)\n      }\n      if (!this._root) { throw Error(\x27unexpected error\x27) }\n      return this._root.t(key, ...args)\n    } else {\n      return this._warnDefault(locale, key, ret, host)\n    }\n  }\n\n  \/\/ 转化函数\n  t (key: string, ...args: any): string {\n    return this._t(key, this.locale, this.messages, null, ...args)\n  }\n\n  _tc (key: string, _locale: string, messages: Messages, host: any, choice?: number, ...args: any): any {\n    if (!key) { return \x27\x27 }\n    if (choice !== undefined) {\n      return fetchChoice(this._t(key, _locale, messages, host, ...args), choice)\n    } else {\n      return this._t(key, _locale, messages, host, ...args)\n    }\n  }\n\n  tc (key: string, choice?: number, ...args: any): any {\n    return this._tc(key, this.locale, this.messages, null, choice, ...args)\n  }\n\n  _te (key: string, _locale: string, messages: Messages, ...args: any): boolean {\n    const locale = parseArgs(...args).locale || _locale\n    return this._exist(messages[locale], key)\n  }\n\n  te (key: string, ...args: any): boolean {\n    return this._te(key, this.locale, this.messages, ...args)\n  }\n}\n\nVueI18n.install = install\nVueI18n.version = \x27__VERSION__\x27\n\n\/\/ 如果是通过CDN或者外链的形式引入的Vue\nif (typeof window !== \x27undefined\x27 \x26amp;\x26amp; window.Vue) {\n  window.Vue.use(VueI18n)\n}\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/* @flow *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { install, Vue } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/install\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { warn, isNull, parseArgs, fetchChoice } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/util\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e BaseFormatter \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/format\x27\x3c\/span\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 转化函数 封装了format, 里面包含了template模板替换的方法\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e getPathValue \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/path\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e type { PathValue } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/path\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ VueI18n构造函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eVueI18n\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e install: \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3estatic\x3c\/span\x3e version: string\n\n  _vm: any\n  _formatter: Formatter\n  _root: ?I18n\n  _sync: ?boolean\n  _fallbackRoot: boolean\n  _fallbackLocale: string\n  _missing: ?MissingHandler\n  _exist: \x3cspan class=\x22hljs-built_in\x22\x3eFunction\x3c\/span\x3e\n  _watcher: any\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 实例化参数配置\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econstructor\x3c\/span\x3e (options: I18nOptions = {}) {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale: string = options.locale || \x3cspan class=\x22hljs-string\x22\x3e\x27en-US\x27\x3c\/span\x3e    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ vue-i18n初始化的时候语言参数配置\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e messages: Messages = options.messages || {}   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 本地配置的所有语言环境都是挂载到了messages这个属性上\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/ ViewModel\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._fallbackLocale = options.fallbackLocale || \x3cspan class=\x22hljs-string\x22\x3e\x27en-US\x27\x3c\/span\x3e  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 缺省语言配置\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._formatter = options.formatter || \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e BaseFormatter()  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 翻译函数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._missing = options.missing\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root = options.root || \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._sync = options.sync || \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e   \n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._fallbackRoot = options.fallbackRoot || \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._exist = (message: \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: string): \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eboolean\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!message || !key) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !isNull(getPathValue(message, key))\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._resetVM({ locale, messages })\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ VM \x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重置viewModel\x3c\/span\x3e\n  _resetVM (data: { \x3cspan class=\x22hljs-attr\x22\x3elocale\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3emessages\x3c\/span\x3e: Messages }): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e silent = Vue.config.silent\n    Vue.config.silent = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e Vue({ data })\n    Vue.config.silent = silent\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根实例的vm监听locale这个属性\x3c\/span\x3e\n  watchLocale (): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._sync || !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e }\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e target: any = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ vm.$watch返回的是一个取消观察的函数，用来停止触发回调\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root.vm.$watch(\x3cspan class=\x22hljs-string\x22\x3e\x27locale\x27\x3c\/span\x3e, (val) =\x26gt; {\n      target.$set(target, \x3cspan class=\x22hljs-string\x22\x3e\x27locale\x27\x3c\/span\x3e, val)\n    }, { \x3cspan class=\x22hljs-attr\x22\x3eimmediate\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 停止触发vm.$watch观察函数\x3c\/span\x3e\n  unwatchLocale (): boolean {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._sync || !\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher()\n      \x3cspan class=\x22hljs-keyword\x22\x3edelete\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._watcher\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e\n  }\n\n  get vm (): any { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm }\n\n  get messages (): Messages { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm.$data.messages }                  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get 获取messages参数\x3c\/span\x3e\n  set messages (messages: Messages): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm.$set(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm, \x3cspan class=\x22hljs-string\x22\x3e\x27messages\x27\x3c\/span\x3e, messages) }  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ set 设置messages参数\x3c\/span\x3e\n\n  get locale (): string { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm.$data.locale }                        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get 获取语言配置参数\x3c\/span\x3e\n  set locale (locale: string): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm.$set(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._vm, \x3cspan class=\x22hljs-string\x22\x3e\x27locale\x27\x3c\/span\x3e, locale) }     \x3cspan class=\x22hljs-comment\x22\x3e\/\/ set 重置语言配置参数\x3c\/span\x3e\n\n  get fallbackLocale (): string { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._fallbackLocale }                 \x3cspan class=\x22hljs-comment\x22\x3e\/\/  fallbackLocale 是什么?\x3c\/span\x3e\n  set fallbackLocale (locale: string): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._fallbackLocale = locale }\n\n  get missing (): ?MissingHandler { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._missing }\n  set missing (handler: MissingHandler): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._missing = handler }\n\n  get formatter (): Formatter { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._formatter }                          \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get 转换函数\x3c\/span\x3e\n  set formatter (formatter: Formatter): \x3cspan class=\x22hljs-keyword\x22\x3evoid\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._formatter = formatter }      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ set 转换函数\x3c\/span\x3e\n\n  _warnDefault (locale: string, \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3eresult\x3c\/span\x3e: ?any, \x3cspan class=\x22hljs-attr\x22\x3evm\x3c\/span\x3e: ?any): ?string {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isNull(result)) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.missing) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.missing.apply(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, [locale, key, vm])\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n        warn(\n          \x3cspan class=\x22hljs-string\x22\x3e`Cannot translate the value of keypath \x27\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e\x27. `\x3c\/span\x3e \x2b\n          \x3cspan class=\x22hljs-string\x22\x3e\x27Use the value of keypath as default.\x27\x3c\/span\x3e\n        )\n      }\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e key\n  }\n\n  _isFallbackRoot (val: any): boolean {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !val \x26amp;\x26amp; !isNull(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root) \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._fallbackRoot\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 插入函数\x3c\/span\x3e\n  _interpolate (message: Messages, \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3eargs\x3c\/span\x3e: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!message) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取key对应的字符串\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e val: PathValue = getPathValue(message, key)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(val)) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e val }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isNull(val)) { val = message[key] }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isNull(val)) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e val !== \x3cspan class=\x22hljs-string\x22\x3e\x27string\x27\x3c\/span\x3e) {\n      warn(\x3cspan class=\x22hljs-string\x22\x3e`Value of key \x27\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e\x27 is not a string!`\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    }\n\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ TODO ?? 这里的links是干什么的？\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Check for the existance of links within the translated string\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (val.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27@:\x27\x3c\/span\x3e) \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Match all the links within the local\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ We are going to replace each of\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ them with its translation\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e matches: any = val.match(\x3cspan class=\x22hljs-regexp\x22\x3e\/(@:[\\w|.]\x2b)\/g\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e idx \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e matches) {\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e link = matches[idx]\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Remove the leading @:\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e linkPlaceholder = link.substr(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Translate the link\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e translatedstring = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._interpolate(message, linkPlaceholder, args)\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ Replace the link with the translated string\x3c\/span\x3e\n        val = val.replace(link, translatedstring)\n      }\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果没有传入需要替换的obj, 那么直接返回字符串, 否则调用this._format进行变量等的替换\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e !args ? val : \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._format(val, args)    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取替换后的字符\x3c\/span\x3e\n  }\n\n  _format (val: any, ...args: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._formatter.format(val, ...args)\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 翻译函数\x3c\/span\x3e\n  _translate (messages: Messages, \x3cspan class=\x22hljs-attr\x22\x3elocale\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3efallback\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3ekey\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3eargs\x3c\/span\x3e: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e res: any = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * messages[locale] 使用哪个语言包\n     * key 语言映射表的key\n     * args 映射替换关系\n     *\/\x3c\/span\x3e\n    res = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._interpolate(messages[locale], key, args)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isNull(res)) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res }\n\n    res = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._interpolate(messages[fallback], key, args)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!isNull(res)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n        warn(\x3cspan class=\x22hljs-string\x22\x3e`Fall back to translate the keypath \x27\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e\x27 with \x27\x3cspan class=\x22hljs-subst\x22\x3e${fallback}\x3c\/span\x3e\x27 locale.`\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 翻译的核心函数\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/**\n   * 这里的方法传入的参数参照mixin.js里面的定义的方法\n   * key map的key值 (为接受的外部参数)\n   * _locale 语言配置选项: \x27zh-CN\x27 | \x27en-US\x27 (内部变量)\n   * messages 映射表 (内部变量)\n   * host为这个i18n的实例 (内部变量)\n   *\n   *\/\x3c\/span\x3e\n  _t (key: string, \x3cspan class=\x22hljs-attr\x22\x3e_locale\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3emessages\x3c\/span\x3e: Messages, \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: any, ...args: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!key) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ parseArgs函数用以返回传入的局部语言配置, 及映射表\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e parsedArgs = parseArgs(...args)   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 接收的参数{ locale, params(映射表) }\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale = parsedArgs.locale || _locale   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 语言配置\x3c\/span\x3e\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 字符串替换\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/**\n     * @params messages  语言包\n     * @params locale  语言配置\n     * @params fallbackLocale 缺省语言配置\n     * @params key 替换的key值\n     * @params parsedArgs.params 需要被替换的参数map表\n     *\/\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e ret: any = \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._translate(messages, locale, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.fallbackLocale, key, parsedArgs.params)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._isFallbackRoot(ret)) {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27production\x27\x3c\/span\x3e) {\n        warn(\x3cspan class=\x22hljs-string\x22\x3e`Fall back to translate the keypath \x27\x3cspan class=\x22hljs-subst\x22\x3e${key}\x3c\/span\x3e\x27 with root locale.`\x3c\/span\x3e)\n      }\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root) { \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eError\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27unexpected error\x27\x3c\/span\x3e) }\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._root.t(key, ...args)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._warnDefault(locale, key, ret, host)\n    }\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 转化函数\x3c\/span\x3e\n  t (key: string, ...args: any): string {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._t(key, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.locale, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, ...args)\n  }\n\n  _tc (key: string, \x3cspan class=\x22hljs-attr\x22\x3e_locale\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3emessages\x3c\/span\x3e: Messages, \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: any, choice?: number, ...args: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!key) { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e }\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (choice !== \x3cspan class=\x22hljs-literal\x22\x3eundefined\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e fetchChoice(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._t(key, _locale, messages, host, ...args), choice)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._t(key, _locale, messages, host, ...args)\n    }\n  }\n\n  tc (key: string, choice?: number, ...args: any): any {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._tc(key, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.locale, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, choice, ...args)\n  }\n\n  _te (key: string, \x3cspan class=\x22hljs-attr\x22\x3e_locale\x3c\/span\x3e: string, \x3cspan class=\x22hljs-attr\x22\x3emessages\x3c\/span\x3e: Messages, ...args: any): boolean {\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e locale = parseArgs(...args).locale || _locale\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._exist(messages[locale], key)\n  }\n\n  te (key: string, ...args: any): boolean {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e._te(key, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.locale, \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.messages, ...args)\n  }\n}\n\nVueI18n.install = install\nVueI18n.version = \x3cspan class=\x22hljs-string\x22\x3e\x27__VERSION__\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是通过CDN或者外链的形式引入的Vue\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e !== \x3cspan class=\x22hljs-string\x22\x3e\x27undefined\x27\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.Vue) {\n  \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.Vue.use(VueI18n)\n}\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e另外还有一个比较重要的库函数\x3ccode\x3eformat.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/**\n *  String format template\n *  - Inspired:\n *    https:\/\/github.com\/Matt-Esch\/string-template\/index.js\n *\/\n\n\/\/ 变量的替换, 在字符串模板中写的站位符 {xxx} 进行替换\nconst RE_NARGS: RegExp = \/(%|)\\{([0-9a-zA-Z_]\x2b)\\}\/g\n\n\/**\n * template\n *\n * @param {String} string\n * @param {Array} ...args\n * @return {String}\n *\/\n\n\/\/ 模板替换函数\nexport function template (str: string, ...args: any): string {\n  \/\/ 如果第一个参数是一个obj\n  if (args.length === 1 \x26amp;\x26amp; typeof args[0] === \x27object\x27) {\n    args = args[0]\n  } else {\n    args = {}\n  }\n\n  if (!args || !args.hasOwnProperty) {\n    args = {}\n  }\n\n  \/\/ str.prototype.replace(substr\/regexp, newSubStr\/function) 第二个参数如果是个函数的话，每次匹配都会调用这个函数\n  \/\/ match 为匹配的子串\n  return str.replace(RE_NARGS, (match, prefix, i, index) =\x3e {\n    let result: string\n\n    \/\/ match是匹配到的字符串\n    \/\/ prefix ???\n    \/\/ i 括号中需要替换的字符换\n    \/\/ index是偏移量\n\n    \/\/ 字符串中如果出现{xxx}不需要被替换。那么应该写成\x22{{\x22xxx\x22}}\x22\n    if (str[index - 1] === \x27{\x27 \x26amp;\x26amp;\n      str[index \x2b match.length] === \x27}\x27) {\n      return i\n    } else {\n      \/\/ 判断args obj是否包含这个key值\n      \/\/ 返回替换值, 或者被匹配上的字符串的值\n      result = hasOwn(args, i) ? args[i] : match\n      if (isNull(result)) {\n        return \x27\x27\n      }\n\n      return result\n    }\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/**\n *  String format template\n *  - Inspired:\n *    https:\/\/github.com\/Matt-Esch\/string-template\/index.js\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 变量的替换, 在字符串模板中写的站位符 {xxx} 进行替换\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e RE_NARGS: \x3cspan class=\x22hljs-built_in\x22\x3eRegExp\x3c\/span\x3e = \x3cspan class=\x22hljs-regexp\x22\x3e\/(%|)\\{([0-9a-zA-Z_]\x2b)\\}\/g\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/**\n * template\n *\n * @param {String} string\n * @param {Array} ...args\n * @return {String}\n *\/\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 模板替换函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3etemplate\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3estr: string, ...args: any\x3c\/span\x3e): \x3cspan class=\x22hljs-title\x22\x3estring\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果第一个参数是一个obj\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (args.length === \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x26amp;\x26amp; \x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27object\x27\x3c\/span\x3e) {\n    args = args[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    args = {}\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!args || !args.hasOwnProperty) {\n    args = {}\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ str.prototype.replace(substr\/regexp, newSubStr\/function) 第二个参数如果是个函数的话，每次匹配都会调用这个函数\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ match 为匹配的子串\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e str.replace(RE_NARGS, (match, prefix, i, index) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e result: string\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ match是匹配到的字符串\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ prefix ???\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ i 括号中需要替换的字符换\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ index是偏移量\x3c\/span\x3e\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 字符串中如果出现{xxx}不需要被替换。那么应该写成\x22{{\x22xxx\x22}}\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (str[index - \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e] === \x3cspan class=\x22hljs-string\x22\x3e\x27{\x27\x3c\/span\x3e \x26amp;\x26amp;\n      str[index \x2b match.length] === \x3cspan class=\x22hljs-string\x22\x3e\x27}\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e i\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 判断args obj是否包含这个key值\x3c\/span\x3e\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 返回替换值, 或者被匹配上的字符串的值\x3c\/span\x3e\n      result = hasOwn(args, i) ? args[i] : match\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isNull(result)) {\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n      }\n\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e result\n    }\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e这个页面是使用\x3ccode\x3evue\x3c\/code\x3e作为前端框架，使用\x3ccode\x3evue-i18n\x3c\/code\x3e作为国际化的工具：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e和后端同学约定好语言标识字段\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e前端根据后端下发的语言标识字段来调用不同的语言包\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e文本内容使用\x3ccode\x3evue-i18n\x3c\/code\x3e进行替换\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e图片内容需要视觉同学提供多语言版本\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e样式需要根据多语言进行定制。比如在\x3ccode\x3ebody\x3c\/code\x3e上添加多语言的标识\x3ccode\x3eclass\x3c\/code\x3e属性\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e第三方的\x3ccode\x3eSDK\x3c\/code\x3e或\x3ccode\x3e插件\x3c\/code\x3e的国际化推动\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>前端国际化之Vue-i18n源码分析</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008752459">https://segmentfault.com/a/1190000008752459</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/dspk4y8d6tu/" target="_blank">https://alili.tech/archive/dspk4y8d6tu/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>