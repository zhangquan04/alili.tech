<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="开发微服务-Node,React和Docker"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>开发微服务-Node,React和Docker | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/hyx8qgfszjn/",
				"appid": "1613049289050283", 
				"title": "开发微服务-Node,React和Docker | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-25T02:30:23"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/84ezp8lesnv/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/x6p61fsluy/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&text=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&text=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&title=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&is_video=false&description=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&title=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&title=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&title=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fhyx8qgfszjn%2f&title=%e5%bc%80%e5%8f%91%e5%be%ae%e6%9c%8d%e5%8a%a1-Node%2cReact%e5%92%8cDocker"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">开发微服务-Node,React和Docker</h1><div class="meta"><div class="postdate"><time datetime="2019-01-25" itemprop="datePublished">2019-01-25</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3cp\x3e在本文中，你将学习如何使用Docker快速创建可复用的开发环境，以管理许多NodeJS微服务。\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/docker-microservices.png\x22 alt=\x22微服务架构\x22\x3e\x3c\/p\x3e\n\x3cp\x3e这篇文章假定你对以下主题预先做了了解。更多主题信息请参阅提供的资源地址：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\n\x3ctr\x3e\n\x3cth\x3e主题\x3c\/th\x3e\n\x3cth\x3e资源地址\x3c\/th\x3e\n\x3c\/tr\x3e\n\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3eDocker\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/docs.docker.com\/engine\/getstarted\/\x22\x3eGet started with Docker\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eDocker Compose\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/docs.docker.com\/compose\/gettingstarted\/\x22\x3eGet started with Docker Compose\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eNode\/Express API\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/mherman.org\/blog\/2016\/09\/12\/testing-node-and-express\x22\x3eTesting Node and Express\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eReact\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22https:\/\/github.com\/mjhea0\/node-workshop\/blob\/master\/w2\/lessons\/03-react.md\x22\x3eReact Intro\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eTestCafe\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/mherman.org\/blog\/2017\/03\/19\/functional-testing-with-testcafe\x22\x3eFunctional Testing With TestCafe\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eSwagger\x3c\/td\x3e\n\x3ctd\x3e\x3ca href=\x22http:\/\/mherman.org\/blog\/2016\/05\/26\/swagger-and-nodejs\/\x22\x3eSwagger and NodeJS\x3c\/a\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意\x3c\/strong\x3e: 想了解稍微简单一点的实现，请访问我之前的文章 -   \x3ca href=\x22http:\/\/mherman.org\/blog\/2017\/04\/18\/developing-and-testing-microservices-with-docker\x22\x3e使用Docker开发和测试微服务\x3c\/a\x3e.\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3ch2\x3e目录\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e目标\x3c\/li\x3e\n\x3cli\x3e体系结构\x3c\/li\x3e\n\x3cli\x3e项目设置\x3c\/li\x3e\n\x3cli\x3eUsers服务\x3c\/li\x3e\n\x3cli\x3eWeb服务 - 第1部分\x3c\/li\x3e\n\x3cli\x3eMovies服务\x3c\/li\x3e\n\x3cli\x3eWeb服务 - 第2部分\x3c\/li\x3e\n\x3cli\x3e工作流\x3c\/li\x3e\n\x3cli\x3e测试设置\x3c\/li\x3e\n\x3cli\x3eSwagger设置\x3c\/li\x3e\n\x3cli\x3e下一步\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2\x3e目标\x3c\/h2\x3e\n\x3cp\x3e本教程结束时，你应该能够......\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e使用Docker和Docker Compose在本地配置和运行微服务\x3c\/li\x3e\n\x3cli\x3e利用卷将代码挂载到容器中\x3c\/li\x3e\n\x3cli\x3e在Docker容器中运行单元和集成测试\x3c\/li\x3e\n\x3cli\x3e用功能性的端到端测试来测试整套服务\x3c\/li\x3e\n\x3cli\x3e调试正在运行的Docker容器\x3c\/li\x3e\n\x3cli\x3e使在不同容器中运行的服务能够相互通信\x3c\/li\x3e\n\x3cli\x3e通过基于JWT的认证保护你的服务\x3c\/li\x3e\n\x3cli\x3e配置Swagger与服务进行交互\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3ch2\x3e体系结构\x3c\/h2\x3e\n\x3cp\x3e这篇文章的最终目标是将文章开头图片中的技术组织到以下容器和服务中：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\n\x3ctr\x3e\n\x3cth\x3e名称\x3c\/th\x3e\n\x3cth\x3e服务\x3c\/th\x3e\n\x3cth\x3e容器\x3c\/th\x3e\n\x3cth\x3e技术\x3c\/th\x3e\n\x3c\/tr\x3e\n\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3eWeb\x3c\/td\x3e\n\x3ctd\x3eWeb\x3c\/td\x3e\n\x3ctd\x3eweb\x3c\/td\x3e\n\x3ctd\x3eReact, React-Router\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eMovies API\x3c\/td\x3e\n\x3ctd\x3eMovies\x3c\/td\x3e\n\x3ctd\x3emovies\x3c\/td\x3e\n\x3ctd\x3eNode, Express\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eMovies DB\x3c\/td\x3e\n\x3ctd\x3eMovies\x3c\/td\x3e\n\x3ctd\x3emovies-db\x3c\/td\x3e\n\x3ctd\x3ePostgres\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eSwagger\x3c\/td\x3e\n\x3ctd\x3eMovies\x3c\/td\x3e\n\x3ctd\x3eswagger\x3c\/td\x3e\n\x3ctd\x3eSwagger UI\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eUsers API\x3c\/td\x3e\n\x3ctd\x3eUsers\x3c\/td\x3e\n\x3ctd\x3eusers\x3c\/td\x3e\n\x3ctd\x3eNode, Express\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eUsers DB\x3c\/td\x3e\n\x3ctd\x3eUsers\x3c\/td\x3e\n\x3ctd\x3eusers-db\x3c\/td\x3e\n\x3ctd\x3ePostgres\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3eFunctional Tests\x3c\/td\x3e\n\x3ctd\x3eTest\x3c\/td\x3e\n\x3ctd\x3en\/a\x3c\/td\x3e\n\x3ctd\x3eTestCafe\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e让我们开始吧！\x3c\/p\x3e\n\x3ch2\x3e项目设置\x3c\/h2\x3e\n\x3cp\x3e首先clone基础项目，然后checkout到第一个标签：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e git \x3cspan class=\x22hljs-built_in\x22\x3eclone\x3c\/span\x3e https:\/\/github.com\/mjhea0\/microservice-movies\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \x3cspan class=\x22hljs-built_in\x22\x3ecd\x3c\/span\x3e microservice-movies\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e git checkout tags\/v1\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e总体的项目结构\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e.\n├── services\n│   ├── movies\n│   │   ├── src\n│   │   │   └── db\n│   │   └── swagger\n│   ├──\x3cspan class=\x22hljs-built_in\x22\x3e users\n\x3c\/span\x3e│   │   └── src\n│   │       └── db\n│   └── web\n└── tests\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在我们添加Docker之前，请务必查看一下代码，方便对所有的功能有个基本的了解。你也可以动手测试一下这些服务......\x3c\/p\x3e\n\x3cp\x3e\x3cem\x3eUsers:\x3c\/em\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e导航到 “services\/users”\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm install\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e将package.json中的\x3ccode\x3estart\x3c\/code\x3e脚本更新为\x3ccode\x3e\x22gulp --gulpfile gulpfile.js\x22\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm start\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e在浏览器中访问\x3ca href=\x22http:\/\/localhost:3000\/users\/ping\x22\x3ehttp:\/\/localhost:3000\/users\/ping\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cem\x3eMovies:\x3c\/em\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e导航到 “services\/movies”\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm install\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e将package.json中的\x3ccode\x3estart\x3c\/code\x3e脚本更新为\x3ccode\x3e\x22gulp --gulpfile gulpfile.js\x22\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm start\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e在浏览器中访问\x3ca href=\x22http:\/\/localhost:3000\/movies\/ping\x22\x3ehttp:\/\/localhost:3000\/movies\/ping\x3c\/a\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cem\x3eWeb:\x3c\/em\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e导航到 “services\/web”\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm install\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3enpm start\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3e在浏览器中访问\x3ca href=\x22http:\/\/localhost:3006\/\x22\x3ehttp:\/\/localhost:3006\x3c\/a\x3e，这时你应该可以看到登录页面。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e接下来，在项目根目录添加\x3ccode\x3edocker-compose.yml\x3c\/code\x3e文件。Docker Compose将调用该文件将多个服务链接在一起。使用一个命令，Docker Compose就可以启动我们所需的所有容器，使这些容器可以根据需要相互通信。\x3c\/p\x3e\n\x3cp\x3e有了这个，在我们开始每一项服务时，确保可以随时进行测试......\x3c\/p\x3e\n\x3ch2\x3eUsers 服务\x3c\/h2\x3e\n\x3cp\x3e我们将从数据库开始，因为API依赖于它的运行……\x3c\/p\x3e\n\x3ch3\x3eDatabase\x3c\/h3\x3e\n\x3cp\x3e首先，在“services\/users\/src\/db”目录中添加 \x3cem\x3eDockerfile\x3c\/em\x3e 文件：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e postgres\n\n\x3cspan class=\x22hljs-comment\x22\x3e# run create.sql on init \x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e create.sql \/docker-entrypoint-initdb.d \n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e在这里，我们通过在容器中的“docker-entrypoint-initdb.d”目录里添加一个SQL文件来扩展官方的Postgres镜像，该镜像将在init上执行。\x3c\/p\x3e\n\x3cp\x3e然后更新 \x3cem\x3edocker-compose.yml\x3c\/em\x3e 文件：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs http\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3eversion\x3c\/span\x3e: \x272.1\x27\n\n\x3cspan class=\x22awk\x22\x3eservices:\n\n  users-db:\n    container_name: users-db\n    build: .\x3cspan class=\x22hljs-regexp\x22\x3e\/services\/u\x3c\/span\x3esers\x3cspan class=\x22hljs-regexp\x22\x3e\/src\/\x3c\/span\x3edb\n    ports:\n      - \x3cspan class=\x22hljs-string\x22\x3e\x275433:5432\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e# expose ports - HOST:CONTAINER\x3c\/span\x3e\n    environment:\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=postgres\n    healthcheck:\n      test: \x3cspan class=\x22hljs-keyword\x22\x3eexit\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这个配置将从“services\/users\/src\/db”中找到 \x3cem\x3eDockerfile\x3c\/em\x3e 文件创建一个名为\x3ccode\x3eusers-db\x3c\/code\x3e的容器。（目录是相对于 \x3cem\x3eDockerfile\x3c\/em\x3e 文件的）。\x3c\/p\x3e\n\x3cp\x3e一旦启动，环境变量将被添加，并在成功启动和运行后发送0的退出代码。Postgres将在宿主机上使用\x3ccode\x3e5433\x3c\/code\x3e端口，其他服务使用\x3ccode\x3e5432\x3c\/code\x3e端口。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3eNOTE:\x3c\/strong\x3e 如果你只希望Postgres用于其他服务而不是主机，请使用\x3ccode\x3eexpose\x3c\/code\x3e, 而不是 \x3ccode\x3eports\x3c\/code\x3e:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs haml\x22\x3eexpose:\n  -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x225432\x22\x3c\/span\x3e \n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3c\/blockquote\x3e\n\x3cp\x3e注意使用的版本-\x3ccode\x3e2.1\x3c\/code\x3e。这与安装的Docker Compose版本没有直接关系；而是指定你想要使用的文件格式。\x3c\/p\x3e\n\x3cp\x3e启动这个容器：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e docker-compose up --build -d users-db\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e一上来，我们先来个快速的完整性检查。进入shell:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e$ docker-compose \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e users-db bash\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e然后运行\x3ccode\x3eenv\x3c\/code\x3e确保设置了正确的环境变量。你也可以查看“docker-entrypoint-initdb.d” 目录：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \x3cspan class=\x22hljs-built_in\x22\x3ecd\x3c\/span\x3e docker-entrypoint-initdb.d\/ \x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e ls \x3c\/span\x3e\ncreate.sql\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e完成后\x3ccode\x3eexit\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch3\x3eAPI\x3c\/h3\x3e\n\x3cp\x3e转向API，在“services\/users”目录上添加一个 \x3cem\x3eDockerfile\x3c\/em\x3e 文件，确保查看注释：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e node:latest\n\n\x3cspan class=\x22hljs-comment\x22\x3e# set working directory\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e mkdir \/usr\/src\/app\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eWORKDIR\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \/usr\/src\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# add `\/usr\/src\/node_modules\/.bin` to $PATH\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eENV\x3c\/span\x3e PATH \/usr\/src\/node_modules\/.bin:$PATH\n\n\x3cspan class=\x22hljs-comment\x22\x3e# install and cache app dependencies\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e package.json \/usr\/src\/package.json\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e npm install\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# start app\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCMD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e [\x3cspan class=\x22hljs-string\x22\x3e\x22npm\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e]\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e注意：确保利用Docker的分层\x3ca href=\x22https:\/\/docs.docker.com\/engine\/userguide\/eng-image\/dockerfile_best-practices\/#build-cache\x22\x3e缓存\x3c\/a\x3e系统，通过在添加应用程序的源文件之前添加package.json和安装依赖项来加快构建时间。有关这方面的更多信息，请查看 \x3ca href=\x22http:\/\/bitjudo.com\/blog\/2014\/03\/13\/building-efficient-dockerfiles-node-dot-js\/\x22\x3e构建有效的Dockerfiles-Node.js\x3c\/a\x3e。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e然后将\x3ccode\x3eusers-service\x3c\/code\x3e添加到 \x3cem\x3edocker-compose.yml\x3c\/em\x3e 文件中：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs haml\x22\x3eusers-service:\n  container_name: users-service\n  build: .\/services\/users\/\n  volumes:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/services\/users:\/usr\/src\/app\x27\x3c\/span\x3e\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/services\/users\/package.json:\/usr\/src\/package.json\x27\x3c\/span\x3e\n\x3c\/span\x3e  ports:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x273000:3000\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e# expose ports - HOST:CONTAINER\x3c\/span\x3e\n\x3c\/span\x3e  environment:\n    -\x3cspan class=\x22ruby\x22\x3e DATABASE_URL=\x3cspan class=\x22hljs-symbol\x22\x3epostgres:\x3c\/span\x3e\/\x3cspan class=\x22hljs-regexp\x22\x3e\/postgres:postgres@users-db:5432\/users\x3c\/span\x3e_dev\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e DATABASE_TEST_URL=\x3cspan class=\x22hljs-symbol\x22\x3epostgres:\x3c\/span\x3e\/\x3cspan class=\x22hljs-regexp\x22\x3e\/postgres:postgres@users-db:5432\/users\x3c\/span\x3e_test\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e NODE_ENV=${NODE_ENV}\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e TOKEN_SECRET=changeme\n\x3c\/span\x3e  depends_on:\n    users-db:\n      condition: service_healthy\n  links:\n    -\x3cspan class=\x22ruby\x22\x3e users-db\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e这里发生了什么？\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3ccode\x3evolumes\x3c\/code\x3e:\x3ca href=\x22https:\/\/docs.docker.com\/engine\/tutorials\/dockervolumes\/\x22\x3evolumes\x3c\/a\x3e用于在容器中挂载目录，这样在对代码进行修改时无需重新生成镜像。这是本地开发环境的默认设置，因此可以快速地获得关于代码的更改反馈。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3edepends_on\x3c\/code\x3e:\x3ca href=\x22https:\/\/docs.docker.com\/compose\/compose-file\/#dependson\x22\x3edepends_on\x3c\/a\x3e指定服务启动的顺序。在这个示例中，\x3ccode\x3eusers-service\x3c\/code\x3e在启动之前需要等待\x3ccode\x3eusers-db\x3c\/code\x3e的成功启动（退出代码为0）。\x3c\/li\x3e\n\x3cli\x3e\x3ccode\x3elinks\x3c\/code\x3e: 通过 \x3ca href=\x22https:\/\/docs.docker.com\/compose\/compose-file\/#links\x22\x3elinks\x3c\/a\x3e 可以链接到在其他容器中运行的服务。因此，通过这个配置，\x3ccode\x3eusers-service\x3c\/code\x3e中的代码能够通过\x3ccode\x3eusers-db:5432\x3c\/code\x3e 来访问数据库。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意:\x3c\/strong\x3e 对于\x3ccode\x3edepends_on\x3c\/code\x3e和\x3ccode\x3elinks\x3c\/code\x3e的区别有疑问的话，可以查看 \x3ca href=\x22http:\/\/stackoverflow.com\/a\/39658359\/1799408\x22\x3eStack Overflow 讨论\x3c\/a\x3e 了解更多信息。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e设置\x3ccode\x3eNODE_ENV\x3c\/code\x3e环境变量：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3e$ \x3cspan class=\x22hljs-builtin-name\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-attribute\x22\x3eNODE_ENV\x3c\/span\x3e=development\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e构建镜像并启动这个容器：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e docker-compose up --build -d users-service\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e 请记住，Docker Compose处理构建和运行时间。这可能会令人有些困惑。比如，看看当前的docker-compose.yml文件 - 构建时发生了什么？运行时间怎么样？你怎么知道的？\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e一旦启动，在项目根目录中创建一个名为 _init_db.sh_ 的新文件，并添加Knex迁移和种子命令：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs bash\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/bin\/sh   \x3c\/span\x3e\ndocker-compose run users-service knex migrate:latest --env development --knexfile app\/knexfile.js \ndocker-compose run users-service knex seed:run --env development --knexfile app\/knexfile.js\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e然后应用迁移并添加种子：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs groovy\x22\x3e$ sh init_db.sh\nUsing \x3cspan class=\x22hljs-string\x22\x3eenvironment:\x3c\/span\x3e development\nBatch \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3erun:\x3c\/span\x3e \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e migrations\n\x3cspan class=\x22hljs-regexp\x22\x3e\/src\/\x3c\/span\x3esrc\x3cspan class=\x22hljs-regexp\x22\x3e\/db\/\x3c\/span\x3emigrations\/\x3cspan class=\x22hljs-number\x22\x3e20170504191016\x3c\/span\x3e_users.js\nUsing \x3cspan class=\x22hljs-string\x22\x3eenvironment:\x3c\/span\x3e development\nRan \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e seed files\n\x3cspan class=\x22hljs-regexp\x22\x3e\/src\/\x3c\/span\x3esrc\x3cspan class=\x22hljs-regexp\x22\x3e\/db\/\x3c\/span\x3eseeds\/users.js\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e测试：\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\n\x3ctr\x3e\n\x3cth\x3e接口\x3c\/th\x3e\n\x3cth\x3eHTTP 方法\x3c\/th\x3e\n\x3cth\x3eCRUD 方法\x3c\/th\x3e\n\x3cth\x3e结果\x3c\/th\x3e\n\x3c\/tr\x3e\n\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/users\/ping\x3c\/td\x3e\n\x3ctd\x3eGET\x3c\/td\x3e\n\x3ctd\x3eREAD\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3epong\x3c\/code\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/users\/register\x3c\/td\x3e\n\x3ctd\x3ePOST\x3c\/td\x3e\n\x3ctd\x3eCREATE\x3c\/td\x3e\n\x3ctd\x3eadd a user\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/users\/login\x3c\/td\x3e\n\x3ctd\x3ePOST\x3c\/td\x3e\n\x3ctd\x3eCREATE\x3c\/td\x3e\n\x3ctd\x3elog in a user\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/users\/user\x3c\/td\x3e\n\x3ctd\x3eGET\x3c\/td\x3e\n\x3ctd\x3eREAD\x3c\/td\x3e\n\x3ctd\x3eget user info\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs awk\x22\x3e$ http POST http:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3elocalhost:\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/users\/\x3c\/span\x3eregister username=foo password=bar\n$ http POST http:\x3cspan class=\x22hljs-regexp\x22\x3e\/\/\x3c\/span\x3elocalhost:\x3cspan class=\x22hljs-number\x22\x3e3000\x3c\/span\x3e\x3cspan class=\x22hljs-regexp\x22\x3e\/users\/\x3c\/span\x3elogin username=foo password=bar\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e 上述命令中的\x3ccode\x3ehttp\x3c\/code\x3e是 \x3ca href=\x22https:\/\/httpie.org\/\x22\x3eHTTPie\x3c\/a\x3e 库的一部分，这个库是cURL之上的包装器。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e在这两种情况下，你都应该看到成功的状态和一个token，如下：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22status\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22success\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3e\x22token\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9\x22\x3c\/span\x3e\n}\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e最后，运行单元和集成测试：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e$ docker-compose \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e users-service npm \x3cspan class=\x22hljs-built_in\x22\x3etest\x3c\/span\x3e\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e运行结果如下：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3eroutes : index\n  \x3cspan class=\x22hljs-builtin-name\x22\x3eGET\x3c\/span\x3e \/does\/\x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e\/exist\n    ✓ should throw an \x3cspan class=\x22hljs-builtin-name\x22\x3eerror\x3c\/span\x3e\n\nroutes :\x3cspan class=\x22hljs-built_in\x22\x3e users\n\x3c\/span\x3e  POST \/users\/register\n    ✓ should register a new\x3cspan class=\x22hljs-built_in\x22\x3e user \x3c\/span\x3e(178ms)\n  POST \/users\/login\n    ✓ should login a\x3cspan class=\x22hljs-built_in\x22\x3e user \x3c\/span\x3e(116ms)\n    ✓ should \x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e login an unregistered\x3cspan class=\x22hljs-built_in\x22\x3e user\n\x3c\/span\x3e    ✓ should \x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e login a valid\x3cspan class=\x22hljs-built_in\x22\x3e user \x3c\/span\x3ewith incorrect password (125ms)\n  \x3cspan class=\x22hljs-builtin-name\x22\x3eGET\x3c\/span\x3e \/users\x3cspan class=\x22hljs-built_in\x22\x3e\/user\n\x3c\/span\x3e    ✓ should return a success (114ms)\n    ✓ should throw an \x3cspan class=\x22hljs-builtin-name\x22\x3eerror\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e a\x3cspan class=\x22hljs-built_in\x22\x3e user \x3c\/span\x3eis \x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e logged \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e\n\nauth : helpers\n  comparePass()\n    ✓ should return \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e the password is correct (354ms)\n    ✓ should return \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e the password is correct (315ms)\n    ✓ should return \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e the password empty (305ms)\n\nauth : local\n  encodeToken()\n    ✓ should return a token\n  decodeToken()\n    ✓ should return a payload\n\n\n12 passing (4s)\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e查看测试规格以获得更多信息。就这样！接下来是网络服务......\x3c\/p\x3e\n\x3ch2\x3eWeb服务 - 第1部分\x3c\/h2\x3e\n\x3cp\x3e随着我们的用户服务开始运行，我们可以将注意力转移到客户端，并在容器中启动React应用程序来测试身份验证。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e React代码是从我的两个学生 - \x3ca href=\x22https:\/\/www.linkedin.com\/in\/charlieblackstock\/\x22\x3eCharlie Blackstock\x3c\/a\x3e和\x3ca href=\x22https:\/\/www.linkedin.com\/in\/etmoore1\/\x22\x3eEvan Moore\x3c\/a\x3e分别编写的\x3ca href=\x22https:\/\/github.com\/blackstc\/intro-react-redux-omdb\x22\x3eintro-react-redux-omdb\x3c\/a\x3e和\x3ca href=\x22https:\/\/github.com\/etmoore\/communikey\x22\x3ecommunikey\x3c\/a\x3e移植而来的。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e在“services\/web”中增加一个 \x3cem\x3eDockerfile\x3c\/em\x3e 文件：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e node:latest\n\n\x3cspan class=\x22hljs-comment\x22\x3e# set working directory\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e mkdir \/usr\/src\/app\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eWORKDIR\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \/usr\/src\/app\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# add `\/usr\/src\/app\/node_modules\/.bin` to $PATH\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eENV\x3c\/span\x3e PATH \/usr\/src\/app\/node_modules\/.bin:$PATH\n\n\x3cspan class=\x22hljs-comment\x22\x3e# install and cache app dependencies\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e package.json \/usr\/src\/app\/package.json\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e npm install\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e npm install react-scripts@0.9.5 -g\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# start app\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCMD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e [\x3cspan class=\x22hljs-string\x22\x3e\x22npm\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e]\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e截至2017年5月10日，\x3ca href=\x22http:\/\/www.omdbapi.com\/\x22\x3eOMDb API\x3c\/a\x3e是私有的，所以您必须捐赠至少1美元才能获得访问权限。获得API密钥后，更 \x3cem\x3eservices\/web\/src\/App.jsx\x3c\/em\x3e 中的\x3ccode\x3eAPI_URL\x3c\/code\x3e：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs rust\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e API_URL = \x3cspan class=\x22hljs-symbol\x22\x3e\x27http\x3c\/span\x3e:\x3cspan class=\x22hljs-comment\x22\x3e\/\/www.omdbapi.com\/?apikey=addyourkey\x26amp;s=\x27\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e然后更新 \x3cem\x3edocker-compose.yml\x3c\/em\x3e 文件，如下所示：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs haml\x22\x3eweb-service:\n  container_name: web-service\n  build: .\/services\/web\/\n  volumes:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/services\/web:\/usr\/src\/app\x27\x3c\/span\x3e\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/usr\/src\/app\/node_modules\x27\x3c\/span\x3e\n\x3c\/span\x3e  ports:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x273007:3006\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e# expose ports - HOST:CONTAINER\x3c\/span\x3e\n\x3c\/span\x3e  environment:\n    -\x3cspan class=\x22ruby\x22\x3e NODE_ENV=${NODE_ENV}\n\x3c\/span\x3e  depends_on:\n    users-service:\n      condition: service_started\n  links:\n    -\x3cspan class=\x22ruby\x22\x3e users-service\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e为了防止卷 - \x3cem\x3e\/usr\/src\/app\x3c\/em\x3e - 覆盖package.json，我们使用了一个数据卷 - _\/usr\/src\/app\/node_modules_ 。这可能有必要，也可能没有必要，具体取决于你设置镜像和容器的顺序。查看\x3ca href=\x22http:\/\/dchua.com\/2016\/02\/07\/getting-npm-packages-to-be-installed-with-docker-compose\/\x22\x3e使用docker-compose安装npm包\x3c\/a\x3e了解更多。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e构建镜像并启动容器：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e docker-compose up --build -d web-service\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e为了避免处理太多的配置（babel和webpack），React应用程序使用\x3ca href=\x22https:\/\/github.com\/facebookincubator\/create-react-app\x22\x3eCreate React App\x3c\/a\x3e。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e打开浏览器并导航到\x3ca href=\x22http:\/\/localhost:3007\/\x22\x3ehttp:\/\/localhost:3007\x3c\/a\x3e。你可以看到登录页面：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/microservice-movies-login.png\x22 alt=\x22login page\x22\x3e\x3c\/p\x3e\n\x3cp\x3e使用下面的用户名和密码登录：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3eusername:\x3ccode\x3efoo\x3c\/code\x3e\x3c\/li\x3e\n\x3cli\x3epassword:\x3ccode\x3ebar\x3c\/code\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e登录成功后，你可以看到下面的页面：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/microservice-movies-search.png\x22 alt=\x22search page\x22\x3e\x3c\/p\x3e\n\x3cp\x3e在 \x3cem\x3eservices\/web\/src\/App.jsx\x3c\/em\x3e 中，让我们快速浏览一下loginUser()方法中的AJAX请求：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3eloginUser (userData, callback) {\n  \x3cspan class=\x22hljs-comment\x22\x3e\/*\n    why? http:\/\/localhost:3000\/users\/login\n    why not? http:\/\/users-service:3000\/users\/login\n   *\/\x3c\/span\x3e\n  return axios.post(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/localhost:3000\/users\/login\x27\x3c\/span\x3e, userData)\n  .then((res) =\x26gt; {\n    window\x3cspan class=\x22hljs-selector-class\x22\x3e.localStorage\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.setItem\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27authToken\x27\x3c\/span\x3e, res\x3cspan class=\x22hljs-selector-class\x22\x3e.data\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.token\x3c\/span\x3e)\n    window\x3cspan class=\x22hljs-selector-class\x22\x3e.localStorage\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.setItem\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27user\x27\x3c\/span\x3e, res\x3cspan class=\x22hljs-selector-class\x22\x3e.data\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.user\x3c\/span\x3e)\n    this.setState({ isAuthenticated: true })\n    this.createFlashMessage(\x3cspan class=\x22hljs-string\x22\x3e\x27You successfully logged in! Welcome!\x27\x3c\/span\x3e)\n    this\x3cspan class=\x22hljs-selector-class\x22\x3e.props\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.history\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.push\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e)\n    this.getMovies()\n  })\n  .catch((error) =\x26gt; {\n    callback(\x3cspan class=\x22hljs-string\x22\x3e\x27Something went wrong\x27\x3c\/span\x3e)\n  })\n}\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e为什么我们使用\x3ccode\x3elocalhost\x3c\/code\x3e而不是容器的名称，\x3ccode\x3eusers-service\x3c\/code\x3e？因为这个请求来自容器外部，在宿主机上。请记住，如果这个请求源于容器内部，那么我们将需要使用容器名称而不是\x3ccode\x3elocalhost\x3c\/code\x3e，因为在这种情况下，\x3ccode\x3elocalhost\x3c\/code\x3e会返回到容器本身。\x3c\/p\x3e\n\x3cp\x3e确保您可以注销并注册。\x3c\/p\x3e\n\x3cp\x3e接下来，让我们启动电影服务，以便终端用户可以将电影保存到集合中......\x3c\/p\x3e\n\x3ch2\x3eMovies 服务\x3c\/h2\x3e\n\x3cp\x3eMovies服务的设置与Users服务的设置几乎相同。亲自尝试来检查一下你的理解：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3eDatabase\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e添加 \x3cem\x3eDockerfile\x3c\/em\x3e 文件\x3c\/li\x3e\n\x3cli\x3e更新 \x3cem\x3edocker-compose.yml\x3c\/em\x3e\x3c\/li\x3e\n\x3cli\x3e启动这个容器\x3c\/li\x3e\n\x3cli\x3e测试\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eAPI\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e添加 \x3cem\x3eDockerfile\x3c\/em\x3e 文件\x3c\/li\x3e\n\x3cli\x3e更新 \x3cem\x3edocker-compose.yml\x3c\/em\x3e (请确保该服务与数据库和用户服务链接，并更新暴露端口 - api为 \x3ccode\x3e3001\x3c\/code\x3e ，db为 \x3ccode\x3e5434\x3c\/code\x3e)\x3c\/li\x3e\n\x3cli\x3e启动这个容器\x3c\/li\x3e\n\x3cli\x3e应用迁移和种子\x3c\/li\x3e\n\x3cli\x3e测试\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e 如果需要帮助，可以从\x3ca href=\x22https:\/\/github.com\/mjhea0\/microservice-movies\x22\x3emicroservices-movies\x3c\/a\x3e的\x3ca href=\x22https:\/\/github.com\/mjhea0\/microservice-movies\/releases\/tag\/v2\x22\x3ev2\x3c\/a\x3e标签中获取代码。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e与用户数据库相比，电影数据库镜像构建所需时间要少的多。为什么？\x3c\/p\x3e\n\x3cp\x3e随着容器的启动，我们来测试一下接口......\x3c\/p\x3e\n\x3ctable\x3e\n\x3cthead\x3e\n\x3ctr\x3e\n\x3cth\x3e接口\x3c\/th\x3e\n\x3cth\x3eHTTP 方法\x3c\/th\x3e\n\x3cth\x3eCRUD 方法\x3c\/th\x3e\n\x3cth\x3e结果\x3c\/th\x3e\n\x3c\/tr\x3e\n\x3c\/thead\x3e\n\x3ctbody\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/movies\/ping\x3c\/td\x3e\n\x3ctd\x3eGET\x3c\/td\x3e\n\x3ctd\x3eREAD\x3c\/td\x3e\n\x3ctd\x3e\x3ccode\x3epong\x3c\/code\x3e\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/movies\/user\x3c\/td\x3e\n\x3ctd\x3eGET\x3c\/td\x3e\n\x3ctd\x3eREAD\x3c\/td\x3e\n\x3ctd\x3eget all movies by user\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3ctr\x3e\n\x3ctd\x3e\/movies\x3c\/td\x3e\n\x3ctd\x3ePOST\x3c\/td\x3e\n\x3ctd\x3eCREATE\x3c\/td\x3e\n\x3ctd\x3eadd a single movie\x3c\/td\x3e\n\x3c\/tr\x3e\n\x3c\/tbody\x3e\n\x3c\/table\x3e\n\x3cp\x3e首先在浏览器中访问\x3ca href=\x22http:\/\/localhost:3001\/movies\/ping\x22\x3ehttp:\/\/localhost:3001\/movies\/ping\x3c\/a\x3e，页面的内容为\x3ccode\x3epong\x3c\/code\x3e!打开\x3ca href=\x22http:\/\/localhost:3001\/movies\/user\x22\x3ehttp:\/\/localhost:3001\/movies\/user\x3c\/a\x3e，内容为：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs json\x22\x3e{\n \x3cspan class=\x22hljs-attr\x22\x3e\x22status\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22Please log in\x22\x3c\/span\x3e \n} \n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e由于你需要通过身份验证来访问其他路由，我们通过运行集成测试来测试它们：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e$ docker-compose \x3cspan class=\x22hljs-keyword\x22\x3erun\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e movies-service npm \x3cspan class=\x22hljs-built_in\x22\x3etest\x3c\/span\x3e\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e结果为：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3eroutes : index\n  \x3cspan class=\x22hljs-builtin-name\x22\x3eGET\x3c\/span\x3e \/does\/\x3cspan class=\x22hljs-keyword\x22\x3enot\x3c\/span\x3e\/exist\n    ✓ should throw an \x3cspan class=\x22hljs-builtin-name\x22\x3eerror\x3c\/span\x3e\n\nMovies API Routes\n  \x3cspan class=\x22hljs-builtin-name\x22\x3eGET\x3c\/span\x3e \/movies\x3cspan class=\x22hljs-built_in\x22\x3e\/ping\n\x3c\/span\x3e    ✓ should return \x3cspan class=\x22hljs-string\x22\x3e\x22pong\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-builtin-name\x22\x3eGET\x3c\/span\x3e \/movies\x3cspan class=\x22hljs-built_in\x22\x3e\/user\n\x3c\/span\x3e    ✓ should return saved movies\n  POST \/movies\n    ✓ should create a new movie\n\n\n4 passing (818ms)\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e检查测试规格了解更多信息。\x3c\/p\x3e\n\x3ch2\x3eWeb服务 - 第2部分\x3c\/h2\x3e\n\x3cp\x3e转向 \x3cem\x3edocker-compose.yml\x3c\/em\x3e 文件。更新\x3ccode\x3eweb-service\x3c\/code\x3e的\x3ccode\x3elinks\x3c\/code\x3e和\x3ccode\x3edepends_on\x3c\/code\x3e键：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs less\x22\x3e\x3cspan class=\x22hljs-attribute\x22\x3edepends_on\x3c\/span\x3e:\n  \x3cspan class=\x22hljs-attribute\x22\x3eusers-service\x3c\/span\x3e:\n    \x3cspan class=\x22hljs-attribute\x22\x3econdition\x3c\/span\x3e: service_started\n  \x3cspan class=\x22hljs-attribute\x22\x3emovies-service\x3c\/span\x3e:\n    \x3cspan class=\x22hljs-attribute\x22\x3econdition\x3c\/span\x3e: service_started\n\x3cspan class=\x22hljs-attribute\x22\x3elinks\x3c\/span\x3e:\n  - users-service\n  - movies-service\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e为什么？\x3c\/p\x3e\n\x3cp\x3e接下来，更新容器：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs shell\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e$\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e docker-compose up -d web-service\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e让我们在浏览器中测试一下！打开\x3ca href=\x22http:\/\/localhost:3007\/\x22\x3ehttp:\/\/localhost:3007\/\x3c\/a\x3e。注册一个新用户，然后添加一些电影到收藏。\x3c\/p\x3e\n\x3cp\x3e一定要查看收藏：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/microservice-movies-collection.png\x22 alt=\x22collection page\x22\x3e\x3c\/p\x3e\n\x3cp\x3e打开 _services\/movies\/src\/routes\/\x3cem\x3ehelpers.js\x3c\/em\x3e 并记下 \x3ccode\x3eensureAuthenticated()\x3c\/code\x3e 方法:\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs moonscript\x22\x3elet ensureAuthenticated = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res, \x3cspan class=\x22hljs-built_in\x22\x3enext\x3c\/span\x3e)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!(req.headers \x26amp;\x26amp; req.headers.authorization)) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.status(\x3cspan class=\x22hljs-number\x22\x3e400\x3c\/span\x3e).json({ \x3cspan class=\x22hljs-name\x22\x3estatus\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Please log in\x27\x3c\/span\x3e });\n  }\n  const options = {\n    \x3cspan class=\x22hljs-name\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-name\x22\x3euri\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/users-service:3000\/users\/user\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-name\x22\x3ejson\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-name\x22\x3eheaders\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-string\x22\x3e\x27Content-Type\x27\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27application\/json\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-name\x22\x3eAuthorization\x3c\/span\x3e: `Bearer ${req.headers.authorization.split(\x3cspan class=\x22hljs-string\x22\x3e\x27 \x27\x3c\/span\x3e)[\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e]}`,\n    },\n  };\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e request(options)\n  .\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(response)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    req.user = response.user;\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3enext\x3c\/span\x3e();\n  })\n  .catch(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(err)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3enext\x3c\/span\x3e(err); });\n};\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3euri为什么指向\x3ccode\x3eusers-service\x3c\/code\x3e而不是\x3ccode\x3elocalhost\x3c\/code\x3e？\x3c\/p\x3e\n\x3ch2\x3e工作流\x3c\/h2\x3e\n\x3cp\x3e首先检查\x3ca href=\x22http:\/\/mherman.org\/blog\/2017\/04\/18\/developing-and-testing-microservices-with-docker\/\x22\x3e使用Docker开发和测试微服务\x3c\/a\x3e的工作流部分。在代码更改时进行实时重新加载，并使用console.log调试正在运行的容器。\x3c\/p\x3e\n\x3cp\x3e在集合页中添加标题：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/microservice-movies-collection-updated.png\x22 alt=\x22带有标题的集合页\x22\x3e\x3c\/p\x3e\n\x3cp\x3e运行日志 - \x3ccode\x3edocker-compose logs -f web-service\x3c\/code\x3e - 然后对其中一个中断编译的组件进行更改：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs 1c\x22\x3eweb-service       \x3cspan class=\x22hljs-string\x22\x3e| Compiling...\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| Failed to compile.\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| Error in .\/src\/components\/SavedMovies.jsx\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| \/usr\/src\/app\/src\/components\/SavedMovies.jsx\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|   10:13  error  \x27Link\x27 is not defined  react\/jsx-no-undef\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| ✖ 1 problem (1 error, 0 warnings)\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e更正错误：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs 1c\x22\x3eweb-service       \x3cspan class=\x22hljs-string\x22\x3e|\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| Compiling...\x3c\/span\x3e\nweb-service       \x3cspan class=\x22hljs-string\x22\x3e| Compiled successfully!\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e继续尝试添加和更新React应用程序，直到在容器中使用它为止感到舒服为止。\x3c\/p\x3e\n\x3ch2\x3e测试设置\x3c\/h2\x3e\n\x3cp\x3e到目前为止，我们只用单元和集成测试测试了每个微服务。让我们把注意力转向功能性的端到端的测试，来测试整个系统。为此，我们将使用\x3ca href=\x22https:\/\/devexpress.github.io\/testcafe\/\x22\x3eTestCafe\x3c\/a\x3e。\x3c\/p\x3e\n\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e不想使用TestCafe？请查看使用Mocha，Chai，Request和Cheerio（全部在容器内）进行测试的\x3ca href=\x22https:\/\/github.com\/mjhea0\/node-docker-api\/tree\/master\/tests\x22\x3e代码\x3c\/a\x3e。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e我们偷个懒，在全局安装TestCafe：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs elixir\x22\x3e\x3cspan class=\x22hljs-variable\x22\x3e$ \x3c\/span\x3enpm install testcafe\x3cspan class=\x22hljs-variable\x22\x3e@0\x3c\/span\x3e.\x3cspan class=\x22hljs-number\x22\x3e15.0\x3c\/span\x3e -g\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e然后运行测试：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stylus\x22\x3e$ testcafe firefox tests\x3cspan class=\x22hljs-comment\x22\x3e\/**\/\x3c\/span\x3e*\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e测试结果为：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs routeros\x22\x3etestcafe firefox tests\/**\/*.js\n Running tests \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e:\n - Firefox 53.0.0 \/ Mac OS X 10.11.0\n\n \/login\n ✓\x3cspan class=\x22hljs-built_in\x22\x3e users \x3c\/span\x3eshould be able \x3cspan class=\x22hljs-keyword\x22\x3eto\x3c\/span\x3e log \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eand\x3c\/span\x3e out\n\n\n 1 passed (3s)\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cblockquote\x3e\n\x3cp\x3e\x3cstrong\x3e注意：\x3c\/strong\x3e 对容器内的运行测试感兴趣，可以查看\x3ca href=\x22https:\/\/devexpress.github.io\/testcafe\/documentation\/using-testcafe\/installing-testcafe.html#using-testcafe-docker-image\x22\x3e官方的TestCafe文档\x3c\/a\x3e，了解更多有关在Docker上使用TestCafe的信息。\x3c\/p\x3e\n\x3c\/blockquote\x3e\n\x3cp\x3e为了简化测试工作流程，请将 \x3cem\x3etest.sh\x3c\/em\x3e 文件添加到项目根目录中：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs bash\x22\x3e\x3cspan class=\x22hljs-meta\x22\x3e#!\/bin\/bash\n\x3c\/span\x3e\nfails=\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-title\x22\x3einspect\x3c\/span\x3e\x3c\/span\x3e() {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e [ \x3cspan class=\x22hljs-variable\x22\x3e$1\x3c\/span\x3e -ne 0 ] ; \x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e\n    fails=\x3cspan class=\x22hljs-string\x22\x3e\x22\x3cspan class=\x22hljs-variable\x22\x3e${fails}\x3c\/span\x3e \x3cspan class=\x22hljs-variable\x22\x3e$2\x3c\/span\x3e\x22\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3efi\x3c\/span\x3e\n}\n\ndocker-compose run users-service npm \x3cspan class=\x22hljs-built_in\x22\x3etest\x3c\/span\x3e\ninspect $? users-service\n\ndocker-compose run movies-service npm \x3cspan class=\x22hljs-built_in\x22\x3etest\x3c\/span\x3e\ninspect $? movies-service\n\ntestcafe firefox tests\/**\/*.js\ninspect $? e2e\n\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e [ -n \x3cspan class=\x22hljs-string\x22\x3e\x22\x3cspan class=\x22hljs-variable\x22\x3e${fails}\x3c\/span\x3e\x22\x3c\/span\x3e ];\n  \x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Tests failed: \x3cspan class=\x22hljs-variable\x22\x3e${fails}\x3c\/span\x3e\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3eexit\x3c\/span\x3e 1\n  \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3eecho\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22Tests passed!\x22\x3c\/span\x3e\n    \x3cspan class=\x22hljs-built_in\x22\x3eexit\x3c\/span\x3e 0\n\x3cspan class=\x22hljs-keyword\x22\x3efi\x3c\/span\x3e\n\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e运行测试：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs stata\x22\x3e$ \x3cspan class=\x22hljs-keyword\x22\x3esh\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3etest\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3esh\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3ch2\x3eSwagger设置\x3c\/h2\x3e\n\x3cp\x3e在“services\/movies\/swagger”目录中添加 \x3cem\x3eDockerfile\x3c\/em\x3e 文件：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs dockerfile\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eFROM\x3c\/span\x3e node:latest\n\n\x3cspan class=\x22hljs-comment\x22\x3e# set working directory\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e mkdir \/usr\/src\/app\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eWORKDIR\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e \/usr\/src\/app\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# add `\/usr\/src\/node_modules\/.bin` to $PATH\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eENV\x3c\/span\x3e PATH \/usr\/src\/app\/node_modules\/.bin:$PATH\n\n\x3cspan class=\x22hljs-comment\x22\x3e# install and cache app dependencies\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eADD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e package.json \/usr\/src\/app\/package.json\n\x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eRUN\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e npm install\n\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e# start app\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eCMD\x3c\/span\x3e\x3cspan class=\x22bash\x22\x3e [\x3cspan class=\x22hljs-string\x22\x3e\x22npm\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22start\x22\x3c\/span\x3e]\n\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e更新 \x3cem\x3edocker-compose.yml\x3c\/em\x3e ：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs haml\x22\x3eswagger:\n  container_name: swagger\n  build: .\/services\/movies\/swagger\/\n  volumes:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/services\/movies\/swagger:\/usr\/src\/app\x27\x3c\/span\x3e\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27\/usr\/src\/app\/node_modules\x27\x3c\/span\x3e\n\x3c\/span\x3e  ports:\n    -\x3cspan class=\x22ruby\x22\x3e \x3cspan class=\x22hljs-string\x22\x3e\x273003:3001\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e# expose ports - HOST:CONTAINER\x3c\/span\x3e\n\x3c\/span\x3e  environment:\n    -\x3cspan class=\x22ruby\x22\x3e NODE_ENV=${NODE_ENV}\n\x3c\/span\x3e  depends_on:\n    users-service:\n      condition: service_started\n    movies-service:\n      condition: service_started\n  links:\n    -\x3cspan class=\x22ruby\x22\x3e users-service\n\x3c\/span\x3e    -\x3cspan class=\x22ruby\x22\x3e movies-service\n\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e启动：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs mipsasm\x22\x3e$ docker-compose up -d --\x3cspan class=\x22hljs-keyword\x22\x3ebuild \x3c\/span\x3e\x3cspan class=\x22hljs-keyword\x22\x3eswagger\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e导航到\x3ca href=\x22http:\/\/localhost:3003\/docs\x22\x3ehttp:\/\/localhost:3003\/docs\x3c\/a\x3e并对其进行测试:\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22http:\/\/mherman.org\/assets\/img\/blog\/microservice-movies-swagger.png\x22 alt=\x22swagger 文档\x22\x3e\x3c\/p\x3e\n\x3cp\x3e现在，你只需要支持基于JWT的身份验证并添加剩余的接口即可！\x3c\/p\x3e\n\x3ch2\x3e下一步\x3c\/h2\x3e\n\x3cp\x3e接下来呢？\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e\x3cem\x3eReact 应用\x3c\/em\x3e - React应用需要用心来完成。 添加样式，解决bug。更新flash消息，这样每次只显示一个。 编写测试。建立新的特性。添加Redux。天空的极限。如果你愿意，请联系我！\x3c\/li\x3e\n\x3cli\x3e\x3cem\x3eSwagger\x3c\/em\x3e - 添加基于JWT的身份验证，并从电影服务中添加额外的接口。.\x3c\/li\x3e\n\x3cli\x3e\x3cem\x3eDockerfiles\x3c\/em\x3e - 阅读Docker团队的\x3ca href=\x22https:\/\/docs.docker.com\/engine\/userguide\/eng-image\/dockerfile_best-practices\/\x22\x3e编写Dockerfiles的最佳实践\x3c\/a\x3e，并根据需要进行重构\x3c\/li\x3e\n\x3cli\x3e生产环境 - 想在AWS上部署吗？查看\x3ca href=\x22http:\/\/mherman.org\/blog\/2017\/09\/18\/on-demand-test-environments-with-docker-and-aws-ecs\x22\x3eOn-Demand Environments With Docker and AWS ECS\x3c\/a\x3e的博客文章。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e从\x3ca href=\x22https:\/\/github.com\/mjhea0\/microservice-movies\x22\x3emicroservice-movies\x3c\/a\x3e的v2标签中获取最终代码。请在下面添加问题和评论。还有幻灯片！如果有兴趣，可以在\x3ca href=\x22http:\/\/mherman.org\/microservice-movies\x22\x3e这里查看\x3c\/a\x3e。\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>开发微服务-Node,React和Docker</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/developing-microservices-node-react-and-docker">https://www.zcfy.cc/article/developing-microservices-node-react-and-docker</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/hyx8qgfszjn/" target="_blank">https://alili.tech/archive/hyx8qgfszjn/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>