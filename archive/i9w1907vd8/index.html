<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="【翻译】关于回调地狱"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>【翻译】关于回调地狱 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/i9w1907vd8/",
				"appid": "1613049289050283", 
				"title": "【翻译】关于回调地狱 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-13T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/ot1d53crzc/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/23ecsdyryk7j/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&text=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&text=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&title=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&is_video=false&description=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&title=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&title=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&title=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fi9w1907vd8%2f&title=%e3%80%90%e7%bf%bb%e8%af%91%e3%80%91%e5%85%b3%e4%ba%8e%e5%9b%9e%e8%b0%83%e5%9c%b0%e7%8b%b1"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">【翻译】关于回调地狱</h1><div class="meta"><div class="postdate"><time datetime="2019-01-13" itemprop="datePublished">2019-01-13</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e回调地狱\x3c\/h1\x3e\n\x3cp\x3eJavaScript异步程序书写指南\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e什么是“回调地狱”？\x3c\/h3\x3e\n\x3cp\x3e我们很难一眼就看懂异步JavaScript，或者是使用回调函数的JavaScript程序。例如下面这段代码：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22fs.readdir(source, function (err, files) {\n  if (err) {\n    console.log(\x27Error finding files: \x27 \x2b err)\n  } else {\n    files.forEach(function (filename, fileIndex) {\n      console.log(filename)\n      gm(source \x2b filename).size(function (err, values) {\n        if (err) {\n          console.log(\x27Error identifying file size: \x27 \x2b err)\n        } else {\n          console.log(filename \x2b \x27 : \x27 \x2b values)\n          aspect = (values.width \/ values.height)\n          widths.forEach(function (width, widthIndex) {\n            height = Math.round(width \/ aspect)\n            console.log(\x27resizing \x27 \x2b filename \x2b \x27to \x27 \x2b height \x2b \x27x\x27 \x2b height)\n            this.resize(width, height).write(dest \x2b \x27w\x27 \x2b width \x2b \x27_\x27 \x2b filename, function(err) {\n              if (err) console.log(\x27Error writing file: \x27 \x2b err)\n            })\n          }.bind(this))\n        }\n      })\n    })\n  }\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3efs.readdir(source, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, files\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Error finding files: \x27\x3c\/span\x3e \x2b err)\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    files.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3efilename, fileIndex\x3c\/span\x3e) \x3c\/span\x3e{\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(filename)\n      gm(source \x2b filename).size(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, values\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Error identifying file size: \x27\x3c\/span\x3e \x2b err)\n        } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(filename \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 : \x27\x3c\/span\x3e \x2b values)\n          aspect = (values.width \/ values.height)\n          widths.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3ewidth, widthIndex\x3c\/span\x3e) \x3c\/span\x3e{\n            height = \x3cspan class=\x22hljs-built_in\x22\x3eMath\x3c\/span\x3e.round(width \/ aspect)\n            \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27resizing \x27\x3c\/span\x3e \x2b filename \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27to \x27\x3c\/span\x3e \x2b height \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27x\x27\x3c\/span\x3e \x2b height)\n            \x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e.resize(width, height).write(dest \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27w\x27\x3c\/span\x3e \x2b width \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27_\x27\x3c\/span\x3e \x2b filename, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n              \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Error writing file: \x27\x3c\/span\x3e \x2b err)\n            })\n          }.bind(\x3cspan class=\x22hljs-keyword\x22\x3ethis\x3c\/span\x3e))\n        }\n      })\n    })\n  }\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个一堆以\x3ccode\x3e})\x3c\/code\x3e结尾的金字塔，我们很亲切地称它为——“回调地狱”。\x3c\/p\x3e\n\x3cp\x3e之所以会出现回调地狱，是因为我们写JavaScript一般是视觉上的从上到下书写。很多人犯了这个错误！在例如C、Ruby或者Python等其他语言，在第二行代码运行之前，第一行代码肯定已经运行完了。然而如后面所说的，JavaScript是不同的。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e什么是回调函数？\x3c\/h2\x3e\n\x3cp\x3e回调函数是JavaScript里约定俗成的一个名称。实际上并不存在确定的“回调函数”，只是大家就管那个位置的函数作回调函数。与大多数运行后立刻给出结果的函数不同，使用回调的函数要花一些时间才能得出结果。“异步”这个词就是代表‘要花时间，将来运行’。通常回调函数会用在下载文件、读取文件、或者数据库相关事务等。\x3c\/p\x3e\n\x3cp\x3e当你调用一个普通函数，你可以立刻得到它的值：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var result = multiplyTwoNumbers(5, 10)\nconsole.log(result)\n\/\/ 50 gets printed out\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e result = multiplyTwoNumbers(\x3cspan class=\x22hljs-number\x22\x3e5\x3c\/span\x3e, \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(result)\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 50 gets printed out\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而使用回调的函数不能立刻得到反馈。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var photo = downloadPhoto(\x27http:\/\/coolcats.com\/cat.gif\x27)\n\/\/ photo is \x27undefined\x27!\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e photo = downloadPhoto(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/coolcats.com\/cat.gif\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ photo is \x27undefined\x27!\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个时候，这张gif可能要下载很久，你总不能让程序什么都不干停下来就等它下载完。\x3c\/p\x3e\n\x3cp\x3e相反，你可以储存下载完后触发的代码到一个函数里，这就是回调函数！把这些代码写进\x3ccode\x3edownloadPhoto\x3c\/code\x3e函数，下载成功后，会运行回调函数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22downloadPhoto(\x27http:\/\/coolcats.com\/cat.gif\x27, handlePhoto)\n\nfunction handlePhoto (error, photo) {\n  if (error) console.error(\x27Download error!\x27, error)\n  else console.log(\x27Download finished\x27, photo)\n}\n\nconsole.log(\x27Download started\x27)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3edownloadPhoto(\x3cspan class=\x22hljs-string\x22\x3e\x27http:\/\/coolcats.com\/cat.gif\x27\x3c\/span\x3e, handlePhoto)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandlePhoto\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, photo\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27Download error!\x27\x3c\/span\x3e, error)\n  \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Download finished\x27\x3c\/span\x3e, photo)\n}\n\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Download started\x27\x3c\/span\x3e)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e我们理解回调最难的地方就是理解程序的运行顺序。例子中发生了三个主要事件，首先是\x3ccode\x3ehandlePhoto\x3c\/code\x3e函数被声明，然后作为回调函数被\x3ccode\x3edownloadPhoto\x3c\/code\x3e函数调用，最后控制台打印出\x3ccode\x3e\x27Download started\x27\x3c\/code\x3e。\x3c\/p\x3e\n\x3cp\x3e注意\x3ccode\x3ehandlePhoto\x3c\/code\x3e还没有被调用，它只是被创建然后最为回调函数传入\x3ccode\x3edownloadPhoto\x3c\/code\x3e。直到\x3ccode\x3edownloadPhoto\x3c\/code\x3e完成下载，他都不会运行。\x3c\/p\x3e\n\x3cp\x3e这个例子说明两个问题：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3ehandlePhoto\x3c\/code\x3e（回调函数）只是储存了将要运行的东西\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e不要从上到下阅读程序，程序会根据事情完成而跳转\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader3\x22\x3e怎么修复回调地狱？\x3c\/h2\x3e\n\x3cp\x3e你只需要跟着一下\x3cstrong\x3e三步\x3c\/strong\x3e走：\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e1.减少代码嵌套\x3c\/h3\x3e\n\x3cp\x3e以下是一些用于AJAX的浏览器端代码（使用\x3ca href=\x22https:\/\/github.com\/iriscouch\/browser-request\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ebrowser-request\x3c\/a\x3e）：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var form = document.querySelector(\x27form\x27)\nform.onsubmit = function (submitEvent) {\n  var name = document.querySelector(\x27input\x27).value\n  request({\n    uri: \x26quot;http:\/\/example.com\/upload\x26quot;,\n    body: name,\n    method: \x26quot;POST\x26quot;\n  }, function (err, response, body) {\n    var statusMessage = document.querySelector(\x27.status\x27)\n    if (err) return statusMessage.value = err\n    statusMessage.value = body\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e form = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27form\x27\x3c\/span\x3e)\nform.onsubmit = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esubmitEvent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e name = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value\n  request({\n    \x3cspan class=\x22hljs-attr\x22\x3euri\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com\/upload\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: name,\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e\n  }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, response, body\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e statusMessage = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.status\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e statusMessage.value = err\n    statusMessage.value = body\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码有两个匿名函数，我们来赋予他们一个函数名！\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var form = document.querySelector(\x27form\x27)\nform.onsubmit = function formSubmit (submitEvent) {\n  var name = document.querySelector(\x27input\x27).value\n  request({\n    uri: \x26quot;http:\/\/example.com\/upload\x26quot;,\n    body: name,\n    method: \x26quot;POST\x26quot;\n  }, function postResponse (err, response, body) {\n    var statusMessage = document.querySelector(\x27.status\x27)\n    if (err) return statusMessage.value = err\n    statusMessage.value = body\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e form = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27form\x27\x3c\/span\x3e)\nform.onsubmit = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eformSubmit\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esubmitEvent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e name = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value\n  request({\n    \x3cspan class=\x22hljs-attr\x22\x3euri\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com\/upload\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: name,\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e\n  }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epostResponse\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, response, body\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e statusMessage = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.status\x27\x3c\/span\x3e)\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e statusMessage.value = err\n    statusMessage.value = body\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e你们看，给函数命名很简单，但是好处可不少：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e有了函数名，可以很容易知道这段代码的作用\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e在控制台调试出错的时候，控制台会告诉你是哪个函数出错了，而不是一个匿名函数（anonymous）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e可以让你把这些函数移动到合适的位置，使用的时候用函数名调用就可以了\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e现在我们都写到程序最外层：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22document.querySelector(\x27form\x27).onsubmit = formSubmit\n\nfunction formSubmit (submitEvent) {\n  var name = document.querySelector(\x27input\x27).value\n  request({\n    uri: \x26quot;http:\/\/example.com\/upload\x26quot;,\n    body: name,\n    method: \x26quot;POST\x26quot;\n  }, postResponse)\n}\n\nfunction postResponse (err, response, body) {\n  var statusMessage = document.querySelector(\x27.status\x27)\n  if (err) return statusMessage.value = err\n  statusMessage.value = body\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27form\x27\x3c\/span\x3e).onsubmit = formSubmit\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eformSubmit\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esubmitEvent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e name = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value\n  request({\n    \x3cspan class=\x22hljs-attr\x22\x3euri\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com\/upload\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: name,\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e\n  }, postResponse)\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epostResponse\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, response, body\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e statusMessage = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.status\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e statusMessage.value = err\n  statusMessage.value = body\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注意，函数声明在底部，却仍然能调用，这得益于\x3ca href=\x22https:\/\/gist.github.com\/maxogden\/4bed247d9852de93c94c\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e函数提升\x3c\/a\x3e\x3cbutton class=\x22btn btn-xs btn-default ml10 preview\x22 data-url=\x22maxogden\/4bed247d9852de93c94c\x22 data-typeid=\x221\x22\x3e点击预览\x3c\/button\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e2.模块化\x3c\/h3\x3e\n\x3cp\x3e用上面的例子，我们将把它拆分成多个文件，我会告诉你怎么把他做成模块。\x3c\/p\x3e\n\x3cp\x3e创建一个包含前面两个函数的新文件\x3ccode\x3eformuploader.js\x3c\/code\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module.exports.submit = formSubmit\n\nfunction formSubmit (submitEvent) {\n  var name = document.querySelector(\x27input\x27).value\n  request({\n    uri: \x26quot;http:\/\/example.com\/upload\x26quot;,\n    body: name,\n    method: \x26quot;POST\x26quot;\n  }, postResponse)\n}\n\nfunction postResponse (err, response, body) {\n  var statusMessage = document.querySelector(\x27.status\x27)\n  if (err) return statusMessage.value = err\n  statusMessage.value = body\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports.submit = formSubmit\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eformSubmit\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3esubmitEvent\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e name = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27input\x27\x3c\/span\x3e).value\n  request({\n    \x3cspan class=\x22hljs-attr\x22\x3euri\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/example.com\/upload\x22\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3ebody\x3c\/span\x3e: name,\n    \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22POST\x22\x3c\/span\x3e\n  }, postResponse)\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3epostResponse\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerr, response, body\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e statusMessage = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27.status\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e statusMessage.value = err\n  statusMessage.value = body\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3emodule.exports\x3c\/code\x3e来自node.js的模块系统，可以使用在node、Electron，浏览器上（借助browserify）。我十分喜欢这种风格，因为哪儿都能用，而且易于理解，不用依赖于其他复杂设置。\x3c\/p\x3e\n\x3cp\x3e我们得到了\x3ccode\x3eformuploader.js\x3c\/code\x3e，只要引入并使用它就可以了！操作如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var formUploader = require(\x27formuploader\x27)\ndocument.querySelector(\x27form\x27).onsubmit = formUploader.submit\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e formUploader = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27formuploader\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.querySelector(\x3cspan class=\x22hljs-string\x22\x3e\x27form\x27\x3c\/span\x3e).onsubmit = formUploader.submit\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e现在我们的代码只有两行，有以下好处：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e易于新开发者理解，他们不会为读取所有的\x3ccode\x3eformuploader\x3c\/code\x3e函数而陷入困境。\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eformuploader\x3c\/code\x3e不用复制粘贴代码，只要在github或者npm下载分享的代码就可以了。\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e3.处理每一个错误\x3c\/h3\x3e\n\x3cp\x3e常见错误有几种\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e语法错误（运行失败）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e运行时错误（可以运行但是有bug）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e平台错误（文件权限问题、磁盘问题、网络问题）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e前两条规则主要是提高你的代码的可读性，而这条是让你的代码更稳定。在处理回调时，您将根据定义处理发送的任务，在后台执行某些操作，最后成功完成或失败中止。任何有经验的开发人员都会告诉你，你永远不会知道这些错误发生什么时候发生，所以在问题出现时都必须有所对策。\x3c\/p\x3e\n\x3cp\x3e最常用的回调错误处理是Node.js风格，也就是回调函数的第一个参数总是错误参数。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22 var fs = require(\x27fs\x27)\n\n fs.readFile(\x27\/Does\/not\/exist\x27, handleFile)\n\n function handleFile (error, file) {\n   if (error) return console.error(\x27Uhoh, there was an error\x27, error)\n   \/\/ otherwise, continue on and use `file` in your code\n }\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e)\n\n fs.readFile(\x3cspan class=\x22hljs-string\x22\x3e\x27\/Does\/not\/exist\x27\x3c\/span\x3e, handleFile)\n\n \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehandleFile\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3eerror, file\x3c\/span\x3e) \x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (error) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(\x3cspan class=\x22hljs-string\x22\x3e\x27Uhoh, there was an error\x27\x3c\/span\x3e, error)\n   \x3cspan class=\x22hljs-comment\x22\x3e\/\/ otherwise, continue on and use `file` in your code\x3c\/span\x3e\n }\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e第一个参数是\x3ccode\x3eerror\x3c\/code\x3e是一个简单的共识，这样做可以提醒你必须处理你的错误。如果是第二个参数的话你很容易把代码写成\x3ccode\x3efunction handleFile (file) { }\x3c\/code\x3e然后就忘了处理错误。\x3cbr\x3e代码规范化工具也可以提醒你添加回调错误处理，最简单的方法之一是使用\x3ca href=\x22https:\/\/standardjs.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estandard\x3c\/a\x3e。只是在你的文件目录运行\x3ccode\x3e $ standard\x3c\/code\x3e就能检查你的代码有没有缺少错误处理。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e总结\x3c\/h3\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e不要嵌套函数，命名后调用更好\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e使用函数提升\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e处理回调函数的\x3cstrong\x3e每一个错误\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e创建可重用函数，写成模块，让你更容易读懂代码。把你的代码拆分成小块可以帮助你处理错误，写测试，重构，方便为你的代码写更稳定的API\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e避免回调地狱的最重要的是\x3cstrong\x3e移动函数\x3c\/strong\x3e，以便程序流程可以更容易地被理解，其他程序员可以不翻遍整个文件就能知道这段程序的功能。\x3c\/p\x3e\n\x3cp\x3e你可以先把函数移动到底部，然后逐渐把函数写到模块文件里，然后使用\x3ccode\x3erequire\x3c\/code\x3e引入它（就像引用其他npm模块一样）。\x3c\/p\x3e\n\x3cp\x3e一些写模块的经验：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e先把经常重复使用的功能写成一个函数\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e当这个函数写得够大之后，把他移动到另一个文件，用\x3ccode\x3emodule.exports\x3c\/code\x3e暴露它，然后用\x3ccode\x3erequire\x3c\/code\x3e引入\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e如果你的代码是通用的，可以写readme文件和\x3ccode\x3epackage.json\x3c\/code\x3e发布到npm或者github\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e一个好模块，体积要小，而且针对只一个问题\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e模块中的单个文件不应超过约150行\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e模块不应该有多个级别的嵌套文件夹，其中包含JavaScript文件。如果是这样，它可能做的太多了\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e让有经验的程序员介绍你一些好用的模块，尝试理解这个模块的功能，如果花了几分钟的话，这个模块可能就不够好了\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3e关于promise\/生成器\/ES6？\x3c\/h4\x3e\n\x3cp\x3e在查看更高级的解决方案之前，请记住，回调是JavaScript的一个基本部分（因为它们只是函数），你应该学习如何读写它们，然后再转向更高级的语言功能，因为它们依赖于对回调的理解。如果您还不能写可维护的回调代码，请继续努力学习！\x3c\/p\x3e\n\x3cp\x3e如果你真的想你的异步代码可以“从上至下阅读”，你可以试试这些美妙的方法。注意，这些功能在不同平台会有兼容性问题，使用前请先调查清楚！\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3ePromise\x3c\/strong\x3e就是一种让你从上至下写回调函数的方法，它鼓励你使用try\/catch处理更多类型的错误。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eGenerator\x3c\/strong\x3e可以让你“暂停”一个函数（而不暂停整个程序），它也能你从上至下写异步函数，但是代价是代码有点复杂难以理解。\x3ca href=\x22https:\/\/github.com\/mappum\/watt\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewat\x3c\/a\x3e就是使用这个方法。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3eAsync functions\x3c\/strong\x3e是ES7的特性，是生成器和promise更高级的封装，有兴趣自己谷歌一下呗。\x3c\/p\x3e\n\x3cp\x3e就我个人而言，我使用回调函数处理90％的异步代码，当事情变得复杂时，依靠一些库，例如\x3ca href=\x22https:\/\/github.com\/feross\/run-parallel\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3erun-parallel\x3c\/a\x3e或者\x3ca href=\x22https:\/\/github.com\/feross\/run-series\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3erun-series\x3c\/a\x3e。我不认为研究回调 vs promise vs 其他什么方法对我来说有什么帮助，最重要的还是保持代码简单，不嵌套，并分成小模块。\x3c\/p\x3e\n\x3cp\x3e无论你选择何种方法，请\x3cstrong\x3e始终处理每个错误\x3c\/strong\x3e，并\x3cstrong\x3e保持代码简洁\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e记住，只有\x3cem\x3e你\x3c\/em\x3e可以防止回调地狱和森林火灾。\x3c\/h3\x3e\n\x3cp\x3e原文： \x3ca href=\x22http:\/\/callbackhell.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/callbackhell.com\/\x3c\/a\x3e\x3cbr\x3e本文github地址： \x3ca href=\x22https:\/\/github.com\/ssshooter\/callback-hell\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/ssshooter\/...\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>【翻译】关于回调地狱</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000009644973">https://segmentfault.com/a/1190000009644973</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/i9w1907vd8/" target="_blank">https://alili.tech/archive/i9w1907vd8/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>