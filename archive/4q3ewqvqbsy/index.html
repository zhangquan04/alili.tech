<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="React和React Native事件系统详解：和谐共存"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>React和React Native事件系统详解：和谐共存 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4q3ewqvqbsy/",
				"appid": "1613049289050283", 
				"title": "React和React Native事件系统详解：和谐共存 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-19T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/wm504yx7dcb/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/agx80jkcr9k/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&text=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&text=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&title=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&is_video=false&description=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&title=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&title=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&title=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4q3ewqvqbsy%2f&title=React%e5%92%8cReact%20Native%e4%ba%8b%e4%bb%b6%e7%b3%bb%e7%bb%9f%e8%af%a6%e8%a7%a3%ef%bc%9a%e5%92%8c%e8%b0%90%e5%85%b1%e5%ad%98"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">React和React Native事件系统详解：和谐共存</h1><div class="meta"><div class="postdate"><time datetime="2019-01-19" itemprop="datePublished">2019-01-19</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n            \x3ch2\x3e\x3cem\x3e使用它，喜欢它，但是你真的了解它吗？知道React事件如何在底层处理实现吗？\x3c\/em\x3e\x3c\/h2\x3e\n\x3cp\x3e已经有很多帖子解释了如何使用React的事件处理系统，但是并没有多少帖子是在解释他们是“如何工作”的。最近我一直在研究React Native，我和“事件处理”的斗争过程提醒我了了解_巧合_是多么的重要。因此，我决心收集尽可能多的有关React事件处理的信息：以下是我在[源代码]（\x3ca href=\x22https:\/\/github.com\/facebook\/react）\x22\x3ehttps:\/\/github.com\/facebook\/react）\x3c\/a\x3e\n中找到相关信息的总结报告。\x3c\/p\x3e\n\x3cp\x3e让我们开始React事件之旅吧！\x3c\/p\x3e\n\x3ch3\x3e关于React事件处理：概况\x3c\/h3\x3e\n\x3cp\x3e从概念的角度说，React中的事件处理并不是什么技术革命，它的目标就是拦截各种事件(比如点击、触摸...)，然后触发程序员编辑的相关回调函数。这种\x3cem\x3e处理方式\x3c\/em\x3e使得React的事件处理方式脱颖而出。\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t016eab6eae216d3acb.jpg\x22 alt=\x22\x22\x3e\nReact事件处理流程图\x3c\/p\x3e\n\x3cp\x3eReact强调的一点是和谐统一：跨浏览器的React web，跨平台的React Native。但事件系统通过为\x3cem\x3eReact web 和 React Native\x3c\/em\x3e创建（几乎）一样的事件处理系统，通过这种方式将这一概念向前推进了一步。\n这种想法应该是正确的：同时使用DOM和Native事件——减去一点预处理 ——使用\x3cem\x3e完全相同的代码\x3c\/em\x3e。 React如何揭开这个魔术之谜的呢？这可能是一篇文章的主题（可能写成系列，也有可能这有这么一篇），所以先让我们试着简要的说说。\x3c\/p\x3e\n\x3ch3\x3e欢迎来到Fiber的魔法世界\x3c\/h3\x3e\n\x3cp\x3e当一个APP更新的时候会发生什么(就是点击更新按钮之后)？新的信息被传播，应用程序被重新渲染。当前，React（web或者native）的核心思想是将上述过程分为两个阶段：“调和”—— React将计算两次文件的不同并决定那一部分需要更新；“渲染”——确定需要更新的位置并更新。看问题的关键在哪？对\x3cstrong\x3e调和的阶段不关心如何、在哪渲染，只是关注什么需要被渲染\x3c\/strong\x3e。因此，这一阶段可以看作是React Native和React web共同流程。剩下的唯一任务就是插入适当的渲染引擎了。\n事件处理是“调和”阶段的一部分，因此发生在同一抽象世界中，在那里浏览器事件和DOM组件与Native事件和组件没有区别。那个世界应该是什么样子的呢？因为我们习惯用有形的可见的事物去类比思考，所以用图片描述它可能有些复杂，但是我们可以明确的是在那个平行宇宙，每一个组件都可以看作是\x3ccode\x3eFiber\x3c\/code\x3e。确实，React的调和算法不关心组件是如何被渲染的，仅仅关心两次渲染之间的差别，组件本身是不重要的。只有当组件先前的状态和新状态之间存在变化它才会起作用(如果没有变化，自然不起作用)。这就是\x3ccode\x3eFiber\x3c\/code\x3e：它不是物理实体只是个工作单位，是调和过程中的一小步。\x3c\/p\x3e\n\x3cp\x3e对于那些被上文介绍的\x3ccode\x3eFiber\x3c\/code\x3e吸引的读者，我建议可以去深入的了解\x3ccode\x3eFiber\x3c\/code\x3e和React Fiber。这些\x3ca href=\x22https:\/\/www.youtube.com\/watch?v=ZCuYPiUIONs\x26amp;t=1267s\x22\x3e视频\x3c\/a\x3e( \x3ca href=\x22https:\/\/medium.com\/@linclark\x22\x3e作者：Lin Clark\x3c\/a\x3e )也许是个不错的开始。如果你不是很能理解\x3ccode\x3eFiber\x3c\/code\x3e的概念也不要担心，这并不是必须的，文章的剩余部分也没有以它为中心将讲开去，只需了解\x3ccode\x3eFiber\x3c\/code\x3e的交换是个新概念，事件管理系统并没有在此经历任何重大的变化。需要记住的是，\x3cstrong\x3eReact工作在“抽象的世界”，在那里更新独立于组件的物理表示形式而进行：复杂的现实世界中（浏览器，你的手机...），组件被渲染的位置仅是那个唯一的独立设备的宇宙的投影。事务处理没有什么特别的，几乎所有的事都发生在那“抽象的世界”，纠结于事件是来着DOM的还是Native的，似乎并不重要。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e在事件处理中，“监听、规范化和再发射”阶段的存在恰恰是为了将真实事件和组件转化为抽象对象。 它捕获来自组件的Native事件，并将它们转换为React中被称为\x3ccode\x3etopLevelType\x3c\/code\x3e与\x3ccode\x3eFiber\x3c\/code\x3e相关联的东西。 因此，Native事件和组件本身对下游事件处理系统是不可见的，并且没有处理程序安装在“真实”环境中：所有事件都发生在虚拟DOM中。\x3c\/p\x3e\n\x3ch3\x3e接收（监听）事件\x3c\/h3\x3e\n\x3cp\x3e通过上图我们可以知道，任何情况下，事件的处理都是从监听阶段开始。这并不难理解，毕竟很多人在编程过程中都习惯自定义监听器，比如只对\x3ccode\x3eclick\x3c\/code\x3e而不是\x3ccode\x3emousescroll\x3c\/code\x3e作出反应。但为什么React本身需要监听所有事件呢？ 其实这是因为事件出现在他们的“自然”环境中：用于Web应用程序的DOM，以及移动设备上的Native应用程序。无论是网络还是Native，React都是在这些基本环境的基础上建立的工具。 因此，\x3cstrong\x3e事件不会主动地返回给React，而是需要React主动监听\x3c\/strong\x3e。\x3c\/p\x3e\n\x3ch4\x3e接收事件：React web\x3c\/h4\x3e\n\x3cp\x3e对于React web而言，这个过程比较简单，即\x3cstrong\x3etop-level delegation\x3c\/strong\x3e。 这意味着React监听\x3ccode\x3edocument\x3c\/code\x3e级别的每个事件，这还有一个有趣的事儿：到执行任何与React相关的代码时，这个事件已经经过了DOM树上的第一个捕获\/冒泡循环。\n当从浏览器接收到该事件后，React将执行另一个跨浏览器协调步骤。 \n作为针对实际上是同一事件的不同名称的浏览器的解决方法，React定义了“topLevelTypes”，作为实际是同一事件但浏览器有给予不同命名的解决办法。它们是针对浏览器特定事件的包装，例如，\x3ccode\x3etransitionEnd\x3c\/code\x3e，\x3ccode\x3ewebkitTransitionEnd\x3c\/code\x3e，\x3ccode\x3eMozTransitionEnd\x3c\/code\x3e和\x3ccode\x3eoTransitionEnd\x3c\/code\x3e全都成为\x3ccode\x3etopAnimationEnd\x3c\/code\x3e ，这种方法有效缓解了设计跨浏览器应用程序的痛苦。\x3c\/p\x3e\n\x3ch4\x3e接收事件: React Native\x3c\/h4\x3e\n\x3cp\x3e对于React Native而言，事件通过\x3cstrong\x3eNative代码和React相连接的网桥进行接收\x3c\/strong\x3e。 简单的说，无论何时创建View，React都会将其ID号传递给Native，以便能够接收与该元素相关的所有事件。 然后，在向下传递（touch）事件之前执行一些轻微修改，包括将“touches”和“changedTouches”添加到事件以使其符合\x3ca href=\x22https:\/\/www.w3.org\/TR\/touch-events\/#idl-def-TouchEvent\x22\x3eW3标准 \x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e从现在开始，为了与之后要介绍的\x3ccode\x3eSyntheticEvents\x3c\/code\x3e相区分开，我们将上文提到的事件”（即来自Native或浏览器，被轻微修改的事件对象）称为 “Native事件”。\x3c\/p\x3e\n\x3ch3\x3eReact事件管理系统内部一览\x3c\/h3\x3e\n\x3cp\x3e现在我们的Native活动，可以跨平台和浏览器进行协调。完美！接下来我们开始准备真正的工作：将这些事件传递给适当的回调函数。React事件系统的真正职责。让我们仔细看看：\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01a24525617c078234.jpg\x22 alt=\x22\x22\x3e\nReact事件系统中的事件流\x3c\/p\x3e\n\x3cp\x3e到处都是事件，尽管如此， \x3ccode\x3eEventPluginHub\x3c\/code\x3e及其事件插件还是非常出色。 \x3ccode\x3eEventPluginHub\x3c\/code\x3e实际上是整个系统的基石，因为它：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e为事件插件注入提供统一的接口。\x3c\/li\x3e\n\x3cli\x3e每接收到一个新的Native事件时，都会通过注入的插件运行，在调度之前返回\x3ccode\x3eSyntheticEvents\x3c\/code\x3e 。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e另一方面，事件插件都具有相似的结构，将Native事件作为输入，输出一个或多个\x3ccode\x3eSyntheticEvents\x3c\/code\x3e，并在后面执行一系列调度（函数）。 \x3ccode\x3eSyntheticEvent\x3c\/code\x3e是React对Native事件的特定包装，基本上和大家已经习惯的浏览器事件具有相同的接口，包括\x3ccode\x3estopPropagation（）\x3c\/code\x3e和\x3ccode\x3epreventDefault（）\x3c\/code\x3e（官方文档事件有一个专门的页面可以提供更多的信息\x3ca href=\x22https:\/\/reactjs.org\/docs\/events.html\x22\x3e点击这儿\x3c\/a\x3e)\x3c\/p\x3e\n\x3ch4\x3e事件插件\x3c\/h4\x3e\n\x3cp\x3e尽管有各种不同的事件插件，如\x3ccode\x3eSimpleEventPlugin\x3c\/code\x3e（\x3ccode\x3eonClick\x3c\/code\x3e，\x3ccode\x3eonTouch\x3c\/code\x3e等等）和非常有名的\x3ccode\x3eResponderEventPlugin\x3c\/code\x3e，它们都遵循相同的模式：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e根据Native事件创建一个或多个\x3ccode\x3eSyntheticEvent\x3c\/code\x3e。.\x3c\/li\x3e\n\x3cli\x3e收集与\x3ccode\x3eSyntheticEvent\x3c\/code\x3e（例如\x3ccode\x3eonTouchStart = {doStuff}\x3c\/code\x3e中的\x3ccode\x3edoStuff\x3c\/code\x3e）相关的所有调度（即你提供的函数，编码器）。\x3c\/li\x3e\n\x3cli\x3e将每个“SyntheticEvent”与其调度一起返回。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e值得注意的是\x3cstrong\x3e实际上没有调度任何插件\x3c\/strong\x3e，因为它只收集自己的函数。（大多数时候，也就是说，一些插件在收集阶段执行一些特定的调度，但这是例外情况而并非常态）。\x3ccode\x3eSyntheticEvent\x3c\/code\x3e可以简单地镜像Native事件（比如\x3ccode\x3eclick\x3c\/code\x3e或\x3ccode\x3edrag\x3c\/code\x3e），或者更复杂一些（比如\x3ccode\x3etouchTap\x3c\/code\x3e），但是在所有情况下它们都会返回调度数组，以便“准备处理“。\x3c\/p\x3e\n\x3cp\x3e为了收集调度，React对组件进行双重遍历（无论是Native的还是DOM），具有从根到嵌套目标（捕获阶段）回到根（冒泡阶段）的捕获和冒泡阶段。\x3c\/p\x3e\n\x3cp\x3e\x3cimg src=\x22https:\/\/p0.ssl.qhimg.com\/t01f96d9beee3ac38cb.jpg\x22 alt=\x22\x22\x3e\n双遍历\x3c\/p\x3e\n\x3cp\x3e请注意，对于所有不同的调度（在插件本身之外执行的调度，即大部分调度），双遍历普遍会发生。诸如\x3ccode\x3estopPropagation（）\x3c\/code\x3e之类的中断将在调度中生效，从而有效地阻止了此\x3ccode\x3eSyntheticEvent\x3c\/code\x3e的后续函数的执行（参见结论）。\x3c\/p\x3e\n\x3ch4\x3e关于\x3ccode\x3eEventPluginHub\x3c\/code\x3e\x3c\/h4\x3e\n\x3cp\x3e当应用程序启动时，所有事件插件都被注入到\x3ccode\x3eEventPluginHub\x3c\/code\x3e中，并且按照配置文件对其排序。在运行工程中，每一次接收到Native事件时，\x3ccode\x3eEventPluginHub\x3c\/code\x3e都将执行以下操作：\x3c\/p\x3e\n\x3col\x3e\n\x3cli\x3e对于每个插件（按顺序），收集所有\x3ccode\x3eSyntheticEvents\x3c\/code\x3e及其调度配置并将它们存储在队列中。\x3c\/li\x3e\n\x3cli\x3e对队列中的所有事件执行相应的调度，并将其从队列中清除。\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e就是这样！ 你的回调函数就是通过这种方式进行工作的。:)\x3c\/p\x3e\n\x3ch3\x3e总结 \x26amp; 结论\x3c\/h3\x3e\n\x3cp\x3eAn interesting consequence of this system is that \x3cstrong\x3ea single native event can (and will, most of the time) generate multiple\x3c\/strong\x3e \x3ccode\x3e**SyntheticEvent**\x3c\/code\x3e\x3cstrong\x3es, each with a scope limited to the plugin that created it\x3c\/strong\x3e. This means that:\n有趣的是在这个系统中\x3cstrong\x3e一个native事件可以(大多数情况下)生成多个\x3c\/strong\x3e \x3ccode\x3e**SyntheticEvent**\x3c\/code\x3e\x3cstrong\x3e每一个的工作范围在创建它的组件里\x3c\/strong\x3e。这意味着：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e只有\x3ccode\x3eSyntheticEvent\x3c\/code\x3e中的\x3ccode\x3enativeEvent\x3c\/code\x3e部分将从插件传递给插件，所以对\x3ccode\x3enativeEvent\x3c\/code\x3e的修改可能会影响后续插件的执行，但对\x3ccode\x3eSyntheticEvent\x3c\/code\x3e的修改则不能。\x3c\/li\x3e\n\x3cli\x3e由于\x3ccode\x3eSyntheticEvent\x3c\/code\x3e的范围有限，所以\x3ccode\x3estopPropagation（）\x3c\/code\x3e等调用方法仅适用于单一事件插件。\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e为第二点举个例子，假设我们有两个插件\x3ccode\x3eA\x3c\/code\x3e和\x3ccode\x3eB\x3c\/code\x3e，分别定义了合成事件\x3ccode\x3eeventA\x3c\/code\x3e和\x3ccode\x3eeventB\x3c\/code\x3e。假设这些事件在冒泡阶段被称为\x3ccode\x3eonEventA\x3c\/code\x3e和\x3ccode\x3eonEventB\x3c\/code\x3e，在捕获阶段被称为\x3ccode\x3eonEventACapture\x3c\/code\x3e和\x3ccode\x3eonEventBCapture\x3c\/code\x3e。最后，两者都由相同的topLevelType（例如\x3ccode\x3etopClick\x3c\/code\x3e）触发，命令为\x3ccode\x3e[A, B]\x3c\/code\x3e。现在考虑React Native中的以下代码（只需将\x3ccode\x3eView\x3c\/code\x3e替换为React web的\x3ccode\x3ediv\x3c\/code\x3e）：\x3c\/p\x3e\n\x3cpre\x3e\x3ccode class=\x22hljs scala\x22\x3e\x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eclass\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eApp\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eextends\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eReact\x3c\/span\x3e.\x3cspan class=\x22hljs-title\x22\x3eComponent\x3c\/span\x3e \x3c\/span\x3e{\n  render() {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e(\n      \x26lt;\x3cspan class=\x22hljs-type\x22\x3eView\x3c\/span\x3e\n        onEventA={(evt) =\x26gt; console.log(\x3cspan class=\x22hljs-symbol\x22\x3e\x27onEvent\x3c\/span\x3eA\x27)}\n        onEventB={(evt) =\x26gt; console.log(\x3cspan class=\x22hljs-symbol\x22\x3e\x27onEvent\x3c\/span\x3eB\x27)}\x26gt;\n        \x26lt;\x3cspan class=\x22hljs-type\x22\x3eView\x3c\/span\x3e\n          onEventACapture={(evt) =\x26gt; evt.stopPropagation()}\n        \/\x26gt;\n      \x26lt;\/\x3cspan class=\x22hljs-type\x22\x3eView\x3c\/span\x3e\x26gt;\n    )\n  }\n}\n\x3c\/code\x3e\x3c\/pre\x3e\x3cp\x3e任何点击事件都会先触发\x3ccode\x3eeventA\x3c\/code\x3e的捕获阶段，在嵌套组件中调用\x3ccode\x3estopPropagation（）\x3c\/code\x3e将有效地防止后续冒泡阶段。因此，\x27onEventA\x27不会出现。 但是，由于\x3ccode\x3eeventB\x3c\/code\x3e已经被定义在不同的插件中，因此依赖于不同的\x3ccode\x3eSyntheticEvent\x3c\/code\x3e，所以\x3ccode\x3e**\x27onEventB\x27**\x3c\/code\x3e\x3cstrong\x3e将会在控制台输出\x3c\/strong\x3e。 虽然这是一个相当极端的情况，但我们导致意外情况发生的时机。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e关于React的事件处理系统还有很多的话要说，比如\x3ca href=\x22https:\/\/reactjs.org\/docs\/events.html#event-pooling\x22\x3e\x3ccode\x3eSyntheticEvents\x3c\/code\x3e \x3c\/a\x3e，为了避免矫枉过正我就不在这儿提及了。\x3c\/p\x3e\n\x3cp\x3e通过阅读源码(可惜关于这个主题没有太多深入的文档)和观看\x3ca href=\x22https:\/\/www.youtube.com\/watch?v=dRo_egw7tBc\x22\x3e视频\x3c\/a\x3e(\x3ca href=\x22https:\/\/medium.com\/@kentcdodds\x22\x3e作者：Kent C. Dodds\x3c\/a\x3e, \x3ca href=\x22https:\/\/medium.com\/@dan_abramov\x22\x3eDan Abramov\x3c\/a\x3e)，希望你也可以和我一样有所收获！\x3c\/p\x3e\n\x3cp\x3e接下来，我将继续深入地学习，看看引擎下的东西是如何运行的。\x3c\/p\x3e\n\n          \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>React和React Native事件系统详解：和谐共存</p><h2 id="原文链接">原文链接</h2><p><a href="https://www.zcfy.cc/article/the-react-and-react-native-event-system-explained-a-harmonious-coexistence">https://www.zcfy.cc/article/the-react-and-react-native-event-system-explained-a-harmonious-coexistence</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4q3ewqvqbsy/" target="_blank">https://alili.tech/archive/4q3ewqvqbsy/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>