<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="Node &amp; 单页应用 来做一个完整用户系统吧！"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>Node &amp; 单页应用 来做一个完整用户系统吧！ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/4sna8qm6ycr/",
				"appid": "1613049289050283", 
				"title": "Node &amp; 单页应用 来做一个完整用户系统吧！ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/wzhng1fv9b/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/6i7sr0vgkxm/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&text=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&text=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&title=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&is_video=false&description=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&title=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&title=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&title=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f4sna8qm6ycr%2f&title=Node%20%26%20%e5%8d%95%e9%a1%b5%e5%ba%94%e7%94%a8%20%e6%9d%a5%e5%81%9a%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%94%a8%e6%88%b7%e7%b3%bb%e7%bb%9f%e5%90%a7%ef%bc%81"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Node &amp; 单页应用 来做一个完整用户系统吧！</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch2 id=\x22articleHeader0\x22\x3e1. 开场白\x3c\/h2\x3e\n\x3cp\x3e用户系统是许多网站的基础。这篇文章主要就是讲解如何写一个基于\x3ccode\x3eNode\x3c\/code\x3e的单页应用的用户系统，这个用户系统的功能包括：注册，登录，自动登录，忘记密码，修改密码，邮件激活。\x3cbr\x3e如果使用在后端使用模板引擎，而不是用前后端分离的方案，用户系统貌似没有那么复杂。在这个\x3ca href=\x22https:\/\/github.com\/harryfyodor\/N-blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNodejs教程\x3c\/a\x3e里面已经介绍得很详细了（这是个不错的\x3ccode\x3eNodejs\x3c\/code\x3e教程）。但是如果选择前后端分离的方案，比如像接下来要介绍的\x3ccode\x3eSPA\x3c\/code\x3e，那用户系统又该怎么处理呢？模板引擎的方案里面，事实上\x3ccode\x3esession\/cookie\x3c\/code\x3e上都做了封装，所以操作起来相对简单。但后者则不一样，它需要我们对于\x3ccode\x3eHTTP\x3c\/code\x3e相关的概念有更加清晰的认识。要求会更加细致。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e2. 基础知识\x3c\/h2\x3e\n\x3cp\x3e下面先介绍一下一些基础的知识。说得不会很多，但是对于彻底理解\x3ccode\x3eCookie\x3c\/code\x3e，\x3ccode\x3eSession\x3c\/code\x3e整个\x3ccode\x3eAuthentication\x3c\/code\x3e的机制非常重要。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e2.1 HTTP\x3c\/h3\x3e\n\x3ch4\x3e2.1.1 Cookie \x26amp; Session\x3c\/h4\x3e\n\x3cp\x3e众所周知，\x3ccode\x3eHTTP\x3c\/code\x3e是无状态的协议。这个的意思就是说，如果发送两个完全一样的请求，那么收到的响应也会完全相同。然而在实际生活中，这明显不符合许多场景。因为每个人虽然都点击了按钮，但我是\x3ccode\x3eHarry\x3c\/code\x3e，她是\x3ccode\x3eClara\x3c\/code\x3e，我们应该收到不同的内容。服务器需要对我们做出区分，这时候\x3ccode\x3ecookie\x3c\/code\x3e就登场了。我发出请求，服务器在响应里面加一个\x3ccode\x3eSet-Cookie\x3c\/code\x3e，到我们浏览器里设了一个\x3ccode\x3ecookie\x3c\/code\x3e（点开\x3ccode\x3edevtool-\x26gt;Application-\x26gt;Cookies\x3c\/code\x3e查看），下一次发送请求的时候，我的\x3ccode\x3eheader\x3c\/code\x3e里面就带有\x3ccode\x3ecookie\x3c\/code\x3e了，服务器看到\x3ccode\x3ecookie\x3c\/code\x3e，就知道我是\x3ccode\x3eHarry\x3c\/code\x3e了。这样就完成了一次认证。\x3cbr\x3e但是接下来还有一个问题：服务器资源极其宝贵，如果每次都认证会造成资源浪费。加之，如果我希望能够暂时性地在当前会话存储一些信息，存储在\x3ccode\x3ecookie\x3c\/code\x3e会显得非常浪费。因此\x3ccode\x3esession\x3c\/code\x3e就来了。\x3cbr\x3e\x3ccode\x3esession\x3c\/code\x3e就是当前用户的回话信息。它需要用到\x3ccode\x3ecookie\x3c\/code\x3e，但不需要把\x3cstrong\x3e所有信息\x3c\/strong\x3e都放在\x3ccode\x3ecookie\x3c\/code\x3e里面，它需要的只是一个标示。\x3cbr\x3e\x3ccode\x3esession\x3c\/code\x3e的信息是存储在服务器上的，可以存在缓存里，数据库里或者类似\x3ccode\x3eRedis\x3c\/code\x3e之类的东西里（没用过..）。举个例子，\x3ccode\x3eExpress-session\x3c\/code\x3e里面的\x3ccode\x3esession\x3c\/code\x3e的标示是一个名字为\x3ccode\x3econnect.sid\x3c\/code\x3e的\x3ccode\x3ecookie\x3c\/code\x3e。这个\x3ccode\x3ecookie\x3c\/code\x3e是随机生成的独一无二的序列码，每次用户发起请求的时候，\x3ccode\x3ecookie\x3c\/code\x3e跟着到了服务器上去。服务器检查一下用户的\x3ccode\x3econnect.sid\x3c\/code\x3e，然后从内存，缓存，数据库或者\x3ccode\x3eRedis\x3c\/code\x3e里面找到相应的信息，然后通过中间件进一步加到请求里面。这样服务器就可以使用专属于这个用户的信息而不再需要多次验证了。\x3cbr\x3e因此\x3ccode\x3ecookie\x3c\/code\x3e是整个用户机制的核心，下面简单介绍一下相关的\x3ccode\x3eheader\x3c\/code\x3e。\x3c\/p\x3e\n\x3ch4\x3e2.1.2 Set-Cookie\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3eSet-Cookie\x3c\/code\x3e是\x3ccode\x3erequest\x3c\/code\x3e的\x3ccode\x3eheader\x3c\/code\x3e。\x3ccode\x3eheader\x3c\/code\x3e的格式是\x3ccode\x3eNAME=VALUE\x3c\/code\x3e然后用分号‘;’分隔开来。\x3cbr\x3e其中有几个设置比较常用：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eexpires=Date\x3c\/code\x3e (设置\x3ccode\x3ecookie\x3c\/code\x3e的到期时间)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3esecure\x3c\/code\x3e (仅仅只在\x3ccode\x3ehttps\x3c\/code\x3e下使用)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3eHttpOnly\x3c\/code\x3e (使得\x3ccode\x3ecookie\x3c\/code\x3e不能被客户端\x3ccode\x3eJavaScript\x3c\/code\x3e修改)\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ccode\x3emaxAge\x3c\/code\x3e （\x3ccode\x3ecookie\x3c\/code\x3e的保持时间，以毫秒为单位）\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e2.2 Node.js\x3c\/h3\x3e\n\x3ch4\x3e关于cookie\x3c\/h4\x3e\n\x3cp\x3e读取和设置\x3ccode\x3ecookie\x3c\/code\x3e在\x3ccode\x3eNodejs\x3c\/code\x3e里面都很方便，在\x3ccode\x3eExpress\x3c\/code\x3e里面添加中间件\x3ccode\x3ecookie-parser\x3c\/code\x3e，可以把\x3ccode\x3ecookie\x3c\/code\x3e对象直接赋给\x3ccode\x3ereq\x3c\/code\x3e。在路由回调函数里面操作的时候，直接用\x3ccode\x3ereq.cookie\x3c\/code\x3e就可以获取到客户端的\x3ccode\x3ecookie\x3c\/code\x3e值。\x3cbr\x3e而设置客户端的\x3ccode\x3ecookie\x3c\/code\x3e则需要用\x3ccode\x3eres.cookie\x3c\/code\x3e函数来设置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 把cookie里面的name值设为name\nres.cookie(\x27name\x27, name, {\n  maxAge: 1000 * 60 * 60 * 24 * 30,\n  path:\x27\/\x27,\n  httpOnly: false\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs less\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 把cookie里面的name值设为name\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3eres\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.cookie\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27name\x27\x3c\/span\x3e, name, {\n  \x3cspan class=\x22hljs-attribute\x22\x3emaxAge\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e60\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e24\x3c\/span\x3e * \x3cspan class=\x22hljs-number\x22\x3e30\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3epath\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27\/\x27\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attribute\x22\x3ehttpOnly\x3c\/span\x3e: false\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch4\x3esession机制\x3c\/h4\x3e\n\x3cp\x3e\x3ccode\x3eExpress\x3c\/code\x3e的\x3ccode\x3esession\x3c\/code\x3e实现需要一个中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var session = require(\x27express-session\x27)\napp.use(session({\n    secret: settings.cookieSecret, \/\/ 设置密码“种子”\n    store: new MongoStore({\n      url: \x27mongodb:\/\/localhost\/color\x27 \/\/ 这里用了数据库存储session，如果不设置就会用内存\n    }),\n    resave: true,\n    saveUninitialized: true\n}))\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs php\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e session = \x3cspan class=\x22hljs-keyword\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27express-session\x27\x3c\/span\x3e)\napp.\x3cspan class=\x22hljs-keyword\x22\x3euse\x3c\/span\x3e(session({\n    secret: settings.cookieSecret, \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 设置密码“种子”\x3c\/span\x3e\n    store: \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e MongoStore({\n      url: \x3cspan class=\x22hljs-string\x22\x3e\x27mongodb:\/\/localhost\/color\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里用了数据库存储session，如果不设置就会用内存\x3c\/span\x3e\n    }),\n    resave: \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e,\n    saveUninitialized: \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e\n}))\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有关\x3ccode\x3esession\x3c\/code\x3e的使用\x3ca href=\x22https:\/\/github.com\/harryfyodor\/N-blog\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNodejs教程\x3c\/a\x3e里面有介绍，具体来说，比如用户登录之后，可以设置 \x3ccode\x3ereq.session.user = \x22harry\x22\x3c\/code\x3e, 然后之后的所有需要用到用户登录的场景都可以先判断一下\x3ccode\x3ereq.session\x3c\/code\x3e里面有没有\x3ccode\x3euser\x3c\/code\x3e这一项。这样就完成了一次区分，而不需要再次验证。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2.3 前端\x3c\/h3\x3e\n\x3cp\x3e在这里的预设是要做一个单页应用。如果使用模板引擎，使用\x3ccode\x3erender\x3c\/code\x3e很容易就可以完成登录等等的功能，但如果要写一个前后端分离的应用，比如一个\x3ccode\x3eSPA\x3c\/code\x3e，那就不得不使用\x3ccode\x3eAJAX\x3c\/code\x3e来收发用户信息。\x3cbr\x3e不管使用什么库来收发\x3ccode\x3eAJAX\x3c\/code\x3e，有一点是需要注意的：那就是发送的AJAX请求要包含\x3ccode\x3ecredentials: \x27include\x27\x3c\/code\x3e 以保证\x3ccode\x3ecookie\x3c\/code\x3e能够被携带发送到后端，否则后端的\x3ccode\x3ereq.cookie\x3c\/code\x3e不会收到。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e3. 实例讲解\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e3.1 确认\x3c\/h3\x3e\n\x3cp\x3e对于需要确认用户已经登录了才能够使用的路由，需要加一个中间件。这个中间件的作用是检查\x3ccode\x3ereq.session.user\x3c\/code\x3e是不是已经定义了。一般来说，在用户登录之后都需要设置一下\x3ccode\x3ereq.session.user\x3c\/code\x3e，以表示处于登录的状态。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function authorize(req, res, next) {\n  if(req.session.user) {\n    next()\n  } else {\n    res.status(401).send({errorMsg: \x26quot;Unauthorize\x26quot;})\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lua\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eauthorize\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(req, res, next)\x3c\/span\x3e\x3c\/span\x3e {\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(req.session.user) {\n    \x3cspan class=\x22hljs-built_in\x22\x3enext\x3c\/span\x3e()\n  } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    res.\x3cspan class=\x22hljs-built_in\x22\x3estatus\x3c\/span\x3e(\x3cspan class=\x22hljs-number\x22\x3e401\x3c\/span\x3e).send({errorMsg: \x3cspan class=\x22hljs-string\x22\x3e\x22Unauthorize\x22\x3c\/span\x3e})\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e3.2 注册\x3c\/h3\x3e\n\x3cp\x3e对于一个注册的过程来说需要有如下的一些步骤。收到用户的用户名，邮箱之后，要在数据库里面找一下，如果找到了同名或者用邮箱的，就要告知用户，重名了。如果没有重名，就发送邮件到邮箱中进行验证，同时创建一个未激活的账户。\x3cbr\x3e另一个要注意的点就是密码的存取最好不要直接存入，推荐是先加密。\x3cbr\x3e这里涉及到了多重嵌套的异步，可以使用\x3ca href=\x22https:\/\/segmentfault.com\/a\/1190000007255138\x22\x3e我之前写的这篇文章\x3c\/a\x3e的\x3ccode\x3eco\x3c\/code\x3e，也可以用\x3ccode\x3easync\/await\x3c\/code\x3e。用回调函数来写后期看起来会很吃力...\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function *registerGen(req, res, newUser) {\n  try {\n    \/\/ 看有没有重名的\n    const userOfSameName = yield new Promise(function(resolve, reject) {\n      User.get(\x26quot;NAME\x26quot;, req.body.name, function(err, user) {\n        if(err) reject(err)\n        resolve(user)\n      })\n    })\n    \/\/ 看是不是同一邮箱又想重复注册\n    const userOfSameEmail = yield new Promise(function(resolve, reject) {\n      User.get(\x26quot;EMAIL\x26quot;, req.body.email, function(err, user) {\n        if(err) reject(err)\n        resolve(user)\n      })\n    })\n    \n    \/\/ 如果是以上两种情况，就发送错误信息。\n    if(userOfSameName) {\n      return res.status(200).send({ errorMsg: \x26quot;此账户名已经被注册。\x26quot;})\n    } else if (userOfSameEmail) {\n      return res.status(200).send({ errorMsg: \x26quot;此邮箱已经被注册。\x26quot;})\n    }\n\n    \/\/ 成功的话就新建一个未激活的账户\n    yield new Promise(function(resolve, reject) {\n      newUser.save(function(err, user) {\n        if(err) {\n          console.log(\x26quot;Register error:\x26quot; ,err)\n          reject(err)\n        }\n        resolve(user)\n      })\n    })\n\n    \/\/ 发送激活邮件\n    yield new Promise(function(resolve, reject) {\n      \n      const nameHash = crypto.createHmac(\x27sha256\x27, SECRET)\n                         .update(req.body.name)\n                         .digest(\x27hex\x27)\n\n      const emailHash = crypto.createHmac(\x27sha256\x27, SECRET)\n                          .update(req.body.email)\n                          .digest(\x27hex\x27)\n     \n      const base = \x26quot;http:\/\/colors.harryfyodor.tk\/activate\/\x26quot;\n\n      \/\/ 打开这一段链接之后会可以通过立即发起一个ajax来更新数据库，激活账户。\n      const link = `${base}${req.body.name}\/${nameHash}|${emailHash}`\n\n      User.activate({\n        subject: \x27Colors 验证邮件\x27,\n        html: \x27如果您并没有注册Colors，请忽略此邮件。点击下面链接激活账户。\x3cbr\x3e\\\n                \x3ca href=\x27 \x2b link \x2b \x27 target=\x26quot;_blank\x26quot;\x3e激活链接\x3c\/a\x3e\x27,\n        to: req.body.email\n      }, function(err) {\n        if(err) reject(err)\n        res.send({ ok: true })\n        resolve()\n      })\n    })\n    \n  } catch(e) {\n    \/\/ 如果有错误就在这里发起，方便debug\n    return res.status(500).send({ msg: \x26quot;ERROR\x26quot;})\n    console.log(\x27Error \x27, e)\n  }\n}\n\nfunction register(req, res) {\n  \n  \/\/ 密码需要先加密，不推荐明文存储。\n  var md5 = crypto.createHash(\x27md5\x27),\n      password = md5.update(req.body.password).digest(\x27hex\x27);\n\n  \/\/ 创建用户，这里的User是model（后端MVC的M）的一个构造函数。\n  var newUser = new User({\n    name: req.body.name,\n    password: password,\n    email: req.body.email\n  })\n\n  \/\/ 用co函数来实现同步写法写异步\n  co(registerGen(req, res, newUser))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e *\x3cspan class=\x22hljs-title\x22\x3eregisterGen\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res, newUser\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3etry\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 看有没有重名的\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e userOfSameName = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n      User.get(\x3cspan class=\x22hljs-string\x22\x3e\x22NAME\x22\x3c\/span\x3e, req.body.name, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, user\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err) reject(err)\n        resolve(user)\n      })\n    })\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 看是不是同一邮箱又想重复注册\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e userOfSameEmail = \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n      User.get(\x3cspan class=\x22hljs-string\x22\x3e\x22EMAIL\x22\x3c\/span\x3e, req.body.email, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, user\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err) reject(err)\n        resolve(user)\n      })\n    })\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果是以上两种情况，就发送错误信息。\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(userOfSameName) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.status(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e).send({ \x3cspan class=\x22hljs-attr\x22\x3eerrorMsg\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22此账户名已经被注册。\x22\x3c\/span\x3e})\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (userOfSameEmail) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.status(\x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e).send({ \x3cspan class=\x22hljs-attr\x22\x3eerrorMsg\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22此邮箱已经被注册。\x22\x3c\/span\x3e})\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 成功的话就新建一个未激活的账户\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n      newUser.save(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, user\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err) {\n          \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Register error:\x22\x3c\/span\x3e ,err)\n          reject(err)\n        }\n        resolve(user)\n      })\n    })\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 发送激活邮件\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3eyield\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n      \n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e nameHash = crypto.createHmac(\x3cspan class=\x22hljs-string\x22\x3e\x27sha256\x27\x3c\/span\x3e, SECRET)\n                         .update(req.body.name)\n                         .digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e)\n\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e emailHash = crypto.createHmac(\x3cspan class=\x22hljs-string\x22\x3e\x27sha256\x27\x3c\/span\x3e, SECRET)\n                          .update(req.body.email)\n                          .digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e)\n     \n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e base = \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/colors.harryfyodor.tk\/activate\/\x22\x3c\/span\x3e\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打开这一段链接之后会可以通过立即发起一个ajax来更新数据库，激活账户。\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e link = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${base}\x3c\/span\x3e\x3cspan class=\x22hljs-subst\x22\x3e${req.body.name}\x3c\/span\x3e\/\x3cspan class=\x22hljs-subst\x22\x3e${nameHash}\x3c\/span\x3e|\x3cspan class=\x22hljs-subst\x22\x3e${emailHash}\x3c\/span\x3e`\x3c\/span\x3e\n\n      User.activate({\n        \x3cspan class=\x22hljs-attr\x22\x3esubject\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27Colors 验证邮件\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3ehtml\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27如果您并没有注册Colors，请忽略此邮件。点击下面链接激活账户。\x26lt;br\x26gt;\\\n                \x26lt;a href=\x27\x3c\/span\x3e \x2b link \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 target=\x22_blank\x22\x26gt;激活链接\x26lt;\/a\x26gt;\x27\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eto\x3c\/span\x3e: req.body.email\n      }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err) reject(err)\n        res.send({ \x3cspan class=\x22hljs-attr\x22\x3eok\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n        resolve()\n      })\n    })\n    \n  } \x3cspan class=\x22hljs-keyword\x22\x3ecatch\x3c\/span\x3e(e) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 如果有错误就在这里发起，方便debug\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e res.status(\x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e).send({ \x3cspan class=\x22hljs-attr\x22\x3emsg\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22ERROR\x22\x3c\/span\x3e})\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27Error \x27\x3c\/span\x3e, e)\n  }\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eregister\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ereq, res\x3c\/span\x3e) \x3c\/span\x3e{\n  \n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 密码需要先加密，不推荐明文存储。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e md5 = crypto.createHash(\x3cspan class=\x22hljs-string\x22\x3e\x27md5\x27\x3c\/span\x3e),\n      password = md5.update(req.body.password).digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e);\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建用户，这里的User是model（后端MVC的M）的一个构造函数。\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e newUser = \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e User({\n    \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: req.body.name,\n    \x3cspan class=\x22hljs-attr\x22\x3epassword\x3c\/span\x3e: password,\n    \x3cspan class=\x22hljs-attr\x22\x3eemail\x3c\/span\x3e: req.body.email\n  })\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 用co函数来实现同步写法写异步\x3c\/span\x3e\n  co(registerGen(req, res, newUser))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader8\x22\x3e3.3 登陆\x3c\/h3\x3e\n\x3cp\x3e用户登录需要有以下的步骤，代码就不详细叙述了。这里面需要非常繁琐的判断语句，但是理解起来非常简单。\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVERif?w=826\x26amp;h=1104\x22 src=\x22https:\/\/static.alili.tech\/img\/bVERif?w=826\x26amp;h=1104\x22 alt=\x22登录流程图\x22 title=\x22登录流程图\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e3.4 邮件通知\x3c\/h3\x3e\n\x3cp\x3e激活用户需要用到\x3ccode\x3enodemailer\x3c\/code\x3e这个库，非常方便，用起来也非常简单。可以上\x3ca href=\x22https:\/\/nodemailer.com\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e官网\x3c\/a\x3e看。如果使用163邮箱作为发件的邮箱，有一点要\x3cstrong\x3e格外注意\x3c\/strong\x3e，那就是密码处要是网易的授权密码。这一个需要在163邮箱里面自己设置，然后代码里就用那一个授权密码。这一点需要格外注意。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function sendEmail(detail, callback) {\n  var config_email = {\n    host: \x27smtp.163.com\x27,\n    post: \x2725\x27,\n    auth: {\n      user: \x27example@163.com\x27,\n      pass: \x27**********\x27 \/\/ 这个密码不是邮箱密码，请先到邮箱里面设置授权密码。\n    }\n  }\n\n  var transporter = nodemailer.createTransport(config_email)\n  var data = {\n    from: config_email.auth.user,\n    to: detail.to,\n    subject: detail.subject,\n    html: detail.html\n  }\n\n  \/\/ 异步发送邮件\n  transporter.sendMail(data, function(err, info) {\n    if(err) {\n      console.log(\x26quot;SendEmail Error\x26quot;, err)\n      callback(err)\n    } else {\n      console.log(\x26quot;Message sent:\x26quot; \x2b info.response)\n      callback(null);\n    }\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3esendEmail\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3edetail, callback\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e config_email = {\n    \x3cspan class=\x22hljs-attr\x22\x3ehost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27smtp.163.com\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epost\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x2725\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3eauth\x3c\/span\x3e: {\n      \x3cspan class=\x22hljs-attr\x22\x3euser\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27example@163.com\x27\x3c\/span\x3e,\n      \x3cspan class=\x22hljs-attr\x22\x3epass\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27**********\x27\x3c\/span\x3e \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这个密码不是邮箱密码，请先到邮箱里面设置授权密码。\x3c\/span\x3e\n    }\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e transporter = nodemailer.createTransport(config_email)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e data = {\n    \x3cspan class=\x22hljs-attr\x22\x3efrom\x3c\/span\x3e: config_email.auth.user,\n    \x3cspan class=\x22hljs-attr\x22\x3eto\x3c\/span\x3e: detail.to,\n    \x3cspan class=\x22hljs-attr\x22\x3esubject\x3c\/span\x3e: detail.subject,\n    \x3cspan class=\x22hljs-attr\x22\x3ehtml\x3c\/span\x3e: detail.html\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 异步发送邮件\x3c\/span\x3e\n  transporter.sendMail(data, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr, info\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(err) {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22SendEmail Error\x22\x3c\/span\x3e, err)\n      callback(err)\n    } \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x22Message sent:\x22\x3c\/span\x3e \x2b info.response)\n      callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e);\n    }\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader10\x22\x3e4.总结\x3c\/h2\x3e\n\x3cp\x3e当然，这一个用户登录系统仍然还有很多要改进的地方（比如安全问题等等）。除此之外，在功能上还有不少需要增加的。比如修改密码，比如更换密码等等，看了上面的内容，其实要完成这些功能也是非常简单的一件事了。\x3cbr\x3e如果感兴趣的话可以看看我自己写的一个网站，\x3ca href=\x22https:\/\/github.com\/harryfyodor\/colors\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eColors\x3c\/a\x3e，这是一个基于\x3ccode\x3eReact\x3c\/code\x3e和\x3ccode\x3eNodejs\x3c\/code\x3e的网站，有完整的用户系统，如果没有什么头绪的话可以参考一下~\x3c\/p\x3e\n\x3cp\x3e如果文章中有什么错误或者不妥的地方，欢迎指出，互相交流学习~感谢阅读~\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>Node &amp; 单页应用 来做一个完整用户系统吧！</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007315867">https://segmentfault.com/a/1190000007315867</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/4sna8qm6ycr/" target="_blank">https://alili.tech/archive/4sna8qm6ycr/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>