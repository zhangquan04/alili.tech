<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="JavaScript 运行机制详解(理解同步、异步和事件循环)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>JavaScript 运行机制详解(理解同步、异步和事件循环) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/6q1oum6e9os/",
				"appid": "1613049289050283", 
				"title": "JavaScript 运行机制详解(理解同步、异步和事件循环) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-07T02:30:11"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/9j7eodud07j/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/9rg87hx6il/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&text=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&text=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&title=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&is_video=false&description=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&title=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&title=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&title=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2f6q1oum6e9os%2f&title=JavaScript%20%e8%bf%90%e8%a1%8c%e6%9c%ba%e5%88%b6%e8%af%a6%e8%a7%a3%28%e7%90%86%e8%a7%a3%e5%90%8c%e6%ad%a5%e3%80%81%e5%bc%82%e6%ad%a5%e5%92%8c%e4%ba%8b%e4%bb%b6%e5%be%aa%e7%8e%af%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">JavaScript 运行机制详解(理解同步、异步和事件循环)</h1><div class="meta"><div class="postdate"><time datetime="2019-01-07" itemprop="datePublished">2019-01-07</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch3 id=\x22articleHeader0\x22\x3e1.为什么JavaScript是单线程？\x3c\/h3\x3e\n\x3cp\x3eJavaScript语言的一大特点就是单线程，也就是说，同一个时间只能做一件事。那么，为什么JavaScript不能有多个线程呢？这样能提高效率啊。\x3cbr\x3eJavaScript的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？\x3cbr\x3e所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。\x3cbr\x3e**\x3cbr\x3e为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。\x3cbr\x3e**\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3eJS引擎中负责解释和执行JavaScript代码的线程只有一个。我们叫它\x3cstrong\x3e主线程\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e但是实际上还存在其他的线程。例如：处理AJAX请求的线程、处理DOM事件的线程、定时器线程、读写文件的线程(例如在Node.js中)等等。这些线程可能存在于JS引擎之内，也可能存在于JS引擎之外，在此我们不做区分。不妨叫它们\x3cstrong\x3e工作线程\x3c\/strong\x3e。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader1\x22\x3e2.同步与异步\x3c\/h3\x3e\n\x3cp\x3e看一段代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(\x27我要做第一件事情\x27);\nconsole.log(\x27我要做第二件事情\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs autoit\x22\x3e\x3ccode\x3econsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27我要做第一件事情\x27\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\nconsole.\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27我要做第二件事情\x27\x3c\/span\x3e)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码的实现就叫做同步,也就是说按照顺序去做,做完第一件事情之后,再去做第二件事情\x3c\/p\x3e\n\x3cp\x3e再看一段代码\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(\x27我要做第一件事情\x27);\nsetTimeout(function () {\n  console.log(\x27我突然有事,晚点再做第二件事情\x27);\n},1000)\nconsole.log(\x27我要做第三件事情\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27我要做第一件事情\x27\x3c\/span\x3e);\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27我突然有事,晚点再做第二件事情\x27\x3c\/span\x3e);\n},\x3cspan class=\x22hljs-number\x22\x3e1000\x3c\/span\x3e)\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27我要做第三件事情\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码的实现就叫做异步,也就是说不完全按照顺序去做,\x3cbr\x3e突发情况,第二件事情不能立刻完成,所以等待一段时间再去完成,\x3cbr\x3e优先去做后面的第三件事情,这样就不耽搁时间。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e3.异步的形成过程\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e为什么需要异步呢\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e前面提过JavaScript是单线程的,\x3cbr\x3e那么单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。\x3cbr\x3e如果排队是因为计算量大，CPU忙不过来，倒也算了，但是很多时候CPU是闲着的，因为IO设备（输入输出设备）很慢（比如Ajax操作从网络读取数据），不得不等着结果出来，再往下执行。\x3cbr\x3eJavaScript语言的设计者意识到，这时主线程完全可以不管IO设备，挂起处于等待中的任务，先运行排在后面的任务。等到IO设备返回了结果，再回过头，把挂起的任务继续执行下去。\x3cbr\x3e所以这就是异步过程的由来。\x3c\/p\x3e\n\x3chr\x3e\n\x3cp\x3e\x3cstrong\x3e那么异步又是如何实现的呢？\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e1.主线程发起一个异步请求，相应的工作线程接收请求并告知主线程已收到(异步函数返回)；\x3cbr\x3e2.主线程可以继续执行后面的代码，同时工作线程执行异步任务；\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e3.工作线程完成工作后，通知主线程；\x3cbr\x3e4.主线程收到通知后，执行一定的动作(调用回调函数)。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e其实我们经常用到的dom事件也是属于一个异步行为\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e举一个栗子:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var button = document.getElement(\x27#btn\x27);\nbutton.addEventListener(\x27click\x27, function(e) {\n    console.log(\x27按钮\x27);\n});\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e button = \x3cspan class=\x22hljs-built_in\x22\x3edocument\x3c\/span\x3e.getElement(\x3cspan class=\x22hljs-string\x22\x3e\x27#btn\x27\x3c\/span\x3e);\nbutton.addEventListener(\x3cspan class=\x22hljs-string\x22\x3e\x27click\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ee\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27按钮\x27\x3c\/span\x3e);\n});\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从事件的角度来看，上述代码表示：在按钮上添加了一个鼠标单击事件的事件监听器；当用户点击按钮时，鼠标单击事件触发，事件监听器函数被调用。\x3c\/p\x3e\n\x3cp\x3e从异步过程的角度看，addEventListener函数就是异步过程的发起函数，事件监听函数就是异步过程的回调函数。\x3cbr\x3e事件触发时，表示异步任务完成，会将事件监听器函数封装成一条消息放到消息队列中，等待主线程执行。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e4.任务队列(消息队列)\x3c\/h3\x3e\n\x3cp\x3e\x22任务队列\x22是一个事件的队列（也可以理解成消息的队列），工作线程完成一项任务，就在\x22任务队列\x22中添加一个事件(也可以理解为发送一条消息)，表示相关的异步任务可以进入\x22执行栈\x22了。主线程读取\x22任务队列\x22，就是读取里面有哪些事件。\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e那么这边就要提到JavaScript 的运行机制了\x3c\/strong\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cul\x3e\n\x3cli\x3e\x3cp\x3e所有同步任务都在主线程上执行，形成一个执行栈\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e主线程发起异步请求,相应的工作线程就会去执行异步任务,\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3cp\x3e主线程可以继续执行后面的代码\x3c\/p\x3e\n\x3cblockquote\x3e\x3cul\x3e\x3cli\x3e\x3cp\x3e主线程之外，还存在一个\x22任务队列\x22（task queue）。只要异步任务\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3cp\x3e有了运行结果，就在\x22任务队列\x22之中放置一个事件,也就是一个消息。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cul\x3e\x3cli\x3e\x3cp\x3e一旦\x22执行栈\x22中的所有同步任务执行完毕，系统就会读取\x22任务队\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3cp\x3e列\x22，看看里面有哪些事件。那些对应的异步任务，于是结束等待状\x3cbr\x3e  态，进入执行栈，开始执行。\x3c\/p\x3e\n\x3cblockquote\x3e\x3cul\x3e\x3cli\x3e\x3cp\x3e主线程把当前的事件执行完成之后,再去读取任务队列,如此反复重复\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3cp\x3e执行,这样就行程了事件循环\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e只要主线程空了，就会去读取\x22任务队列\x22，这就是JavaScript的运行机制。这个过程会不断重复。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e用一张图来表示整个过程\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000010292801\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000010292801\x22 alt=\x22\x22 title=\x22\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e5.Event Loop(事件循环)\x3c\/h3\x3e\n\x3cp\x3e\x3cstrong\x3e主线程从\x22任务队列\x22中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）\x3c\/strong\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3ch4\x3emacrotasks与microtasks的区别\x3c\/h4\x3e\n\x3cblockquote\x3e\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3emacrotasks: setTimeout setInterval setImmediate I\/O UI渲染\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3cstrong\x3emicrotasks: Promise process.nextTick Object.observe MutationObserver\x3c\/strong\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\x3c\/blockquote\x3e\n\x3ch6\x3e一个事件循环(EventLoop)中会有一个正在执行的任务(Task)，而这个任务就是从 macrotask 队列中来的。当这个 macrotask 执行结束后所有可用的 microtask 将会在同一个事件循环中执行，当这些 microtask 执行结束后还能继续添加 microtask 一直到整个 microtask 队列执行结束。\x3c\/h6\x3e\n\x3cp\x3e\x3cstrong\x3e通俗点来理解的话,就是microtask会在当前循环中执行完成,而macrotask会在下一个循环中执行\x3c\/strong\x3e\x3cbr\x3e下面我们来看一段代码,自己思考一下运行结果会是什么?\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(\x271\x27);\nsetTimeout(function () {\n  console.log(\x272\x27);\n  new Promise(function(resolve, reject) {\n    console.log(\x27promise-start2\x27);\n    resolve();\n  }).then(function() {\n    console.log(\x27promise-end2\x27);\n });\n},0);\nnew Promise(function(resolve, reject) {\n    console.log(\x27promise-start\x27);\n    resolve();\n}).then(function() {\n    console.log(\x27promise-end\x27);\n});\nsetTimeout(function () {\n    console.log(\x273\x27);\n},0);\nconsole.log(\x274\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x271\x27\x3c\/span\x3e);\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x272\x27\x3c\/span\x3e);\n  \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27promise-start2\x27\x3c\/span\x3e);\n    resolve();\n  }).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27promise-end2\x27\x3c\/span\x3e);\n });\n},\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27promise-start\x27\x3c\/span\x3e);\n    resolve();\n}).then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27promise-end\x27\x3c\/span\x3e);\n});\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e);\n},\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x274\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e运行结果\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x221\npromise-start\n4\npromise-end\n2\npromise-start2\npromise-end2\n3\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lsl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e\npromise-start\n\x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e\npromise-end\n\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e\npromise-start2\npromise-end2\n\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从结果可以看出\x3cbr\x3e主进程这个macroTask（也就是1、promise-start和4）执行完了，自然会去执行promise then这个microTask。这是第一个循环。之后的setTimeout和promise属于第二个循环。\x3c\/p\x3e\n\x3ch4\x3e这边有一个注意点,就是主进程的代码也属于macroTask,因为主线程可以被视为没有异步任务的异步执行\x3c\/h4\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e6.定时器\x3c\/h3\x3e\n\x3cp\x3e定时器功能主要由setTimeout()和setInterval()这两个函数来完成，它们的内部运行机制完全一样，区别在于前者指定的代码是一次性执行，后者则为反复执行。以下主要讨论setTimeout()。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22console.log(\x271\x27);\nsetTimeout(function () {\n  console.log(\x272\x27);\n},0);\nconsole.log(\x273\x27);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x271\x27\x3c\/span\x3e);\nsetTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x272\x27\x3c\/span\x3e);\n},\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e);\n\x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x273\x27\x3c\/span\x3e);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这段代码的运行结果是1,3,2,表示0毫秒间隔运行指定的回调函数\x3cbr\x3e那么竟然是0秒,为啥3会是在2前面打印呢\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e总之，setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在\x22任务队列\x22的尾部添加一个事件，因此要等到同步任务和\x22任务队列\x22现有的事件都处理完，才会得到执行。\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3eHTML5标准规定了setTimeout()的第二个参数的最小值（最短间隔），不得低于\x3cstrong\x3e4毫秒\x3c\/strong\x3e，如果低于这个值，就会自动增加。在此之前，老版本的浏览器都将最短间隔设为\x3cstrong\x3e10毫秒\x3c\/strong\x3e。另外，对于那些DOM的变动（尤其是涉及页面重新渲染的部分），通常不会立即执行，而是每16毫秒执行一次。这时使用\x3cstrong\x3erequestAnimationFrame()\x3c\/strong\x3e的效果要好于setTimeout()。\x3c\/p\x3e\n\x3cp\x3e需要注意的是，setTimeout()只是将事件插入了\x22任务队列\x22，必须等到当前代码（执行栈）执行完，主线程才会去执行它指定的回调函数。要是当前代码耗时很长，有可能要等很久，\x3cstrong\x3e所以并没有办法保证，回调函数一定会在setTimeout()指定的时间执行\x3c\/strong\x3e。\x3c\/p\x3e\n\x3chr\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e7.总结\x3c\/h3\x3e\n\x3cp\x3e以上是我对于JavaScript 运行机制的一些了解,\x3cbr\x3e知道这些知识,对于我们去理解js的运行机智,还有对于同步异步的处理会有很大的帮助,如果您有不同的意见或者文章有错误的地方,可以给我留言,一起讨论,谢谢\x3cbr\x3e参考资料:\x3cbr\x3e\x3ca href=\x22http:\/\/www.ruanyifeng.com\/blog\/2014\/10\/event-loop.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eJavaScript 运行机制详解：再谈Event Loop\x3c\/a\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>JavaScript 运行机制详解(理解同步、异步和事件循环)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000010292798">https://segmentfault.com/a/1190000010292798</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/6q1oum6e9os/" target="_blank">https://alili.tech/archive/6q1oum6e9os/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>