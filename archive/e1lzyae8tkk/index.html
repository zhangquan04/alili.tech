<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="关于Redux的一些总结(一)：Action &amp; 中间件 &amp; 异步"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>关于Redux的一些总结(一)：Action &amp; 中间件 &amp; 异步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/e1lzyae8tkk/",
				"appid": "1613049289050283", 
				"title": "关于Redux的一些总结(一)：Action &amp; 中间件 &amp; 异步 | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-03T02:30:40"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/kkbpk4dlnab/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/bkmzdr7lr29/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&text=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&text=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&title=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&is_video=false&description=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&title=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&title=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&title=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fe1lzyae8tkk%2f&title=%e5%85%b3%e4%ba%8eRedux%e7%9a%84%e4%b8%80%e4%ba%9b%e6%80%bb%e7%bb%93%28%e4%b8%80%29%ef%bc%9aAction%20%26%20%e4%b8%ad%e9%97%b4%e4%bb%b6%20%26%20%e5%bc%82%e6%ad%a5"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">关于Redux的一些总结(一)：Action &amp; 中间件 &amp; 异步</h1><div class="meta"><div class="postdate"><time datetime="2019-02-03" itemprop="datePublished">2019-02-03</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e在\x3ca href=\x22https:\/\/github.com\/dwqs\/blog\/issues\/14\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e浅说Flux开发\x3c\/a\x3e中，简单介绍了Flux及其开发方式。Flux可以说是一个框架，其有本身的 \x3ccode\x3eDispatcher\x3c\/code\x3e 接口供开发者；也可以说是一种数据流单向控制的架构设计，围绕单向数据流的核心，其定义了一套行为规范，如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/remote\/1460000006762475\x22 src=\x22https:\/\/static.alili.tech\/img\/remote\/1460000006762475\x22 alt=\x22flux\x22 title=\x22flux\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3eRedux的设计就继承了Flux的架构，并将其完善，提供了多个API供开发者调用。借着react-redux，可以很好的与React结合，开发组件化程度极高的现代Web应用。本文是笔者近半年使用react\x2bredux组合的一些总结，不当之处，敬请谅解。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3eAction\x3c\/h2\x3e\n\x3cp\x3eAction是数据从应用传递到 store\/state 的载体，也是开启一次完成数据流的开始。\x3c\/p\x3e\n\x3cp\x3e以添加一个todo的Action为例:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    type:\x27add_todo\x27,\n    data:\x27我要去跑步\x27\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3etype\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27add_todo\x27\x3c\/span\x3e,\n    data:\x3cspan class=\x22hljs-string\x22\x3e\x27我要去跑步\x27\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就定义了一个添加一条todo的Action，然后就能通过某个行为去触发这个Action，由这个Action携带的数据(data)去更新store(state\/reducer)：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22store.dispatch({\n    type:\x27add_todo\x27,\n    data:\x27your data\x27\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3estore\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.dispatch\x3c\/span\x3e({\n    \x3cspan class=\x22hljs-attribute\x22\x3etype\x3c\/span\x3e:\x3cspan class=\x22hljs-string\x22\x3e\x27add_todo\x27\x3c\/span\x3e,\n    data:\x3cspan class=\x22hljs-string\x22\x3e\x27your data\x27\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3etype\x3c\/code\x3e 是一个常量，Action必备一个字段，用于标识该Action的类型。在项目初期，这样定义Action也能愉快的撸码，但是随着项目的复杂度增加，这种方式会让代码显得冗余，因为如果有多个行为触发同一个Action，则这个Action要写多次；同时，也会造成代码结构不清晰。因而，得更改创建Action的方式：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const ADD_TODO = \x27add_todo\x27;\n\nlet addTodo = (data=\x27default data\x27) =\x3e {\n    return {\n        type: ADD_TODO,\n        data: data\n    }\n}\n\n\/\/触发action\nstore.dispatch(addTodo());\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3econst ADD_TODO = \x3cspan class=\x22hljs-string\x22\x3e\x27add_todo\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodo = (\x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27default data\x27\x3c\/span\x3e) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: ADD_TODO,\n        \x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e\n    }\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/触发action\x3c\/span\x3e\nstore.dispatch(addTodo());\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e更改之后，代码清晰多了，如果有多个行为触发同一个Action，只要调用一下函数 \x3ccode\x3eaddTodo\x3c\/code\x3e 就行，并将Action要携带的数据传递给该函数。类似 \x3ccode\x3eaddTodo\x3c\/code\x3e 这样的函数，称之为 Action Creator。Action Creator 的唯一功能就是返回一个Action供 \x3ccode\x3edispatch\x3c\/code\x3e 进行调用。\x3c\/p\x3e\n\x3cp\x3e但是，这样的Action Creator 返回的Action 并不是一个标准的Action。在Flux的架构中，一个Action要符合 FSA(Flux Standard Action) 规范，需要满足如下条件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e是一个纯文本对象\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e只具备 \x3ccode\x3etype\x3c\/code\x3e 、\x3ccode\x3epayload\x3c\/code\x3e、\x3ccode\x3eerror\x3c\/code\x3e 和 \x3ccode\x3emeta\x3c\/code\x3e 中的一个或者多个属性。\x3ccode\x3etype\x3c\/code\x3e 字段不可缺省，其它字段可缺省\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e若 Action 报错，\x3ccode\x3eerror\x3c\/code\x3e 字段不可缺省，切必须为 true\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3ccode\x3epayload\x3c\/code\x3e 是一个对象，用作Action携带数据的载体。所以，上述的写法可以更改为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let addTodo = (data=\x27default data\x27) =\x3e {\n    return {\n        type: ADD_TODO,\n        payload: {\n            data\n        }\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lasso\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodo = (\x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x27default data\x27\x3c\/span\x3e) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e: ADD_TODO,\n        payload: {\n            \x3cspan class=\x22hljs-built_in\x22\x3edata\x3c\/span\x3e\n        }\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在 redux 全家桶中，可以利用 redux-actions 来创建符合 FSA 规范的Action：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {creatAction} from \x27redux-actions\x27;\n\nlet addTodo = creatAction(ADD_TODO)\n\/\/same as\nlet addTodo = creatAction(ADD_TODO,data=\x3edata)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {creatAction} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux-actions\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodo = creatAction(ADD_TODO)\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/same as\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodo = creatAction(ADD_TODO,\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3edata\x3c\/span\x3e=\x26gt;\x3c\/span\x3edata)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以采用如下一个简单的方式检验一个Action是否符合FSA标准：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22let isFSA = Object.keys(action).every((item)=\x3e{\n   return  [\x27payload\x27,\x27type\x27,\x27error\x27,\x27meta\x27].indexOf(item) \x3e  -1\n})\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e isFSA = \x3cspan class=\x22hljs-built_in\x22\x3eObject\x3c\/span\x3e.keys(action).every(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eitem\x3c\/span\x3e)=\x26gt;\x3c\/span\x3e{\n   \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e  [\x3cspan class=\x22hljs-string\x22\x3e\x27payload\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27type\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e,\x3cspan class=\x22hljs-string\x22\x3e\x27meta\x27\x3c\/span\x3e].indexOf(item) \x26gt;  \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e\n})\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e中间件\x3c\/h2\x3e\n\x3cp\x3e在我看来，Redux提高了两个非常重要的功能，一是 Reducer 拆分，二是中间件。Reducer 拆分可以使组件获取其最小属性(state)，而不需要整个Store。中间件则可以在 Action Creator 返回最终可供 dispatch 调用的 action 之前处理各种事情，如异步API调用、日志记录等，是扩展 Redux 功能的一种推荐方式。\x3c\/p\x3e\n\x3cp\x3eRedux 提供了 \x3ccode\x3eapplyMiddleware(...middlewares)\x3c\/code\x3e 来将中间件应用到 createStore。applyMiddleware 会返回一个函数，该函数接收原来的 creatStore 作为参数，返回一个应用了 middlewares 的增强后的 creatStore。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function applyMiddleware(...middlewares) {\n  return (createStore) =\x3e (reducer, preloadedState, enhancer) =\x3e {\n    \/\/接收createStore参数\n    var store = createStore(reducer, preloadedState, enhancer)\n    var dispatch = store.dispatch\n    var chain = []\n    \n    \/\/传递给中间件的参数\n    var middlewareAPI = {\n      getState: store.getState,\n      dispatch: (action) =\x3e dispatch(action)\n    }\n    \n    \/\/注册中间件调用链\n    chain = middlewares.map(middleware =\x3e middleware(middlewareAPI))\n    dispatch = compose(...chain)(store.dispatch)\n    \n    \/\/返回经middlewares增强后的createStore\n    return {\n      ...store,\n      dispatch\n    }\n  }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs actionscript\x22\x3e\x3ccode\x3eexport \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eapplyMiddleware\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-rest_arg\x22\x3e...middlewares\x3c\/span\x3e)\x3c\/span\x3e \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e (createStore) =\x26gt; (reducer, preloadedState, enhancer) =\x26gt; {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/接收createStore参数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e store = createStore(reducer, preloadedState, enhancer)\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e dispatch = store.dispatch\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e chain = []\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/传递给中间件的参数\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e middlewareAPI = {\n      getState: store.getState,\n      dispatch: (action) =\x26gt; dispatch(action)\n    }\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/注册中间件调用链\x3c\/span\x3e\n    chain = middlewares.map(middleware =\x26gt; middleware(middlewareAPI))\n    dispatch = compose(...chain)(store.dispatch)\n    \n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/返回经middlewares增强后的createStore\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n      ...store,\n      dispatch\n    }\n  }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e创建 store 的方式也会因是否使用中间件而略有区别。未应用中间价之前，创建 store 的方式如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {createStore} from \x27redux\x27;\nimport reducers from \x27.\/reducers\/index\x27;\n\nexport let store = createStore(reducers);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {createStore} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e reducers \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\/index\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e store = createStore(reducers);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e应用中间价之后，创建 store 的方式如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {createStore，applyMiddleware} from \x27redux\x27;\nimport reducers from \x27.\/reducers\/index\x27;\n\nlet createStoreWithMiddleware = applyMiddleware(...middleware)(createStore);\nexport let store = createStoreWithMiddleware(reducers);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {createStore，applyMiddleware} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e reducers \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\/index\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e createStoreWithMiddleware = applyMiddleware(...middleware)(createStore);\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e store = createStoreWithMiddleware(reducers);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么怎么自定义一个中间件呢？\x3c\/p\x3e\n\x3cp\x3e根据 \x3ca href=\x22http:\/\/redux.js.org\/docs\/api\/applyMiddleware.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux 文档\x3c\/a\x3e，中间件的签名如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22({ getState, dispatch }) =\x3e next =\x3e action\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs coq\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e({ getState, dispatch }) =\x26gt; next =\x26gt; action\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e根据上文的 \x3ccode\x3eapplyMiddleware\x3c\/code\x3e 源码，每个中间件接收 getState \x26amp; dispatch 作为参数，并返回一个函数，该函数会被传入下一个中间件的 dispatch 方法，并返回一个接收 action 的新函数。\x3c\/p\x3e\n\x3cp\x3e以一个打印 dispatch action 前后的 state 为例，创建一个中间件示例：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function({getState,dispatch}) {\n    return (next) =\x3e (action) =\x3e {\n        console.log(\x27pre state\x27, getState());\n        \/\/ 调用 middleware 链中下一个 middleware 的 dispatch。\n        next(action);\n        console.log(\x27after dispatch\x27, getState());\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{getState,dispatch}\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (action) =\x26gt; {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27pre state\x27\x3c\/span\x3e, getState());\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 调用 middleware 链中下一个 middleware 的 dispatch。\x3c\/span\x3e\n        next(action);\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27after dispatch\x27\x3c\/span\x3e, getState());\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在创建 store 的文件中调用该中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import {createStore,applyMiddleware} from \x27redux\x27;\n\nimport reducers from \x27.\/reducers\/index\x27;\nimport log from \x27..\/lib\/log\x27;\n\n\/\/export let store = createStore(reducers);\n\n\/\/应用中间件log\nlet createStoreWithLog = applyMiddleware(log)(createStore);\nexport let store = createStoreWithLog(reducers);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e {createStore,applyMiddleware} \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27redux\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e reducers \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27.\/reducers\/index\x27\x3c\/span\x3e;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e log \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27..\/lib\/log\x27\x3c\/span\x3e;\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/export let store = createStore(reducers);\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/应用中间件log\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e createStoreWithLog = applyMiddleware(log)(createStore);\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e store = createStoreWithLog(reducers);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e可以在控制台看到输出：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/sfault-image.b0.upaiyun.com\/272\/306\/2723068311-57bc91cc94c15_articlex\x22 src=\x22https:\/\/static.alili.techhttps:\/\/sfault-image.b0.upaiyun.com\/272\/306\/2723068311-57bc91cc94c15_articlex\x22 alt=\x22img\x22 title=\x22img\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e可以对 store 应用多个中间件：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import log from \x27..\/lib\/log\x27;\nimport log2 from \x27..\/lib\/log2\x27;\n\nlet createStoreWithLog = applyMiddleware(log,log2)(createStore);\nexport let store = createStoreWithLog(reducers);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xl\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e from \x27..\/lib\/\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e\x27;\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3elog2\x3c\/span\x3e from \x27..\/lib\/\x3cspan class=\x22hljs-built_in\x22\x3elog2\x3c\/span\x3e\x27;\n\nlet createStoreWithLog = applyMiddleware(\x3cspan class=\x22hljs-built_in\x22\x3elog\x3c\/span\x3e,\x3cspan class=\x22hljs-built_in\x22\x3elog2\x3c\/span\x3e)(createStore);\nexport let store = createStoreWithLog(reducers);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3elog2 也是一个简单的输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export default function({getState,dispatch}) {\n    return (next) =\x3e (action) =\x3e {\n        console.log(\x27我是第二个中间件1\x27);\n        next(action);\n        console.log(\x27我是第二个中间件2\x27);\n    }\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{getState,dispatch}\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3enext\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e (action) =\x26gt; {\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27我是第二个中间件1\x27\x3c\/span\x3e);\n        next(action);\n        \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.log(\x3cspan class=\x22hljs-string\x22\x3e\x27我是第二个中间件2\x27\x3c\/span\x3e);\n    }\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看控制台的输出：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/sfault-image.b0.upaiyun.com\/550\/097\/550097178-57bc93deb3d9c_articlex\x22 src=\x22https:\/\/static.alili.techhttps:\/\/sfault-image.b0.upaiyun.com\/550\/097\/550097178-57bc93deb3d9c_articlex\x22 alt=\x22img2\x22 title=\x22img2\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e应用多个中间件时，中间件调用链中任何一个缺少 \x3ccode\x3enext(action)\x3c\/code\x3e 的调用，都会导致 action 执行失败\x3c\/strong\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e异步\x3c\/h2\x3e\n\x3cp\x3eRedux 本身不处理异步行为，需要依赖中间件。结合 \x3ca href=\x22https:\/\/github.com\/acdlite\/redux-actions\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-actions\x3c\/a\x3e 使用，Redux 有两个推荐的异步中间件：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/gaearon\/redux-thunk\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-thunk\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/acdlite\/redux-promise\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-promise\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e两个中间件的源码都是非常简单的，redux-thunk 的源码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function createThunkMiddleware(extraArgument) {\n  return ({ dispatch, getState }) =\x3e next =\x3e action =\x3e {\n    if (typeof action === \x27function\x27) {\n      return action(dispatch, getState, extraArgument);\n    }\n\n    return next(action);\n  };\n}\n\nconst thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\nexport default thunk;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecreateThunkMiddleware\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eextraArgument\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ dispatch, getState }\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e next =\x26gt; \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eaction\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e action === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) {\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e action(dispatch, getState, extraArgument);\n    }\n\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e next(action);\n  };\n}\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e thunk = createThunkMiddleware();\nthunk.withExtraArgument = createThunkMiddleware;\n\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3edefault\x3c\/span\x3e thunk;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从源码可知，action creator 需要返回一个函数给 redux-thunk 进行调用，示例如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export let addTodoWithThunk = (val) =\x3e async (dispatch, getState)=\x3e{\n    \/\/请求之前的一些处理\n        \n    let value = await Promise.resolve(val \x2b \x27 thunk\x27);\n    dispatch({\n        type:CONSTANT.ADD_TO_DO_THUNK,\n        payload:{\n            value\n        }\n    });\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodoWithThunk = \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (dispatch, getState)=\x26gt;{\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/请求之前的一些处理\x3c\/span\x3e\n        \n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(val \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 thunk\x27\x3c\/span\x3e);\n    dispatch({\n        \x3cspan class=\x22hljs-keyword\x22\x3etype\x3c\/span\x3e:CONSTANT.ADD_TO_DO_THUNK,\n        payload:{\n            value\n        }\n    });\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e效果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVCjJg\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVCjJg\x22 alt=\x22thunk\x22 title=\x22thunk\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e这里之所以不用 createAction，如前文所说，因为 createAction 会返回一个 FSA 规范的 action，该 action 会是一个对象，而不是一个 function：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n    type: \x26quot;add_to_do_thunk\x26quot;,\n    payload: function(){}\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e{\n    \x3cspan class=\x22hljs-attribute\x22\x3etype\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22add_to_do_thunk\x22\x3c\/span\x3e,\n    payload: \x3cspan class=\x22hljs-built_in\x22\x3efunction\x3c\/span\x3e(){}\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果要使用 createAction，则要自定义一个异步中间件。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export let addTodoWithCustom = createAction(CONSTANT.ADD_TO_DO_CUSTOM, (val) =\x3e async (dispatch, getState)=\x3e{\n    let value = await Promise.resolve(val \x2b \x27 custom\x27);\n    return {\n        value\n    };\n});\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs typescript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e addTodoWithCustom = createAction(CONSTANT.ADD_TO_DO_CUSTOM, \x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eval\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3easync\x3c\/span\x3e (dispatch, getState)=\x26gt;{\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e value = \x3cspan class=\x22hljs-keyword\x22\x3eawait\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e.resolve(val \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27 custom\x27\x3c\/span\x3e);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e {\n        value\n    };\n});\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e在经过中间件处理时，先判断 action.payload 是否是一个函数，是则执行函数，否则交给 next 处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22if(typeof action.payload === \x27function\x27){\n    let res = action.payload(dispatch, getState);\n} else {\n    next(action);\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs sqf\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e(\x3cspan class=\x22hljs-built_in\x22\x3etypeof\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eaction\x3c\/span\x3e.payload === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e){\n    let res = \x3cspan class=\x22hljs-built_in\x22\x3eaction\x3c\/span\x3e.payload(dispatch, getState);\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    next(\x3cspan class=\x22hljs-built_in\x22\x3eaction\x3c\/span\x3e);\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e而 async 函数返回一个 Promise，因而需要作进一步处理：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22res.then(\n    (result) =\x3e {\n        dispatch({...action, payload: result});\n    },\n    (error) =\x3e {\n        dispatch({...action, payload: error, error: true});\n    }\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs moonscript\x22\x3e\x3ccode\x3eres.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e(\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(result)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        dispatch({...action, \x3cspan class=\x22hljs-name\x22\x3epayload\x3c\/span\x3e: result});\n    },\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-built_in\x22\x3eerror\x3c\/span\x3e)\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n        dispatch({...action, \x3cspan class=\x22hljs-name\x22\x3epayload\x3c\/span\x3e: \x3cspan class=\x22hljs-built_in\x22\x3eerror\x3c\/span\x3e, \x3cspan class=\x22hljs-name\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e});\n    }\n);\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这样就自定义了一个异步中间件，效果如下：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVCjIP\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVCjIP\x22 alt=\x22custom\x22 title=\x22custom\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e当然，我们可以对函数执行后的结果是否是Promise作一个判断：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function isPromise (val) {\n    return val \x26amp;\x26amp; typeof val.then === \x27function\x27;\n}\n\n\/\/对执行结果是否是Promise\nif (isPromise(res)){\n    \/\/处理\n} else {\n    dispatch({...action, payload: res});\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs fsharp\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e isPromise (\x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e) {\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e \x26amp;\x26amp; typeof \x3cspan class=\x22hljs-keyword\x22\x3eval\x3c\/span\x3e.\x3cspan class=\x22hljs-keyword\x22\x3ethen\x3c\/span\x3e === \x27\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e\x27;\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/对执行结果是否是Promise\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (isPromise(res)){\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/处理\x3c\/span\x3e\n} \x3cspan class=\x22hljs-keyword\x22\x3eelse\x3c\/span\x3e {\n    dispatch({...action, payload: res});\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么，怎么利用 redux-promise 呢？redux-promise 是能处理符合 FSA 规范的 action 的，其对异步处理的关键源码如下：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22action.payload.then(\n    result =\x3e dispatch({ ...action, payload: result }),\n    error =\x3e {\n        dispatch({ ...action, payload: error, error: true });\n        return Promise.reject(error);\n    }\n)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs aspectj\x22\x3e\x3ccode\x3eaction.payload.then(\n    result =\x26gt; dispatch({ ...action, payload: result }),\n    \x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e =\x26gt; {\n        dispatch({ ...action, payload: \x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e, \x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e: \x3cspan class=\x22hljs-keyword\x22\x3etrue\x3c\/span\x3e });\n        \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e Promise.\x3cspan class=\x22hljs-title\x22\x3ereject\x3c\/span\x3e\x3cspan class=\x22hljs-params\x22\x3e(\x3cspan class=\x22hljs-keyword\x22\x3eerror\x3c\/span\x3e)\x3c\/span\x3e\x3c\/span\x3e;\n    }\n)\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e因而，返回的 payload 不再是一个函数，而是一个 Promise。而 async 函数执行后就是返回一个 Promise，所以，让上文定义的 async 函数自执行一次就可以：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22export let addTodoWithPromise = createAction(CONSTANT.ADD_TO_DO_PROMISE, (val) =\x3e\n    (async (dispatch, getState)=\x3e{\n        let value = await Promise.resolve(val \x2b \x27 promise\x27);\n        return {\n            value\n        };\n    })()\n);\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs lisp\x22\x3e\x3ccode\x3eexport let addTodoWithPromise = createAction(\x3cspan class=\x22hljs-name\x22\x3eCONSTANT\x3c\/span\x3e.ADD_TO_DO_PROMISE, (\x3cspan class=\x22hljs-name\x22\x3eval\x3c\/span\x3e) =\x26gt;\n    (\x3cspan class=\x22hljs-name\x22\x3easync\x3c\/span\x3e (\x3cspan class=\x22hljs-name\x22\x3edispatch\x3c\/span\x3e, getState)=\x26gt;{\n        let value = await Promise.resolve(\x3cspan class=\x22hljs-name\x22\x3eval\x3c\/span\x3e \x2b \x27 promise\x27)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n        return {\n            value\n        }\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\n    })()\n)\x3cspan class=\x22hljs-comment\x22\x3e;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e结果如下图：\x3c\/p\x3e\n\x3cp\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22https:\/\/segmentfault.com\/img\/bVCjJP\x22 src=\x22https:\/\/static.alili.techhttps:\/\/segmentfault.com\/img\/bVCjJP\x22 alt=\x22promise\x22 title=\x22promise\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e示例源码：\x3ca href=\x22https:\/\/github.com\/dwqs\/blog\/tree\/master\/redux-demo\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eredux-demo\x3c\/a\x3e\x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e原文：\x3ca href=\x22https:\/\/github.com\/dwqs\/blog\/issues\/35\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttps:\/\/github.com\/dwqs\/blog\/...\x3c\/a\x3e \x3c\/strong\x3e\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>关于Redux的一些总结(一)：Action &amp; 中间件 &amp; 异步</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000006723527">https://segmentfault.com/a/1190000006723527</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/e1lzyae8tkk/" target="_blank">https://alili.tech/archive/e1lzyae8tkk/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>