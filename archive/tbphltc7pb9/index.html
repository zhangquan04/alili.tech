<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="你用 webpack 1.x 输出的 hash 靠谱不？"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>你用 webpack 1.x 输出的 hash 靠谱不？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/tbphltc7pb9/",
				"appid": "1613049289050283", 
				"title": "你用 webpack 1.x 输出的 hash 靠谱不？ | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-02-01T02:30:10"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/cudsya9p28i/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/hcwolfihm8u/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&text=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&text=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&title=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&is_video=false&description=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&title=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&title=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&title=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2ftbphltc7pb9%2f&title=%e4%bd%a0%e7%94%a8%20webpack%201.x%20%e8%be%93%e5%87%ba%e7%9a%84%20hash%20%e9%9d%a0%e8%b0%b1%e4%b8%8d%ef%bc%9f"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">你用 webpack 1.x 输出的 hash 靠谱不？</h1><div class="meta"><div class="postdate"><time datetime="2019-02-01" itemprop="datePublished">2019-02-01</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3cp\x3e来自 \x3ca href=\x22http:\/\/zhenyong.site\/2016\/10\/27\/webpack-long-term-hash\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/zhenyong.site\/2016\/10\/...\x3c\/a\x3e\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e使用 webpack 构建输出文件时，通常会给文件名加上 hash，该 hash 值根据文件内容计算得到，只要文件内容不变，hash 就不变，于是就可以利用浏览器缓存来节省下载流量。可是 webpack 提供的 hash 似乎不那么靠谱...\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e本文只围绕如何保证 webpack 1.x 在 \x3cstrong\x3e生产发布阶段\x3c\/strong\x3e 输出稳定的 hash 值展开讨论，如果对 webpack 还没了解的，可以戳 \x3ca href=\x22http:\/\/webpack.github.io\/docs\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\x3c\/a\x3e。\x3c\/p\x3e\n\x3cp\x3e本文 基于 webpack 1.x 的背景展开讨论，毕竟有些问题在 webpack 2 已经得到解决。为了方便描述问题，文中展示的代码、配置可能很挫，也许不是工程最佳实践，请轻拍。\x3c\/p\x3e\n\x3cp\x3e懒得看文章的可以考虑直接读插件源码 \x3ca href=\x22https:\/\/github.com\/zhenyong\/webpack-stable-module-id-and-hash\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ezhenyong\/webpack-stable-module-id-and-hash\x3c\/a\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader0\x22\x3e目标\x3c\/h2\x3e\n\x3cp\x3e除了 html 文件以外，其他静态资源文件名都带上哈希值，根据文件本身的内容计算得到，保证文件没变化，则构建后的文件名跟上次一样。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3ewebpack 提供的 hash\x3c\/h2\x3e\n\x3ch3 id=\x22articleHeader2\x22\x3e[hash]\x3c\/h3\x3e\n\x3cp\x3e假设\x3cstrong\x3e文件目录\x3c\/strong\x3e长这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/src\n  |- pageA.js (入口1)\n  |- pageB.js (入口2)\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs 1c\x22\x3e\x3ccode\x3e\/src\n  \x3cspan class=\x22hljs-string\x22\x3e|- pageA.js (入口1)\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e|- pageB.js (入口2)\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e使用 \x3cstrong\x3ewebpack 配置\x3c\/strong\x3e:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22entry: {\n    pageA: \x27.\/src\/pageA.js\x27,\n    pageB: \x27.\/src\/pageB.js\x27,\n},\noutput: {\n    path: __dirname \x2b \x27\/build\x27,\n    \/\/ [hash:4] 表示截取 [hash] 前四位\n    filename: \x27[name].[hash:4].js\x27\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eentry: {\n    \x3cspan class=\x22hljs-attr\x22\x3epageA\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/pageA.js\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-attr\x22\x3epageB\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/pageB.js\x27\x3c\/span\x3e,\n},\n\x3cspan class=\x22hljs-attr\x22\x3eoutput\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e: __dirname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/build\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ [hash:4] 表示截取 [hash] 前四位\x3c\/span\x3e\n    filename: \x3cspan class=\x22hljs-string\x22\x3e\x27[name].[hash:4].js\x27\x3c\/span\x3e\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e首次\x3c\/strong\x3e构建输出:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.c56c.js  1.47 kB       0  [emitted]  pageA\npageB.c56c.js  1.47 kB       1  [emitted]  pageB\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.c56c\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.c56c\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e再次\x3c\/strong\x3e构建输出：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.c56c.js  1.47 kB       0  [emitted]  pageA\npageB.c56c.js  1.47 kB       1  [emitted]  pageB\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.c56c\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.c56c\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ehash 值是稳定的呀，是不是就可以了呢？且慢！\x3c\/p\x3e\n\x3cp\x3e根据 \x3ca href=\x22https:\/\/github.com\/webpack\/docs\/wiki\/Configuration#outputfilename\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eConfiguration · webpack\/docs Wiki\x3c\/a\x3e ：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e[hash] is replaced by the hash of the compilation.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e意译：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e[hash] 是根据一个 compilation 对象计算得出的哈希值，如果 compilation 对象的信息不变，则 [hash] 不变\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e结合 \x3ca href=\x22http:\/\/webpack.github.io\/docs\/how-to-write-a-plugin.html#compiler-and-compilation\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehow to write a plugin\x3c\/a\x3e 提到：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3eA \x3ccode\x3ecompilation\x3c\/code\x3e object represents a single build of versioned assets. While running Webpack development middleware, a new compilation will be created each time a file change is detected, thus generating a new set of compiled assets. A compilation surfaces information about the present state of module resources, compiled assets, changed files, and watched dependencies.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e意译：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e\x3ccode\x3ecompilation\x3c\/code\x3e 对象代表对某个版本进行一次编译构建的过程，如果在开发模式下（例如用 --watch 检测变化，实时编译），则每次内容变化时会新建一个 complidation，包含了构建所需的上下文信息（构建器配置、文件、文件依赖）。\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e我们来动一下 \x3ccode\x3epageA.js\x3c\/code\x3e，再次构建：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.e6a9.js  1.48 kB       0  [emitted]  pageA\npageB.e6a9.js  1.47 kB       1  [emitted]  pageB\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.e6a9\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.48\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.e6a9\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e发现 hash 变了，并且所有文件的 hash 值总是一样，这似乎就跟文档描述的一致，只要构建过程依赖的任何资源（代码）发生变化，\x3ccode\x3ecompilation\x3c\/code\x3e 的信息就会跟上一次不一样了。\x3c\/p\x3e\n\x3cp\x3e那是不是肯定说，源码不变的话，hash 值就一定稳定呢？也不是的，我们改一下 webpack 配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22entry: {\n    pageA: \x27.\/src\/pageA.js\x27,\n    \/\/ 不再构建入口 pageB\n    \/\/ pageB: \x27.\/src\/pageB.js\x27,\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eentry: {\n    \x3cspan class=\x22hljs-attr\x22\x3epageA\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/pageA.js\x27\x3c\/span\x3e,\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 不再构建入口 pageB\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ pageB: \x27.\/src\/pageB.js\x27,\x3c\/span\x3e\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e再次构建：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.1f01.js  1.48 kB       0  [emitted]  pageA\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1f01\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.48\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3ccode\x3ecompilation\x3c\/code\x3e 的信息还包括构建上下文，所以，移除入口或者换个loader 都会引起 hash 改变。\x3c\/p\x3e\n\x3cp\x3e\x3ccode\x3e[hash]\x3c\/code\x3e 的缺点很明显，不是根据内容来计算哈希，但是 hash 值是\x22稳定的\x22，用这种方案能保证『每次上线，浏览器访问到的静态资源都是新的（url 变了）』\x3c\/p\x3e\n\x3cp\x3e你接受用 \x3ccode\x3e[hash]\x3c\/code\x3e 吗，我是接受不了？于是我们看 webpack 提供的另一种根据内容计算 hash 的配置。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e[chunkhash]\x3c\/h3\x3e\n\x3cblockquote\x3e\x3cp\x3e[chunkhash] is replaced by the hash of the chunk.\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e意译：\x3c\/p\x3e\n\x3cblockquote\x3e\x3cp\x3e[chunkhash] 根据 chunk 的内容计算得到。（chunk 可以理解成一个输出文件，其中可能包含多个 js 模块）\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e我们改下配置：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22entry: {\n    pageA: \x27.\/src\/pageA.js\x27,\n    pageB: \x27.\/src\/pageB.js\x27,\n},\noutput: {\n    path: __dirname \x2b \x27\/build\x27,\n    filename: \x27[name].[chunkhash:4].js\x27,\n},\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3eentry\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attribute\x22\x3epageA\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/pageA.js\x27\x3c\/span\x3e,\n    pageB: \x3cspan class=\x22hljs-string\x22\x3e\x27.\/src\/pageB.js\x27\x3c\/span\x3e,\n},\n\x3cspan class=\x22hljs-selector-tag\x22\x3eoutput\x3c\/span\x3e: {\n    \x3cspan class=\x22hljs-attribute\x22\x3epath\x3c\/span\x3e: __dirname \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\/build\x27\x3c\/span\x3e,\n    filename: \x3cspan class=\x22hljs-string\x22\x3e\x27[name].[chunkhash:4].js\x27\x3c\/span\x3e,\n},\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e构建试试：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.f308.js  1.48 kB       0  [emitted]  pageA\npageB.53a9.js  1.47 kB       1  [emitted]  pageB\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.f308\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.48\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.53a9\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e动下 \x3ccode\x3epageA.js\x3c\/code\x3e 再构建：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.16d6.js  1.48 kB       0  [emitted]  pageA\npageB.53a9.js  1.47 kB       1  [emitted]  pageB\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.16d6\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.48\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.53a9\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  1\x3cspan class=\x22hljs-selector-class\x22\x3e.47\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e发现只有 pageA 的 hash 变了，似乎 [chunkhash] 就能解决问题了？且慢！\x3c\/p\x3e\n\x3cp\x3e我们目前的代码没涉及到 css，先加点 css 文件依赖：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/src\n  |- pageA.js\n  |- pageA.css\n\n\/\/pageA.js\nrequire(\x27.\/a.css\x27);\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs 1c\x22\x3e\x3ccode\x3e\/src\n  \x3cspan class=\x22hljs-string\x22\x3e|- pageA.js\x3c\/span\x3e\n  \x3cspan class=\x22hljs-string\x22\x3e|- pageA.css\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/pageA.js\x3c\/span\x3e\nrequire(\x27.\/a.css\x27);\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e给 webpack 配置 css 文件的 loader，并且抽取所有样式输出到一个文件\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22module: {\n    loaders: [{\n        test: \/\\.css$\/,\n        loader: ExtractTextPlugin.extract(\x27style-loader\x27, \x27css-loader\x27)\n    }],\n},\nplugins: [\n    \/\/ 这里的 contenthash 是 ExtractTextPlugin 根据抽取输出的文件内容计算得到\n    new ExtractTextPlugin(\x27[name].[contenthash:4].css\x27)\n],\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs groovy\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-string\x22\x3emodule:\x3c\/span\x3e {\n\x3cspan class=\x22hljs-symbol\x22\x3e    loaders:\x3c\/span\x3e [{\n\x3cspan class=\x22hljs-symbol\x22\x3e        test:\x3c\/span\x3e \x3cspan class=\x22hljs-regexp\x22\x3e\/\\.css$\/\x3c\/span\x3e,\n\x3cspan class=\x22hljs-symbol\x22\x3e        loader:\x3c\/span\x3e ExtractTextPlugin.extract(\x3cspan class=\x22hljs-string\x22\x3e\x27style-loader\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27css-loader\x27\x3c\/span\x3e)\n    }],\n},\n\x3cspan class=\x22hljs-string\x22\x3eplugins:\x3c\/span\x3e [\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里的 contenthash 是 ExtractTextPlugin 根据抽取输出的文件内容计算得到\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e ExtractTextPlugin(\x3cspan class=\x22hljs-string\x22\x3e\x27[name].[contenthash:4].css\x27\x3c\/span\x3e)\n],\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e构建：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.ab4b.js    1.6 kB       0  [emitted]  pageA\npageA.b9bc.css  36 bytes       0  [emitted]  pageA\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.ab4b\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e    1\x3cspan class=\x22hljs-selector-class\x22\x3e.6\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.b9bc\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.css\x3c\/span\x3e  36 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e改一下样式，那么样式的 hash 肯定会变的，那 pageA.js 的 hash 变不变呢?\x3c\/p\x3e\n\x3cp\x3e答案是『变了』：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22pageA.0482.js    1.6 kB       0  [emitted]  pageA\npageA.c61a.css  31 bytes       0  [emitted]  pageA\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.0482\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e    1\x3cspan class=\x22hljs-selector-class\x22\x3e.6\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.c61a\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.css\x3c\/span\x3e  31 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e记得之前说 webpack 的 \x3ccode\x3e[chunkhash]\x3c\/code\x3e 是根据 chunk 的内容计算的，而 pageA.js 这个 chunk 的输出在 webpack 看来是包括 css 文件的，只不过被你抽取出来罢了，所以你改 css 也就改了这个 chunk 的内容，这体验很不好吧，怎么让 css 不影响 js 的 hash 呢？\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader4\x22\x3e自定义 chunkhash\x3c\/h2\x3e\n\x3cp\x3e源码 \x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/75caa169bcf63c66ab069c38c73c3ab0e873cdc2\/lib\/Compilation.js#L915,L928\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/Compilation.js\x3c\/a\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\nthis.applyPlugins(\x26quot;chunk-hash\x26quot;, chunk, chunkHash);\nchunk.hash = chunkHash.digest(hashDigest);\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs clean\x22\x3e\x3ccode\x3e...\nthis.applyPlugins(\x3cspan class=\x22hljs-string\x22\x3e\x22chunk-hash\x22\x3c\/span\x3e, chunk, chunkHash);\nchunk.hash = chunkHash.digest(hashDigest);\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e通过这段代码可以发现，通过在 \x27chunk-hash\x27 \x22钩子\x22 中替换掉 chunk 的 digest 方法，就可以自定义 \x3ccode\x3echunk.hash\x3c\/code\x3e 了。\x3c\/p\x3e\n\x3cp\x3e查看文档 \x3ca href=\x22http:\/\/webpack.github.io\/docs\/how-to-write-a-plugin.html#accessing-the-compilation\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehow to write a plugin\x3c\/a\x3e 了解怎么写插件来注册一个钩子方法：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22plugins: [\n        ...\n        new ContentHashPlugin() \/\/ 添加插件（生产发布阶段使用）\n    ],\n};\n\n\/\/ 插件函数\nfunction ContentHashPlugin() {}\n\/\/ webpack 会执行插件函数的 apply 方法\nContentHashPlugin.prototype.apply = function(compiler) {\n    compiler.plugin(\x27compilation\x27, function(compilation) {\n        compilation.plugin(\x27chunk-hash\x27, function(chunk, chunkHash) {\n            \/\/ 这里注册了之前说到的 \x27chunk-hash\x27 钩子\n            chunk.digest = function () {\n                return \x27这就是自定义的 hash 值\x27;\n            }\n        });\n    });\n};\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3eplugins: [\n        ...\n        new ContentHashPlugin() \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加插件（生产发布阶段使用）\x3c\/span\x3e\n    ],\n};\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 插件函数\x3c\/span\x3e\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eContentHashPlugin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ webpack 会执行插件函数的 apply 方法\x3c\/span\x3e\nContentHashPlugin.prototype.apply = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompiler\x3c\/span\x3e) \x3c\/span\x3e{\n    compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27compilation\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompilation\x3c\/span\x3e) \x3c\/span\x3e{\n        compilation.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x27chunk-hash\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3echunk, chunkHash\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这里注册了之前说到的 \x27chunk-hash\x27 钩子\x3c\/span\x3e\n            chunk.digest = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e (\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27这就是自定义的 hash 值\x27\x3c\/span\x3e;\n            }\n        });\n    });\n};\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e那么这个 hash 值如何计算好呢？\x3c\/p\x3e\n\x3cp\x3e可以将 chunk 所依赖的各个模块 (单个源码文件) 的内容拼接后计算一个 md5 作为 hash 值，当然需要对所有文件排序后再拼接：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22var crypto = require(\x27crypto\x27);\n\nvar md5Cache = {}\n\nfunction md5(content) {\n    if (!md5Cache[content]) {\n        md5Cache[content] = crypto.createHash(\x27md5\x27) \/\/\n            .update(content, \x27utf-8\x27).digest(\x27hex\x27)\n    }\n    return md5Cache[content];\n}\n\nfunction ContentHashPlugin() {}\n\nContentHashPlugin.prototype.apply = function(compiler) {\n    var context = compiler.options.context;\n\n    function getModFilePath(mod) {\n        \/\/ 获取形如 \x27.\/src\/pageA.css\x27 这样的路径\n        \/\/ libIdent 方法会处理好不同平台的路径分隔符问题\n        return mod.libIdent({\n            context: context\n        });\n    }\n\n    \/\/ 根据模块对应的文件路径排序\n    \/\/（可以根据模块ID，但是暂时不靠谱，后面会讲）\n    function compareMod(modA, modB) {\n        var modAPath = getModFilePath(modA);\n        var modBPath = getModFilePath(modB);\n        return modAPath \x3e modBPath ? 1 : modAPath \x3c modBPath ? -1 : 0;\n    }\n\n    \/\/ 获取模块源码，开发阶段别用\n    function getModSrc(mod) {\n        return mod._source \x26amp;\x26amp; mod._source._value || \x27\x27;\n    }\n\n    compiler.plugin(\x26quot;compilation\x26quot;, function(compilation) {\n        compilation.plugin(\x26quot;chunk-hash\x26quot;, function(chunk, chunkHash) {\n            var source = chunk.modules.sort(compareMod).map(getModSrc).join(\x27\x27);\n            chunkHash.digest = function() {\n                return md5(source);\n            };\n        });\n    });\n};\n\nmodule.exports = ContentHashPlugin;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e crypto = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crypto\x27\x3c\/span\x3e);\n\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e md5Cache = {}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emd5\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3econtent\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!md5Cache[content]) {\n        md5Cache[content] = crypto.createHash(\x3cspan class=\x22hljs-string\x22\x3e\x27md5\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/\x3c\/span\x3e\n            .update(content, \x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e).digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e)\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e md5Cache[content];\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eContentHashPlugin\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{}\n\nContentHashPlugin.prototype.apply = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompiler\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e context = compiler.options.context;\n\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetModFilePath\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emod\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取形如 \x27.\/src\/pageA.css\x27 这样的路径\x3c\/span\x3e\n        \x3cspan class=\x22hljs-comment\x22\x3e\/\/ libIdent 方法会处理好不同平台的路径分隔符问题\x3c\/span\x3e\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mod.libIdent({\n            \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e: context\n        });\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 根据模块对应的文件路径排序\x3c\/span\x3e\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/（可以根据模块ID，但是暂时不靠谱，后面会讲）\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecompareMod\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emodA, modB\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e modAPath = getModFilePath(modA);\n        \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e modBPath = getModFilePath(modB);\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e modAPath \x26gt; modBPath ? \x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e : modAPath \x26lt; modBPath ? \x3cspan class=\x22hljs-number\x22\x3e-1\x3c\/span\x3e : \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e;\n    }\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 获取模块源码，开发阶段别用\x3c\/span\x3e\n    \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetModSrc\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emod\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e mod._source \x26amp;\x26amp; mod._source._value || \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n    }\n\n    compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompilation\x3c\/span\x3e) \x3c\/span\x3e{\n        compilation.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22chunk-hash\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3echunk, chunkHash\x3c\/span\x3e) \x3c\/span\x3e{\n            \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e source = chunk.modules.sort(compareMod).map(getModSrc).join(\x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e);\n            chunkHash.digest = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n                \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e md5(source);\n            };\n        });\n    });\n};\n\n\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.exports = ContentHashPlugin;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e此时，pageA.css 修改之后，再也不会影响 pageA.js 的 hash 值。\x3c\/p\x3e\n\x3cp\x3e另外要注意，ExtractTextPlugin 会把 pageA.css 的内容抽取之后，替换该模块的内容 \x3ccode\x3emod._source._value\x3c\/code\x3e 为：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ removed by extract-text-webpack-plugin\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livecodeserver\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\/\/ removed \x3cspan class=\x22hljs-keyword\x22\x3eby\x3c\/span\x3e extract-\x3cspan class=\x22hljs-keyword\x22\x3etext\x3c\/span\x3e-webpack-plugin\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e由于每一个 css 模块都对应这段内容，所以不会影响效果。\x3c\/p\x3e\n\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/erm0l0v\/webpack-md5-hash\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eerm0l0v\/webpack-md5-hash\x3c\/a\x3e 插件也是为了解决类似问题，但是它其中的『排序』算法是基于模块的 id，而模块的 id 理论上是不稳定的，接下来我们就讨论不稳定的模块 ID 带来的坑。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader5\x22\x3e模块 ID 的坑\x3c\/h2\x3e\n\x3cp\x3e我们简单的把每个文件理解为一个模块（module），在 webpack 处理模块依赖关系时，会给每个模块定义一个 ID，查看 \x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/75caa169bcf63c66ab069c38c73c3ab0e873cdc2\/lib\/Compilation.js#L748\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/Compilation.js \x3c\/a\x3e 发现，webpack 根据收集 module 的顺序给每个模块分配递增数字作为 ID，至于『收集的 module 顺序』，在你开发生涯里，这玩意绝对是不稳定！不稳定的！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3eModule ID 不稳定怎么了\x3c\/h3\x3e\n\x3cp\x3e我们的\x3cstrong\x3e文件结构\x3c\/strong\x3e现在长这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/src\n    |- pageA.js\n    |- pageB.js\n    |- a.js\n    |- b.js\n    |- c.js\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs 1c\x22\x3e\x3ccode\x3e\/src\n    \x3cspan class=\x22hljs-string\x22\x3e|- pageA.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e|- pageB.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e|- a.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e|- b.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-string\x22\x3e|- c.js\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3epageA.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27.\/a.js\x27) \/\/ a.js\nrequire(\x27.\/b.js\x27) \/\/ b.js\nvar a = \x27this is pageA\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/a.js\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ a.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.js\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ b.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-string\x22\x3e\x27this is pageA\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3epageB.js\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22require(\x27.\/b.js\x27) \/\/  b.js\x27\nrequire(\x27.\/c.js\x27) \/\/ c.js\nvar b = \x27this is pageB\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.js\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/  b.js\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/c.js\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ c.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e b = \x3cspan class=\x22hljs-string\x22\x3e\x27this is pageB\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e更新配置，把引用达到 2 次的模块抽取出来：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  output: {\n        chunkFilename: \x26quot;[id].[chunkhash:4].bundle.js\x26quot;,\n    ...\nplugins: [\n    new webpack.optimize.CommonsChunkPlugin({\n        name: \x26quot;commons\x26quot;,\n        minChunks: 2,\n        chunks: [\x26quot;pageA\x26quot;, \x26quot;pageB\x26quot;],\n    }),\n    ...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e  output: {\n        \x3cspan class=\x22hljs-attr\x22\x3echunkFilename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22[id].[chunkhash:4].bundle.js\x22\x3c\/span\x3e,\n    ...\nplugins: [\n    \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e webpack.optimize.CommonsChunkPlugin({\n        \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22commons\x22\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3eminChunks\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e,\n        \x3cspan class=\x22hljs-attr\x22\x3echunks\x3c\/span\x3e: [\x3cspan class=\x22hljs-string\x22\x3e\x22pageA\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x22pageB\x22\x3c\/span\x3e],\n    }),\n    ...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ebuild build build:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  pageA.1cda.js  262 bytes       0  [emitted]  pageA\n  pageB.0752.js  280 bytes       1  [emitted]  pageB\ncommons.14bf.js    3.64 kB       2  [emitted]  commons\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.1cda\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  262 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.0752\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  280 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3ecommons\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.14bf\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e    3\x3cspan class=\x22hljs-selector-class\x22\x3e.64\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       2  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecommons\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e观察 pageB.0752.js，有一段:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22__webpack_require__(2) \/\/  b.js\x27\n__webpack_require__(3) \/\/ c.js\nvar b = \x27this is pageB\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e__webpack_require__(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/  b.js\x27\x3c\/span\x3e\n__webpack_require__(\x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ c.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e b = \x3cspan class=\x22hljs-string\x22\x3e\x27this is pageB\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e从上面看出，webpack 构建时给 \x3ccode\x3eb.js\x3c\/code\x3e 的模块 ID 为 \x3cstrong\x3e2\x3c\/strong\x3e\x3c\/p\x3e\n\x3cp\x3e这时，我们改一下 \x3cstrong\x3epageA.js\x3c\/strong\x3e：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 移除对 a.js 的依赖\n\/\/ require(\x27.\/a.js\x27) \/\/ a.js\nrequire(\x27.\/b.js\x27) \/\/ b.js\nvar a = \x27this is pageA\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 移除对 a.js 的依赖\x3c\/span\x3e\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ require(\x27.\/a.js\x27) \/\/ a.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27.\/b.js\x27\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ b.js\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e a = \x3cspan class=\x22hljs-string\x22\x3e\x27this is pageA\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3ebuild build build ：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  pageA.a945.js  200 bytes       0  [emitted]  pageA\n  pageB.0752.js  271 bytes       1  [emitted]  pageB\ncommons.14bf.js    3.65 kB       2  [emitted]  commons\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs css\x22\x3e\x3ccode\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.a945\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  200 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       0  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageA\x3c\/span\x3e\n  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.0752\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e  271 \x3cspan class=\x22hljs-selector-tag\x22\x3ebytes\x3c\/span\x3e       1  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3epageB\x3c\/span\x3e\n\x3cspan class=\x22hljs-selector-tag\x22\x3ecommons\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.14bf\x3c\/span\x3e\x3cspan class=\x22hljs-selector-class\x22\x3e.js\x3c\/span\x3e    3\x3cspan class=\x22hljs-selector-class\x22\x3e.65\x3c\/span\x3e \x3cspan class=\x22hljs-selector-tag\x22\x3ekB\x3c\/span\x3e       2  \x3cspan class=\x22hljs-selector-attr\x22\x3e[emitted]\x3c\/span\x3e  \x3cspan class=\x22hljs-selector-tag\x22\x3ecommons\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e嗯! 只有 pageA.js 的 hash 变了，挺合理合理，我们进去 pageB.0752.js 看看\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22    __webpack_require__(1) \/\/  b.js\x27\n    __webpack_require__(2) \/\/ c.js\n    var b = \x27this is pageB\x27;\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e    __webpack_require__(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/  b.js\x27\x3c\/span\x3e\n    __webpack_require__(\x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) \x3cspan class=\x22hljs-comment\x22\x3e\/\/ c.js\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e b = \x3cspan class=\x22hljs-string\x22\x3e\x27this is pageB\x27\x3c\/span\x3e;\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e看出来了没！这次构建，webpack 给 \x3ccode\x3eb.js\x3c\/code\x3e 的 ID 是 \x3cstrong\x3e1\x3c\/strong\x3e。\x3c\/p\x3e\n\x3cp\x3e我们 pageB.js 的 hash 没变，因为背后依赖的模块内容 (b.js、c.js) 没有变呀，但是此时 pageB.0752.js 的内容确实变了，如果你用 CDN 上传这个文件，\x3cstrong\x3e也许\x3c\/strong\x3e会传不上去，因为文件大小和名称一模一样，就是这个不稳定的模块 ID 给坑的！\x3c\/p\x3e\n\x3cp\x3e怎么解决呢？\x3c\/p\x3e\n\x3cp\x3e第一念头：把原来计算 hash 的方式改一下，就那构建输出后的文件内容来计算？\x3c\/p\x3e\n\x3cp\x3e细想: 不要，明明 pageB 这一次就不用重新上传的，浪费。\x3c\/p\x3e\n\x3cp\x3e比较优雅的思路就是：让模块 ID 给我稳定下来！！！\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader7\x22\x3e给我稳定的 Module ID\x3c\/h3\x3e\n\x3ch4\x3ewebpack 1 的官方方案\x3c\/h4\x3e\n\x3cp\x3ewebpack 文档提供了几种方案\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/webpack.github.io\/docs\/list-of-plugins.html#occurrenceorderplugin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eOccurrenceOrderPlugin\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22这个插件根据 module 被引用的次数（被 entry 引用、被 chunk 引用）来排序分配 ID，如果你的整个应用的文件依赖是没太多变化，那么模块 ID 就稳定，但是谁能保证呢？\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs crystal\x22\x3e\x3ccode\x3e这个插件根据 \x3cspan class=\x22hljs-class\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3emodule\x3c\/span\x3e 被引用的次数（被 \x3cspan class=\x22hljs-title\x22\x3eentry\x3c\/span\x3e 引用、被 \x3cspan class=\x22hljs-title\x22\x3echunk\x3c\/span\x3e 引用）来排序分配 \x3cspan class=\x22hljs-title\x22\x3eID\x3c\/span\x3e，如果你的整个应用的文件依赖是没太多变化，那么模块 \x3cspan class=\x22hljs-title\x22\x3eID\x3c\/span\x3e 就稳定，但是谁能保证呢？\x3c\/span\x3e\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/webpack.github.io\/docs\/configuration.html#recordspath-recordsinputpath-recordsoutputpath\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e\x3ccode\x3erecordsPath 配置\x3c\/code\x3e\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3eStore\/Load compiler state from\/to a json file. This will result in persistent ids of modules and chunks.\n\n会记录每一次打包的模块的\x26quot;文件处理路径\x26quot;使用的 ID，下次打包同样的模块直接使用记录中的 ID:\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs livecodeserver\x22\x3e\x3ccode\x3e\x26gt;Store\/Load compiler state \x3cspan class=\x22hljs-built_in\x22\x3efrom\x3c\/span\x3e\/\x3cspan class=\x22hljs-built_in\x22\x3eto\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ea\x3c\/span\x3e json \x3cspan class=\x22hljs-built_in\x22\x3efile\x3c\/span\x3e. This will \x3cspan class=\x22hljs-built_in\x22\x3eresult\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3ein\x3c\/span\x3e persistent ids \x3cspan class=\x22hljs-keyword\x22\x3eof\x3c\/span\x3e modules \x3cspan class=\x22hljs-keyword\x22\x3eand\x3c\/span\x3e chunks.\n\n会记录每一次打包的模块的\x3cspan class=\x22hljs-string\x22\x3e\x22文件处理路径\x22\x3c\/span\x3e使用的 ID，下次打包同样的模块直接使用记录中的 ID:\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22  \x26quot;node_modules\/style-loader\/index.js!node_modules\/css-loader\/index.js!src\/b.css\x26quot;: 9,\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs n1ql\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e  \x22node_modules\/style-loader\/\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e.js!node_modules\/css-loader\/\x3cspan class=\x22hljs-keyword\x22\x3eindex\x3c\/span\x3e.js!src\/b.css\x3cspan class=\x22hljs-string\x22\x3e\x22: 9,\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\n\n这就要求每个人都得提交这份文件了，港真，我觉得体验很差咯。\n\n另外一旦你修改文件名，或者是增减 loader，原来的路径就无效了，从而再次入坑！\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs http\x22\x3e\x3ccode\x3e\n\n\x3cspan class=\x22undefined\x22\x3e这就要求每个人都得提交这份文件了，港真，我觉得体验很差咯。\n\n另外一旦你修改文件名，或者是增减 loader，原来的路径就无效了，从而再次入坑！\n\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3cli\x3e\n\x3cp\x3e\x3ca href=\x22http:\/\/webpack.github.io\/docs\/list-of-plugins.html#dllplugin\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eDllPlugin 和 DllReferencePlugin\x3c\/a\x3e\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22原理就是在你打包源码前，你得新建一个构建配置用 [DllPlugin](https:\/\/github.com\/webpack\/webpack\/tree\/master\/examples\/dll) 单独打包生成一份模块文件路径对应的 ID 记录，然后在你的原来配置使用 [DllReferencePlugin](https:\/\/github.com\/webpack\/webpack\/tree\/master\/examples\/dll-user) 引用这份记录，跟 recordsPath 大同小异，但是更高效和稳定，但是这个额外的构建，我觉得不够优雅，至于能快多少呢，我目前还不在意这个速度，另外还是得提交多一份记录文件。\n\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs markdown\x22\x3e\x3ccode\x3e原理就是在你打包源码前，你得新建一个构建配置用 [\x3cspan class=\x22hljs-string\x22\x3eDllPlugin\x3c\/span\x3e](\x3cspan class=\x22hljs-link\x22\x3ehttps:\/\/github.com\/webpack\/webpack\/tree\/master\/examples\/dll\x3c\/span\x3e) 单独打包生成一份模块文件路径对应的 ID 记录，然后在你的原来配置使用 [\x3cspan class=\x22hljs-string\x22\x3eDllReferencePlugin\x3c\/span\x3e](\x3cspan class=\x22hljs-link\x22\x3ehttps:\/\/github.com\/webpack\/webpack\/tree\/master\/examples\/dll-user\x3c\/span\x3e) 引用这份记录，跟 recordsPath 大同小异，但是更高效和稳定，但是这个额外的构建，我觉得不够优雅，至于能快多少呢，我目前还不在意这个速度，另外还是得提交多一份记录文件。\n\x3c\/code\x3e\x3c\/pre\x3e\n\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3ch4\x3ewebpack 2 的思路\x3c\/h4\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/master\/lib\/HashedModuleIdsPlugin.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/HashedModuleIdsPlugin.js at master · webpack\/webpack\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/master\/lib\/NamedModulesPlugin.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/NamedModulesPlugin.js at master · webpack\/webpack\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e以上两个插件的思路都是用模块对应的文件路径直接作为模块 ID，而不是 webpack 1 中的默认使用数字，另外 webpack 1 不接受非数字作为 模块 ID。\x3c\/p\x3e\n\x3ch4\x3e我们的思路\x3c\/h4\x3e\n\x3cp\x3e把模块对应的文件路径通过一个哈希计算映射为数字，用这个全局唯一的数字作为 ID 就解决了，妥妥的！\x3c\/p\x3e\n\x3cp\x3e参考：\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/75caa169bcf63c66ab069c38c73c3ab0e873cdc2\/lib\/Compilation.js#L569,L571\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/Compilation.js 中暴露的 before-module-ids 钩子\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/blob\/54aa3cd0d6167943713491fd5e1110b777336be6\/lib\/HashedModuleIdsPlugin.js\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack\/HashedModuleIdsPlugin.js\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e给出 webpack 1.x 中的解决方案：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22...\n\nxx.prototype.apply = function(compiler) {\n\n  function hexToNum(str) {\n    str = str.toUpperCase();\n    var code = \x27\x27\n    for (var i = 0; i \x3c str.length; i\x2b\x2b) {\n      var c = str.charCodeAt(i) \x2b \x27\x27;\n      if ((c \x2b \x27\x27).length \x3c 2) {\n        c = \x270\x27 \x2b c\n      }\n      code \x2b= c\n    }\n    return parseInt(code, 10);\n  }\n\n  var usedIds = {};\n\n  function genModuleId(module) {\n    var modulePath = module.libIdent({\n      context: compiler.options.context\n    });\n    var id = md5(modulePath);\n    var len = 4;\n    while (usedIds[id.substr(0, len)]) {\n      len\x2b\x2b;\n    }\n    id = id.substr(0, len);\n    return hexToNum(id)\n  }\n\n  compiler.plugin(\x26quot;compilation\x26quot;, function(compilation) {\n    compilation.plugin(\x26quot;before-module-ids\x26quot;, function(modules) {\n      modules.forEach(function(module) {\n        if (module.libIdent \x26amp;\x26amp; module.id === null) {\n          module.id = genModuleId(module);\n          usedIds[module.id] = true;\n        }\n      });\n    });\n  });\n};\n...\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs javascript\x22\x3e\x3ccode\x3e...\n\nxx.prototype.apply = \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompiler\x3c\/span\x3e) \x3c\/span\x3e{\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ehexToNum\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3estr\x3c\/span\x3e) \x3c\/span\x3e{\n    str = str.toUpperCase();\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e code = \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e\n    \x3cspan class=\x22hljs-keyword\x22\x3efor\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e i = \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e; i \x26lt; str.length; i\x2b\x2b) {\n      \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e c = str.charCodeAt(i) \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e;\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e ((c \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e).length \x26lt; \x3cspan class=\x22hljs-number\x22\x3e2\x3c\/span\x3e) {\n        c = \x3cspan class=\x22hljs-string\x22\x3e\x270\x27\x3c\/span\x3e \x2b c\n      }\n      code \x2b= c\n    }\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(code, \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e);\n  }\n\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e usedIds = {};\n\n  \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egenModuleId\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emodule\x3c\/span\x3e) \x3c\/span\x3e{\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e modulePath = \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.libIdent({\n      \x3cspan class=\x22hljs-attr\x22\x3econtext\x3c\/span\x3e: compiler.options.context\n    });\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e id = md5(modulePath);\n    \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e len = \x3cspan class=\x22hljs-number\x22\x3e4\x3c\/span\x3e;\n    \x3cspan class=\x22hljs-keyword\x22\x3ewhile\x3c\/span\x3e (usedIds[id.substr(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, len)]) {\n      len\x2b\x2b;\n    }\n    id = id.substr(\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e, len);\n    \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e hexToNum(id)\n  }\n\n  compiler.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22compilation\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ecompilation\x3c\/span\x3e) \x3c\/span\x3e{\n    compilation.plugin(\x3cspan class=\x22hljs-string\x22\x3e\x22before-module-ids\x22\x3c\/span\x3e, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emodules\x3c\/span\x3e) \x3c\/span\x3e{\n      modules.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3emodule\x3c\/span\x3e) \x3c\/span\x3e{\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.libIdent \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.id === \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e) {\n          \x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.id = genModuleId(\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e);\n          usedIds[\x3cspan class=\x22hljs-built_in\x22\x3emodule\x3c\/span\x3e.id] = \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e;\n        }\n      });\n    });\n  });\n};\n...\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e注册钩子的思路跟之前的 content hash 插件差不多，获取到模块文件路径后，通过 md5 计算输出 16 进制的字符串（[0-9A-E]），再把字符串的字符逐个转为 ascii 形式的整数，由于 16 进制字符串只会包含 \x3ccode\x3e[0-9A-E]\x3c\/code\x3e，所以保证单个字符转化的整数是两位就能保证这个算法是有效的。\x3c\/p\x3e\n\x3cp\x3e举例:\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22path = \x27\/node_module\/xxx\x27\nmd5Hash = md5(path) \/\/ =\x3e A3E...\nnul = hexToNum(md5Hash) \/\/ =\x3e 650369 \x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs ini\x22\x3e\x3ccode\x3e\x3cspan class=\x22hljs-attr\x22\x3epath\x3c\/span\x3e = \x3cspan class=\x22hljs-string\x22\x3e\x27\/node_module\/xxx\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-attr\x22\x3emd5Hash\x3c\/span\x3e = md5(path) \/\/ =\x26gt; A3E...\n\x3cspan class=\x22hljs-attr\x22\x3enul\x3c\/span\x3e = hexToNum(md5Hash) \/\/ =\x26gt; \x3cspan class=\x22hljs-number\x22\x3e650369\x3c\/span\x3e \x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个方案还有些小缺点，就是用模块文件路径作为哈希输入还不是百分百完美，如果文件名改了，那么模块 ID 就 \x22不稳定了\x22。其实，可以用模块文件内容作为哈希输入，考虑到效率问题，权衡之下还是用路径好了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e总结\x3c\/h2\x3e\n\x3cp\x3e为了保证 webpack 1.x 生产阶段的文件 hash 值能够完美跟文件内容一一映射，查阅了大量信息，根据目前 github 上讨论的解决方案算是大体解决了问题，但是还不够优雅和完美，于是借鉴 webpack 2 的思路加上一点小技巧，比较优雅地解决了这个问题。\x3c\/p\x3e\n\x3cp\x3e插件放在 Github: \x3ca href=\x22https:\/\/github.com\/zhenyong\/webpack-stable-module-id-and-hash\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ezhenyong\/webpack-stable-module-id-and-hash\x3c\/a\x3e『有用的话给个 star 嘛 O(∩_∩)O』\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader9\x22\x3e参考资料\x3c\/h2\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/issues\/1315\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVendor chunkhash changes when app code changes · Issue #1315 · webpack\/webpack\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/webpack\/webpack\/issues\/1315\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eVendor chunkhash changes when app code changes · Issue #1315 · webpack\/webpack\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.cnblogs.com\/ihardcoder\/p\/5623411.html\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eWebpack中hash与chunkhash的区别，以及js与css的hash指纹解耦方案 - zhoujunpeng - 博客园\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22http:\/\/www.alloyteam.com\/2016\/01\/webpack-use-optimization\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ewebpack使用优化 | Web前端 腾讯AlloyTeam Blog | 愿景: 成为地球卓越的Web团队！\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>你用 webpack 1.x 输出的 hash 靠谱不？</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000007309850">https://segmentfault.com/a/1190000007309850</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/tbphltc7pb9/" target="_blank">https://alili.tech/archive/tbphltc7pb9/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>