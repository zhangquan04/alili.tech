<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hugo 0.51"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="initial-scale=1,width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta name="wap-font-scale" content="no"><meta name="360-site-verification" content="0903ba33c82867d1f7bd8831e32a7e34"><meta name="sogou_site_verification" content="E8uWFBcf4a"><meta name="author" content="Fan"><meta name="description" itemprop="description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta name="keywords" content="Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js"><meta property="og:locale" content="en_US"><meta property="og:title" content="用 vue2 和 webpack 快速建构 NW.js 项目(2)"><meta property="og:image" content="https://alili.tech/images/logo2.png"><meta property="og:description" content="Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css"><meta property="og:site_name" content="Alili"><title>用 vue2 和 webpack 快速建构 NW.js 项目(2) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!</title><link rel="shortcut icon" href="https://alili.tech/images/favicon.ico"><link rel="manifest" href="/manifest.json"><link rel="stylesheet" href="https://alili.tech/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="https://alili.tech/lib/justified-gallery/justifiedGallery.min.css"><link rel="stylesheet" href="https://alili.tech/css/style.css"><script src="https://alili.tech/lib/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script src="https://alili.tech/lib/jquery/jquery.min.js"></script><script>document.addEventListener("error", function (e) {
			  var elem = e.target;
			  if (elem.tagName.toLowerCase() == 'img') {
				elem.style.display='none'
			  }
			}, true);</script><script type="application/ld+json">{
				"@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
				"@id": "https://alili.tech/archive/wz2b9wm5g8r/",
				"appid": "1613049289050283", 
				"title": "用 vue2 和 webpack 快速建构 NW.js 项目(2) | 前端大爆炸! - WEB BANG! BANG!! BANG!!!", 
				"images": [],
				"pubDate": "2019-01-18T02:30:34"
			}</script></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></span><br><span id="actions"><ul><li><a class="icon" href="https://alili.tech/archive/06kzovqi2sob/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle();' onmouseout='$("#i-prev").toggle();'></i></a></li><li><a class="icon" href="https://alili.tech/archive/8ovkt6e7ybf/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li><li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li><li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li></ul><span id="i-prev" class="info" style="display:none;">Previous post</span> <span id="i-next" class="info" style="display:none;">Next post</span> <span id="i-top" class="info" style="display:none;">Back to top</span> <span id="i-share" class="info" style="display:none;">Share post</span></span><br><div id="share" style="display: none"><ul><li><a class="icon" href="http://v.t.sina.com.cn/share/share.php?u=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&text=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-weibo" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f"><i class="fa fa-facebook" aria-hidden="true"></i></a></li><li><a class="icon" href="https://twitter.com/share?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&text=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-twitter" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&title=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li><li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&is_video=false&description=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-pinterest" aria-hidden="true"></i></a></li><li><a class="icon" href="mailto:?subject=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29&body=Check out this article: https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f"><i class="fa fa-envelope" aria-hidden="true"></i></a></li><li><a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&title=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-get-pocket" aria-hidden="true"></i></a></li><li><a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&title=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-reddit" aria-hidden="true"></i></a></li><li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&title=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-stumbleupon" aria-hidden="true"></i></a></li><li><a class="icon" href="http://digg.com/submit?url=https%3a%2f%2falili.tech%2farchive%2fwz2b9wm5g8r%2f&title=%e7%94%a8%20vue2%20%e5%92%8c%20webpack%20%e5%bf%ab%e9%80%9f%e5%bb%ba%e6%9e%84%20NW.js%20%e9%a1%b9%e7%9b%ae%282%29"><i class="fa fa-digg" aria-hidden="true"></i></a></li></ul></div><div id="toc"><nav id="TableOfContents"><ul><li><a href="#版权声明">版权声明</a><ul><li><a href="#原文标题">原文标题</a></li><li><a href="#原文链接">原文链接</a></li></ul></li></ul></nav></div></span></div><div class="content index width mx-auto px3 my3"><section id="wrapper" class="home"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">用 vue2 和 webpack 快速建构 NW.js 项目(2)</h1><div class="meta"><div class="postdate"><time datetime="2019-01-18" itemprop="datePublished">2019-01-18</time></div><div class="article-tag"><i class="fa fa-eye"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span></span></div><div class="article-tag-box"></div></div></header><div class="content" itemprop="articleBody"><div id="raw"><p style="opacity: 0;">Alili | 前端大爆炸! - WEB BANG! BANG!! BANG!!! 前端大爆炸,一个前端技术博客.想到哪,学到哪,写到哪. 本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有， Alili, 前端大爆炸, WEB BANG BANG BANG, web前端博客, 前端模块化, 前端工程化, 前端数据监控, 性能优化, 网页制作, 前端, js, html5, css, 踩坑小报告, 微前端, 树莓派, 前端开发, 区块链, 网络, Mongodb, Vue.js, Angular.js, node.js</p><script>$(function () {
            var html = "\n\n                    \n\x3ch1 id=\x22articleHeader0\x22\x3e打包NW.js应用和制作windows安装文件\x3c\/h1\x3e\n\x3cp\x3e更新：\x3cbr\x3e此文章部分技术点已落后，可以查看 \x3cstrong\x3e \x3ca href=\x22https:\/\/github.com\/anchengjian\/anchengjian.github.io\/blob\/master\/posts\/2017\/vuejs-webpack-nwjs-2.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e最新文章\x3c\/a\x3e \x3c\/strong\x3e\x3c\/p\x3e\n\x3chr\x3e\n\x3cblockquote\x3e\x3cp\x3e这可能是中文史上最详细的 NW.js 打包教程\x3c\/p\x3e\x3c\/blockquote\x3e\n\x3cp\x3e本文适应有一定 js 基础，第一次玩 windows 下 setup 打包的同学，默认的环境 windows。然后，文章太\x3cstrong\x3e过于详实\x3c\/strong\x3e，看完会耗费大量时间，暂时不想实操的，我会直接提供一个 \x3ca href=\x22https:\/\/github.com\/anchengjian\/vue-nw-seed\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3evue-nw-seed\x3c\/a\x3e 种子项目，包含了当前文章的一些优化点。   \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e本文涉及到的点：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\n\x3cli\x3e\x3cp\x3eNode.js 打包 zip 、文件处理、crypto 提取 MD5 、iconv 处理字符串等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eResource Hacker 配置应用的权限、图标、版权等\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eInnoSetup 制作安装包、iss 文件配置\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3eNW.js 应用的更新（增量、全量更新）\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e...\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ul\x3e\n\x3cp\x3e\x3cstrong\x3e未涉及到的点：\x3c\/strong\x3e\x3c\/p\x3e\n\x3cul\x3e\x3cli\x3e\x3cp\x3e代码加密，本着前端的心态做的桌面端应用，代码 Uglify 后就已经不可看了。如果有机密代码或者加密算法等需要另外考虑，不在本文的讨论范围，提供一个官方文档 \x3ca href=\x22http:\/\/docs.nwjs.io\/en\/latest\/For%20Users\/Advanced\/Protect%20JavaScript%20Source%20Code\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eProtect JavaScript Source Code\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\x3c\/ul\x3e\n\x3ch2 id=\x22articleHeader1\x22\x3e一、折腾能力强，直接上文档\x3c\/h2\x3e\n\x3col\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/nwjs\/nw.js\/wiki\/How-to-package-and-distribute-your-apps\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eHow-to-package-and-distribute-your-apps\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3cli\x3e\x3cp\x3e\x3ca href=\x22https:\/\/github.com\/nwjs\/nw.js\/wiki\/How-to-package-and-distribute-your-apps#setup-on-windows\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3esetup-on-windows\x3c\/a\x3e\x3c\/p\x3e\x3c\/li\x3e\n\x3c\/ol\x3e\n\x3cp\x3e这部分没啥好说的，都很简单。   \x3c\/p\x3e\n\x3cp\x3e对新手友好。。。还有个 NW.js 的打包在 gayhub 上还专门有个 npm 包 \x3ca href=\x22https:\/\/github.com\/nwjs\/nw-builder\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enw-builder\x3c\/a\x3e ，这个用起来就更简单了，我连示例都不想写的那种简单。然后这儿需要下载 NW.js 的 SDK 或者 NORMAL 的包，方法同我上一篇文章 \x3ca href=\x22http:\/\/anchengjian.com\/#\/posts\/2017\/vuejs-webpack-nwjs.md\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e用 vue2 和 webpack 快速建构 NW.js 项目\x3c\/a\x3e 中 \x3ccode\x3e网络不太好\x3c\/code\x3e 部分\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader2\x22\x3e二、自助打包\x3c\/h2\x3e\n\x3cp\x3eNW.js 被打包出来后是一个文件夹，里面有整个 runtime 和一个 exe 文件，这时候整个打包就成功了，差不多有 100MB 左右。  \x3cbr\x3e但是，我们的应用不再是给内部使用，给用户下载总不能直接给用户拷贝一个文件夹或者下载 zip 压缩包，那样忒不靠谱的样子，还以为是啥病毒呢。  \x3c\/p\x3e\n\x3cp\x3e我们能不能就像吃自助餐那样，想吃啥就拿啥，想打包成啥样就弄成啥样。  \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e实现思路\x3c\/strong\x3e  \x3cbr\x3e自己搞一个 runtime，然后用 Node.js 对打包好的代码进行 zip 压缩为 \x3ccode\x3epackage.nw\x3c\/code\x3e，然后放到 runtime 中，再用官方推荐的 InnoSetup 来打包成一个 setup.exe。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader3\x22\x3e1. XP 兼容性问题\x3c\/h3\x3e\n\x3cp\x3e使用 NW.js 的主要优势是兼容 XP，教育行业这个真的很重要呀。。。   \x3cbr\x3eNW.js 不是全版本都支持 XP，由于 Chromium50 开始就不支持XP了，所以如果你的客户端要支持 XP，目前最佳的版本选择是 \x3ccode\x3e0.14.7\x3c\/code\x3e 。参见 NW.js 的博客 \x3ca href=\x22https:\/\/nwjs.io\/blog\/v0.14.7\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eNW.js v0.14.7 (LTS) Released\x3c\/a\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader4\x22\x3e2. 制作一个自己的  runtime\x3c\/h3\x3e\n\x3cp\x3e从官网 \x3ca href=\x22http:\/\/dl.nwjs.io\/v0.14.7\/\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3ehttp:\/\/dl.nwjs.io\/v0.14.7\/\x3c\/a\x3e 下载一个 normal 的包，然后在此基础上进行 DIY。  \x3c\/p\x3e\n\x3cp\x3e大概目录就是这样子\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc35?w=581\x26amp;h=394\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc35?w=581\x26amp;h=394\x22 alt=\x22原始runtime\x22 title=\x22原始runtime\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然后就开始优化和自定义工作：  \x3c\/p\x3e\n\x3cp\x3e1) 先整理下 locales 下的语言包，减少部分冗余。  \x3c\/p\x3e\n\x3cp\x3e2) 替换下 \x3ca href=\x22https:\/\/github.com\/iteufel\/nwjs-ffmpeg-prebuilt\/releases\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3effmpeg.dll\x3c\/a\x3e 解决部分格式 video 的播放问题等，下载的时候注意下版本，和 NW.js 相对应就好。\x3c\/p\x3e\n\x3cp\x3e3) 将 \x3ccode\x3enw.exe\x3c\/code\x3e 改名字为我们的应用的名字，比如\x3ccode\x3emyProgramApp.exe\x3c\/code\x3e，更正规一点。然后用 \x3ccode\x3eResource Hacker\x3c\/code\x3e 修改下版本和版权公司等相关信息。\x3c\/p\x3e\n\x3cp\x3e4) 再用使用 \x3ccode\x3eResource Hacker\x3c\/code\x3e 进行图标替换，建议尺寸是256。\x3c\/p\x3e\n\x3cp\x3e5) 同时为其添加管理员权限。因为我们要做增量更新，需要用 Node.js 写文件到应用所在目录，当安装目录是 \x3ccode\x3eC:\\Program Files\\\x3c\/code\x3e 的时候，普通权限用户没有写权限。  \x3cbr\x3e具体操作还是用 \x3ccode\x3eResource Hacker\x3c\/code\x3e 打开\x3ccode\x3emyProgramApp.exe\x3c\/code\x3e，找到 \x3ccode\x3eManifest\x3c\/code\x3e中\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3crequestedExecutionLevel level=\x26quot;asInvoker\x26quot; uiAccess=\x26quot;false\x26quot;\/\x3e\x3c\/requestedPrivileges\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3erequestedExecutionLevel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elevel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22asInvoker\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euiAccess\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22false\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3erequestedPrivileges\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e修改为\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\x3crequestedExecutionLevel level=\x26quot;requireAdministrator\x26quot; uiAccess=\x26quot;false\x26quot;\/\x3e\x3c\/requestedPrivileges\x3e\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs xml\x22\x3e\x3ccode style=\x22word-break: break-word; white-space: initial;\x22\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\x3cspan class=\x22hljs-name\x22\x3erequestedExecutionLevel\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3elevel\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22requireAdministrator\x22\x3c\/span\x3e \x3cspan class=\x22hljs-attr\x22\x3euiAccess\x3c\/span\x3e=\x3cspan class=\x22hljs-string\x22\x3e\x22false\x22\x3c\/span\x3e\/\x26gt;\x3c\/span\x3e\x3cspan class=\x22hljs-tag\x22\x3e\x26lt;\/\x3cspan class=\x22hljs-name\x22\x3erequestedPrivileges\x3c\/span\x3e\x26gt;\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e弄完了大概是这个样子\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4c?w=581\x26amp;h=388\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4c?w=581\x26amp;h=388\x22 alt=\x22DIY完成的runtime\x22 title=\x22DIY完成的runtime\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader5\x22\x3e3. 用 Node.js 打包 \x3ccode\x3epackage.nw\x3c\/code\x3e\n\x3c\/h3\x3e\n\x3cp\x3e需要一个 zip 处理的依赖 \x3ca href=\x22https:\/\/github.com\/archiverjs\/node-archiver\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3earchiver\x3c\/a\x3e，第一次用这个依赖，建议直接去看他们的英文文档，谨慎使用 \x3ccode\x3ebulk\x3c\/code\x3e 这个方法，在 0.21.0 的时候就被废弃了。  \x3cbr\x3e打包 zip 的方法大概就长这样：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const fs = require(\x27fs\x27)\nconst archive = require(\x27archive\x27)\n\nfunction buildZipFile({ outZipPath, files, mainPackage } = {}) {\n  let filesArr = Array.isArray(files) ? files : [files]\n\n  \/\/ 创建一个可写流的 zip 文件\n  var output = fs.createWriteStream(outZipPath)\n  var archive = archiver(\x27zip\x27, { store: true })\n\n  archive.on(\x27error\x27, console.error)\n\n  \/\/ 打包 dist 目录为 zip 压缩包格式的 nw 文件\n  archive.pipe(output)\n\n  if (filesArr.length \x3e 0) {\n    filesArr.forEach(p =\x3e {\n      if (!p) return\n\n      \/\/ 剔除 package.json\n      let hasPackJson = path.resolve(p, \x27package.json\x27)\n      if (fs.existsSync(hasPackJson)) fs.unlinkSync(hasPackJson)\n\n      \/\/ 压缩目录\n      archive.directory(p, \x27\x27)\n    })\n\n    \/\/ 添加 package.json\n    archive.file(mainPackage, { name: \x27package.json\x27 })\n  }\n\n  archive.finalize()\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e fs = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27fs\x27\x3c\/span\x3e)\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e archive = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27archive\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ebuildZipFile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ outZipPath, files, mainPackage } = {}\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e filesArr = \x3cspan class=\x22hljs-built_in\x22\x3eArray\x3c\/span\x3e.isArray(files) ? files : [files]\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 创建一个可写流的 zip 文件\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e output = fs.createWriteStream(outZipPath)\n  \x3cspan class=\x22hljs-keyword\x22\x3evar\x3c\/span\x3e archive = archiver(\x3cspan class=\x22hljs-string\x22\x3e\x27zip\x27\x3c\/span\x3e, { \x3cspan class=\x22hljs-attr\x22\x3estore\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e })\n\n  archive.on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 打包 dist 目录为 zip 压缩包格式的 nw 文件\x3c\/span\x3e\n  archive.pipe(output)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (filesArr.length \x26gt; \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e) {\n    filesArr.forEach(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ep\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!p) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 剔除 package.json\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hasPackJson = path.resolve(p, \x3cspan class=\x22hljs-string\x22\x3e\x27package.json\x27\x3c\/span\x3e)\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fs.existsSync(hasPackJson)) fs.unlinkSync(hasPackJson)\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 压缩目录\x3c\/span\x3e\n      archive.directory(p, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e)\n    })\n\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 添加 package.json\x3c\/span\x3e\n    archive.file(mainPackage, { \x3cspan class=\x22hljs-attr\x22\x3ename\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27package.json\x27\x3c\/span\x3e })\n  }\n\n  archive.finalize()\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader6\x22\x3e4. InnoSetup 打包安装包\x3c\/h3\x3e\n\x3cp\x3eNode.js 的丰富的生态已经有人提供了一个 \x3ca href=\x22https:\/\/github.com\/felicienfrancois\/node-innosetup-compiler\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3enode-innosetup-compiler\x3c\/a\x3e 了，所以这个也很方便。不过对于我这种第一次玩这个的玩家还是有点懵逼，特别是那个 \x3ccode\x3eiss\x3c\/code\x3e 文件的编写。。。\x3c\/p\x3e\n\x3cp\x3e鉴于本文不想写成 InnoSetup 的使用教程，所以只讲讲普通使用，如果你需要更复杂的功能,给你个文档 \x3ca href=\x22http:\/\/www.jrsoftware.org\/ishelp\/index.php?topic=setup_defaultdirname\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eInno Setup Help\x3c\/a\x3e   \x3c\/p\x3e\n\x3cp\x3e我提供一个我用的 \x3ccode\x3esetup.iss \x3c\/code\x3e 文件，其中用下划线开头（如: _appName ）这种将会被 js 正则匹配掉\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22; Script generated by the Inno Setup Script Wizard.\n; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!\n; 该执行目录为 setup.iss 所在的目录，请注意拼接相对目录\n\n#define MyAppName \x26quot;_appName\x26quot;\n#define MyAppNameZh \x26quot;_appZhName\x26quot;\n#define MyAppVersion \x26quot;_appVersion\x26quot;\n#define MyAppPublisher \x26quot;_appPublisher\x26quot;\n#define MyAppURL \x26quot;_appURL\x26quot;\n#define MyAppExeName \x26quot;_appName.exe\x26quot;\n#define OutputPath \x26quot;_appOutputPath\x26quot;\n#define SourceMain \x26quot;_appRuntimePath\\_appName.exe\x26quot;\n#define SourceFolder \x26quot;_appRuntimePath\\*\x26quot;\n#define LicenseFilePath \x26quot;_appResourcesPath\\license.txt\x26quot;\n#define SetupIconFilePath \x26quot;_appResourcesPath\\_appName.ico\x26quot;\n#define MyAppId \x26quot;_appId\x26quot;\n\n[Setup]\n; NOTE: The value of AppId uniquely identifies this application.\n; Do not use the same AppId value in installers for other applications.\n; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)\nAppId={#MyAppId}\nAppName={#MyAppName}\nAppVersion={#MyAppVersion}\nAppVerName={#MyAppName}\nAppPublisher={#MyAppPublisher}\nAppPublisherURL={#MyAppURL}\nAppSupportURL={#MyAppURL}\nAppUpdatesURL={#MyAppURL}\nDefaultDirName={pf}\\{#MyAppName}\nLicenseFile={#LicenseFilePath}\nOutputDir={#OutputPath}\nOutputBaseFilename={#MyAppName}-v{#MyAppVersion}-setup\nSetupIconFile={#SetupIconFilePath}\nCompression=lzma\nSolidCompression=yes\nPrivilegesRequired=admin\nUninstallable=yes\nUninstallDisplayName={#MyAppNameZh}\nDefaultGroupName={#MyAppNameZh}\n\n[Tasks]\nName: \x26quot;desktopicon\x26quot;; Description: \x26quot;{cm:CreateDesktopIcon}\x26quot;; GroupDescription: \x26quot;{cm:AdditionalIcons}\x26quot;; Flags: checkedonce\n\n[Files]\nSource: {#SourceMain}; DestDir: \x26quot;{app}\x26quot;; Flags: ignoreversion\nSource: {#SourceFolder}; DestDir: \x26quot;{app}\x26quot;; Flags: ignoreversion recursesubdirs createallsubdirs\n\n[Icons]\nName: \x26quot;{commondesktop}\\{#MyAppNameZh}\x26quot;; Filename: \x26quot;{app}\\{#MyAppExeName}\x26quot;; Tasks: desktopicon\nName: \x26quot;{group}\\{#MyAppNameZh}\x26quot;; Filename: \x26quot;{app}\\{#MyAppExeName}\x26quot;\nName: \x26quot;{group}\\卸载{#MyAppNameZh}\x26quot;; Filename: \x26quot;{uninstallexe}\x26quot;\n\n[Languages]\nName: \x26quot;chinese\x26quot;; MessagesFile: \x26quot;innosetup\\Languages\\ChineseSimp.isl\x26quot;\n\n[Run]\nFilename: \x26quot;{app}\\{#MyAppExeName}\x26quot;; Description: \x26quot;{cm:LaunchProgram,{#StringChange(MyAppName, \x27\x26amp;\x27, \x27\x26amp;\x26amp;\x27)\x22}}\x22\x26quot;; Flags: nowait postinstall skipifsilent\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs dts\x22\x3e\x3ccode\x3e; Script generated by the Inno Setup Script Wizard.\n; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!\n; 该执行目录为 setup.iss 所在的目录，请注意拼接相对目录\n\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppName \x3cspan class=\x22hljs-string\x22\x3e\x22_appName\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppNameZh \x3cspan class=\x22hljs-string\x22\x3e\x22_appZhName\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppVersion \x3cspan class=\x22hljs-string\x22\x3e\x22_appVersion\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppPublisher \x3cspan class=\x22hljs-string\x22\x3e\x22_appPublisher\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppURL \x3cspan class=\x22hljs-string\x22\x3e\x22_appURL\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppExeName \x3cspan class=\x22hljs-string\x22\x3e\x22_appName.exe\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e OutputPath \x3cspan class=\x22hljs-string\x22\x3e\x22_appOutputPath\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e SourceMain \x3cspan class=\x22hljs-string\x22\x3e\x22_appRuntimePath\\_appName.exe\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e SourceFolder \x3cspan class=\x22hljs-string\x22\x3e\x22_appRuntimePath\\*\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e LicenseFilePath \x3cspan class=\x22hljs-string\x22\x3e\x22_appResourcesPath\\license.txt\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e SetupIconFilePath \x3cspan class=\x22hljs-string\x22\x3e\x22_appResourcesPath\\_appName.ico\x22\x3c\/span\x3e\x3c\/span\x3e\n\x3cspan class=\x22hljs-meta\x22\x3e#\x3cspan class=\x22hljs-meta-keyword\x22\x3edefine\x3c\/span\x3e MyAppId \x3cspan class=\x22hljs-string\x22\x3e\x22_appId\x22\x3c\/span\x3e\x3c\/span\x3e\n\n[Setup]\n; NOTE: The value of AppId uniquely identifies this application.\n; Do not use the same AppId value in installers for other applications.\n; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)\nAppId={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppId}\x3c\/span\x3e\nAppName={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppName}\x3c\/span\x3e\nAppVersion={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppVersion}\x3c\/span\x3e\nAppVerName={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppName}\x3c\/span\x3e\nAppPublisher={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppPublisher}\x3c\/span\x3e\nAppPublisherURL={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppURL}\x3c\/span\x3e\nAppSupportURL={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppURL}\x3c\/span\x3e\nAppUpdatesURL={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppURL}\x3c\/span\x3e\nDefaultDirName={pf}\\{\x3cspan class=\x22hljs-meta\x22\x3e#MyAppName}\x3c\/span\x3e\nLicenseFile={\x3cspan class=\x22hljs-meta\x22\x3e#LicenseFilePath}\x3c\/span\x3e\nOutputDir={\x3cspan class=\x22hljs-meta\x22\x3e#OutputPath}\x3c\/span\x3e\nOutputBaseFilename={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppName}-v{#MyAppVersion}-setup\x3c\/span\x3e\nSetupIconFile={\x3cspan class=\x22hljs-meta\x22\x3e#SetupIconFilePath}\x3c\/span\x3e\nCompression=lzma\nSolidCompression=yes\nPrivilegesRequired=admin\nUninstallable=yes\nUninstallDisplayName={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppNameZh}\x3c\/span\x3e\nDefaultGroupName={\x3cspan class=\x22hljs-meta\x22\x3e#MyAppNameZh}\x3c\/span\x3e\n\n[Tasks]\n\x3cspan class=\x22hljs-symbol\x22\x3eName:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22desktopicon\x22\x3c\/span\x3e; Description: \x3cspan class=\x22hljs-string\x22\x3e\x22{cm:CreateDesktopIcon}\x22\x3c\/span\x3e; GroupDescription: \x3cspan class=\x22hljs-string\x22\x3e\x22{cm:AdditionalIcons}\x22\x3c\/span\x3e; Flags: checkedonce\n\n[Files]\n\x3cspan class=\x22hljs-symbol\x22\x3eSource:\x3c\/span\x3e {\x3cspan class=\x22hljs-meta\x22\x3e#SourceMain}; DestDir: \x3cspan class=\x22hljs-string\x22\x3e\x22{app}\x22\x3c\/span\x3e; Flags: ignoreversion\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3eSource:\x3c\/span\x3e {\x3cspan class=\x22hljs-meta\x22\x3e#SourceFolder}; DestDir: \x3cspan class=\x22hljs-string\x22\x3e\x22{app}\x22\x3c\/span\x3e; Flags: ignoreversion recursesubdirs createallsubdirs\x3c\/span\x3e\n\n[Icons]\n\x3cspan class=\x22hljs-symbol\x22\x3eName:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22{commondesktop}\\{#MyAppNameZh}\x22\x3c\/span\x3e; Filename: \x3cspan class=\x22hljs-string\x22\x3e\x22{app}\\{#MyAppExeName}\x22\x3c\/span\x3e; Tasks: desktopicon\n\x3cspan class=\x22hljs-symbol\x22\x3eName:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22{group}\\{#MyAppNameZh}\x22\x3c\/span\x3e; Filename: \x3cspan class=\x22hljs-string\x22\x3e\x22{app}\\{#MyAppExeName}\x22\x3c\/span\x3e\n\x3cspan class=\x22hljs-symbol\x22\x3eName:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22{group}\\卸载{#MyAppNameZh}\x22\x3c\/span\x3e; Filename: \x3cspan class=\x22hljs-string\x22\x3e\x22{uninstallexe}\x22\x3c\/span\x3e\n\n[Languages]\n\x3cspan class=\x22hljs-symbol\x22\x3eName:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22chinese\x22\x3c\/span\x3e; MessagesFile: \x3cspan class=\x22hljs-string\x22\x3e\x22innosetup\\Languages\\ChineseSimp.isl\x22\x3c\/span\x3e\n\n[Run]\n\x3cspan class=\x22hljs-symbol\x22\x3eFilename:\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x22{app}\\{#MyAppExeName}\x22\x3c\/span\x3e; Description: \x3cspan class=\x22hljs-string\x22\x3e\x22{cm:LaunchProgram,{#StringChange(MyAppName, \x27\x26amp;\x27, \x27\x26amp;\x26amp;\x27)\x22}}\x22\x22\x3c\/span\x3e; Flags: nowait postinstall skipifsilent\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e创建一个 resources 文件夹，里面放上 icon 和 license，就像这样\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4e?w=225\x26amp;h=164\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4e?w=225\x26amp;h=164\x22 alt=\x22resources目录\x22 title=\x22resources目录\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e再然后此 iss 配合 \x3ccode\x3emakeExeSetup\x3c\/code\x3e 使用，格外酸爽，请忽略那一串 replace，233333333\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 新依赖，用于处理 utf 和 ansi 的字符串\nconst iconv = require(\x27iconv-lite\x27)\n\nfunction makeExeSetup(opt) {\n  const { issPath, outputPath, mainPackage, runtimePath, resourcesPath, appPublisher, appURL, appId } = opt\n  const { name, appName, version } = require(mainPackage)\n  const tmpIssPath = path.resolve(path.parse(issPath).dir, \x27_tmp.iss\x27)\n  const innosetupCompiler = require(\x27innosetup-compiler\x27)\n\n  \/\/ rewrite name, version to iss\n  fs.readFile(issPath, null, (err, text) =\x3e {\n    if (err) throw err\n\n    let str = iconv.decode(text, \x27gbk\x27)\n      .replace(\/_appName\/g, name)\n      .replace(\/_appZhName\/g, appName)\n      .replace(\/_appVersion\/g, version)\n      .replace(\/_appOutputPath\/g, outputPath)\n      .replace(\/_appRuntimePath\/g, runtimePath)\n      .replace(\/_appResourcesPath\/g, resourcesPath)\n      .replace(\/_appPublisher\/g, appPublisher)\n      .replace(\/_appURL\/g, appURL)\n      .replace(\/_appId\/g, appId)\n\n\n    fs.writeFile(tmpIssPath, iconv.encode(str, \x27gbk\x27), null, err =\x3e {\n      if (err) throw err\n\n      \/\/ inno setup start\n      innosetupCompiler(tmpIssPath, { gui: false, verbose: true }, function(err) {\n        fs.unlinkSync(tmpIssPath)\n        if (err) throw err\n      })\n    })\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 新依赖，用于处理 utf 和 ansi 的字符串\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e iconv = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27iconv-lite\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3emakeExeSetup\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eopt\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { issPath, outputPath, mainPackage, runtimePath, resourcesPath, appPublisher, appURL, appId } = opt\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { name, appName, version } = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(mainPackage)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e tmpIssPath = path.resolve(path.parse(issPath).dir, \x3cspan class=\x22hljs-string\x22\x3e\x27_tmp.iss\x27\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e innosetupCompiler = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27innosetup-compiler\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ rewrite name, version to iss\x3c\/span\x3e\n  fs.readFile(issPath, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, (err, text) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err\n\n    \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e str = iconv.decode(text, \x3cspan class=\x22hljs-string\x22\x3e\x27gbk\x27\x3c\/span\x3e)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appName\/g\x3c\/span\x3e, name)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appZhName\/g\x3c\/span\x3e, appName)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appVersion\/g\x3c\/span\x3e, version)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appOutputPath\/g\x3c\/span\x3e, outputPath)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appRuntimePath\/g\x3c\/span\x3e, runtimePath)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appResourcesPath\/g\x3c\/span\x3e, resourcesPath)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appPublisher\/g\x3c\/span\x3e, appPublisher)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appURL\/g\x3c\/span\x3e, appURL)\n      .replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/_appId\/g\x3c\/span\x3e, appId)\n\n\n    fs.writeFile(tmpIssPath, iconv.encode(str, \x3cspan class=\x22hljs-string\x22\x3e\x27gbk\x27\x3c\/span\x3e), \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, err =\x26gt; {\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ inno setup start\x3c\/span\x3e\n      innosetupCompiler(tmpIssPath, { \x3cspan class=\x22hljs-attr\x22\x3egui\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3efalse\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3everbose\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e }, \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eerr\x3c\/span\x3e) \x3c\/span\x3e{\n        fs.unlinkSync(tmpIssPath)\n        \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err\n      })\n    })\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这个时候就能制作出一个安装包了，就像这样\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4k?w=603\x26amp;h=61\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4k?w=603\x26amp;h=61\x22 alt=\x22安装包\x22 title=\x22安装包\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e然后是安装的流程\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4p?w=861\x26amp;h=562\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4p?w=861\x26amp;h=562\x22 alt=\x22安装流程\x22 title=\x22安装流程\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e安装完成的目录\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4u?w=616\x26amp;h=550\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4u?w=616\x26amp;h=550\x22 alt=\x22安装完成的目录\x22 title=\x22安装完成的目录\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader7\x22\x3e三、炫酷的安装界面\x3c\/h2\x3e\n\x3cp\x3e虽然 InnoSetup 简单好使，但是制作出来的安装包的安装界面默认是 windows2000 的界面，那个丑那个老旧哟。。。   \x3c\/p\x3e\n\x3cp\x3e如果你的应用只要能用就行了，那这一步已经完全够了。   \x3cbr\x3e但技术人怎么能不折腾，下面，我们来搞炫酷的安装包的制作方法。   \x3c\/p\x3e\n\x3cp\x3e先摆一个被我模仿的例子 \x3ca href=\x22http:\/\/blog.csdn.net\/HarounCloud\/article\/details\/50613590\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eINNOSETUP 仿有道云安装包界面\x3c\/a\x3e，同时还有个参考资料:\x3ca href=\x22http:\/\/blog.csdn.net\/oceanlucy\/article\/details\/50033773\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3e互联网软件的安装包界面设计-Inno setup\x3c\/a\x3e 真心吐个槽，这方面的资料真少。。。\x3c\/p\x3e\n\x3cp\x3e我其实都按照已有的素材包写好了一个了，但我们的 ui 还没设计出更漂亮的安装界面出来，所以，我就暂时不放相关资源和效果了。\x3c\/p\x3e\n\x3ch2 id=\x22articleHeader8\x22\x3e四、应用的更新\x3c\/h2\x3e\n\x3cp\x3e这一块，应该是最轻松的，蛤。  \x3c\/p\x3e\n\x3cp\x3e我们的更新策略分为两种，一种是只更新我们的业务代码，每次只需要下载1MB多的业务代码就搞定，走增量更新渠道；另一种是更新了我们的 runtime ，或者其他啥玩意的重要更新，需要全量更新，走全量更新的渠道。  \x3c\/p\x3e\n\x3cp\x3e\x3cstrong\x3e实现思路\x3c\/strong\x3e  \x3cbr\x3e在打包的时候把版本和更新信息写入到 \x3ccode\x3eupdate.json\x3c\/code\x3e 中，在每次客户端打开的时候都去请求这个 json ，检查 json 中版本和客户端版本是否匹配，不匹配则根据 json 中的约定规则进行增量更新或全量更新。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader9\x22\x3e1、准备好更新文件\x3c\/h3\x3e\n\x3cp\x3e一个开发原则是能懒就懒，能用工具做的就一定要用工具做。蛤蛤，在这个原则的坚持下，我们来继续优化上文提到的打包建构。  \x3c\/p\x3e\n\x3cp\x3e用 Node.js 把之前临时放在 runtime 中的 package.nw (zip) 包拷贝到 output 目录，再根据 \x3ccode\x3echangelog.txt\x3c\/code\x3e 文件写更新信息到 update.json 中。\x3c\/p\x3e\n\x3cp\x3e准备一个 changelog.txt 文件在 config 配置目录下，大概就长这样子，每次更新以\x3ccode\x3e---\x3c\/code\x3e 进行分割，第一行是版本，后面是更新信息：\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x220.1.0\n- 程序员 peter 开始开发了！\n- 顺便，请老板给 peter 涨工资。\n---\n1.0.0\n- 客户端正式版成功发布啦！\n- 同时，peter 因为要求涨工资已被打残住院中，所以暂时不会有其他更新。\n---\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs asciidoc\x22\x3e\x3ccode\x3e0.1.0\n\x3cspan class=\x22hljs-bullet\x22\x3e- \x3c\/span\x3e程序员 peter 开始开发了！\n\x3cspan class=\x22hljs-section\x22\x3e- 顺便，请老板给 peter 涨工资。\n---\x3c\/span\x3e\n1.0.0\n\x3cspan class=\x22hljs-bullet\x22\x3e- \x3c\/span\x3e客户端正式版成功发布啦！\n\x3cspan class=\x22hljs-section\x22\x3e- 同时，peter 因为要求涨工资已被打残住院中，所以暂时不会有其他更新。\n---\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e有同学问我，为啥要这么设计个 log.txt 出来，不直接用 json 等其他形式进行描述？  \x3cbr\x3e因为这个文件在未来可能要被打包到应用中，连同 license 文件进行打包；还有就是分离这部分描述，更易扩展。  \x3c\/p\x3e\n\x3cp\x3e然后写一读取这个 log 的方法\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22function getLatestLogBycheckVersion({ changelogPath, mainPackage }) {\n  \/\/ get package.json by package\n  const packageJson = require(mainPackage)\n\n  \/\/ check version\n  \/\/ 大于等于3是因为合法的版本信息最少 \x26quot;---\x26quot; 有3个长度\n  const changeLogArr = fs.readFileSync(changelogPath, \x27utf-8\x27).split(\x27---\x27).filter(v =\x3e v.trim().length \x3e= 3)\n  const latestInfo = changeLogArr.pop().split(\x27\\n\x27).map(v =\x3e v.trim()).filter(v =\x3e v.length)\n  const version = latestInfo[0]\n\n  if (packageJson.version !== version) {\n    \/\/ 更新 package.json 的版本\n    packageJson.version = version\n    fs.writeFileSync(mainPackage, JSON.stringify(packageJson, null, \x27  \x27), \x27utf-8\x27)\n  }\n  return latestInfo\n}\n\n\/\/ 这就是全局的 options\nopt.latestLog = getLatestLogBycheckVersion(opt)\n\n\/\/ 更新约定，用来判断当前版本是否需要增量更新\nopt.noIncremental = process.argv.indexOf(\x27--noIncremental\x27) \x3e= 0\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetLatestLogBycheckVersion\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e{ changelogPath, mainPackage }\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ get package.json by package\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e packageJson = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(mainPackage)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ check version\x3c\/span\x3e\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 大于等于3是因为合法的版本信息最少 \x22---\x22 有3个长度\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e changeLogArr = fs.readFileSync(changelogPath, \x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e).split(\x3cspan class=\x22hljs-string\x22\x3e\x27---\x27\x3c\/span\x3e).filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e =\x26gt;\x3c\/span\x3e v.trim().length \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e3\x3c\/span\x3e)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e latestInfo = changeLogArr.pop().split(\x3cspan class=\x22hljs-string\x22\x3e\x27\\n\x27\x3c\/span\x3e).map(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e =\x26gt;\x3c\/span\x3e v.trim()).filter(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ev\x3c\/span\x3e =\x26gt;\x3c\/span\x3e v.length)\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e version = latestInfo[\x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e]\n\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (packageJson.version !== version) {\n    \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新 package.json 的版本\x3c\/span\x3e\n    packageJson.version = version\n    fs.writeFileSync(mainPackage, \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(packageJson, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27  \x27\x3c\/span\x3e), \x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e)\n  }\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e latestInfo\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 这就是全局的 options\x3c\/span\x3e\nopt.latestLog = getLatestLogBycheckVersion(opt)\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 更新约定，用来判断当前版本是否需要增量更新\x3c\/span\x3e\nopt.noIncremental = process.argv.indexOf(\x3cspan class=\x22hljs-string\x22\x3e\x27--noIncremental\x27\x3c\/span\x3e) \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e0\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e\x3cstrong\x3e增量更新的约定\x3c\/strong\x3e  \x3cbr\x3e通过 \x3ccode\x3eprocess.argv\x3c\/code\x3e 来检测当前是否需要增量更新，并写入到 options 中，这一点看起来有点稍微繁琐，如果有其他更好的点子，欢迎踊跃来提 \x3ca href=\x22https:\/\/github.com\/anchengjian\/anchengjian.github.io\/issues\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eissue\x3c\/a\x3e 或者直接私信我，谢谢！  \x3c\/p\x3e\n\x3cp\x3e接下来继续处理打包完成的系列流程，需求是要移动 nw 到 output 目录，还要写一个 update.json\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22const crypto = require(\x27crypto\x27)\n\nfunction finishedPackage(opt) {\n  const { mainPackage, outputPath, latestLog, outZipPath, updateServerPath, noIncremental } = opt\n  const { name, appName, version } = require(mainPackage)\n\n  let versionCode = parseInt(version.replace(\/\\.\/g, \x27\x27))\n  let updateDesc = latestLog.slice(1).join(\x27#%#\x27)\n\n  let outNWName = `${name}-v${version}.nw`\n  let outNWPath = path.resolve(outputPath, outNWName)\n  let updateJsonPath = path.resolve(outputPath, \x27update.json\x27)\n\n  \/\/ write update.json\n  let updateJson = {\n    appName,\n    version,\n    versionCode,\n    requiredVersion: version,\n    requiredVersionCode: versionCode,\n    updateDesc,\n    filePath: updateServerPath \x2b outNWName,\n    incremental: !noIncremental\n  }\n\n  \/\/ fileSize and MD5\n  getMd5ByFile(outZipPath, (err, hexStr) =\x3e {\n    if (err) throw err\n    updateJson.MD5 = hexStr\n    updateJson.fileSize = fs.statSync(outZipPath).size\n    fs.writeFileSync(updateJsonPath, JSON.stringify(updateJson, null, \x27  \x27), \x27utf-8\x27)\n\n    copyFile(outZipPath, outNWPath)\n    fs.unlink(outZipPath, err =\x3e err \x26amp;\x26amp; console.error(err))\n  })\n}\n\nfunction getMd5ByFile(filePath, callback) {\n  let rs = fs.createReadStream(filePath)\n  let hash = crypto.createHash(\x27md5\x27)\n  rs.on(\x27error\x27, err =\x3e {\n    if (typeof callback === \x27function\x27) callback(err)\n  })\n  rs.on(\x27data\x27, hash.update.bind(hash))\n  rs.on(\x27end\x27, () =\x3e {\n    if (typeof callback === \x27function\x27) callback(null, hash.digest(\x27hex\x27))\n  })\n}\n\nfunction copyFile(src, dst) {\n  fs.createReadStream(src).pipe(fs.createWriteStream(dst))\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e crypto = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27crypto\x27\x3c\/span\x3e)\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3efinishedPackage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3eopt\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { mainPackage, outputPath, latestLog, outZipPath, updateServerPath, noIncremental } = opt\n  \x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e { name, appName, version } = \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(mainPackage)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e versionCode = \x3cspan class=\x22hljs-built_in\x22\x3eparseInt\x3c\/span\x3e(version.replace(\x3cspan class=\x22hljs-regexp\x22\x3e\/\\.\/g\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27\x27\x3c\/span\x3e))\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e updateDesc = latestLog.slice(\x3cspan class=\x22hljs-number\x22\x3e1\x3c\/span\x3e).join(\x3cspan class=\x22hljs-string\x22\x3e\x27#%#\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e outNWName = \x3cspan class=\x22hljs-string\x22\x3e`\x3cspan class=\x22hljs-subst\x22\x3e${name}\x3c\/span\x3e-v\x3cspan class=\x22hljs-subst\x22\x3e${version}\x3c\/span\x3e.nw`\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e outNWPath = path.resolve(outputPath, outNWName)\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e updateJsonPath = path.resolve(outputPath, \x3cspan class=\x22hljs-string\x22\x3e\x27update.json\x27\x3c\/span\x3e)\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ write update.json\x3c\/span\x3e\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e updateJson = {\n    appName,\n    version,\n    versionCode,\n    \x3cspan class=\x22hljs-attr\x22\x3erequiredVersion\x3c\/span\x3e: version,\n    \x3cspan class=\x22hljs-attr\x22\x3erequiredVersionCode\x3c\/span\x3e: versionCode,\n    updateDesc,\n    \x3cspan class=\x22hljs-attr\x22\x3efilePath\x3c\/span\x3e: updateServerPath \x2b outNWName,\n    \x3cspan class=\x22hljs-attr\x22\x3eincremental\x3c\/span\x3e: !noIncremental\n  }\n\n  \x3cspan class=\x22hljs-comment\x22\x3e\/\/ fileSize and MD5\x3c\/span\x3e\n  getMd5ByFile(outZipPath, (err, hexStr) =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (err) \x3cspan class=\x22hljs-keyword\x22\x3ethrow\x3c\/span\x3e err\n    updateJson.MD5 = hexStr\n    updateJson.fileSize = fs.statSync(outZipPath).size\n    fs.writeFileSync(updateJsonPath, \x3cspan class=\x22hljs-built_in\x22\x3eJSON\x3c\/span\x3e.stringify(updateJson, \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, \x3cspan class=\x22hljs-string\x22\x3e\x27  \x27\x3c\/span\x3e), \x3cspan class=\x22hljs-string\x22\x3e\x27utf-8\x27\x3c\/span\x3e)\n\n    copyFile(outZipPath, outNWPath)\n    fs.unlink(outZipPath, err =\x26gt; err \x26amp;\x26amp; \x3cspan class=\x22hljs-built_in\x22\x3econsole\x3c\/span\x3e.error(err))\n  })\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetMd5ByFile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3efilePath, callback\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e rs = fs.createReadStream(filePath)\n  \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e hash = crypto.createHash(\x3cspan class=\x22hljs-string\x22\x3e\x27md5\x27\x3c\/span\x3e)\n  rs.on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, err =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e callback === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) callback(err)\n  })\n  rs.on(\x3cspan class=\x22hljs-string\x22\x3e\x27data\x27\x3c\/span\x3e, hash.update.bind(hash))\n  rs.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, () =\x26gt; {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (\x3cspan class=\x22hljs-keyword\x22\x3etypeof\x3c\/span\x3e callback === \x3cspan class=\x22hljs-string\x22\x3e\x27function\x27\x3c\/span\x3e) callback(\x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e, hash.digest(\x3cspan class=\x22hljs-string\x22\x3e\x27hex\x27\x3c\/span\x3e))\n  })\n}\n\n\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3ecopyFile\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3esrc, dst\x3c\/span\x3e) \x3c\/span\x3e{\n  fs.createReadStream(src).pipe(fs.createWriteStream(dst))\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e整个打包完了差不多就这样子了\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4C?w=595\x26amp;h=154\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4C?w=595\x26amp;h=154\x22 alt=\x22output-dir\x22 title=\x22output-dir\x22 style=\x22cursor: pointer;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e那个 update.json 里面的实际内容就是这些\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22{\n  \x26quot;appName\x26quot;: \x26quot;doudou\x26quot;,\n  \x26quot;version\x26quot;: \x26quot;1.0.1-beta19\x26quot;,\n  \x26quot;versionCode\x26quot;: 101,\n  \x26quot;requiredVersion\x26quot;: \x26quot;1.0.1-beta19\x26quot;,\n  \x26quot;requiredVersionCode\x26quot;: 101,\n  \x26quot;updateDesc\x26quot;: \x26quot;- 程序员 peter 无话可说\x26quot;,\n  \x26quot;filePath\x26quot;: \x26quot;http:\/\/upgrade.iclassedu.com\/doudou\/upgrade\/teacher\/doudou-v1.0.1-beta19.nw\x26quot;,\n  \x26quot;incremental\x26quot;: true,\n  \x26quot;MD5\x26quot;: \x26quot;9be46fc8fb04d38449eeb4358c3b5a31\x26quot;,\n  \x26quot;fileSize\x26quot;: 5469\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22json hljs\x22\x3e\x3ccode class=\x22json\x22\x3e{\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22appName\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22doudou\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22version\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.0.1-beta19\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22versionCode\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e101\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22requiredVersion\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x221.0.1-beta19\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22requiredVersionCode\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e101\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22updateDesc\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22- 程序员 peter 无话可说\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22filePath\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x22http:\/\/upgrade.iclassedu.com\/doudou\/upgrade\/teacher\/doudou-v1.0.1-beta19.nw\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22incremental\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22MD5\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x229be46fc8fb04d38449eeb4358c3b5a31\x22\x3c\/span\x3e,\n  \x3cspan class=\x22hljs-attr\x22\x3e\x22fileSize\x22\x3c\/span\x3e: \x3cspan class=\x22hljs-number\x22\x3e5469\x3c\/span\x3e\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader10\x22\x3e2、获取 update.json 并检查更新\x3c\/h3\x3e\n\x3cp\x3e上代码，代码切换到 src 目录中，在我们的应用代码中写上 \x3ccode\x3eutils\/update.js\x3c\/code\x3e 的相关方法。具体的几个小方法，看注释吧。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22import { updateApi } from \x27config\/app\x27\nimport { App } from \x27nw.gui\x27\n\nconst options = { method: \x27GET\x27, mode: \x27cors\x27, credentials: \x27include\x27 }\nlet tmpUpdateJson = null\n\n\/\/ 请求 update.json，返回的是 promise 类型的 json\nexport function getUpdateJson(noCache) {\n  if (!noCache \x26amp;\x26amp; tmpUpdateJson) return new Promise((resolve, reject) =\x3e resolve(tmpUpdateJson))\n  return window.fetch(updateApi \x2b \x27?\x27 \x2b (new Date().getTime()), options)\n    .then(resp =\x3e resp.json())\n    .then(json =\x3e {\n      tmpUpdateJson = json\n      return tmpUpdateJson\n    })\n}\n\n\/\/ 检查版本，如果有更新则跳转到更新页面\nexport function checkUpdate() {\n  getUpdateJson().then(json =\x3e {\n    if (json.version === App.manifest.version) return\n    setTimeout(() =\x3e { window.location.hash = \x27\/update\x27 }, 500)\n  })\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { updateApi } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27config\/app\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { App } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27nw.gui\x27\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-keyword\x22\x3econst\x3c\/span\x3e options = { \x3cspan class=\x22hljs-attr\x22\x3emethod\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27GET\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3emode\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27cors\x27\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecredentials\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27include\x27\x3c\/span\x3e }\n\x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e tmpUpdateJson = \x3cspan class=\x22hljs-literal\x22\x3enull\x3c\/span\x3e\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 请求 update.json，返回的是 promise 类型的 json\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3egetUpdateJson\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3enoCache\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!noCache \x26amp;\x26amp; tmpUpdateJson) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e resolve(tmpUpdateJson))\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.fetch(updateApi \x2b \x3cspan class=\x22hljs-string\x22\x3e\x27?\x27\x3c\/span\x3e \x2b (\x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3eDate\x3c\/span\x3e().getTime()), options)\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3eresp\x3c\/span\x3e =\x26gt;\x3c\/span\x3e resp.json())\n    .then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ejson\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      tmpUpdateJson = json\n      \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e tmpUpdateJson\n    })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 检查版本，如果有更新则跳转到更新页面\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3echeckUpdate\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  getUpdateJson().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ejson\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (json.version === App.manifest.version) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e\n    setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e { \x3cspan class=\x22hljs-built_in\x22\x3ewindow\x3c\/span\x3e.location.hash = \x3cspan class=\x22hljs-string\x22\x3e\x27\/update\x27\x3c\/span\x3e }, \x3cspan class=\x22hljs-number\x22\x3e500\x3c\/span\x3e)\n  })\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e然后在 main.js 中进行更新检查\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 优先更新\nimport { checkUpdate } from \x27@\/utils\/update\x27\nif (process.env.NODE_ENV !== \x27development\x27) checkUpdate()\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 优先更新\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eimport\x3c\/span\x3e { checkUpdate } \x3cspan class=\x22hljs-keyword\x22\x3efrom\x3c\/span\x3e \x3cspan class=\x22hljs-string\x22\x3e\x27@\/utils\/update\x27\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (process.env.NODE_ENV !== \x3cspan class=\x22hljs-string\x22\x3e\x27development\x27\x3c\/span\x3e) checkUpdate()\x3c\/code\x3e\x3c\/pre\x3e\n\x3ch3 id=\x22articleHeader11\x22\x3e3、更新\x3c\/h3\x3e\n\x3cp\x3e在上面的基础上做增量更新，基本思路就是用 Node.js 去下载 nw 包到应用所在的目录，并直接替换掉原有的 package.nw ，再重启一下自己就搞定了；全量更新的话，就直接打开应用的下载页面，让用户自行下载覆盖安装就搞定了。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22\/\/ 下载 nw 包\nexport function updatePackage() {\n  return new Promise((resolve, reject) =\x3e {\n    getUpdateJson().then(json =\x3e {\n      \/\/ 全量更新\n      if (!json.incremental) {\n        Shell.openExternal(getSetupApi)\n        return reject({ message: \x27请下载最新版本，再覆盖安装\x27 })\n      }\n\n      \/\/ 增量更新\n      let packageZip = fs.createWriteStream(tmpNWPath)\n      http\n        .get(json.filePath, res =\x3e {\n          if (res.statusCode \x3c 200 || res.statusCode \x3e= 300) return reject({ message: \x27下载出错，请稍后重试\x27 })\n          res.on(\x27end\x27, () =\x3e {\n            if (fs.statSync(tmpNWPath).size \x3c 10) return reject({ message: \x27更新包出错，请稍后重试\x27 })\n            fs.renameSync(tmpNWPath, appPath)\n            resolve(json)\n          })\n          res.pipe(packageZip)\n        })\n        .on(\x27error\x27, reject)\n    })\n  })\n}\n\n\/\/ 重启自己\nexport function restartSelf(waitTime) {\n  setTimeout(() =\x3e {\n    require(\x27child_process\x27).spawn(\x27restart.bat\x27, [], { detached: true, cwd: rootPath })\n  }, ~~waitTime || 2000)\n}\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22javascript hljs\x22\x3e\x3ccode class=\x22javascript\x22\x3e\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 下载 nw 包\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3eupdatePackage\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3e\x3c\/span\x3e) \x3c\/span\x3e{\n  \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e \x3cspan class=\x22hljs-keyword\x22\x3enew\x3c\/span\x3e \x3cspan class=\x22hljs-built_in\x22\x3ePromise\x3c\/span\x3e(\x3cspan class=\x22hljs-function\x22\x3e(\x3cspan class=\x22hljs-params\x22\x3eresolve, reject\x3c\/span\x3e) =\x26gt;\x3c\/span\x3e {\n    getUpdateJson().then(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3ejson\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 全量更新\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (!json.incremental) {\n        Shell.openExternal(getSetupApi)\n        \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject({ \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27请下载最新版本，再覆盖安装\x27\x3c\/span\x3e })\n      }\n\n      \x3cspan class=\x22hljs-comment\x22\x3e\/\/ 增量更新\x3c\/span\x3e\n      \x3cspan class=\x22hljs-keyword\x22\x3elet\x3c\/span\x3e packageZip = fs.createWriteStream(tmpNWPath)\n      http\n        .get(json.filePath, res =\x26gt; {\n          \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (res.statusCode \x26lt; \x3cspan class=\x22hljs-number\x22\x3e200\x3c\/span\x3e || res.statusCode \x26gt;= \x3cspan class=\x22hljs-number\x22\x3e300\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject({ \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27下载出错，请稍后重试\x27\x3c\/span\x3e })\n          res.on(\x3cspan class=\x22hljs-string\x22\x3e\x27end\x27\x3c\/span\x3e, () =\x26gt; {\n            \x3cspan class=\x22hljs-keyword\x22\x3eif\x3c\/span\x3e (fs.statSync(tmpNWPath).size \x26lt; \x3cspan class=\x22hljs-number\x22\x3e10\x3c\/span\x3e) \x3cspan class=\x22hljs-keyword\x22\x3ereturn\x3c\/span\x3e reject({ \x3cspan class=\x22hljs-attr\x22\x3emessage\x3c\/span\x3e: \x3cspan class=\x22hljs-string\x22\x3e\x27更新包出错，请稍后重试\x27\x3c\/span\x3e })\n            fs.renameSync(tmpNWPath, appPath)\n            resolve(json)\n          })\n          res.pipe(packageZip)\n        })\n        .on(\x3cspan class=\x22hljs-string\x22\x3e\x27error\x27\x3c\/span\x3e, reject)\n    })\n  })\n}\n\n\x3cspan class=\x22hljs-comment\x22\x3e\/\/ 重启自己\x3c\/span\x3e\n\x3cspan class=\x22hljs-keyword\x22\x3eexport\x3c\/span\x3e \x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-keyword\x22\x3efunction\x3c\/span\x3e \x3cspan class=\x22hljs-title\x22\x3erestartSelf\x3c\/span\x3e(\x3cspan class=\x22hljs-params\x22\x3ewaitTime\x3c\/span\x3e) \x3c\/span\x3e{\n  setTimeout(\x3cspan class=\x22hljs-function\x22\x3e\x3cspan class=\x22hljs-params\x22\x3e()\x3c\/span\x3e =\x26gt;\x3c\/span\x3e {\n    \x3cspan class=\x22hljs-built_in\x22\x3erequire\x3c\/span\x3e(\x3cspan class=\x22hljs-string\x22\x3e\x27child_process\x27\x3c\/span\x3e).spawn(\x3cspan class=\x22hljs-string\x22\x3e\x27restart.bat\x27\x3c\/span\x3e, [], { \x3cspan class=\x22hljs-attr\x22\x3edetached\x3c\/span\x3e: \x3cspan class=\x22hljs-literal\x22\x3etrue\x3c\/span\x3e, \x3cspan class=\x22hljs-attr\x22\x3ecwd\x3c\/span\x3e: rootPath })\n  }, ~~waitTime || \x3cspan class=\x22hljs-number\x22\x3e2000\x3c\/span\x3e)\n}\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e这儿有个小小的 hack ，仔细看看代码的同学应该已经发现了 \x3ccode\x3erestart.bat\x3c\/code\x3e 。我尝试了很多办法，想让 NW.exe 重启自己，最终多番尝试后失败了。。。就写了个 bat 来重启自己。\x3c\/p\x3e\n\x3cdiv class=\x22widget-codetool\x22 style=\x22display:none;\x22\x3e\n      \x3cdiv class=\x22widget-codetool--inner\x22\x3e\n      \x3cspan class=\x22selectCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22全选\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22copyCode code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 data-clipboard-text=\x22taskkill \/im doudou.exe \/f\nstart .\\doudou.exe\nexit\x22 title=\x22\x22 data-original-title=\x22复制\x22\x3e\x3c\/span\x3e\n      \x3cspan type=\x22button\x22 class=\x22saveToNote code-tool\x22 data-toggle=\x22tooltip\x22 data-placement=\x22top\x22 title=\x22\x22 data-original-title=\x22放进笔记\x22\x3e\x3c\/span\x3e\n      \x3c\/div\x3e\n      \x3c\/div\x3e\x3cpre class=\x22hljs awk\x22\x3e\x3ccode class=\x22bat\x22\x3etaskkill \x3cspan class=\x22hljs-regexp\x22\x3e\/im doudou.exe \/\x3c\/span\x3ef\nstart .\\doudou.exe\n\x3cspan class=\x22hljs-keyword\x22\x3eexit\x3c\/span\x3e\x3c\/code\x3e\x3c\/pre\x3e\n\x3cp\x3e如果有其他更好的办法，欢迎踊跃来提 \x3ca href=\x22https:\/\/github.com\/anchengjian\/anchengjian.github.io\/issues\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3eissue\x3c\/a\x3e 或者直接私信我，谢谢！  \x3c\/p\x3e\n\x3cp\x3e可能会有同学会问，为啥不直接下载 exe 包下来，再打开引导安装？  \x3cbr\x3e我试过了，当应用被安装在 \x3ccode\x3eC:\\Program Files\x3c\/code\x3e 目录里面，管理员权限都不能写 \x3ccode\x3e.exe\x3c\/code\x3e 后缀的文件进去。。。所以，我干脆用浏览器打开我们的应用的下载页，让用户自己去下载后，自己安装算了。这儿应该可以优化，下载到 用户数据目录，或者其他临时目录。\x3c\/p\x3e\n\x3ch3 id=\x22articleHeader12\x22\x3e4、update 页面\x3c\/h3\x3e\n\x3cp\x3e这个页面就没啥技术点，就是体力劳动了。根据前面 \x3ccode\x3egetUpdateJson\x3c\/code\x3e 方法获得的 json 来渲染出要更新的版本和更新信息，然后提供一个更新按钮，按钮点击后，执行 \x3ccode\x3eupdatePackage\x3c\/code\x3e 这个方法，如果顺利执行就在 then 里面调用 \x3ccode\x3erestartSelf\x3c\/code\x3e 重启自己就行了。\x3c\/p\x3e\n\x3cp\x3e整体效果就是这样的\x3cbr\x3e\x3cspan class=\x22img-wrap\x22\x3e\x3cimg data-src=\x22\/img\/bVLc4J?w=913\x26amp;h=604\x22 src=\x22https:\/\/static.alili.tech\/img\/bVLc4J?w=913\x26amp;h=604\x22 alt=\x22更新效果\x22 title=\x22更新效果\x22 style=\x22cursor: pointer; display: inline;\x22\x3e\x3c\/span\x3e\x3c\/p\x3e\n\x3cp\x3e如果对您有用，帮我点个 \x3ca href=\x22https:\/\/github.com\/anchengjian\/anchengjian.github.io\x22 rel=\x22nofollow noreferrer\x22 target=\x22_blank\x22\x3estar\x3c\/a\x3e ，谢谢！您的支持是我继续更新下去的动力。\x3c\/p\x3e\n\n                \n"
            html = html.replace(/"{/g, "{")
            html = html.replace(/{"/g, "{")
            html = html.replace(/"}/g, "}")
            html = html.replace(/}"/g, "}")
            $('#raw').html(html);

            let postTitle =  $('.posttitle').text()
            let postContentTitle =  $('#raw > h1').text()
            if(postTitle === postContentTitle){
                $('#raw > h1').hide()
            }
            $('button.preview').hide()
        })</script></div><h1 id="版权声明">版权声明</h1><p>本文资源来源互联网，仅供学习研究使用，版权归该资源的合法拥有者所有，</p><p>本文仅用于学习、研究和交流目的。转载请注明出处、完整链接以及原作者。</p><p>原作者若认为本站侵犯了您的版权，请联系我们，我们会立即删除！</p><h2 id="原文标题">原文标题</h2><p>用 vue2 和 webpack 快速建构 NW.js 项目(2)</p><h2 id="原文链接">原文链接</h2><p><a href="https://segmentfault.com/a/1190000008829356">https://segmentfault.com/a/1190000008829356</a></p><h2>本文链接：</h2><a href="https://alili.tech/archive/wz2b9wm5g8r/" target="_blank">https://alili.tech/archive/wz2b9wm5g8r/</a></div></article><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><div class="blog-post-comments"></div><script>new Valine({
        el: '.blog-post-comments', 
        app_id: 'ItyOVb4I33bTwprf3cY6uqMc-gzGzoHsz', 
        app_key: 'hLhtmd4tT0qJbyO2SgQ8odya', 
        placeholder: '说点什么?', 
        avatar:'robohash',
        notify:true,
        verify:true
    });</script><ul id="more-post-list" class="archive readmore"><h3>其他推荐</h3><li><a href="/archive/5ed53lrrg7e/">如何禁止浏览器自动填充<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/gij1sdp355j/">实践是检验程序员的唯一标准02：用户不想跟你说话并向你扔出一张图片 - 图片上传组件开发【开发篇】<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/y9eqaypgij/">123<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/4ho25kya1mg/">2018你成长了么？一份给你的前端技术清单<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/g2lx7wrrhy4/">Apache、Nginx 与 Node.js 之争 —— WordPress 与 Ghost 的性能大对决<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/dfejr0q89no/">CSS单位em是相对于父元素还是当前元素的字体大小？<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/cik25m3bh7m/">ES6 系列之 Babel 将 Generator 编译成了什么样子<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/vwkme203i7/">ES6 系列之异步处理实战<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/q2at4ffqrr/">Hola～ 一款基于Electron的聊天软件<aside class="dates">2019-02-15</aside></a></li><li><a href="/archive/t2mci6htsdn/">JavaScript 数组操作方法小结<aside class="dates">2019-02-15</aside></a></li></ul></section></div><footer id="footer"><div class="footer-left">Copyright © 2019 Fan <a href="http://www.miitbeian.gov.cn" rel="external nofollow noopener noreferrer" target="_blank">浙ICP备18045521号</a></div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archive/">Archives</a></li><li><a href="/about/">About</a></li><li><a href="http://github.com/Fantasy9527" target="_blank">Github</a></li></ul></nav></div></footer><script src="https://alili.tech/lib/justified-gallery/jquery.justifiedGallery.min.js"></script><script src="https://alili.tech/lib/typed.js"></script><script src="https://alili.tech/js/main.js"></script><script async src=""></script><script>(function(){
  if(location.host!=='alili.tech')return;
  var ga = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  ga.src = 'https://www.googletagmanager.com/gtag/js?id=UA-129382678-1';       
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(ga, s);
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129382678-1');
})()</script><script>(function(){
    if(location.host!=='alili.tech')return;
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
          navigator.serviceWorker
              .register('/sw.js')
              .then(registration => {
                  console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                  console.log('SW registration failed: ', registrationError);
              });
      });
  }</script></body></html>